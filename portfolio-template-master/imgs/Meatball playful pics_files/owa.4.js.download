self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.4.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[4],{281:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return a}));var r=n(186),o=null,c=3e4;function i(){return null==o&&(o=new r.Cache),o}function u(e){return i().get(e)}function s(e){return i().del(e)}function a(e,t){i().put(e,t,c)}},440:function(e,t,n){"use strict";n.r(t);var r=n(524),o=n(1),c=n(186),i=n(201),u=n(135),s=n(289),a=n(44),l="OWA_GetDelegationAccessToken",d={};function f(e){return Object(o.c)(this,void 0,void 0,(function(){var t,n;return Object(o.f)(this,(function(r){switch(r.label){case 0:t=encodeURIComponent(e.client_id+e.scope+e.requestId),n={},r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,h(e,window,t)];case 2:return n=r.sent(),[3,5];case 3:return r.sent(),n.TokenResultCode=2,[3,5];case 4:return function(e,t){var n=t.document.getElementById(e);null!=n&&(n.removeEventListener("load",d[e]),t.document.body.removeChild(n),delete d[e])}(t,window),[7];case 5:return[2,n]}}))}))}function h(e,t,n){return Object(o.c)(this,void 0,void 0,(function(){var r,c;return Object(o.f)(this,(function(o){return r=function(e){var t={response_type:"token",prompt:"none",redirect_uri:e.redirect_uri,scope:e.scope,client_id:e.client_id};return e.authorization_uri+"?"+i.stringify(t)}(e),t.document.getElementById(n)?[2,{TokenResultCode:2}]:((c=t.document.createElement("iframe")).src=r.toString(),c.style.display="none",c.id=n,t.document.body.appendChild(c),[2,new Promise((function(r,o){d[n]=function(n){var u={};try{c.contentWindow&&c.contentWindow.location.host==t.location.host&&(u=function(e,t){var n=i.parse(e),r={};n.access_token?(r.AccessToken=n.access_token,r.AccessTokenExpiry=Object(s.a)(Date.now(),parseInt(n.expires_in)).toISOString(),r.TokenResultCode=0):"login_required"==n.error||"interaction_required"==n.error||"consent_required"==n.error?(r.TokenResultCode=3,Object(a.h)(l+" MSA Failure Unauthorized",{error:n.error,param:e,requestId:t})):(r.TokenResultCode=2,Object(a.h)(l+" MSA Failure",{error:n.error,param:e,requestId:t}));return r}(c.contentWindow.location.hash.substring(1),e.requestId))}catch(t){Object(a.h)(l+" Hash Param Parsing Failure ",{err:t.toString(),message:t.message,stk:t.stack||"",scope:e.scope,uri:e.redirect_uri,requestId:e.requestId}),u.TokenResultCode=2,o(u)}r(u)},c.addEventListener("load",d[n],!1)}))])}))}))}var b,v=n(24),p=n(281),T=n(518),k=3,O=1500;function A(e){return new Promise((function(t,n){(null==b&&(b=new T.a(k,j,O)),b).add({onFulfilled:t,onRejected:n,options:e})}))}function j(e){return f(e.options).then((function(t){e.onFulfilled(t)})).catch((function(t){e.onRejected(t)})),Promise.resolve()}var g=n(159),m=n(203),w=null,_="OWA_GetDelegationAccessToken",I="https://login.live.com/oauth20_authorize.srf",R="/owa/auth/dt.aspx",C="292841";function y(e,t,n){return Object(o.c)(this,void 0,void 0,(function(){var r,c,s,l,d;return Object(o.f)(this,(function(o){switch(o.label){case 0:r={scope:e,client_id:"",authorization_uri:"",redirect_uri:"",requestId:n||Object(m.a)()},o.label=1;case 1:return o.trys.push([1,7,,8]),Object(v.i)("auth-disableGetAuthenticationCall")?[4,E(q(r))]:[3,3];case 2:return c=o.sent(),[3,6];case 3:return[4,Object(u.a)({})];case 4:return 0!=(s=o.sent()).ResultCode||null==s.ImplicitGrantAuthorizationUrl||""==s.ImplicitGrantAuthorizationUrl?(Object(a.h)(_+" ImplicitGrantAuthorizationUrl is empty or null ",{scope:e,correlationId:r.requestId}),[2,c]):(l=i.parse(s.ImplicitGrantAuthorizationUrl.split("?")[1]||"")).client_id&&l.redirect_uri?(r.client_id=l.client_id,r.authorization_uri=s.ImplicitGrantAuthorizationUrl.split("?")[0],r.redirect_uri=l.redirect_uri,[4,E(r,t)]):[3,6];case 5:c=o.sent(),o.label=6;case 6:return[2,c];case 7:return d=o.sent(),Object(a.h)(_+" GetDelegationToken Operation failed ",{err:d.toString(),message:d.message,stk:d.stack||"",scope:e,requestId:r.requestId,api:t}),[2,c];case 8:return[2]}}))}))}function E(e,t){return Object(o.c)(this,void 0,void 0,(function(){var n,r,c,i;return Object(o.f)(this,(function(o){switch(o.label){case 0:return n=e.client_id+e.scope,(null==(r=function(e,t){var n=e.get(t),r=void 0;if(null==n?void 0:n.AccessTokenExpiry){new Date(n.AccessTokenExpiry)>new Date(Date.now())&&(r=n)}return r}(D(),n))?void 0:r.AccessToken)?[2,r.AccessToken]:[3,1];case 1:return Object(v.i)("auth-getDelegationTokenQueueEnabled")?(c=Object(p.a)(n),i=void 0,c?i=c:(i=A(e),Object(p.b)(n,i)),[2,i.then((function(e){return S(n,e),Object(p.c)(n),e.AccessToken})).catch((function(r){Object(p.c)(n),Object(a.h)(_,{category:"Promise_For_Token_Request_Failed",err:r?r.toString():"",message:r?r.message:"",scope:e.scope,requestId:e.requestId,api:t})}))]):[3,2];case 2:return[4,f(e)];case 3:return r=o.sent(),S(n,r),[2,0==r.TokenResultCode?r.AccessToken:void 0]}}))}))}function S(e,t){if(t&&0==t.TokenResultCode&&t.AccessTokenExpiry){var n=new Date(t.AccessTokenExpiry).getTime()-Date.now();n>0&&D().put(e,t,n)}}function D(){return null==w&&(w=new c.Cache),w}function q(e){return e.redirect_uri=Object(g.a)()+R,e.authorization_uri=I,e.client_id=C,e}var x=n(10),U=n(478);var F=!1;function P(){var e;F||(e=Object(U.a)("/owa"),Object(x.b)({baseUrl:e}),F=!0)}var z={NoUserLogin:"AADSTS50058",InvalidResourceUrl:"AADSTS50001",NoPreAuth:"AADSTS65001",UserAborted:"AADSTS65004",NotConsent:"AADSTS70011"};function G(e,t,n,r,o){n?e.acquireTokenPopup(t,null,n,o):e.acquireToken(t,(function(n,c){n&&n.indexOf(z.NoPreAuth)>=0&&r?e.acquireTokenPopup(t,null,null,o):o(n,c)}))}var N=n(31),L=new N.c((function(){return n.e(523).then(n.bind(null,18570))})),W=new N.a(L,(function(e){return e.createAdalAuthenticationContext}));function B(){return Object(o.c)(this,void 0,void 0,(function(){var e,t,n,r;return Object(o.f)(this,(function(o){switch(o.label){case 0:return e="https://login.microsoftonline.com/",[4,Object(u.a)({})];case 1:return 0===(null==(t=o.sent())?void 0:t.ResultCode)&&(null==t?void 0:t.AuthenticationUrl)&&(r=t.AuthenticationUrl.split("/"),n=r[0]+"//"+r[2]+"/"),[2,n||e]}}))}))}var H=function(e,t,n,r,o){return function(c,i){c||!i?o(c,null):(e.getCachedUser(),G(e,t,n,r,o))}},Q="adalIdTokenFrame";function M(e,t,n,r,o){e.config.displayCall=function(c){!function(e){if(-1==e.indexOf("?"))throw new Error("Invalid Url in Adal Auth Context Display Call")}(c),window.detectUserCachedCallback=H(e,t,n,r,o),function(e,t){e._addAdalFrame(Q).src="about:blank",e._loadFrame(t+"&prompt=none",Q)}(e,c)},e.login()}var $=n(19);function J(e,t,n,r,c,i){var u,s;return Object(o.c)(this,void 0,void 0,(function(){var a,l,d,f,h;return Object(o.f)(this,(function(o){switch(o.label){case 0:return[4,B()];case 1:return a=o.sent(),[4,W.importAndExecute(a,e,t)];case 2:return l=o.sent(),d=Object($.a)(),f=null===(u=d.SessionSettings)||void 0===u?void 0:u.UserPrincipalName,h=null===(s=d.SessionSettings)||void 0===s?void 0:s.UserEmailAddress,l._user={profile:{upn:f||h}},l.getCachedUser()?G(l,n,r,c,i):M(l,n,r,c,i),[2]}}))}))}n.d(t,"getAccessTokenforResource",(function(){return r.b})),n.d(t,"getAccessTokenforResourceAsLazy",(function(){return r.c})),n.d(t,"getDelegationTokenForOwa",(function(){return y})),n.d(t,"bootstrap",(function(){return P})),n.d(t,"getAccessTokenOnBehalfOfResource",(function(){return J})),n.d(t,"AdalErrorCode",(function(){return z}))},524:function(e,t,n){"use strict";var r=n(1),o=n(186),c=n(262),i=n(289);function u(e){return Object(r.a)({__type:"TokenRequest:#Exchange"},e)}var s=n(146),a=n(33);function l(e,t){return void 0===e||e.__type||(e=u(e)),Object(a.a)("GetAccessTokenforResource",e,t)}var d=n(326),f=n(159),h=n(154),b=n(210),v="OWA_GetAccessTokenForResource";function p(e,t,n,o,c,s,a){var p,T;return Object(r.c)(this,void 0,void 0,(function(){var k,O,A,j,g,m;return Object(r.f)(this,(function(r){switch(r.label){case 0:return[4,Object(d.a)()];case 1:return(k=r.sent())&&e==Object(f.a)()?[2,{AccessToken:k}]:Object(b.a)("opxComponentLifecycle")?(O=Object(h.a)(),(A=O.isResourceTokenPrefetchEnabled)?[4,O.isResourceTokenPrefetchEnabled()]:[3,3]):[3,6];case 2:A=r.sent(),r.label=3;case 3:return A?(g=O.getResourceToken)?[4,O.getResourceToken(e,s)]:[3,5]:[3,6];case 4:g=r.sent(),r.label=5;case 5:if((j=g)&&j.length>0&&"bearer"===(null===(p=j.split(" ")[0])||void 0===p?void 0:p.toLowerCase())&&(null===(T=j.split(" ")[1])||void 0===T?void 0:T.length)>0)return[2,{AccessToken:j.split(" ")[1],TokenResultCode:0,ExpiresIn:3600,AccessTokenExpiry:Object(i.a)(Date.now(),3600).toISOString()}];r.label=6;case 6:return m={isUserActivity:!1,datapoint:{customData:{Scenario:v,Resource_Url:e,Retry_attempt:t,Request_Id:n,Target_Tenant_Id:c||"",Api:o||""},headersCustomData:function(e){return{TokenResultDetails:e.get("x-tokenresult")||""}},jsonCustomData:function(e){var t;return{TokenStatus:(null===(t=null==e?void 0:e.TokenResultCode)||void 0===t?void 0:t.toString())||2}}},returnFullResponseOnSuccess:!0},[4,l(u({Resource:e,UserToken:k,TargetTenantId:c,PreferIdpToken:a}),m)];case 7:return[4,r.sent().json()];case 8:return[2,r.sent()]}}))}))}function T(e,t,n,o,c,i,u,a){return Object(r.c)(this,void 0,void 0,(function(){return Object(r.f)(this,(function(r){return t<1?[2,Promise.reject()]:[2,p(e,t,o,c,i,u,a).catch((function(r){return Object(s.a)(n).then((function(){return T(e,t-1,2*n,o,c,i,u,a)}))}))]}))}))}var k,O=n(24),A=n(518),j=3,g=500;function m(e,t,n,r){return new Promise((function(o,c){(null==k&&(k=new A.a(j,w,g)),k).add({onFulfilled:o,onRejected:c,resource:e,requestId:t,apiName:n,targetTenantId:r})}))}function w(e){return F(e.resource,e.apiName,e.requestId,e.targetTenantId).then((function(t){e.onFulfilled(t)})).catch((function(t){e.onRejected(t)})),Promise.resolve()}var _=n(281),I=n(44),R=n(203);function C(e){return{error:{subErrorCode:null==e?void 0:e.SubErrorCode},accessToken:null==e?void 0:e.AccessToken}}n.d(t,"b",(function(){return x})),n.d(t,"c",(function(){return U})),n.d(t,"a",(function(){return F}));var y=1,E=8e3,S=3,D=1500,q=null;function x(e,t,n,o,c,i){return Object(r.c)(this,void 0,void 0,(function(){var u,s;return Object(r.f)(this,(function(r){switch(r.label){case 0:return n=n||Object(R.a)(),u=G(e,o,i),c||(s=P(z(),u)),null!=s?[3,2]:[4,F(e,t,n,o,c,i)];case 1:s=r.sent(),r.label=2;case 2:return[2,null!=s?s.AccessToken:void 0]}}))}))}function U(e,t,n,r,o,c,i){n=n||Object(R.a)();var u,s=G(e,r,i);if(o||(u=P(z(),s)),u)return[c?C(u):u.AccessToken,void 0];if(Object(O.i)("auth-getAccessTokenQueueEnabled")){var a=Object(_.a)(s),l=void 0;return a?l=a:(l=m(e,n,t,r),Object(_.b)(s,l)),[void 0,l.then((function(e){return Object(_.c)(s),c?C(e):e.AccessToken})).catch((function(i){Object(_.c)(s),Object(I.h)(v,{category:"Promise_For_Token_Request_Failed",err:i?i.toString():"",message:i?i.message:"",stk:i?i.stack:"",resource:e,requestId:n,targetTenantId:r||"",api:t,wwwAuthenticateHeader:o||"",showFullTokenResponse:c||!1})}))]}return[void 0,F(e,t,n,r,o,i).then((function(e){return c?C(e):null==e?void 0:e.AccessToken}))]}function F(e,t,n,o,c,u){return Object(r.c)(this,void 0,void 0,(function(){var s,a,l,d;return Object(r.f)(this,(function(r){switch(r.label){case 0:return Object(O.i)("auth-getAccessTokenQueueEnabled")?[4,T(e,S,D,n,t,o,c,u)]:[3,2];case 1:return a=r.sent(),[3,4];case 2:return[4,p(e,S,n,t,o,c,u)];case 3:a=r.sent(),r.label=4;case 4:return null!=(s=a)&&0==s.TokenResultCode&&null!=s.AccessTokenExpiry&&(s.ExpiresIn&&s.ExpiresIn>0&&(s.AccessTokenExpiry=Object(i.a)(Date.now(),s.ExpiresIn).toISOString()),l=G(e,o,u),(d=new Date(s.AccessTokenExpiry).getTime()-Date.now()-E)>0&&z().put(l,s,d,(function(r,i){F(e,t,n,o,c,u).catch((function(e){Object(I.h)(v,{category:"Cache_Expired",err:e?e.toString():"",message:e?e.message:"",stk:e?e.stack:"",resource:r,requestId:n,targetTenantId:o||"",api:t,wwwAuthenticateHeader:c||"",preferIdpToken:u})}))}))),[2,s]}}))}))}function P(e,t){var n=e.get(t),r=void 0;(null==n?void 0:n.AccessTokenExpiry)&&n.AccessToken&&(Object(c.a)(new Date(n.AccessTokenExpiry),-y)>new Date(Date.now())&&(r=n));return r}function z(){return null==q&&(q=new o.Cache),q}function G(e,t,n){var r=e;return t&&(r+="|"+t),n&&(r+="|IdpToken"),r}}}]);
//# sourceMappingURL=owa.4.js.map
self.scriptsLoaded['owa.4.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.4.js'] = (new Date()).getTime();