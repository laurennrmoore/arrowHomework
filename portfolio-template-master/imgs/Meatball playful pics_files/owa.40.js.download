self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.40.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[40],{1110:function(e,t,n){"use strict";var r=n(536),c=n(896),a=n(479),o=Object(c.a)((function(e,t,n,c){Object(r.a)(t,Object(a.a)(t),e,c)}));t.a=o},1403:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(2),c=Object(r.action)("logCacheUpdateForDiagnostics",(function(e){return{cacheUpdateLog:e}}))},199:function(e,t,n){"use strict";n.d(t,"g",(function(){return o})),n.d(t,"d",(function(){return u})),n.d(t,"e",(function(){return i})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return f})),n.d(t,"f",(function(){return d})),n.d(t,"a",(function(){return l})),n.d(t,"h",(function(){return v}));var r=n(1),c=n(268),a=n(269);function o(e,t){var n=Object(c.a)().calendarFolderEvents.get(t);return n?n.locksInfo.get(e):null}function u(e){var t=d(e);return t?Object(r.j)([],Object(r.g)(t.locksInfo.entries())).reduce(Object(a.c)(),[]):[]}function i(e){var t=d(e);return t?Object(r.j)([],Object(r.g)(t.locksInfo.entries())).reduce(Object(a.d)(),{}):{}}function s(e,t){var n=d(e);return n?Object(r.j)([],Object(r.g)(n.locksInfo.entries())).reduce(Object(a.e)(Object(a.m)(t)),[]):[]}function f(){var e=Object(c.a)();return Object(r.j)([],Object(r.g)(e.calendarFolderEvents.keys()))}function d(e){return Object(c.a)().calendarFolderEvents.get(e)||null}function l(e){var t=d(e);return(null==t?void 0:t.events)?Object(r.j)([],Object(r.g)(t.events.values())):[]}function v(e){return!!d(e)}},268:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(2),c=n(14),a={calendarFolderEvents:new c.ObservableMap,fullItemsMruMap:new c.ObservableMap,calendarFolderWorkingHours:new c.ObservableMap},o=Object(r.createStore)("calendarEventsStore",a)},269:function(e,t,n){"use strict";var r=n(1);function c(e,t){t.locksInfo.get(e)||t.locksInfo.set(e,{lockedDateRange:null,lockedEvents:{}})}var a=n(1110),o=n(14),u=n(24);function i(e,t,n){void 0===n&&(n=!1);t.Key;var c,a=Object(r.h)(t,["Key"]);s(e,n?a:(c=a,Object.keys(c).reduce((function(e,t){return void 0!==c[t]&&(e[t]=c[t]),e}),{})))}function s(e,t){if(e!==t){var n=Array.isArray(e)||Object(o.isObservableArray)(e),c=Array.isArray(t)||Object(o.isObservableArray)(t);if(n||c){var i=e,d=t;if(!e&&c)return d.length>0?d:i;if(!t&&n)return i.length>0&&i.splice(0),i;if(n&&c){if(i.length===d.length&&i.length>0)for(var l=0;l<i.length;l++)f(i[l])?Object(a.a)(i[l],d[l],s):i[l]=d[l];else i.length!==d.length&&(i.splice(0),i.push.apply(i,Object(r.j)([],Object(r.g)(d))));return i}return d}if(f(e)&&f(t)){if(Object(u.i)("cal-event-mergeReplaceNonObservable")&&!Object(o.isObservable)(e))return;return Object(a.a)(e,t,s)}}}function f(e){return"[object Object]"===Object.prototype.toString.call(e)}var d=n(5),l=n(428);function v(e,t,n){void 0===n&&(n=!1);var r=function(e,t,n){for(var r=[],c=0;c<e.length;c++){var a=e[c],o=t.get(a.Key);o?(i(o,a,n),r.push(o)):r.push(a)}return r}(e,t,n);return r.forEach((function(e){t.set(e.Key,e)})),function(e){e.sort((function(e,t){return Object(d.p)(e.Start,t.Start)}))}(r),Object(l.a)({lockId:"",updateMessage:"Upserted "+r.length+" items in the cache"}),r}function g(e,t,n,a,o){void 0===a&&(a=!1),void 0===o&&(o=!1),c(t,n);var u=n.events;if(a){var s=u.get(e.Key);s&&(i(s,e,o),e=s)}var f=Object(r.g)(v([e],u,o),1)[0];return n.locksInfo.get(t).lockedEvents[e.Key]=!0,Object(l.a)({lockId:t,updateMessage:"Event with startTime "+f.Start+" added to the lock"}),f}var j=n(137);function b(e,t){for(var n={start:e.Start,end:e.End},r=0;r<t.length;r++)if(0===Object(j.j)(t[r],n,!0))return!0;return!1}function O(e,t,n){var r=n.dateRangesToRetain,c=n.eventsToRetain;return function(e,t,n){var r=t.dateRangesToRetain,c=t.eventsToRetain,a=[];return e.forEach((function(e,t){var o=b(e,[n]),u=b(e,r),i=c[e.Key]||u;o&&!i&&a.push(e)})),a.forEach((function(t){e.delete(t.Key)})),a}(t,{dateRangesToRetain:r.filter((function(t){return 0===Object(j.j)(t,e,!0)})),eventsToRetain:c},e)}function k(e,t,n){var r=[];return t.forEach((function(t){-1!==e.indexOf(t.Key)&&function(e,t){var n=t.dateRangesToRetain,r=t.eventsToRetain;return!b(e,n)&&!r[e.Key]}(t,n)&&r.push(t)})),r.forEach((function(e){t.delete(e.Key)})),r}function h(e){return void 0===e&&(e=function(){return!0}),function(t,n){var c=Object(r.g)(n,2),a=c[0],o=c[1];return e([a,o])&&Object.keys(o.lockedEvents).forEach((function(e){return t[e]=!0})),t}}function R(e){return void 0===e&&(e=function(){return!0}),function(t,n){var c=Object(r.g)(n,2),a=c[0],o=c[1];return e([a,o])&&o.lockedDateRange&&t.push(o.lockedDateRange),t}}function E(e){return void 0===e&&(e=function(){return!0}),function(t,n){var c=Object(r.g)(n,2),a=c[0],o=c[1];return e([a,o])&&t.push(a),t}}function p(e){return function(t){var n=Object(r.g)(t,2),c=(n[0],n[1]);return c.lockedDateRange&&0===Object(j.j)(c.lockedDateRange,e,!1)}}var I,y=function(e){return function(t){return Object(r.g)(t,1)[0]!==e}};function D(e,t,n){c(t,n);var a=n.locksInfo.get(t),o=a.lockedDateRange,u=a.lockedEvents,i=Object(r.j)([],Object(r.g)(n.locksInfo.entries())).reduce(R(e!==I.EventIds?y(t):function(){return!0}),[]),s=Object(r.j)([],Object(r.g)(n.locksInfo.entries())).reduce(h(e!==I.DateRange?y(t):function(){return!0}),{});!o||e!==I.All&&e!==I.DateRange||(O(o,n.events,{dateRangesToRetain:i,eventsToRetain:s}),a.lockedDateRange=null);var f=Object.keys(u);f.length>0&&(e===I.All||e===I.EventIds)&&(k(f,n.events,{dateRangesToRetain:i,eventsToRetain:s}),a.lockedEvents={})}!function(e){e[e.All=0]="All",e[e.DateRange=1]="DateRange",e[e.EventIds=2]="EventIds"}(I||(I={}));var w=n(23);function m(e,t,n,r){c(n,r);var a,o,u=r.locksInfo.get(n).lockedDateRange,i=u?u.start+" - "+u.end:"null";u&&(a=u,o=e,0==Object(j.j)(a,o,!0)||function(e,t){return 1==(Object(d.p)(e.start,t.start)<0?Object(d.w)(t.start,e.end):Object(d.w)(e.start,t.end))}(a,o))&&!Object(j.c)(e,u,!0)?Object(j.c)(u,e,!0)?w.g.info("[addEventsForLock]: Date range in lock "+n+" already contains the range to be added."):u=Object(j.f)(u,e):(w.g.info('[addEventsForLock] Replacing all items in cache for lock "'+n+'". Date range: '+e.start+" - "+e.end),D(I.DateRange,n,r),u=e);var s=v(t,r.events);return r.locksInfo.get(n).lockedDateRange=u,w.g.info('[addEvents] New range in cache for lock "'+n+'": '+u.start+" - "+u.end),Object(l.a)({lockId:n,updateMessage:s.length+" events added to the lock. Previous locked daterange: "+i+". New locked daterange: "+u.start+" - "+u.end}),s}function T(e,t,n){var r=t.events.size,c=[];t.events.forEach((function(e,t){var r={start:e.Start,end:e.End};n.some((function(e){return 0===Object(j.j)(r,e,!0)}))&&c.push(t)})),c.forEach((function(e){t.events.delete(e)})),e.forEach((function(e){t.events.set(e.Key,e)})),Object(l.a)({lockId:"",updateMessage:"Replaced "+c.length+" items of initial "+r+" from cache with "+e.length+" items"})}function K(e,t,n){if(0===e.length)return[];c(t,n);var a=n.locksInfo.get(t);e=e.filter((function(e){return a.lockedEvents[e]}));var o=Object(r.j)([],Object(r.g)(n.locksInfo.entries())).reduce(R(),[]),u=Object(r.j)([],Object(r.g)(n.locksInfo.entries())).reduce(h(y(t)),{}),i=k(e,n.events,{dateRangesToRetain:o,eventsToRetain:u});return e.forEach((function(e){delete a.lockedEvents[e]})),i}function M(e,t,n){c(t,n);var a=n.locksInfo.get(t),o=a.lockedDateRange;if(o&&!Object(j.c)(e,a.lockedDateRange,!0)){Object(l.a)({lockId:t,updateMessage:"Now evicting events in cache except for events in date range "+e.start+" - "+e.end+". Current locked cache range: "+o.start+" - "+o.end});var u=Object(r.j)([],Object(r.g)(n.locksInfo.entries())).reduce(R(y(t)),[e]),i=Object(r.j)([],Object(r.g)(n.locksInfo.entries())).reduce(h(),{}),s=O(o,n.events,{dateRangesToRetain:u,eventsToRetain:i});w.g.info("[owa-events-cache:evictEventsExceptInDateRangeForLock] Evicted "+s.length+" events for lock '"+t+"'"),Object(j.c)(o,e,!0)?a.lockedDateRange=Object(r.a)({},e):a.lockedDateRange=function(e,t){var n=-1===Object(d.p)(e.start,t.start),r=1===Object(d.p)(e.end,t.end),c=e.start,a=e.end;n&&(c=t.start);r&&(a=t.end);return{start:c,end:a}}(e,o),Object(l.a)({lockId:t,updateMessage:"Evicted "+s.length+" events for lock. New locked cache range: "+o.start+" - "+o.end})}}function A(e,t){var n=t.events,c=[];return n.forEach((function(t,n){e(t)&&c.push(t)})),c.forEach((function(e){n.delete(e.Key)})),function(e,t){Object(r.j)([],Object(r.g)(t.locksInfo.keys())).forEach((function(n){var r=t.locksInfo.get(n);e.forEach((function(e){return delete r.lockedEvents[e.Key]}))}))}(c,t),Object(l.a)({lockId:"",updateMessage:"Unloaded "+c.length+" items from cache"}),c.reverse()}function S(e,t){D(I.All,e,t),t.locksInfo.delete(e)}function F(e,t){var n=[];return t.forEach((function(t){var r={start:t.Start,end:t.End};0===Object(j.j)(e,r,!0)&&n.push(t)})),n}var N=n(8);function L(e,t,n){var r=n&&n.locksInfo.get(t)?n.locksInfo.get(t).lockedDateRange:null;if(null!=r&&Object(j.c)(r,e,!0)){var c=F(e,n.events);if(Object(N.d)("debugEventsCache")){var a=c?c.length:"no";Object(l.a)({lockId:t,updateMessage:"Returning "+a+" items from cache for date range: "+e.start+" - "+e.end})}return c}return null}function U(e,t,n){var r=n.locksInfo.get(t)||{},c=r.lockedDateRange,a=void 0===c?null:c,o=r.lockedEvents,u=void 0===o?[]:o;return null===a&&0===Object.keys(u).length?e.map((function(e){return null})):function(e,t,n){var r=n.locksInfo.get(t),c=r.lockedDateRange,a=r.lockedEvents,o={};return e.forEach((function(e){var t=n.events.get(e);if(t){var r={start:t.Start,end:t.End};(!!c&&0===Object(j.j)(c,r,!0)||a[t.Key])&&(o[t.Key]=t)}})),e.map((function(e){return o[e]||null}))}(e,t,n)}var x=0;function C(e){var t=e||"events_cache_lock_"+x;return x++,t}function _(){return{events:new o.ObservableMap,locksInfo:new o.ObservableMap}}n.d(t,"a",(function(){return g})),n.d(t,"b",(function(){return m})),n.d(t,"r",(function(){return v})),n.d(t,"p",(function(){return T})),n.d(t,"i",(function(){return K})),n.d(t,"h",(function(){return M})),n.d(t,"o",(function(){return A})),n.d(t,"n",(function(){return S})),n.d(t,"q",(function(){return i})),n.d(t,"k",(function(){return L})),n.d(t,"j",(function(){return F})),n.d(t,"l",(function(){return U})),n.d(t,"g",(function(){return C})),n.d(t,"f",(function(){return _})),n.d(t,"c",(function(){return R})),n.d(t,"d",(function(){return h})),n.d(t,"e",(function(){return E})),n.d(t,"m",(function(){return p}))},428:function(e,t,n){"use strict";var r=n(1403),c=n(24),a=function(e){Object(c.i)("cal-cacheDiagnostics")&&setTimeout((function(){return Object(r.a)(e)}),0)};n.d(t,"a",(function(){return a}))}}]);
//# sourceMappingURL=owa.40.js.map
self.scriptsLoaded['owa.40.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.40.js'] = (new Date()).getTime();