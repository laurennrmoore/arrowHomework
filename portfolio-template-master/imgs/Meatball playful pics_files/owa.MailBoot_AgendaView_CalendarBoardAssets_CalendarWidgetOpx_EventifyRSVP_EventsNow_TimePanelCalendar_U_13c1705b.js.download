self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~AgendaView~CalendarBoardAssets~CalendarWidgetOpx~EventifyRSVP~EventsNow~TimePanelCalendar~U~13c1705b.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[103],{2095:function(e,t,n){"use strict";var r=n(2),c=Object(r.action)("updateLoadedDateRange",(function(e,t){return{dateRange:e,eventsCacheLockId:t}})),a=Object(r.action)("updateCalendarEventLoadStates",(function(e,t){return{calendarIds:e,eventsCacheLockId:t}})),o=Object(r.action)("resetCalendarEventLoadStates",(function(e){return{eventsCacheLockId:e}})),i=Object(r.action)("updateLoadState",(function(e,t){return{eventsCacheLockId:t,loadState:e}})),u=Object(r.action)("initializeScenario",(function(e){return{eventsCacheLockId:e}})),d=Object(r.action)("updateIsInitializingCalendarEventsLoader",(function(e,t){return{eventsCacheLockId:t,isInitializingCalendarEventsLoader:e}})),s=n(1),f=n(1282),l=n(860);function v(e){var t=Object(l.p)(e);return Object(s.a)(Object(s.a)({},t),{getOrderedEvents:function(t,n){return function(e,t,n){var r=Object(l.p)(n).getCalendarEventsForDateRange,c=[];return e.forEach((function(e){c.push.apply(c,Object(s.j)([],Object(s.g)(r(e,t))))})),c.sort(f.a)}(t,n,e)}})}var b=n(2514);var h=n(14),j={scenarios:new h.ObservableMap},O=Object(r.createStore)("EventsLoadedStore",j),L=n(76),I=n(1309);function g(e){return Object(L.d)(e)&&!Object(L.c)(e)}function C(e){return Object(L.d)(e)&&Object(L.c)(e)}function k(e){return void 0===e&&(e=function(){return!0}),function(t,n){var r=Object(s.g)(n,2),c=r[0],a=r[1];return e([c,a])&&t.push(c),t}}function E(e){return function(t){var n=Object(s.g)(t,2);n[0];return n[1]===e}}var p=n(121);function m(e){return z(e).eventsCacheLockId}function w(e,t){return Object(L.d)(t)?g(t)?P(e).get(t):Object(I.d)(t):"Loading"}function R(e){return x(e).map((function(t){return w(e,t)}))}function D(e){return O().scenarios.has(e)?z(e).scenarioLoadState:"DoesNotExist"}function S(e){return z(e).loadedDateRange}function F(e,t){return y(e).reduce(k(E(t)),[])}function z(e){var t=O().scenarios.get(e);return t||(Object(p.s)("GetScenarioDataError",{eventsCacheLockId:e}),{eventsCacheLockId:e,loadedDateRange:null,scenarioLoadState:"DoesNotExist",calendarEventsLoadState:new h.ObservableMap({}),isInitializingCalendarEventsLoader:!1})}function N(e,t){var n=t||S(e),r=function(e){return x(e).filter(g).map(L.w)}(e),c=m(e),a=r?v(c).getOrderedEvents(r,n):[];return Object(b.a)()||(a=a.filter((function(e){return"Decline"!==e.ResponseType}))),a}function P(e){return z(e).calendarEventsLoadState}function y(e){return Object(s.j)([],Object(s.g)(P(e).entries()))}function x(e){return Object(s.j)([],Object(s.g)(P(e).keys()))}Object(r.mutator)(c,(function(e){var t=e.eventsCacheLockId,n=e.dateRange;z(t).loadedDateRange=n})),Object(r.mutator)(i,(function(e){var t=e.eventsCacheLockId,n=e.loadState;z(t).scenarioLoadState=n})),Object(r.mutator)(d,(function(e){var t=e.eventsCacheLockId,n=e.isInitializingCalendarEventsLoader;z(t).isInitializingCalendarEventsLoader=n})),Object(r.mutator)(u,(function(e){var t=e.eventsCacheLockId;O().scenarios.get(t)||O().scenarios.set(t,{eventsCacheLockId:t,loadedDateRange:null,scenarioLoadState:"Loading",calendarEventsLoadState:new h.ObservableMap({}),isInitializingCalendarEventsLoader:!0})})),Object(r.mutator)(l.v,(function(e){var t=e.calendarId,n=e.loadingState,r=function(e){var t=Object(s.j)([],Object(s.g)(O().scenarios.entries())).filter((function(t){var n=Object(s.g)(t,2);n[0];return n[1].eventsCacheLockId===e}));return t.length>0?{value:!0,eventsCacheLockId:t[0][0]}:{value:!1}}(e.lockId);if(r.value){var c=P(r.eventsCacheLockId);t&&c.has(t.id)&&c.set(t.id,n)}})),Object(r.mutator)(a,(function(e){var t=e.calendarIds,n=e.eventsCacheLockId,r=P(n);t.forEach((function(e){r.has(e)||r.set(e,"NotLoaded")})),x(n).forEach((function(e){t.some((function(t){return t===e}))||r.delete(e)}))})),Object(r.mutator)(o,(function(e){var t=e.eventsCacheLockId,n=P(t);x(t).forEach((function(e){n.set(e,"NotLoaded")}))}));var A=Object(r.action)("initializeCalendarEventsLoader",(function(e,t,n){return{calendarIds:e,dateRange:t,eventsCacheLockId:n}})),M=Object(r.action)("calendarEventsLoaderInitialized",(function(e){return{eventsCacheLockId:e}})),U=Object(r.action)("updateCalendarIds",(function(e,t){return{calendarIds:e,eventsCacheLockId:t}})),q=Object(r.action)("onCalendarIdsUpdated",(function(e){return{eventsCacheLockId:e}})),$=Object(r.action)("onDateRangeUpdated",(function(e,t){return{dateRange:e,eventsCacheLockId:t}})),G=Object(r.action)("loadFullEvent",(function(e,t,n){return{eventsCacheLockId:e,id:t,parentFolderId:n}})),T=Object(r.action)("updateDateRange",(function(e,t){return{dateRange:e,eventsCacheLockId:t}})),_=Object(r.action)("expandDateRange",(function(e,t){return{numberOfDays:e,eventsCacheLockId:t}})),B=n(5);function H(e,t){return null===t||!Object(B.Ib)(e.start,t.start)||!Object(B.Ib)(e.end,t.end)}var J=n(23),K=function(e,t,n){return e&&0!==e.length&&null!==t?function(e,t,n){var r=this,c=m(n),a=Object(l.q)(c),o=e.map((function(e){return a.fetchCalendarEventsForDateRange(e,t)})),i=o.every((function(e){return null!==e.events})),u=new Promise((function(t){return Object(s.c)(r,void 0,void 0,(function(){var n;return Object(s.f)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Promise.all(o.map((function(e){return e.fetchPromise})))];case 1:return r.sent(),e.forEach((function(e){return a.subscribeNotifications(e)})),[3,3];case 2:return n=r.sent(),J.g.warn("loadEvents: Exception occured: "+n.message),[3,3];case 3:return t(),[2]}}))}))}));return{canFetchAllEventsFromLocal:i,fetchPromise:u}}(e,t,n):{canFetchAllEventsFromLocal:!1,fetchPromise:new Promise((function(e){return Object(s.c)(void 0,void 0,void 0,(function(){return Object(s.f)(this,(function(t){return[2,e()]}))}))}))}};function Q(e,t,n){return Object(s.c)(this,void 0,void 0,(function(){var r,c,a,o,u;return Object(s.f)(this,(function(d){switch(d.label){case 0:return(r=t.filter(g)).length>0?(c=r.map(L.w),a=K(c,n,e),o=a.canFetchAllEventsFromLocal,u=a.fetchPromise,o||i("Fetching",e),[4,u]):[3,2];case 1:d.sent(),d.label=2;case 2:return[2]}}))}))}var V=function(e){return Object(s.c)(void 0,void 0,void 0,(function(){return Object(s.f)(this,(function(t){switch(t.label){case 0:return e?[4,Promise.all(e.filter(C).map(I.c).map((function(e){return e.catch(W)})))]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))};function W(e){return J.g.warn("Failed to update folderId:\n"+e),Promise.resolve()}function X(e){o(e),c(null,e)}function Y(e,t){return Object(s.c)(this,void 0,void 0,(function(){var n,r,o,u;return Object(s.f)(this,(function(d){switch(d.label){case 0:return n=t.calendarIds,r=t.dateRange,a(n,e),o=F(e,"NotLoaded"),V(o),u=S(e),H(r,u)||0!==o.length?(i("Loading",e),H(r,u)&&X(e),[4,Q(e,n,r)]):[3,2];case 1:d.sent(),c(r,e),i("Loaded",e),q(e),d.label=2;case 2:return[2]}}))}))}Object(r.orchestrator)(A,(function(e){return Object(s.c)(void 0,void 0,void 0,(function(){var t,n,r;return Object(s.f)(this,(function(c){switch(c.label){case 0:if(t=e.eventsCacheLockId,n=e.calendarIds,r=e.dateRange,"DoesNotExist"===D(t))u(t);else if(function(e){return z(e).isInitializingCalendarEventsLoader}(t))return[2];return[4,Y(t,{calendarIds:n,dateRange:r})];case 1:return c.sent(),M(t),d(!1,t),[2]}}))}))})),Object(r.orchestrator)(U,(function(e){return Object(s.c)(void 0,void 0,void 0,(function(){var t,n,r,c;return Object(s.f)(this,(function(o){switch(o.label){case 0:return t=e.calendarIds,n=e.eventsCacheLockId,a(t,n),r=F(n,"NotLoaded"),V(r),c=S(n),0===r.length?[3,2]:(i("Loading",n),[4,Q(n,r,c)]);case 1:o.sent(),i("Loaded",n),q(n),o.label=2;case 2:return[2]}}))}))}));var Z=n(715),ee=(Object(r.orchestrator)(T,(function(e){return Object(s.c)(void 0,void 0,void 0,(function(){var t,n,r;return Object(s.f)(this,(function(a){switch(a.label){case 0:return t=e.dateRange,n=e.eventsCacheLockId,r=S(n),H(t,r)?(i("Loading",n),X(n),[4,Object(Z.c)((function(){return Q(n,x(n),t)}),"UpdateDateRange_"+n)]):[3,2];case 1:a.sent().isCurrent&&(c(t,n),i("Loaded",n),$(t,n)),a.label=2;case 2:return[2]}}))}))})),Object(r.orchestrator)(_,(function(e){return Object(s.c)(void 0,void 0,void 0,(function(){var t,n,r,a;return Object(s.f)(this,(function(o){switch(o.label){case 0:return t=e.eventsCacheLockId,n=e.numberOfDays,r=S(t),a={start:r.start,end:Object(B.e)(r.end,n)},i("Loading",t),[4,Q(t,x(t),a)];case 1:return o.sent(),c(a,t),i("Loaded",t),[2]}}))}))})),Object(r.orchestrator)(G,(function(e){var t=e.eventsCacheLockId,n=e.parentFolderId,r=e.id,c=m(t);(0,Object(l.q)(c).fetchFullCalendarEvent)(r,n?n.Id:null,void 0,void 0,{fetchSource:t})})),n(1096));function te(){var e=this;Object(s.j)([],Object(s.g)(O().scenarios.entries())).reduce((function(e,t){var n=Object(s.g)(t,2),r=n[0],c=(n[1],y(r).reduce(k(E("NotLoaded")),[]));return c&&c.length>0&&e.push({eventsCacheLockId:r,calendarIds:c}),e}),[]).forEach((function(t){return Object(s.c)(e,void 0,void 0,(function(){var e,n,r;return Object(s.f)(this,(function(c){switch(c.label){case 0:return e=t.eventsCacheLockId,n=t.calendarIds,(r=S(e))?(i("Loading",e),[4,Q(e,n,r)]):[3,2];case 1:c.sent(),i("Loaded",e),c.label=2;case 2:return[2]}}))}))}))}Object(r.orchestrator)(ee.c,te),Object(r.orchestrator)(I.a,te);n.d(t,"h",(function(){return A})),n.d(t,"a",(function(){return M})),n.d(t,"l",(function(){return U})),n.d(t,"j",(function(){return q})),n.d(t,"k",(function(){return $})),n.d(t,"i",(function(){return G})),n.d(t,"m",(function(){return T})),n.d(t,"b",(function(){return _})),n.d(t,"e",(function(){return w})),n.d(t,"f",(function(){return R})),n.d(t,"d",(function(){return D})),n.d(t,"g",(function(){return S})),n.d(t,"c",(function(){return N}))}}]);
//# sourceMappingURL=owa.MailBoot~AgendaView~CalendarBoardAssets~CalendarWidgetOpx~EventifyRSVP~EventsNow~TimePanelCalendar~U~13c1705b.js.map
self.scriptsLoaded['owa.MailBoot~AgendaView~CalendarBoardAssets~CalendarWidgetOpx~EventifyRSVP~EventsNow~TimePanelCalendar~U~13c1705b.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~AgendaView~CalendarBoardAssets~CalendarWidgetOpx~EventifyRSVP~EventsNow~TimePanelCalendar~U~13c1705b.js'] = (new Date()).getTime();