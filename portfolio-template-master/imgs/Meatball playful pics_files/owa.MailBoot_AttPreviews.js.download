self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~AttPreviews.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[535],{18420:function(t,e,n){"use strict";n.r(e);var r=n(1),i=n(183),c=n(2133),a=Object(i.action)("removeAttachmentPreviewsForRow")((function(t){var e=c.a.rowAttachmentPreviewWellViews,n=e.get(t);if(n){var r=c.a.attachmentViewStates;n.imageViewStateIds.forEach((function(t){r.delete(t)})),n.documentViewStateIds.forEach((function(t){r.delete(t)})),e.delete(t)}}));var o=n(121),u=n(2070),s=n(2128),d=n(1956),f=n(203),h=n(14);var m=Object(i.action)("createAndStoreAttachmentViewState")((function(t,e,n,i,a){return Object(r.c)(this,void 0,void 0,(function(){var o,d,f,m=this;return Object(r.f)(this,(function(l){switch(l.label){case 0:return o=function(t,e){return t+"_"+e}(t,n.AttachmentId.Id),d=c.a.attachmentViewStates.get(o),f=h.observable.object(Object(r.a)(Object(r.a)({},n.AttachmentId),{mailboxInfo:a})),[4,s.d.import().then((function(t){return Object(r.c)(m,void 0,void 0,(function(){return Object(r.f)(this,(function(r){switch(r.label){case 0:return d=d||t(f,n,!0,!0,!1,!1,e),[4,u.h.import()];case 1:return n=r.sent()(f).model,c.a.attachmentViewStates.set(o,d),[4,u.n.import()];case 2:return r.sent()(n)?i.imageViewStateIds.push(o):i.documentViewStateIds.push(o),[2]}}))}))}))];case 1:return l.sent(),[2]}}))}))}));var l=Object(i.action)("processAttachmentsForConversation")((function(t,e,n){var r;void 0===n&&(n={listView:c.a});var i=n.listView.conversationItems.get(t.ConversationId.Id);if(i){var u=[];if((null===(r=t.AttachmentPreviews)||void 0===r?void 0:r.Previews)&&(u=I(t.AttachmentPreviews.Previews)),u.length>0){var s=function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n],c=i.Attachment,a=-1;if(c.IsInline)for(var o=0;o<e.length;o++){var u=e[o];if(u.Attachment.IsInline&&u.Attachment.Name==c.Name&&u.ParentItemId.Id!=i.ParentItemId.Id){a=o;break}}-1==a&&e.push(i)}return e}(t.AttachmentPreviews.Previews);w(t.ConversationId.Id,s,e);var d=t.AttachmentPreviews.Previews.length-s.length;d>0&&Object(o.t)("IP_II_DP",[d])}else i.shouldShowAttachmentPreviews=!1,a(t.ConversationId.Id),Object(o.t)("IP_FP")}})),v=Object(i.action)("processAttachmentPreviewsForItems")((function(t,e,n){var i=t.filter((function(t){return t.AttachmentPreviews})),c=[];i.forEach((function(t){c.push.apply(c,Object(r.j)([],Object(r.g)(t.AttachmentPreviews.Previews)))}));var o=I(c),u={};o.forEach((function(t){var n=t.ParentItemId.Id;e.indexOf(n)>-1&&(u[n]||(u[n]=[]),u[n].push(t))})),e.forEach((function(t){var e=d.u.items.get(t);e?u[t]?w(t,u[t],n):(e.shouldShowAttachmentPreviews=!1,a(t)):delete u[t]}))})),w=Object(i.action)("processAttachmentsForRow")((function(t,e,n){return Object(r.c)(this,void 0,void 0,(function(){var i,a=this;return Object(r.f)(this,(function(o){switch(o.label){case 0:return i={documentViewStateIds:[],imageViewStateIds:[]},[4,Promise.all(e.map((function(e){return Object(r.c)(a,void 0,void 0,(function(){return Object(r.f)(this,(function(c){switch(c.label){case 0:return e.Attachment.AttachmentId.Id||(e.Attachment.AttachmentId.Id=Object(f.a)()),[4,m(t,Object(r.a)(Object(r.a)({},e.ParentItemId),{mailboxInfo:n}),e.Attachment,i,n)];case 1:return c.sent(),[2]}}))}))})))];case 1:return o.sent(),c.a.rowAttachmentPreviewWellViews.set(t,i),[2]}}))}))}));function I(t){var e=t.filter(A);if(e.length!==t.length){var n=t.filter((function(t){return!A(t)})).map((function(t){return t.Attachment.AttachmentId?t.Attachment.AttachmentId.Id:"UNDEFINED"})).join(",");Object(o.s)("InvalidAttachmentPreview",{AttachmentIdString:n})}return e}function A(t){return!!t.Attachment.Name}var b=n(8981),O=n(7102);function P(t,e,n){var i=Object(O.a)(Object(r.a)(Object(r.a)({},n),{ConversationIds:t}));return Object(b.a)(i,e).then((function(t){return t}))}var g=n(1947),j=n(197),p=n(419),E=new Map,S=Object(i.action)("AttachmentPreviewsOperations.add")((function(t,e,n,r){void 0===r&&(r={rowIdsToGetPreviewsMap:E});var i=r.rowIdsToGetPreviewsMap[null==t?void 0:t.mailboxSmtpAddress];i||(i={conversationsIdsArray:[],itemIdsArray:[]},r.rowIdsToGetPreviewsMap[null==t?void 0:t.mailboxSmtpAddress]=i),i.conversationsIdsArray.some((function(t){return t.Id==e.Id}))||i.conversationsIdsArray.push(e),-1==i.itemIdsArray.indexOf(n)&&i.itemIdsArray.push(n)})),T=Object(i.action)("AttachmentPreviewsOperations.getPreviews")((function(t,e,n){return void 0===n&&(n={rowIdsToGetPreviewsMap:E}),Object(r.c)(this,void 0,void 0,(function(){var i,c,a,o,u;return Object(r.f)(this,(function(r){switch(r.label){case 0:if(!(i=n.rowIdsToGetPreviewsMap[null==t?void 0:t.mailboxSmtpAddress]))return[2];c=i.conversationsIdsArray,a=i.itemIdsArray,o=Object(j.a)(),delete n.rowIdsToGetPreviewsMap[null==t?void 0:t.mailboxSmtpAddress],r.label=1;case 1:return r.trys.push([1,3,,4]),[4,P(c,Object(p.a)(t),{IncludeInlineAttachments:o})];case 2:return void 0!==(u=r.sent()).Conversations?1==e?v(u.Conversations,a,t):function(t,e){t.forEach((function(t){l(t,e)}))}(u.Conversations,t):C(e,a,c),[3,4];case 3:return r.sent(),C(e,a,c),[3,4];case 4:return[2]}}))}))}));function C(t,e,n){1==t?e.forEach((function(t){var e=d.u.items.get(t);e&&(g.ab.rowAttachmentPreviewWellViews.get(t)||(e.shouldShowAttachmentPreviews=!1))})):n.forEach((function(t){var e=t.Id,n=g.ab.conversationItems.get(e);n&&(g.ab.rowAttachmentPreviewWellViews.get(e)||(n.shouldShowAttachmentPreviews=!1))}))}var V=Object(i.action)("AttachmentPreviewsOperations.getAttachmentsForConversationWell")((function(t){return Object(r.c)(this,void 0,void 0,(function(){var e,n,i,c,a;return Object(r.f)(this,(function(o){switch(o.label){case 0:e=[t],n=[],i={},c={},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,P(e,Object(p.a)(t.mailboxInfo),{FullPreviewsPerConversation:300,PreviewsPerConversation:300,MinimumAttachmentSize:0,IncludeInlineAttachments:!1})];case 2:return void 0!==(a=o.sent()).Conversations&&a.Conversations.forEach((function(e){e.ConversationId.Id==t.Id&&e.AttachmentPreviews&&e.AttachmentPreviews.Previews&&I(e.AttachmentPreviews.Previews).forEach((function(e){n.push(e.Attachment),i[e.Attachment.AttachmentId.Id]=Object(r.a)(Object(r.a)({},e.ParentItemId),{mailboxInfo:t.mailboxInfo}),c[e.Attachment.AttachmentId.Id]=e.ItemReceivedTime}))})),[3,4];case 3:return o.sent(),[3,4];case 4:return[2,[n,i,c]]}}))}))}));n.d(e,"getPreviews",(function(){return T})),n.d(e,"add",(function(){return S})),n.d(e,"getAttachmentsForConversationWell",(function(){return V})),n.d(e,"removeAttachmentPreviewsForRow",(function(){return a}))},2070:function(t,e,n){"use strict";n.d(e,"e",(function(){return s})),n.d(e,"m",(function(){return d})),n.d(e,"i",(function(){return f})),n.d(e,"g",(function(){return h})),n.d(e,"l",(function(){return m})),n.d(e,"k",(function(){return l})),n.d(e,"j",(function(){return v})),n.d(e,"h",(function(){return w})),n.d(e,"f",(function(){return I})),n.d(e,"n",(function(){return A}));var r=n(31),i=n(2113);n.d(e,"o",(function(){return i.a})),n.d(e,"p",(function(){return i.b})),n.d(e,"q",(function(){return i.c}));var c=n(2143);n.d(e,"b",(function(){return c.a}));var a=n(2214);n.d(e,"d",(function(){return a.a})),n.d(e,"c",(function(){return a.b}));var o=n(2230);n.d(e,"a",(function(){return o.a}));var u=new r.c((function(){return Promise.all([n.e(4),n.e(21),n.e(42),n.e(77),n.e(539),n.e(352)]).then(n.bind(null,3605))})),s=new r.a(u,(function(t){return t.addAndInitializeAttachments})),d=new r.a(u,(function(t){return t.setPreviewImageUrl})),f=new r.a(u,(function(t){return t.refreshDownloadUrl})),h=new r.a(u,(function(t){return t.createAttachmentInfo})),m=new r.a(u,(function(t){return t.setAttachmentInfo})),l=new r.a(u,(function(t){return t.refreshThumbnailImageUrl})),v=new r.a(u,(function(t){return t.refreshPreviewImageUrl})),w=new r.b(u,(function(t){return t.getAttachment})),I=new r.b(u,(function(t){return t.checkPendingAttachmentOperation})),A=new r.b(u,(function(t){return t.shouldShowImageView}))},2113:function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return c})),n.d(e,"c",(function(){return a}));var r=n(2),i=Object(r.action)("REFRESH_SHARING_TIPS_FOR_ATTACHMENT",(function(t){return{attachmentId:t}})),c=Object(r.action)("SET_ATTACHMENT_CONTENTID",(function(t,e){return{attachmentId:t,attachmentContentId:e}})),a=Object(r.action)("SET_ATTACHMENT_ISINLINE",(function(t,e){return{attachmentId:t,isInline:e}}))},2128:function(t,e,n){"use strict";n.d(e,"n",(function(){return o})),n.d(e,"q",(function(){return u})),n.d(e,"r",(function(){return s})),n.d(e,"a",(function(){return d})),n.d(e,"p",(function(){return f})),n.d(e,"f",(function(){return h})),n.d(e,"u",(function(){return m})),n.d(e,"g",(function(){return l})),n.d(e,"d",(function(){return v})),n.d(e,"e",(function(){return w})),n.d(e,"j",(function(){return I})),n.d(e,"i",(function(){return A})),n.d(e,"l",(function(){return b})),n.d(e,"k",(function(){return O})),n.d(e,"c",(function(){return P})),n.d(e,"o",(function(){return g})),n.d(e,"s",(function(){return j})),n.d(e,"b",(function(){return p})),n.d(e,"m",(function(){return E})),n.d(e,"h",(function(){return S})),n.d(e,"t",(function(){return T}));var r=n(31),i=n(2248);n.d(e,"v",(function(){return i.a}));var c=n(2249);n.d(e,"w",(function(){return c.a}));var a=new r.c((function(){return Promise.all([n.e(0),n.e(1),n.e(2),n.e(3),n.e(4),n.e(15),n.e(17),n.e(16),n.e(21),n.e(22),n.e(29),n.e(34),n.e(37),n.e(41),n.e(42),n.e(52),n.e(57),n.e(72),n.e(77),n.e(78),n.e(82),n.e(111),n.e(143),n.e(170),n.e(353)]).then(n.bind(null,3209))})),o=new r.a(a,(function(t){return t.initializeAttachments})),u=new r.a(a,(function(t){return t.reinitializeAttachments})),s=new r.a(a,(function(t){return t.setInlineAttachmentStatus})),d=new r.a(a,(function(t){return t.addAttachmentIntoWellBeforeUpload})),f=new r.b(a,(function(t){return t.refreshSharingTipsAttachmentWell})),h=new r.b(a,(function(t){return t.createAttachmentsViaQueueManager})),m=new r.b(a,(function(t){return t.createAttachmentsFromRecentAttachments})),l=new r.a(a,(function(t){return t.deleteAttachmentViaQueueManager})),v=new r.b(a,(function(t){return t.createAttachmentFullViewStateAndStoreBackingModel})),w=new r.b(a,(function(t){return t.createAttachmentFullViewState})),I=new r.b(a,(function(t){return t.getAttachmentWellInitialValue})),A=new r.b(a,(function(t){return t.getAttachmentWellForCompose})),b=new r.b(a,(function(t){return t.getConversationAttachmentWellInitialValue})),O=(new r.b(a,(function(t){return t.getMaxClassicAttachmentsSize})),new r.b(a,(function(t){return t.getAvailableLocalAttachmentSize}))),P=new r.b(a,(function(t){return t.createAttachmentFileFromExistingMailboxAttachment})),g=new r.a(a,(function(t){return t.mergeToConversationAttachmentWell})),j=new r.a(a,(function(t){return t.sortConversationAttachmentWell})),p=new r.a(a,(function(t){return t.convertImageViewAttachmentToInlineAttachment})),E=new r.b(a,(function(t){return t.getLastCloudyAttachmentsSharingIssueForBlockOnSend})),S=new r.b(a,(function(t){return t.getAllValidAttachments})),T=new r.b(a,(function(t){return t.uploadLocalFile}))},2143:function(t,e,n){"use strict";var r=n(14),i=n(2),c={attachments:new r.ObservableMap({})},a=Object(i.createStore)("attachment",c);e.a=a},2214:function(t,e,n){"use strict";function r(t){return(null==t?void 0:t.AttachmentId)&&i(t.AttachmentId.Id)}function i(t){return t&&-1!==t.indexOf("smime-")}n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i}))},2230:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return i})),n.d(e,"d",(function(){return c})),n.d(e,"e",(function(){return a})),n.d(e,"f",(function(){return o})),n.d(e,"g",(function(){return u})),n.d(e,"h",(function(){return s})),n.d(e,"i",(function(){return d})),n.d(e,"j",(function(){return f})),n.d(e,"k",(function(){return h})),n.d(e,"l",(function(){return m})),n.d(e,"a",(function(){return l}));var r="Box",i="Dropbox",c="Facebook",a="GDrive",o="Mailbox",u="MailMessage",s="OneDriveConsumer",d="OneDrivePro",f="WopiBox",h="WopiDropbox",m="WopiEgnyte",l={providers:{BOX:r,DROPBOX:i,FACEBOOK:c,GDRIVE:a,MAILBOX:o,ONE_DRIVE_CONSUMER:s,ONE_DRIVE_PRO:d,RECENT_ATTACHMENTS:"RecentAttachments",WOPI:"Wopi",WOPI_BOX:f,WOPI_EGNYTE:m}}},2248:function(t,e,n){"use strict";var r=n(2);e.a=Object(r.action)("ON_ATTACHMENT_CREATED",(function(t,e,n,r){return void 0===r&&(r=!0),{parentItemId:t,attachmentId:e,attachment:n,shouldTriggerAddInAttachmentsChangedCallback:r}}))},2249:function(t,e,n){"use strict";var r=n(2);e.a=Object(r.action)("ON_ATTACHMENT_DELETED",(function(t,e,n,r){return void 0===r&&(r=!0),{parentItemId:t,attachmentId:e,attachment:n,shouldTriggerAddInAttachmentsChangedCallback:r}}))},419:function(t,e,n){"use strict";var r=n(1);function i(t,e){return t?Object(r.a)({mailboxInfo:t},e):null!=e?e:void 0}n.d(e,"a",(function(){return i}))},7102:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(1);function i(t){return Object(r.a)({__type:"GetAttachmentPreviewsRequest:#Exchange"},t)}},8981:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var r=n(33),i=n(7102);function c(t,e){return void 0===t||t.__type||(t=Object(i.a)(t)),Object(r.a)("GetAttachmentPreviews",t,e)}}}]);
//# sourceMappingURL=owa.MailBoot~AttPreviews.js.map
self.scriptsLoaded['owa.MailBoot~AttPreviews.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~AttPreviews.js'] = (new Date()).getTime();