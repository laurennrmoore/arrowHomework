self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~AttachmentModelStore.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[539],{186:function(e,t,n){"use strict";function r(){var e=Object.create(null),t=0,n=0,r=0,i=!1;function a(t){r--,delete e[t]}this.put=function(t,n,i,o){if(void 0!==i&&("number"!=typeof i||isNaN(i)||i<=0))throw new Error("Cache timeout must be a positive number");if(void 0!==o&&"function"!=typeof o)throw new Error("Cache timeout callback must be a function");var c=e[t];c?clearTimeout(c.timeout):r++;var u={value:n,expire:i+Date.now()};return isNaN(u.expire)||(u.timeout=setTimeout(function(){a(t),o&&o(t,n)}.bind(this),i)),e[t]=u,n},this.del=function(t){var n=!0,r=e[t];return r?(clearTimeout(r.timeout),!isNaN(r.expire)&&r.expire<Date.now()&&(n=!1)):n=!1,n&&a(t),n},this.clear=function(){for(var a in e)clearTimeout(e[a].timeout);r=0,e=Object.create(null),i&&(t=0,n=0)},this.get=function(a){var o=e[a];if(void 0!==o){if(isNaN(o.expire)||o.expire>=Date.now())return i&&t++,o.value;i&&n++,r--,delete e[a]}else i&&n++;return null},this.size=function(){return r},this.memsize=function(){var t,n=0;for(t in e)n++;return n},this.debug=function(e){i=e},this.hits=function(){return t},this.misses=function(){return n},this.keys=function(){return Object.keys(e)},this.exportJson=function(){var t={};for(var n in e){var r=e[n];t[n]={value:r.value,expire:r.expire||"NaN"}}return JSON.stringify(t)},this.importJson=function(t,n){var r=JSON.parse(t),i=Date.now(),a=n&&n.skipDuplicates;for(var o in r)if(r.hasOwnProperty(o)){if(a)if(e[o])continue;var c=r[o],u=c.expire-i;if(u<=0){this.del(o);continue}u=u>0?u:void 0,this.put(o,c.value,u)}return this.size()}}e.exports=new r,e.exports.Cache=r},1963:function(e,t,n){"use strict";function r(e){if(!e)return null;var t=e.lastIndexOf(".");return t>0?e.substr(t).toLowerCase():null}function i(e){var t=r(e);return t?t.replace(".",""):null}function a(e){var t;return(null===(t=i(e))||void 0===t?void 0:t.substring(0,4))||""}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return a}))},1969:function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.Base64InlineImage=0]="Base64InlineImage",e[e.Cloud=1]="Cloud",e[e.Local=2]="Local",e[e.MailItem=3]="MailItem",e[e.Uri=4]="Uri",e[e.AttachmentItem=5]="AttachmentItem",e[e.CloudSuggestion=6]="CloudSuggestion",e[e.AttachmentItemSuggestion=7]="AttachmentItemSuggestion",e[e.Inline=8]="Inline",e[e.Smime=9]="Smime",e[e.FilesHub=10]="FilesHub",e[e.GroupFilesHub=11]="GroupFilesHub",e[e.MailSearchFileSuggestion=12]="MailSearchFileSuggestion",e[e.Unknown=13]="Unknown",e[e.ContextualSuggestion=14]="ContextualSuggestion",e[e.ConsumerGroupFilesHub=15]="ConsumerGroupFilesHub",e[e.SmartDoc=16]="SmartDoc",e[e.ExpirableBase64InlineImage=17]="ExpirableBase64InlineImage"}(r||(r={}))},1992:function(e,t,n){"use strict";var r=n(1963),i=n(2210),a=n(6);function o(e){var t;return e>=1073741824?(e/=1073741824,t=Object(a.b)(i.b)):e>=1048576?(e/=1048576,t=Object(a.b)(i.d)):e>=1024?(e/=1024,t=Object(a.b)(i.c)):t=Object(a.b)(i.a),Object(a.c)(t,Math.round(e))}var c,u=n(2061),s=n(24),l=[".pdf",".doc",".docx",".odt",".rtf",".ppt",".pptx",".pptm",".potx",".potm",".pot",".ppxx",".pps",".odp"];function d(e){if(!Object(s.i)("doc-attachment-documentThumbnail"))return!1;var t=Object(r.a)(e);return!!t&&l.indexOf(t.toLowerCase())>=0}function f(e){switch(e){case".doc":case".docm":case".docx":case".dot":case".dotm":case".dotx":case".odt":case".rtf":return c.Word;case".csv":case".ods":case".xls":case".xlsb":case".xlsm":case".xlsx":return c.Excel;case".odp":case".pot":case".potm":case".potx":case".pps":case".ppsm":case".ppsx":case".ppt":case".pptm":case".pptx":return c.PowerPoint;default:return null}}!function(e){e[e.Word=0]="Word",e[e.Excel=1]="Excel",e[e.PowerPoint=2]="PowerPoint"}(c||(c={}));var b=n(2019);n.d(t,"b",(function(){return r.a})),n.d(t,"c",(function(){return r.b})),n.d(t,"d",(function(){return r.c})),n.d(t,"i",(function(){return o})),n.d(t,"g",(function(){return u.a})),n.d(t,"h",(function(){return d})),n.d(t,"f",(function(){return f})),n.d(t,"e",(function(){return b.b})),n.d(t,"a",(function(){return c}))},1996:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2143);function i(e){return Object(r.a)().attachments.get(e.Id)}},2004:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(267);function i(e){var t;return null===(t=Object(r.a)(e))||void 0===t?void 0:t.AttachmentPolicy}},2019:function(e,t,n){"use strict";function r(e){return t=e||"",(n=a.exec(t))&&n.length>1&&i[n[1].toLowerCase()];var t,n}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o}));var i={"image/bmp":".bmp","image/x-ms-bmp":".bmp","image/gif":".gif","image/jpeg":".jpeg","image/png":".png","image/vnd.adobe.photoshop":".psd","image/tiff":".tiff"},a=/^\s*([^;\s]*)(?:;|\s|$)/;function o(e){var t="";return Object.entries(i).forEach((function(n){n[1]===e&&(t=n[0])})),t}},2029:function(e,t,n){"use strict";var r,i,a;n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return a})),function(e){e[e.Compose=0]="Compose",e[e.Extensibility=1]="Extensibility",e[e.ReadingPane=2]="ReadingPane",e[e.Fileshub=3]="Fileshub",e[e.Txp=4]="Txp",e[e.Peek=5]="Peek",e[e.CalendarCard=6]="CalendarCard"}(r||(r={})),function(e){e[e.SmimeSignature=0]="SmimeSignature",e[e.Safety=1]="Safety",e[e.Error=2]="Error",e[e.Info=3]="Info",e[e.Encryption=4]="Encryption",e[e.Translation=5]="Translation",e[e.Sensitivity=6]="Sensitivity",e[e.InsightMessage=7]="InsightMessage",e[e.External=8]="External",e[e.Spotlight=9]="Spotlight"}(i||(i={})),function(e){e[e.Grey=0]="Grey",e[e.Red=1]="Red",e[e.Green=2]="Green",e[e.Yellow=3]="Yellow",e[e.Orange=4]="Orange",e[e.Green20=5]="Green20"}(a||(a={}))},2061:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return s}));var r=n(1963),i=n(2019),a=n(102),o=[".bmp",".gif",".jpe",".jpeg",".jpg",".jfif",".dib",".png",".psd"],c=[".tiff",".tif"];function u(e,t,n){return void 0===n&&(n=!0),s(Object(r.a)(e)||Object(i.a)(t),n)}function s(e,t){return void 0===t&&(t=!0),!!e&&(o.indexOf(e.toLowerCase())>=0||t&&c.indexOf(e.toLowerCase())>=0&&(Object(a.e)()||Object(a.d)()||Object(a.h)()||Object(a.g)()&&!Object(a.l)()))}},2065:function(e,t,n){"use strict";var r=new RegExp("^data:(image\\/\\w+);base64,([A-Za-z0-9+/=]+?)$","i");function i(e){var t=null,n=r.exec(e);if(n){var i=n[1],a=n[2],o=null;try{o=atob(a)}catch(e){}if(o){for(var c=new ArrayBuffer(o.length),u=new Uint8Array(c),s=0;s<o.length;s++)u[s]=o.charCodeAt(s);t=new File([c],"image.png",{type:i})}}return t}var a=n(1969),o=n(1992);function c(e){return e.map((function(e){return{fileType:a.a.Uri,name:e.name,type:Object(o.b)(e.url)||"",size:0,uri:e.url}}))}var u=n(23);function s(e,t,n){if(e.length!=t.length)return u.d("The sizes of subjects and latestItemIds are different"),null;for(var r=[],i=0;i<e.length;i++){var o={fileType:a.a.MailItem,name:e[i],size:(null==n?void 0:n[i])||0,itemId:t[i]};r.push(o)}return r}function l(e,t,n){var r=[],i={fileType:a.a.MailItem,name:e,size:n||0,mimeContent:t};return r.push(i),r}function d(e){if(!e)return null;for(var t=[],n=0;n<e.length;n++){var r=e[n],i={fileType:a.a.Local,name:r.name,size:r.size,type:r.type,fileObject:r};t.push(i)}return t}function f(e){if(!e)return null;for(var t=[],n=0;n<e.length;n++){var r=e[n],i={fileType:r.fileType,name:r.name,size:r.size,type:r.type,dataUri:r.dataUri};t.push(i)}return t}function b(e){var t,n;return null===e?null:{fileType:a.a.Cloud,name:e.Name,size:e.Size,providerId:e.AttachmentProviderId,providerType:e.ProviderType,location:e.Location,providerEndpointUrl:e.ProviderEndpointUrl,isFolder:1===e.Type,fileId:e.Id,fileParentId:e.ParentId,thumbnailUrl:(null===(t=e.Thumbnail)||void 0===t?void 0:t.Url)||"",previewUrl:(null===(n=e.Preview)||void 0===n?void 0:n.Url)||"",type:e.MimeType}}function m(e){return null===e?null:{attachmentItemId:e.Id,name:e.Name,size:e.Size,fileType:a.a.AttachmentItem,type:"ItemIdAttachment:#Exchange"}}var v={BOX:"Box",DROPBOX:"Dropbox",FACEBOOK:"Facebook",GDRIVE:"GDrive",MAILBOX:"Mailbox",ONE_DRIVE_CONSUMER:"OneDriveConsumer",ONE_DRIVE_PRO:"OneDrivePro",RECENT_ATTACHMENTS:"RecentAttachments",WOPI:"Wopi",WOPI_BOX:"WopiBox",WOPI_EGNYTE:"WopiEgnyte"};function h(e){switch(e?e.toLowerCase():null){case v.ONE_DRIVE_PRO.toLowerCase():return 0;case v.GDRIVE.toLowerCase():return 5;case v.ONE_DRIVE_CONSUMER.toLowerCase():return 1;case v.DROPBOX.toLowerCase():return 2;case v.BOX.toLowerCase():return 3;case v.WOPI_BOX.toLowerCase():return 7;case v.WOPI_EGNYTE.toLowerCase():return 8;case v.MAILBOX.toLowerCase():return 4;case v.FACEBOOK.toLowerCase():return 6;default:return null}}n.d(t,"f",(function(){return i})),n.d(t,"j",(function(){return c})),n.d(t,"i",(function(){return s})),n.d(t,"h",(function(){return l})),n.d(t,"g",(function(){return d})),n.d(t,"d",(function(){return f})),n.d(t,"e",(function(){return b})),n.d(t,"c",(function(){return m})),n.d(t,"b",(function(){return h})),n.d(t,"a",(function(){return a.a}))},2140:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(94);function i(e){switch(e){case 0:return"ReadOnlyAccess";case 1:return"ReadOnlyPlusAttachmentsBlockedAccess";case 2:return null;default:return Object(r.a)(e)}}},2161:function(e,t,n){"use strict";var r;function i(){return[r.noPermissionToShare,r.getSharingInfoFailed,r.linkHasExpired,r.linkWillExpire,r.noPermissionToShareExternally,r.externalRecipientCSL,r.noPermissionSet,r.sharingWithLargeDL]}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i})),function(e){e.noPermissionToShare="WarningNoPermissionToShare",e.getSharingInfoFailed="WarningGetSharingInfoFailed",e.linkHasExpired="WarningLinksHasExpired",e.linkWillExpire="WarningLinksWillExpire",e.noPermissionToShareExternally="WarningExternalRecipientButNoPermissionToShareExternally",e.externalRecipientCSL="WarningExternalRecipientsCannotOpenCSLs",e.noPermissionSet="WarningOnlyPeopleWithExistingAccessCanAccess",e.sharingWithLargeDL="WarningNotAllMembersOfDLCanAccess"}(r||(r={}))},2210:function(e){e.exports=JSON.parse('{"b":"Nea","d":"Oea","c":"Pea","a":"Qea"}')},2253:function(e,t,n){"use strict";var r=n(2004);function i(){var e=Object(r.a)();return e.ConditionalAccessDirectFileAccessOnPrivateComputersBlocked||e.ConditionalAccessDirectFileAccessOnPublicComputersBlocked?e.ConditionalAccessWacViewingOnPrivateComputersBlocked||e.ConditionalAccessWacViewingOnPublicComputersBlocked?[1]:[0]:[]}var a=n(2140),o=n(2110);function c(){return i()}function u(e){return(e&&e.length>0&&function(e){return e.some((function(e){return!((t=e).IsInline&&!Object(o.a)(t));var t}))}(e)?i():[]).map(a.a)}n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return u}))},2309:function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.InProgress=0]="InProgress",e[e.Failed=1]="Failed",e[e.Succeeded=2]="Succeeded"}(r||(r={}))},2330:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2),i=Object(r.action)("REFRESH_EXPIRATION_DATE",(function(e){return{id:e}}))},2331:function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.ignore=0]="ignore",e[e.refreshExpiration=1]="refreshExpiration",e[e.changePermission=2]="changePermission",e[e.attachAsACopy=3]="attachAsACopy"}(r||(r={}))},2359:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var r=n(2212);function i(e){return o(e.type)}function a(e){return o(Object(r.a)(e))}function o(e){return 1===e||3===e}},2360:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(209),i=n(374);function a(e){if("ArchiveMailbox"==e.type)return Object(r.a)();var t=e.userIdentity&&Object(i.r)(e.userIdentity),n="GroupMailbox"===e.type;return t&&!n?Object(r.b)(e.mailboxSmtpAddress)+e.userIdentity:"UserMailbox"===e.type?Object(r.a)():e.mailboxSmtpAddress}},2361:function(e,t,n){"use strict";var r=n(374),i=n(1),a={};function o(e){return a[e]}function c(e,t){var n=a[e];a[e]=Object(i.a)(Object(i.a)({},n),t)}var u=n(57),s=n(33);var l=n(121),d=n(23),f=n(742),b=n(1986),m=n(1989);function v(e){return Object(i.c)(this,void 0,void 0,(function(){var t,n;return Object(i.f)(this,(function(r){switch(r.label){case 0:return(t={}).headers=new Headers,[4,Object(b.a)(e)];case 1:return n=r.sent(),Object(m.b)(t.headers,n),[2,t]}}))}))}var h=Object(f.b)({timeBetweenRetryInMS:function(){return 3e4}});function p(e,t){t=t<1?1:t,setInterval((function(){!function(e){Object(i.c)(this,void 0,void 0,(function(){var t,n,a,u,f,b,m=this;return Object(i.f)(this,(function(p){switch(p.label){case 0:if(t=function(){return Object(i.c)(m,void 0,void 0,(function(){var t,n;return Object(i.f)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),t={},Object(r.r)(e.userIdentity)?[4,v(e.userIdentity)]:[3,2];case 1:t=i.sent(),i.label=2;case 2:return[2,(a=t,Object(s.a)("GetAttachmentDownloadToken",{},a))];case 3:throw n=i.sent(),d.g.warn("Unable to get the download token "+n),n.networkError=!0,n;case 4:return[2]}var a}))}))},null==(n=o(e.userIdentity))?void 0:n.isRefreshingDownloadToken)return[3,4];c(e.userIdentity,{isRefreshingDownloadToken:!0}),a=0,u=h((function(){return Object(i.c)(m,void 0,void 0,(function(){var n;return Object(i.f)(this,(function(r){switch(r.label){case 0:return a++,[4,t()];case 1:return n=r.sent(),d.g.info("update new token"),c(e.userIdentity,{downloadToken:n,isRefreshingDownloadToken:!1}),[2]}}))}))})).retriableFunc,f=new l.c("AttachmentRefreshDownloadToken"),p.label=1;case 1:return p.trys.push([1,3,,4]),[4,u()];case 2:return p.sent(),f.addCustomData([a]),f.end(),[3,4];case 3:return b=p.sent(),d.g.warn("Retry to refresh token failed: "+b),f.addCustomData([a]),f.endWithError("ServerError",b),c(e.userIdentity,{isRefreshingDownloadToken:!1}),[3,4];case 4:return[2]}}))}))}(e)}),6e4*t)}var O=n(94);function g(e){var t=Object(r.j)(null==e?void 0:e.userIdentity),n=o(null==e?void 0:e.userIdentity);if((null==n?void 0:n.downloadToken)&&(null==n?void 0:n.downloadUrlBase))return n;switch(t){case null:case"Outlook":!function(e){var t=Object(r.r)(e.userIdentity)?Object(u.i)(e.userIdentity):Object(u.h)(),n=null==t?void 0:t.ApplicationSettings;if(n){var i=n.DownloadUrlBase;c(e.userIdentity,{downloadUrlBase:i,downloadToken:n.FirstDownloadToken}),i&&p(e,n.DownloadTokenRefreshMinutes)}}(e);break;case"Google":case"ICloud":break;default:Object(O.a)(t)}var i=o(e.userIdentity);return i||(Object(l.s)("FilesUrlDataNotFound",{accountProviderType:t}),d.g.warn("Unable to get the url data")),i}function j(e){if(!e)return null;var t=g(e);return null==t?void 0:t.downloadToken}n.d(t,"b",(function(){return g})),n.d(t,"a",(function(){return j}))},2399:function(e,t,n){"use strict";n.d(t,"h",(function(){return s})),n.d(t,"i",(function(){return l})),n.d(t,"f",(function(){return d})),n.d(t,"k",(function(){return f})),n.d(t,"m",(function(){return b})),n.d(t,"e",(function(){return m})),n.d(t,"g",(function(){return v})),n.d(t,"j",(function(){return h})),n.d(t,"l",(function(){return p}));var r=n(31),i=n(2330);n.d(t,"n",(function(){return i.a}));var a=n(2309);n.d(t,"a",(function(){return a.a}));var o=n(2161);n.d(t,"d",(function(){return o.b})),n.d(t,"c",(function(){return o.a}));var c=n(2331);n.d(t,"b",(function(){return c.a}));var u=new r.c((function(){return Promise.all([n.e(4),n.e(42),n.e(81),n.e(819)]).then(n.bind(null,3601))})),s=new r.b(u,(function(e){return e.getSharingInformation})),l=new r.b(u,(function(e){return e.getSharingIssuesForSharingData})),d=new r.b(u,(function(e){return e.getInfoBarCreator})),f=new r.b(u,(function(e){return e.hasLargeDLRecipient})),b=new r.b(u,(function(e){return e.hasRecipientExpansionFailure})),m=new r.b(u,(function(e){return e.getGroupsAndSmallDLs})),v=new r.b(u,(function(e){return e.getInvididualRecipients})),h=new r.b(u,(function(e){return e.hasGetRecipientPermissionFailed})),p=new r.b(u,(function(e){return e.logSharingTipChangesForLinkRemoval}))},2458:function(e){e.exports=JSON.parse('{"a":"Cda"}')},2495:function(e,t,n){"use strict";var r=n(31),i=[0,1],a=n(2505),o=n(2458),c=n(6),u=n(94),s=n(2029);function l(e){switch(e){case"ReadOnlyPlusAttachmentsBlockedAccess":return{key:"access_control_info_bar",source:s.c.Compose,rank:s.b.Error,message:Object(c.b)(o.a),messageParts:[Object(c.b)(o.a),d()],color:s.a.Red};case"ReadOnlyAccess":return{key:"access_control_info_bar_check",source:s.c.Compose,rank:s.b.Error,message:Object(c.b)(a.b),messageParts:[Object(c.b)(a.b),d()],color:s.a.Red};default:return Object(u.a)(e)}}function d(){return{text:Object(c.b)(a.a),action:function(){window.open("https://docs.microsoft.com/en-us/intune-user-help/use-managed-devices-to-get-work-done","_blank")}}}var f=n(2253),b=n(2140),m=n(1),v=n(24),h=n(2004);function p(){var e=Object(h.a)();if(Object(v.i)("fwk-devTools")){if(Object(v.i)("doc-attachment-CA-readOnlyAccessIssues"))return Object(m.a)(Object(m.a)({},e),{DirectFileAccessOnPrivateComputersEnabled:!1,DirectFileAccessOnPublicComputersEnabled:!1,WacViewingOnPrivateComputersEnabled:!0,WacViewingOnPublicComputersEnabled:!0});if(Object(v.i)("doc-attachment-CA-readOnlyPlusAttachmentsBlocked"))return Object(m.a)(Object(m.a)({},e),{DirectFileAccessOnPrivateComputersEnabled:!1,DirectFileAccessOnPublicComputersEnabled:!1,WacViewingOnPrivateComputersEnabled:!1,WacViewingOnPublicComputersEnabled:!1})}return e}function O(){var e=p();return e.DirectFileAccessOnPrivateComputersEnabled&&e.DirectFileAccessOnPublicComputersEnabled?2:e.WacViewingOnPrivateComputersEnabled&&e.WacViewingOnPublicComputersEnabled?0:1}n.d(t,"g",(function(){return j})),n.d(t,"a",(function(){return i})),n.d(t,"f",(function(){return l})),n.d(t,"b",(function(){return f.a})),n.d(t,"e",(function(){return b.a})),n.d(t,"d",(function(){return O})),n.d(t,"c",(function(){return p}));var g=new r.c((function(){return n.e(1708).then(n.bind(null,18005))})),j=new r.b(g,(function(e){return e.getAccessIssuesForAttachments}))},2505:function(e){e.exports=JSON.parse('{"a":"Ada","b":"Bda"}')},2508:function(e,t,n){"use strict";var r=n(2551);n.d(t,"a",(function(){return r.a})),n.d(t,"b",(function(){return r.b}));var i=n(2361);n.d(t,"c",(function(){return i.a}));var a=n(2360);n.d(t,"d",(function(){return a.a}))},2551:function(e,t,n){"use strict";var r=n(94),i=n(6),a=n(65),o="/owa/",c="service.svc/s/GetFileAttachment?id={0}",u="service.svc/s/GetReferenceAttachment?attachmentId={0}&location={1}",s="service.svc/s/GetAttachmentThumbnail?id={0}&thumbnailType=2",l="service.svc/s/GetReferenceAttachment?attachmentId={0}&location={1}&isImagePreview=True",d="service.svc/s/GetAttachmentThumbnail?id={0}",f="pdfprint.aspx?id={0}",b="pdfprint.aspx?id={0}&location={1}",m=[".bmp",".gif",".jpe",".jpeg",".jpg",".jfif",".dib",".png",".psd",".tiff",".tif"];var v=n(197),h=n(67),p=n(4),O=n(34),g=n(2361),j=n(2360);function w(e,t,n,r,c){if(void 0===r&&(r=!1),void 0===c&&(c=null),!e||!e.Id||!e.mailboxInfo)return null;var u=Object(g.b)(e.mailboxInfo),s=null==u?void 0:u.downloadUrlBase,l=Object(j.a)(e.mailboxInfo);if(c=c||Object(i.c)(t,encodeURIComponent(e.Id)),!s||r&&"Firefox"===Object(h.a)().browser){var d=o+c+"&X-OWA-CANARY="+Object(a.a)();return Object(O.a)(d)}var f="{0}{1}/{2}";Object(v.a)()&&(f+="&isc=1");var b=Object(i.c)(f,s,l,c);return n&&(b+="&token="+(null==u?void 0:u.downloadToken),b+="&X-OWA-CANARY="+Object(a.a)()),Object(h.i)()||(b+="&owa="+window.location.hostname,b+="&scriptVer="+Object(p.r)()||!1),b}function I(e,t,n,c,s,d,f,v,h){var p;switch(void 0===s&&(s=0),void 0===d&&(d=0),void 0===f&&(f=!0),void 0===v&&(v=null),void 0===h&&(h=null),n){case 0:p=u;break;case 3:p=b;break;case 1:if(!function(e){if(!e)return!1;var t=null,n=e.lastIndexOf(".");return n>0&&(t=e.substr(n).toLowerCase()),!!t&&m.indexOf(t.toLowerCase())>=0}(v))return null;p=l;break;default:Object(r.a)(n)}var g=c?d:s;!g&&s&&(g=s);var j=Object(i.c)("{0}&permissionLevel={1}",Object(i.c)(p,encodeURIComponent(e.Id),encodeURIComponent(t)),g),I=w(e,p,!0,3===n,j);if(I)return I;var A=Object(i.c)("{0}{1}{2}",o,h,j);f&&(A=A+"&X-OWA-CANARY="+Object(a.a)());return Object(O.a)(A)}function A(e,t,n,a){var o;switch(void 0===n&&(n=!1),void 0===a&&(a=!0),t){case 0:o=c;break;case 1:o=s;break;case 2:o=d;break;case 3:o=f;break;default:return Object(r.a)(t)}if(!Object(i.f)(o)){var u=w(e,o,a,3===t);return Object(i.c)("{0}{1}{2}",u,n?"&isDownload=true":"","&animation=true")}return null}n.d(t,"b",(function(){return I})),n.d(t,"a",(function(){return A}))},2704:function(e,t,n){"use strict";var r=n(94),i=n(2508),a=n(65),o=n(3159);function c(e,t,n,a,c){var u;void 0===c&&(c=!0);var s=t,l=s.Name,d=s.OriginalPermissionType,f=s.PermissionType,b=Object(o.a)(t),m="GroupMailbox"===(null===(u=null==e?void 0:e.mailboxInfo)||void 0===u?void 0:u.type)?e.mailboxInfo.mailboxSmtpAddress+"/":null;switch(n){case 0:case 3:return i.b(e,b,n,a,f,d,c,l,m);case 1:return t.AttachmentPreviewUrl?t.AttachmentPreviewUrl:i.b(e,b,1,a,f,d,c,l,m);case 2:return t.AttachmentThumbnailUrl;default:return Object(r.a)(n)}}function u(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),i.a(e,t,n,r)}function s(e,t,n,r,o){void 0===o&&(o=!1);var s=n?c(e,t,1,r,!1):u(e,1,o,!1);if(n)return{url:s,init:{credentials:"include"}};var l=Object(i.c)(e.mailboxInfo),d=new Headers;return d.set("X-Token",l),d.set("X-OWA-CANARY",Object(a.a)()),{url:s,init:{headers:d}}}function l(e,t,n,r,i,a){return void 0===a&&(a=!1),r?c(e,t,n,i):u(e,n,a)}n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return s}))},3159:function(e,t,n){"use strict";function r(e){var t=null;return(t=e.AttachLongPathName)||(t=e.WebUrl),t}n.d(t,"a",(function(){return r}))},326:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return o}));var r,i=n(1);function a(e){r=e}function o(){var e,t;return Object(i.c)(this,void 0,void 0,(function(){var n,a;return Object(i.f)(this,(function(i){switch(i.label){case 0:return(a=r)?[4,r()]:[3,2];case 1:a=i.sent(),i.label=2;case 2:if((n=a)&&n.length>0){if("bearer"===(null===(e=null==n?void 0:n.split(" ")[0])||void 0===e?void 0:e.toLowerCase()))return[2,n.split(" ")[1]];if("msauth1.0"===(null===(t=null==n?void 0:n.split(" ")[0])||void 0===t?void 0:t.toLowerCase()))return[2,n]}return[2,void 0]}}))}))}},3605:function(e,t,n){"use strict";n.r(t);var r=n(1),i=n(2),a=Object(i.action)("checkPendingAttachmentOperation",(function(e,t,n,r,i){return{attachmentId:e,itemId:t,operationId:n,operationType:r,completeHandler:i}}));function o(e){return Object(r.a)({__type:"CheckPendingAttachmentOperationRequest:#Exchange"},e)}var c=n(33);function u(e,t,n,r,i){var a,u,s=function(e,t,n,r){return o({ewsAttachmentId:e,itemId:t,operationId:n,operationType:r})}(e,t,n,r);return u=i,void 0===(a=s)||a.__type||(a=o(a)),Object(c.a)("CheckPendingAttachmentOperation",a,u)}var s=n(23),l=n(419),d=(Object(i.orchestrator)(a,(function(e){return Object(r.c)(void 0,void 0,void 0,(function(){var t,n,i;return Object(r.f)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t=e.itemId?e.itemId.mailboxInfo:e.attachmentId.mailboxInfo,[4,u(e.attachmentId?e.attachmentId.Id:null,e.itemId?e.itemId.Id:null,e.operationId,e.operationType,Object(l.a)(t))];case 1:return n=r.sent(),e.completeHandler(n),[3,3];case 2:return i=r.sent(),s.g.warn("checkPendingAttachmentOperationAction is failing with error: "+i),[3,3];case 3:return[2]}}))}))})),n(2113)),f=n(1996),b=n(2399),m=n(6798);Object(i.orchestrator)(b.n,(function(e){return Object(r.c)(void 0,void 0,void 0,(function(){var t,n;return Object(r.f)(this,(function(r){switch(r.label){case 0:return"object"!=typeof e.id?[3,2]:(t=Object(f.a)(e.id))?(n=t.model,[4,Object(m.a)([e.id],n.PermissionType)]):[3,2];case 1:r.sent(),Object(d.a)(t.id),r.label=2;case 2:return[2]}}))}))})),Object(i.mutator)(d.b,(function(e){var t=e.attachmentId,n=e.attachmentContentId;Object(f.a)(t).model.ContentId=n})),Object(i.mutator)(d.c,(function(e){var t=e.attachmentId,n=e.isInline;Object(f.a)(t).model.IsInline=n}));var v=n(4355),h=n(183),p=Object(h.action)("setPreviewImageUrl")((function(e,t){Object(f.a)(e).previewImage.url=t})),O=n(6140),g=n(6005),j=n(2230),w=n(4865),I=n(2359),A=n(2704);function y(e){return Object(r.c)(this,void 0,void 0,(function(){var t;return Object(r.f)(this,(function(n){switch(n.label){case 0:return[4,Object(w.a)(e)];case 1:if(null==(t=n.sent()))throw new Error("URL not available");return"2",[2,t+"2"]}}))}))}var x=Object(h.action)("refreshPreviewImageUrl")((function(e,t,n){return void 0===n&&(n=!1),Object(r.c)(this,void 0,void 0,(function(){var i,a,o;return Object(r.f)(this,(function(r){switch(r.label){case 0:return i=Object(f.a)(e),Object(I.b)(i.model)&&i.model.ProviderType===j.e?[4,y(i.model)]:[3,2];case 1:return a=r.sent(),p(e,a),[3,3];case 2:Object(I.b)(i.model)&&i.model.ProviderType!==j.h&&i.model.ProviderType!==j.i||(o=Object(A.a)(e,i.model,1,1===i.type,t,n),p(e,o)),r.label=3;case 3:return[2]}}))}))})),P=n(4708),C=n(6347),E=Object(h.action)("setAttachmentInfo")((function(e,t){Object(f.a)(e).info=t}));n.d(t,"addAndInitializeAttachments",(function(){return v.a})),n.d(t,"setPreviewImageUrl",(function(){return p})),n.d(t,"refreshDownloadUrl",(function(){return O.a})),n.d(t,"refreshThumbnailImageUrl",(function(){return g.a})),n.d(t,"refreshPreviewImageUrl",(function(){return x})),n.d(t,"getAttachment",(function(){return f.a})),n.d(t,"checkPendingAttachmentOperation",(function(){return a})),n.d(t,"shouldShowImageView",(function(){return P.a})),n.d(t,"createAttachmentInfo",(function(){return C.a})),n.d(t,"setAttachmentInfo",(function(){return E}))},419:function(e,t,n){"use strict";var r=n(1);function i(e,t){return e?Object(r.a)({mailboxInfo:e},t):null!=t?t:void 0}n.d(t,"a",(function(){return i}))},6005:function(e,t,n){"use strict";var r=n(1),i=n(1996),a=n(2230),o=n(4865),c=n(2359),u=n(2704),s=n(183);t.a=Object(s.action)("refreshThumbnailImageUrl")((function(e,t,n){return void 0===n&&(n=!1),Object(r.c)(this,void 0,void 0,(function(){var s,l;return Object(r.f)(this,(function(r){switch(r.label){case 0:if(s=Object(i.a)(e),!Object(c.b)(s.model))return[3,7];switch(s.model.ProviderType){case a.e:return[3,1]}return[3,5];case 1:return r.trys.push([1,3,,4]),[4,Object(o.a)(s.model)];case 2:return l=r.sent(),s.thumbnailImage.url=l,[3,4];case 3:return r.sent(),s.thumbnailImage.url=null,[3,4];case 4:case 5:return[3,6];case 6:return[3,8];case 7:l=Object(u.a)(e,s.model,2,Object(c.b)(s.model),t,n),s.thumbnailImage.url=l,r.label=8;case 8:return[2]}}))}))}))},6168:function(e,t,n){"use strict";var r=n(2113),i=n(1996),a=n(6604),o=n(24),c=n(183);t.a=Object(c.action)("setAttachmentPermissionLevel")((function(e,t,n,c){var u=Object(i.a)(e),s=u.model;s.PermissionType=t,n&&(s.AttachLongPathName=n,u.openUrl=Object(a.a)(s)),Object(o.i)("doc-attachment-referenceAttachmentExpiration")&&u.info&&u.info.sharingInfo&&(u.info.sharingInfo.expirationDate=c),Object(r.a)(e)}))},6798:function(e,t,n){"use strict";var r=n(1),i=n(183),a=n(5),o=n(6168);function c(e){return Object(r.a)({__type:"SetAttachmentPermissionsRequest:#Exchange"},e)}var u=n(33);function s(e,t,n,r){void 0===n&&(n=null),void 0===r&&(r=!1);var i,a,o=function(e,t,n,r){return void 0===n&&(n=null),void 0===r&&(r=!1),c({AttachmentIds:e,PermissionLevel:t,NewAttachLongPathNames:n,SetToOriginalPermissionLevel:r})}(e,t,n,r);return void 0===(i={request:o}).request||i.request.__type||(i.request=c(i.request)),Object(u.a)("SetAttachmentPermissionsV2",i,a)}t.a=Object(i.action)("changeAttachmentPermission")((function(e,t,n,i){return void 0===n&&(n=null),void 0===i&&(i=!1),Object(r.c)(this,void 0,void 0,(function(){var c;return Object(r.f)(this,(function(r){switch(r.label){case 0:return[4,s(e.map((function(e){return e.Id})),t,n,i)];case 1:if(!(c=r.sent()).OperationSucceeded||!c.NewAttachLongPathNames||c.NewAttachLongPathNames.length!==e.length)throw new Error("Error setting attachment permissions");return e.forEach((function(e,n){var r,i=null;(null===(r=c.ExpirationDates)||void 0===r?void 0:r[n])&&(i=Object(a.nc)(c.ExpirationDates[n])),Object(o.a)(e,t,c.NewAttachLongPathNames[n],i)})),[2]}}))}))}))},742:function(e,t,n){"use strict";function r(e){void 0===e&&(e={}),function(e){e.timeBetweenRetryInMS=e.timeBetweenRetryInMS||function(){return 6e4}}(e);var t=e.maximumAttempts,n=e.timeBetweenRetryInMS;return function(e){var r=0,i=!1,a=function(o,c){i?c(new Error("The function retry was cancelled")):(r++,e().then((function(e){return o(e)})).catch((function(e){t&&r>=t?c(e):setTimeout((function(){return a(o,c)}),n(r))})))};return{retriableFunc:function(){return new Promise((function(e,t){return a(e,t)}))},cancel:function(){return i=!0}}}}function i(e){return function(t){return Math.pow(2,t)*e}}n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i}))}}]);
//# sourceMappingURL=owa.MailBoot~AttachmentModelStore.js.map
self.scriptsLoaded['owa.MailBoot~AttachmentModelStore.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~AttachmentModelStore.js'] = (new Date()).getTime();