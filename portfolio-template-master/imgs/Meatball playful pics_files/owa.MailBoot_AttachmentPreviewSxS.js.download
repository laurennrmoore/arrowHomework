self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~AttachmentPreviewSxS.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[541],{16896:function(e){e.exports=JSON.parse('{"a":"lbb"}')},1996:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(2143);function a(e){return Object(r.a)().attachments.get(e.Id)}},2036:function(e,t,n){"use strict";n.d(t,"b",(function(){return u}));var r=n(1),a=n(14),i=n(24),o=n(2066),c=n(2),s={conversationReadingPaneViewState:null,loadedItemReadingPaneViewStates:new a.ObservableMap({}),loadedConversationReadingPaneViewStates:new a.ObservableMap({}),itemReadingPaneViewState:null,itemPreviewPaneViewState:null,itemPrintPaneViewState:null,deeplinkId:null,shouldShowMobileUpsellEmptyState:!1,primaryReadingPaneTabId:null,sxsItemId:null},u=Object(c.createStore)("readingpane",s),d=u();o.a.registerReference((function(){var e,t;return Object(i.i)("rp-persistedReadingPaneTabs")?Object(r.j)([],Object(r.g)(d.loadedConversationReadingPaneViewStates.keys())):null===(t=null===(e=d.conversationReadingPaneViewState)||void 0===e?void 0:e.conversationId)||void 0===t?void 0:t.Id})),t.a=d},2093:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(2036),a=n(24),i=n(2442);function o(e){return Object(a.i)("rp-persistedReadingPaneTabs")?Object(r.b)().loadedConversationReadingPaneViewStates.get(e||Object(r.b)().sxsItemId||Object(i.a)()):Object(r.b)().conversationReadingPaneViewState}},2119:function(e,t,n){"use strict";var r=n(14),a=n(2),i={viewStates:new r.ObservableMap,primaryComposeId:null,newMessageCreationInProgress:!1},o=Object(a.createStore)("compose",i),c=o();n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return o}))},2158:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"e",(function(){return c})),n.d(t,"c",(function(){return s}));var r=n(1);function a(e){return Object(r.a)({},e)}function i(e){return Object(r.a)({},e)}function o(e){return Object(r.a)({},e)}function c(e){return Object(r.a)({},e)}function s(e){return Object(r.a)({},e)}},2161:function(e,t,n){"use strict";var r;function a(){return[r.noPermissionToShare,r.getSharingInfoFailed,r.linkHasExpired,r.linkWillExpire,r.noPermissionToShareExternally,r.externalRecipientCSL,r.noPermissionSet,r.sharingWithLargeDL]}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a})),function(e){e.noPermissionToShare="WarningNoPermissionToShare",e.getSharingInfoFailed="WarningGetSharingInfoFailed",e.linkHasExpired="WarningLinksHasExpired",e.linkWillExpire="WarningLinksWillExpire",e.noPermissionToShareExternally="WarningExternalRecipientButNoPermissionToShareExternally",e.externalRecipientCSL="WarningExternalRecipientsCannotOpenCSLs",e.noPermissionSet="WarningOnlyPeopleWithExistingAccessCanAccess",e.sharingWithLargeDL="WarningNotAllMembersOfDLCanAccess"}(r||(r={}))},2179:function(e,t){e.exports=function(e){return e instanceof Date}},2190:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(1);function a(e){return Object(r.a)({__type:"UnifiedGroupIdentity:#Exchange"},e)}},2227:function(e,t,n){"use strict";var r=n(871),a=n(613),i=n(1);function o(e){return Object(i.a)({__type:"SingleLargeArchiveSearchScopeType:#Exchange"},e)}function c(e){return Object(i.a)({__type:"SearchFolderScopeType:#Exchange"},e)}var s=n(2190),u=n(1964);var d=n(1244),l=n(2158),f=n(1959),b=n(2222);n.d(t,"a",(function(){return I})),n.d(t,"b",(function(){return O})),n.d(t,"c",(function(){return j}));var p={getKey:function(e){return e.kind+"-"+e.folderId},getSearchScopeList:function(){var e,t,n=[];n.push(Object(l.b)({folderId:Object(d.a)(f.j),kind:"PrimaryMailbox"}));var r=Object(b.b)("UserMailbox");try{for(var a=Object(i.k)(r),o=a.next();!o.done;o=a.next()){var c=o.value;n.push(Object(l.b)({folderId:c,kind:"PrimaryMailbox"}))}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n},getSearchScopeType:function(e){var t,n,o=Object(u.a)(e.folderId);return t="none"!=o?Object(r.a)({Id:o}):Object(a.a)({Id:e.folderId}),[(n={FolderScope:c({BaseFolderId:t}),IsDeepTraversal:!0},Object(i.a)({__type:"PrimaryMailboxSearchScopeType:#Exchange"},n))]}},m={getKey:function(e){return e.kind+"-"+e.folderId},getSearchScopeList:function(){var e=[];return e.push(Object(l.a)({folderId:Object(d.a)(f.d),kind:"ArchiveMailbox"})),e.push(Object(l.a)({folderId:Object(d.a)(f.a),kind:"ArchiveMailbox"})),e},getSearchScopeType:function(e){var t,n,s=Object(u.a)(e.folderId);return t="none"!=s?Object(r.a)({Id:s}):Object(a.a)({Id:e.folderId}),"archivemsgfolderroot"==s?[(n={ArchiveTypes:16777215},Object(i.a)({__type:"LargeArchiveSearchScopeType:#Exchange"},n))]:[o({FolderScope:c({BaseFolderId:t})})]}},v={getKey:function(e){return e.kind+"-"+e.folderId},getSearchScopeList:function(){return[]},getSearchScopeType:function(e){return null}},h={getKey:function(e){return e.kind+"-"+e.groupId.toLowerCase()},getSearchScopeList:function(){return[]},getSearchScopeType:function(e){return[(t={GroupIdentity:Object(s.a)({Type:0,Value:e.groupId})},Object(i.a)({__type:"SingleGroupSearchScopeType:#Exchange"},t))];var t}},w={getKey:function(e){return e.kind+"-"+e.calendarFolderId?e.calendarFolderId.toLowerCase():""},getSearchScopeList:function(){return[]},getSearchScopeType:function(e){return null}},g={getKey:function(e){return e.kind+"-"+e.folderId},getSearchScopeList:function(){return[]},getSearchScopeType:function(e){return null}},S=function(e){switch(e.kind){case"PrimaryMailbox":return p;case"ArchiveMailbox":return m;case"SharedFolders":return v;case"Group":return h;case"Calendar":return w;case"PublicFolder":return g;default:throw new Error("Unregistered search scope")}},I=function(e){return S(e).getKey(e)},O=function(e){return S(e).getSearchScopeList()},j=function(e){return S(e).getSearchScopeType(e)}},2243:function(e,t,n){var r=n(2179),a=36e5,i=6e4,o=2,c=/[T ]/,s=/:/,u=/^(\d{2})$/,d=[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],l=/^(\d{4})/,f=[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],b=/^-(\d{2})$/,p=/^-?(\d{3})$/,m=/^-?(\d{2})-?(\d{2})$/,v=/^-?W(\d{2})$/,h=/^-?W(\d{2})-?(\d{1})$/,w=/^(\d{2}([.,]\d*)?)$/,g=/^(\d{2}):?(\d{2}([.,]\d*)?)$/,S=/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,I=/([Z+-].*)$/,O=/^(Z)$/,j=/^([+-])(\d{2})$/,P=/^([+-])(\d{2}):?(\d{2})$/;function x(e,t,n){t=t||0,n=n||0;var r=new Date(0);r.setUTCFullYear(e,0,4);var a=7*t+n+1-(r.getUTCDay()||7);return r.setUTCDate(r.getUTCDate()+a),r}e.exports=function(e,t){if(r(e))return new Date(e.getTime());if("string"!=typeof e)return new Date(e);var n=(t||{}).additionalDigits;n=null==n?o:Number(n);var y=function(e){var t,n={},r=e.split(c);s.test(r[0])?(n.date=null,t=r[0]):(n.date=r[0],t=r[1]);if(t){var a=I.exec(t);a?(n.time=t.replace(a[1],""),n.timezone=a[1]):n.time=t}return n}(e),C=function(e,t){var n,r=d[t],a=f[t];if(n=l.exec(e)||a.exec(e)){var i=n[1];return{year:parseInt(i,10),restDateString:e.slice(i.length)}}if(n=u.exec(e)||r.exec(e)){var o=n[1];return{year:100*parseInt(o,10),restDateString:e.slice(o.length)}}return{year:null}}(y.date,n),T=C.year,A=function(e,t){if(null===t)return null;var n,r,a,i;if(0===e.length)return(r=new Date(0)).setUTCFullYear(t),r;if(n=b.exec(e))return r=new Date(0),a=parseInt(n[1],10)-1,r.setUTCFullYear(t,a),r;if(n=p.exec(e)){r=new Date(0);var o=parseInt(n[1],10);return r.setUTCFullYear(t,0,o),r}if(n=m.exec(e)){r=new Date(0),a=parseInt(n[1],10)-1;var c=parseInt(n[2],10);return r.setUTCFullYear(t,a,c),r}if(n=v.exec(e))return i=parseInt(n[1],10)-1,x(t,i);if(n=h.exec(e)){i=parseInt(n[1],10)-1;var s=parseInt(n[2],10)-1;return x(t,i,s)}return null}(C.restDateString,T);if(A){var D,E=A.getTime(),R=0;return y.time&&(R=function(e){var t,n,r;if(t=w.exec(e))return(n=parseFloat(t[1].replace(",",".")))%24*a;if(t=g.exec(e))return n=parseInt(t[1],10),r=parseFloat(t[2].replace(",",".")),n%24*a+r*i;if(t=S.exec(e)){n=parseInt(t[1],10),r=parseInt(t[2],10);var o=parseFloat(t[3].replace(",","."));return n%24*a+r*i+1e3*o}return null}(y.time)),y.timezone?D=function(e){var t,n;if(t=O.exec(e))return 0;if(t=j.exec(e))return n=60*parseInt(t[2],10),"+"===t[1]?-n:n;if(t=P.exec(e))return n=60*parseInt(t[2],10)+parseInt(t[3],10),"+"===t[1]?-n:n;return 0}(y.timezone):(D=new Date(E+R).getTimezoneOffset(),D=new Date(E+R+D*i).getTimezoneOffset()),new Date(E+R+D*i)}return new Date(e)}},2309:function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.InProgress=0]="InProgress",e[e.Failed=1]="Failed",e[e.Succeeded=2]="Succeeded"}(r||(r={}))},2330:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(2),a=Object(r.action)("REFRESH_EXPIRATION_DATE",(function(e){return{id:e}}))},2331:function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.ignore=0]="ignore",e[e.refreshExpiration=1]="refreshExpiration",e[e.changePermission=2]="changePermission",e[e.attachAsACopy=3]="attachAsACopy"}(r||(r={}))},2359:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return i}));var r=n(2212);function a(e){return o(e.type)}function i(e){return o(Object(r.a)(e))}function o(e){return 1===e||3===e}},2399:function(e,t,n){"use strict";n.d(t,"h",(function(){return u})),n.d(t,"i",(function(){return d})),n.d(t,"f",(function(){return l})),n.d(t,"k",(function(){return f})),n.d(t,"m",(function(){return b})),n.d(t,"e",(function(){return p})),n.d(t,"g",(function(){return m})),n.d(t,"j",(function(){return v})),n.d(t,"l",(function(){return h}));var r=n(31),a=n(2330);n.d(t,"n",(function(){return a.a}));var i=n(2309);n.d(t,"a",(function(){return i.a}));var o=n(2161);n.d(t,"d",(function(){return o.b})),n.d(t,"c",(function(){return o.a}));var c=n(2331);n.d(t,"b",(function(){return c.a}));var s=new r.c((function(){return Promise.all([n.e(4),n.e(42),n.e(81),n.e(819)]).then(n.bind(null,3601))})),u=new r.b(s,(function(e){return e.getSharingInformation})),d=new r.b(s,(function(e){return e.getSharingIssuesForSharingData})),l=new r.b(s,(function(e){return e.getInfoBarCreator})),f=new r.b(s,(function(e){return e.hasLargeDLRecipient})),b=new r.b(s,(function(e){return e.hasRecipientExpansionFailure})),p=new r.b(s,(function(e){return e.getGroupsAndSmallDLs})),m=new r.b(s,(function(e){return e.getInvididualRecipients})),v=new r.b(s,(function(e){return e.hasGetRecipientPermissionFailed})),h=new r.b(s,(function(e){return e.logSharingTipChangesForLinkRemoval}))},2442:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2043),a=n(2627);function i(){var e=Object(r.d)();switch(e.type){case r.a.SecondaryReadingPane:return e.data.id.Id;case r.a.Primary:default:return Object(a.a)()}}},2485:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(2227);function a(e,t){return!(!e||!t)&&Object(r.a)(e)===Object(r.a)(t)}},2603:function(e,t,n){"use strict";n.d(t,"m",(function(){return i})),n.d(t,"l",(function(){return o})),n.d(t,"o",(function(){return c})),n.d(t,"q",(function(){return s})),n.d(t,"p",(function(){return u})),n.d(t,"b",(function(){return d})),n.d(t,"e",(function(){return l})),n.d(t,"g",(function(){return f})),n.d(t,"h",(function(){return b})),n.d(t,"k",(function(){return p})),n.d(t,"n",(function(){return m})),n.d(t,"r",(function(){return v})),n.d(t,"c",(function(){return h})),n.d(t,"d",(function(){return w})),n.d(t,"j",(function(){return g})),n.d(t,"f",(function(){return S})),n.d(t,"i",(function(){return I})),n.d(t,"a",(function(){return O}));var r=n(31),a=new r.c((function(){return Promise.all([n.e(4),n.e(22),n.e(26),n.e(43),n.e(42),n.e(77),n.e(78),n.e(82),n.e(194),n.e(908)]).then(n.bind(null,4342))})),i=new r.a(a,(function(e){return e.onSmimeItemAttachmentOpened})),o=new r.a(a,(function(e){return e.mergeSmimeDecodedMessageProperties})),c=(new r.b(a,(function(e){return e.fetchAndDecodeSmimeMessage})),new r.b(a,(function(e){return e.setSmimePropertiesInDraftMessage}))),s=new r.b(a,(function(e){return e.trySetSmimeProperties})),u=new r.b(a,(function(e){return e.tryAddSmimeProperties})),d=new r.b(a,(function(e){return e.createMailResponseBodyContent})),l=new r.b(a,(function(e){return e.downloadSmimeAttachment})),f=new r.b(a,(function(e){return e.getMergedSmimeViewState})),b=new r.b(a,(function(e){return e.getMergedSmimeViewStateForDraft})),p=new r.b(a,(function(e){return e.isSmimeItemDecoding})),m=new r.b(a,(function(e){return e.previewSmimeAttachment})),v=new r.b(a,(function(e){return e.updateSmimeAttachmentIds})),h=new r.b(a,(function(e){return e.createSmimeAttachmentsFromFiles})),w=new r.b(a,(function(e){return e.createSmimeAttachmentsViaSmimeQueueManager})),g=new r.b(a,(function(e){return e.initializeAttachmentStateForSmimeAttachments})),S=new r.b(a,(function(e){return e.getAttachmentsForSmimeResponse})),I=new r.b(a,(function(e){return e.getSmimeAttachmentsForRequest})),O=Object(r.d)(a,(function(e){return e.SignatureDetails}))},2627:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2036),a=n(514);function i(){var e,t;return Object(a.w)()?null===(e=Object(r.b)().deeplinkId)||void 0===e?void 0:e.id:null===(t=Object(r.b)().primaryReadingPaneTabId)||void 0===t?void 0:t.Id}},2656:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o}));var r=n(2),a=Object(r.action)("CONVERSATION_READY_TO_LOAD",(function(e,t){return{conversationId:e,nodeIdCollectionChange:t}})),i=Object(r.action)("UPDATE_ATTACHMENTS"),o=Object(r.action)("UPDATE_ITEM_MANDATORY_PROPERTIES",(function(e,t){return{conversationId:e,nodeIdCollectionWithItemMandatoryPropertiesChanged:t}}))},2751:function(e,t,n){"use strict";var r=n(2);t.a=Object(r.action)("initializeExtendedCardForItemReadingPane",(function(e,t){return{itemReadingPaneViewState:e,loadedItem:t}}))},3427:function(e,t,n){"use strict";var r=n(1);function a(e,t,n,a,i,o,c,s,u,d){return{folderId:null,type:1,listViewType:i,searchNumber:e,queryString:t,searchScope:n,pillSuggestions:Object(r.j)([],Object(r.g)(a.values())),includeAttachments:o,fromDate:c,toDate:s,scenarioType:"mail",lastIndexFetched:0,searchProvider:u,viewFilter:d||"All"}}function i(e){var t=e;return 1==e.type?t.scenarioType:void 0}var o=n(1959),c=n(1956),s=n(1244),u=n(2158),d=n(2485);function l(e){var t=e;return Object(c.m)(t.folderId)?Object(d.a)(t.searchScope,Object(u.a)({folderId:Object(s.a)(o.b),kind:"ArchiveMailbox"})):Object(d.a)(t.searchScope,Object(u.b)({folderId:Object(s.a)(o.h),kind:"PrimaryMailbox"}))}n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return l}))},5147:function(e){e.exports=JSON.parse('{"a":"zbb"}')},5209:function(e,t,n){"use strict";function r(e){switch(e){case"csv":case"ods":case"xls":case"xlsb":case"xlsm":case"xlsx":return"Excel";case"odp":case"pot":case"potm":case"potx":case"pps":case"ppsm":case"ppsx":case"ppt":case"pptm":case"pptx":return"PowerPoint";case"vsd":case"vsdm":case"vsdx":return"Visio";case"doc":case"docm":case"docx":case"dot":case"dotm":case"dotx":case"odt":case"rtf":return"Word";default:return""}}n.d(t,"a",(function(){return r}))},5367:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n(2),i=Object(a.action)("initializeReadingPaneInSxS",(function(e,t,n,r,a,i){return{readingPaneStrategy:e,attachmentSelectionSource:t,parentItemId:n,instrumentationContext:r,sxsId:a,isProjectionPopout:i}})),o=Object(a.action)("initializeConversationReadingPaneInSxS",(function(e,t,n,r,a){return{readingPaneStrategy:e,attachmentSelectionSource:t,parentItemId:n,instrumentationContext:r,sxsId:a}})),c=Object(a.action)("initializeReadingPaneInSxSByCopyingMailReadingPane",(function(e,t,n,r,a){return{attachmentSelectionSource:e,parentItemId:t,instrumentationContext:n,sxsId:r,isProjectionPopout:a}})),s=n(94),u=n(2350),d=n(2087);Object(a.orchestrator)(o,(function(e){return Object(r.c)(void 0,void 0,void 0,(function(){var t,n,a,i,o,c;return Object(r.f)(this,(function(r){switch(r.label){case 0:return t=e.readingPaneStrategy,n=e.attachmentSelectionSource,a=e.parentItemId,i=e.instrumentationContext,o=e.sxsId,t&&t.conversationId?(c=Object(d.l)(o)).readingPaneState&&c.readingPaneState.mode===d.h.ConversationReadingPane&&c.readingPaneState.conversationId&&c.readingPaneState.conversationId.Id===t.conversationId.Id?(a&&function(e){switch(e){case d.b.MailList:case d.b.ConversationAttachmentWell:return!0;case d.b.ReadingPane:case d.b.FilesHub:case d.b.PhotoHub:case d.b.GroupFilesHub:case d.b.ConsumerGroupFilesHub:case d.b.Deeplink:case d.b.FileSuggestion:case d.b.LinkSuggestion:case d.b.ComposeDocLink:case d.b.ReadingPaneDocLink:case d.b.FolderTree:return!1;default:return Object(s.a)(e)}}(n)&&u.s.importAndExecute(t.conversationId.Id,a.Id),[2]):(Object(d.I)(t.conversationId.Id),[4,u.l.importAndExecute(t.conversationId,i,t.conversationSubject,t.conversationCategories,t.itemIdToScrollTo)]):[2];case 1:return r.sent(),Object(d.M)({mode:d.h.ConversationReadingPane,conversationId:t.conversationId,conversationCategories:t.conversationCategories,conversationSubject:t.conversationSubject},o),a&&u.s.importAndExecute(t.conversationId.Id,a.Id),[2]}}))}))}));var l=Object(a.action)("initializeItemReadingPaneInSxS",(function(e,t,n){return{readingPaneStrategy:e,sxsId:t,instrumentationContext:n}}));Object(a.orchestrator)(l,(function(e){return Object(r.c)(void 0,void 0,void 0,(function(){var t,n,a,i,o;return Object(r.f)(this,(function(r){switch(r.label){case 0:return t=e.readingPaneStrategy,n=e.instrumentationContext,a=e.sxsId,t&&t.itemId?(i=Object(d.l)(a)).readingPaneState&&i.readingPaneState.mode===d.h.ItemReadingPane&&i.readingPaneState.itemId&&i.readingPaneState.itemId.Id===t.itemId.Id?[2]:(o=Object(u.c)(t.itemId.Id))&&o.itemId==t.itemId.Id?(Object(d.M)({mode:d.h.ItemReadingPane,itemId:t.itemId,itemReadingPaneViewState:o},a),[3,4]):[3,1]:[2];case 1:return[4,u.n.import()];case 2:return[4,r.sent()(t.itemId,n,(function(e){Object(d.M)({mode:d.h.ItemReadingPane,itemId:t.itemId,itemReadingPaneViewState:e},a)}))];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))}));var f=n(2807),b=n(2119),p=n(3427),m=n(2036),v=n(2093),h=n(2043),w=n(514),g=n(2112),S=n(7898),I=n(2861),O=n(1947),j=n(2054);Object(a.orchestrator)(c,(function(e){return Object(r.c)(void 0,void 0,void 0,(function(){var t,n,a,i,c,s,u,P,x,y,C,T,A,D,E,R,M,k,L,F;return Object(r.f)(this,(function(N){switch(N.label){case 0:return e.isProjectionPopout?[2]:(t=Object(d.l)(e.sxsId)).shouldShow&&(t.readingPaneState||t.composeId)?[2]:(n=e.attachmentSelectionSource,a=e.parentItemId,i=e.instrumentationContext,c=null===(F=O.ab.tableViews.get(O.ab.selectedTableViewId))||void 0===F?void 0:F.tableQuery,s=c&&(Object(O.T)(c)||Object(p.c)(c)),u=Object(h.d)(),(P=Object(S.a)())?Object(w.w)()&&window.opener?[2]:P.composeId!==b.a.primaryComposeId?[3,2]:[4,g.k.import()]:[3,4]);case 1:N.sent()(P,!0,!1),u=Object(h.d)(),N.label=2;case 2:return[4,d.B.import()];case 3:return N.sent()(P.composeId,e.sxsId),[2];case 4:return x=m.a.deeplinkId,y=Object(v.a)(),x?l({method:f.a.LoadItemReadingPane,itemId:{mailboxInfo:x.mailboxInfo,Id:x.id}},e.sxsId,i):u&&u.type===h.a.SecondaryReadingPane?1===(C=u.data).listViewType||Object(j.a)()?l({method:f.a.LoadItemReadingPane,itemId:C.id},e.sxsId,i):0===C.listViewType&&o({method:f.a.LoadConversationReadingPane,conversationId:C.id,conversationSubject:C.subject,conversationCategories:C.categories},n,a,i,e.sxsId):y&&Object(I.a)(y.conversationId.Id)?o({method:f.a.LoadConversationReadingPane,conversationId:y.conversationId,conversationSubject:y.conversationSubject,conversationCategories:y.conversationCategories},n,a,i,e.sxsId):(T=Object(O.J)(),A=T&&Object(r.j)([],Object(r.g)(T.selectedRowKeys.keys())),D=null==T?void 0:T.isInVirtualSelectAllMode,E=O.ab.expandedConversationViewState.selectedNodeIds.length,1==A.length&&E<=1&&!D&&!s&&(R=O.b.getRowIdToShowInReadingPane(A[0],T),1===(M=T&&T.tableQuery.listViewType)||Object(j.a)()?l({method:f.a.LoadItemReadingPane,itemId:R},e.sxsId,i):0===M&&(k=O.b.getSubject(A[0],T),L=O.b.getCategories(A[0],T),o({method:f.a.LoadConversationReadingPane,conversationId:R,conversationSubject:k,conversationCategories:L},n,a,i,e.sxsId)))),[2]}}))}))})),Object(a.orchestrator)(i,(function(e){return Object(r.c)(void 0,void 0,void 0,(function(){var t,n,a,i,s,u;return Object(r.f)(this,(function(r){if(t=e.readingPaneStrategy,n=e.attachmentSelectionSource,a=e.parentItemId,i=e.instrumentationContext,s=e.sxsId,u=e.isProjectionPopout,!t)return[2];switch(t.method){case f.a.NoOp:return[2];case f.a.AlwaysHidden:return Object(d.M)(null,s),[2];case f.a.CopyMailReadingPaneContainer:return c(n,a,i,s,u),[2];case f.a.LoadConversationReadingPane:return o(t,n,a,i,s),[2];case f.a.LoadItemReadingPane:return l(t,s,i),[2];default:return[2]}return[2]}))}))}));var P=n(121),x=n(2099),y=n(2217),C=n(2070),T=n(2774),A=n(6488),D="download",E="open";function R(e){var t;return Object(r.c)(this,void 0,void 0,(function(){var n,a;return Object(r.f)(this,(function(r){switch(r.label){case 0:return n=Object(A.a)(e.AttachLongPathName),[4,Object(T.l)(n)];case 1:return a=r.sent(),[2,(null===(t=a.result)||void 0===t?void 0:t.webContentLink)&&(i=a.result.webContentLink,i.lastIndexOf(D,i.length-D.length)>-1)?M(a.result.webContentLink):null]}var i}))}))}function M(e){return e.slice(0,-D.length)+E}var k=n(2359),L=n(2644),F=n(11629),N=n(2704),U=n(4702),W=n(11955),V=n(24),B=n(1992),G=n(5209),H=n(203),_=n(6),z=n(4921),$=n(8189),J=n(5147),K=n(1956),Y=n(10108),q=n(8),Q=n(2382),X=n(23);function Z(e){switch(e){case x.b.Unsupported:return"Unsupported";case x.b.Image:return"Image";case x.b.MailItem:return"MailItem";case x.b.CalendarEvent:return"CalendarEvent";case x.b.Wac:return"Wac";case x.b.SuiteExtensions:return"SuiteExtensions";case x.b.Audio:return"Audio";case x.b.Text:return"Text";case x.b.NativeView:return"NativeView";case x.b.GoogleDoc:return"GoogleDoc";case x.b.PdfJs:return"PdfJs";case x.b.ItemAttachment:return"ItemAttachment";case x.b.Video:return"Video";default:return Object(s.a)(e)}}var ee="/owa/{0}/service.svc/s/GetAttachmentPdfPreview?id={1}";function te(e,t){return Object(r.c)(this,void 0,void 0,(function(){var n;return Object(r.f)(this,(function(r){switch(r.label){case 0:return n=Object(_.c)(ee,e,encodeURIComponent(t)),[4,fetch(n,{credentials:"same-origin"})];case 1:return[2,r.sent()]}}))}))}var ne=n(2508);function re(e){return Object(r.c)(this,void 0,void 0,(function(){var t,n,a,i,o,c,s,u,d,l;return Object(r.f)(this,(function(r){switch(r.label){case 0:return e.mailboxInfo?[4,te(Object(ne.d)(e.mailboxInfo),e.Id)]:[2,null];case 1:return(t=r.sent()).ok?[4,t.text()]:[3,3];case 2:for(n=r.sent(),a=n.replace(/\s/gi,""),i=atob(a),o=i.length,c=new Uint8Array(new ArrayBuffer(o)),s=0;s<o;s++)c[s]=i.charCodeAt(s);return u=t.headers.get("PrintAllowed"),d=t.headers.get("CopyAllowed"),l=t.headers.get("ExportAllowed"),[2,{data:c,printAllowed:!u||"true"===u.toLowerCase(),copyAllowed:!d||"true"===d.toLowerCase(),exportAllowed:!l||"true"===l.toLowerCase()}];case 3:throw t.statusText}}))}))}var ae=n(4);function ie(e,t){var n=Object(ae.J)()?"OWA-PWA":"OWA-WEB",r=t?"SXS-EDIT":"SXS-VIEW",a="";switch(e){case d.b.MailList:a="ML";break;case d.b.ConversationAttachmentWell:a="CAW";break;case d.b.ReadingPane:a="RP";break;case d.b.FilesHub:a="FH";break;case d.b.PhotoHub:a="PH";break;case d.b.GroupFilesHub:a="GFH";break;case d.b.ConsumerGroupFilesHub:a="CGF";break;case d.b.Deeplink:a="DL";break;case d.b.FileSuggestion:a="FS";break;case d.b.LinkSuggestion:a="LS";break;case d.b.ComposeDocLink:a="CDL";break;case d.b.ReadingPaneDocLink:a="RPDL";break;case d.b.FolderTree:a="FT";break;default:a="UNKNOWN"}return n+"."+a+"."+r}var oe=n(2862);function ce(e){var t=new Error(e);throw t.isUserError=!0,t}function se(e){if(null!=e&&e.isUserError)return!0;return!1}var ue=n(16896),de=n(2934),le=n(419),fe=[".odp",".pot",".potm",".potx",".pps",".ppsm",".ppsx",".ppt",".pptm",".pptx"];function be(e,t,n){return Object(r.c)(this,void 0,void 0,(function(){return Object(r.f)(this,(function(r){switch(r.label){case 0:return[4,g.j.import()];case 1:return r.sent()(e.Id,t,3,{forceInsertSignatureOperation:n}),[2]}}))}))}function pe(e){return Object(r.c)(this,void 0,void 0,(function(){var t,n,a;return Object(r.f)(this,(function(i){switch(i.label){case 0:return t=e.mailboxInfo,n=t&&"GroupMailbox"==t.type?t.mailboxSmtpAddress:null,[4,g.d.import()];case 1:return[4,i.sent()(e.Id,!0,n,!1)];case 2:return a=i.sent(),[2,Object(r.a)(Object(r.a)({},a.ItemId),{mailboxInfo:e.mailboxInfo})]}}))}))}function me(e){return Object(r.c)(this,void 0,void 0,(function(){var t;return Object(r.f)(this,(function(n){switch(n.label){case 0:return(t=Object(I.a)(e))?[4,g.s.import()]:[3,3];case 1:return[4,n.sent()(t)];case 2:return n.sent(),[2,t.itemId];case 3:return[2,null]}}))}))}function ve(e,t,n,a,o,c,s,u,l,f,b){var v,w;return void 0===f&&(f=d.f.Mail),Object(r.c)(this,void 0,void 0,(function(){function g(){return Object(r.c)(this,void 0,void 0,(function(){var t,n;return Object(r.f)(this,(function(r){switch(r.label){case 0:return c?[3,1]:(n=null,[3,3]);case 1:return[4,c()];case 2:n=r.sent(),r.label=3;case 3:return t=n,te(),Oe.setImagePreviewState(xe,Ce.previewImage.url,t,Ee,!Ee&&!Object(L.e)().printWithoutDownloadEnabled,Le),[4,C.j.import()];case 4:return[4,r.sent()(e.attachmentId,e.isReadOnly)];case 5:return r.sent(),te(),Oe.setImagePreviewState(xe,ye(e.attachmentId).previewImage.url,t,Ee,!Ee&&!Object(L.e)().printWithoutDownloadEnabled,Le),[2]}}))}))}function j(){return Object(r.c)(this,void 0,void 0,(function(){var t;return Object(r.f)(this,(function(n){switch(n.label){case 0:return t=Ce.model.ProviderType,Object(y.b)(e.isCloudy,t,Ce.model.Name)&&t===C.a.providers.ONE_DRIVE_PRO?[4,A()]:[3,2];case 1:return n.sent(),[3,4];case 2:return[4,T()];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))}function T(){return Object(r.c)(this,void 0,void 0,(function(){var t,n,a,i,c,s,u;return Object(r.f)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t=!1,[4,Object(W.a)(e.attachmentId,t,x.c[o])];case 1:return n=r.sent(),Ce.model.Name&&(a=Ce.model.Name.lastIndexOf("."))>=0&&(i=Ce.model.Name.substr(a).toLowerCase(),Le.useHighContrastCommandBar=fe.indexOf(i)>=0),te(),Oe.setWacPreviewState(xe,n.wacUrl,null,n.accessToken,n.accessTokenTtl,n.additionalParameters,n.deprecatedTokenAndParameters,ne.getTime(),!t,Le),[3,3];case 2:if(c=r.sent(),null==(s=c)?void 0:s.errorMessage)throw X.g.warn("Something went wrong while getting the attachment state: "+s),e.isCloudy&&(u=Ce,Le.openInNewTabUrl=Object(V.i)("doc-unwrap-safelinks")?u.originalUrl:u.openUrl),Oe.setPreviewError(xe,s.errorMessage,Le),s.error;throw c;case 3:return[2]}}))}))}function A(){return Object(r.c)(this,void 0,void 0,(function(){var e,t,n,a,i,c,s,u;return Object(r.f)(this,(function(d){switch(d.label){case 0:e=Ce,t=Object(V.i)("doc-unwrap-safelinks")?e.originalUrl:e.openUrl,d.label=1;case 1:if(d.trys.push([1,3,,4]),Ve.addCustomData({useJsApi:"true"}),null==t)throw new Error("openUrl is null");return n=Ce.model.Name,a=n&&n.substring(n.lastIndexOf(".")),l=a,i=!Object(V.i)("doc-SxS-jsApi-ODB-Readonly")&&".xls"!==l,[4,Object(U.a)(0,t,i,!0)];case 2:if(!(c=d.sent()))throw new Error("Vroom API call failed");return te(),s=Object(H.a)(),Oe.setWacPreviewState(xe,c.openWith.wac.applicationUrl,{bootScriptUrl:c.openWith.wac.bootstrapperUrl,wopiSrcUrl:c.openWith.wac.wopiSrc,accessToken:c.openWith.wac.accessToken,accessTokenExpiry:c.openWith.wac.accessTokenExpiry,fileSize:Ce.model.Size,fileGetUrl:c.openWith.wac.fileGetUrl,bundleInfo:c.officeBundle,fetchStartTime:c.fetchStartTime,responseStartTime:c.responseStartTime,openUrl:t,owaSessionId:s,userId:c.openWith.wac.userId,sessionOrigin:ie(o,i),clientThrottlingProtection:c.openWith.wac.clientThrottlingProtection,requestedCallThrottling:c.openWith.wac.requestedCallThrottling},null,null,null,null,ne.getTime(),c.currentUserRole.readOnly,Le),Ve.addCustomData({owaSessionId:s}),[3,4];case 3:throw u=d.sent(),X.g.warn("Something went wrong while getting the attachment state: "+u.message),Oe.setPreviewError(xe,Object(_.b)(z.a),Object(r.a)(Object(r.a)({},Le),{openInNewTabUrl:t})),u;case 4:return[2]}var l}))}))}function D(){return Object(r.c)(this,void 0,void 0,(function(){var t;return Object(r.f)(this,(function(n){switch(n.label){case 0:return Object(k.b)(Ce.model)&&Ce.model.ProviderType===C.a.providers.GDRIVE?[4,E()]:[3,2];case 1:return n.sent(),[3,3];case 2:t=Object(N.a)(e.attachmentId,Ce.model,3,Object(k.b)(Ce.model),e.isReadOnly),Oe.setNativePdfPreviewState(xe,Ce.download.url+"&isDocumentPreview=True#toolbar=0",t,"application/pdf",Le),n.label=3;case 3:return[2]}}))}))}function E(){return Object(r.c)(this,void 0,void 0,(function(){var e,t,n;return Object(r.f)(this,(function(r){switch(r.label){case 0:e=null,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,R(Ce.model)];case 2:return(t=r.sent())?(te(),Oe.setNativePdfPreviewState(xe,t,null,"application/pdf",Le),[2]):[3,4];case 3:return n=r.sent(),e=n,[3,4];case 4:throw te(),Oe.setPreviewError(xe,Object(_.b)($.a)),e||new Error("Unexpected error in handleNativeViewPreviewForGDrive")}}))}))}function M(){return Object(r.c)(this,void 0,void 0,(function(){var t,n;return Object(r.f)(this,(function(r){switch(r.label){case 0:return t=Object(L.c)(Ce.model,!0),Ee&&t.directFileAccessEnabled&&!Ne?(Oe.setPdfJsPreviewState(xe,Ce.download.url+"&isDocumentPreview=True",!1,Le),[3,3]):[3,1];case 1:return[4,re(e.attachmentId)];case 2:n=r.sent(),te(),Oe.setPdfJsPreviewStateByData(xe,n.data,!Ee&&!Object(L.e)().printWithoutDownloadEnabled||!n.printAllowed,n.copyAllowed,n.exportAllowed,Le),r.label=3;case 3:return[2]}}))}))}function B(){return Object(r.c)(this,void 0,void 0,(function(){var t,n,a;return Object(r.f)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Object(F.a)(e.attachmentId.Id,Object(le.a)(e.attachmentId.mailboxInfo),0,x.c[o])];case 1:return t=r.sent(),te(),Oe.setTextPreviewState(xe,t,Ee,Le),[3,3];case 2:if(n=r.sent(),null==(a=n)?void 0:a.errorMessage)throw te(),Oe.setPreviewError(xe,a.errorMessage),a.error;throw n;case 3:return[2]}}))}))}function ee(){return Object(r.c)(this,void 0,void 0,(function(){var t,n,a;return Object(r.f)(this,(function(r){switch(r.label){case 0:return t={calendarItem:null,isIcsAttachmentLoading:!0,icsCalendarEventType:Y.a.UNKNOWN,attachmentId:e.attachmentId,addToCalendarStatus:1,errorMessage:null},[4,Y.d.import()];case 1:return n=r.sent(),a=null,[4,n({attachmentId:e.attachmentId,size:Ce.model.Size,showSizeLimitExceedsError:function(){a=Object(_.b)(ue.a)},errorCallback:function(){a=Object(_.b)(J.a)},state:t})];case 2:if(r.sent(),te(),a)throw Oe.setPreviewError(xe,a),new Error(a);return ae.onShowCustomPreview(t,Se),Oe.setCustomPreviewState(xe,Le),[2]}}))}))}function te(){Object(d.l)(Se).pendingPreviewOperation&&He.id===Object(d.l)(Se).pendingPreviewOperation.id||ce("Preview changed before loading finished")}var ne,ae,ve,Se,Ie,Oe,je,Pe,xe,ye,Ce,Te,Ae,De,Ee,Re,Me,ke,Le,Fe,Ne,Ue,We,Ve,Be,Ge,He,_e,ze,$e,Je,Ke,Ye,qe;return Object(r.f)(this,(function(c){switch(c.label){case 0:return ne=new Date,[4,d.G.import()];case 1:return ae=c.sent(),oe.a.available()?(l=l||window,ve=l!==window,Se=Object(d.k)(l),oe.a.run(l,Se),b&&o==x.c.Deeplink&&(Ie=(new Date).getTime()-b,Object(P.s)("PopOutSxSUsage",{PopOutType:"DeepLink",TimeElapsed:Ie})),[4,Q.u.import()]):(ae.openSxSInANewWindow(t,e.attachmentId.Id,null),[2]);case 2:return Oe=c.sent(),je=ae.onPreviewOperationStart,Pe=ae.onPreviewOperationFinished,xe=Object(d.l)(Se).viewState,[4,C.h.import()];case 3:ye=c.sent(),Ce=ye(e.attachmentId),Te=e.strategy,Ae=-1!==Te.supportedOpenActions.indexOf(x.a.Download),De=Ae&&(null==Ce?void 0:Ce.download)?Ce.download.url:null,Ee=Ce.info.allowDownload,Re=0,Object(V.i)("wvn-productizeSTCChicletAndPreview")||Object(V.i)("wvn-sxsEditButtonSplit")?Re=Te.isSaveToCloudSupported?Object(_.f)(Ce.model.AttachmentOriginalUrl)?1:3:0:(Me=Te.isSaveToCloudSupported&&Object(_.f)(Ce.model.AttachmentOriginalUrl),Re=Me?1:0),ke=Te.previewMethod===x.b.Wac,Le={downloadUrl:De,downloadShouldOpenNewTab:ke,fileName:Ce.model.Name,useHighContrastCommandBar:!1,id:e.attachmentId,isCloudy:e.isCloudy,openInNewTabUrl:null},Fe=Te.previewMethod,Ne=!1,Te.previewMethod!==x.b.NativeView&&Te.previewMethod!==x.b.PdfJs||(Ue=K.u.items.get(t.Id))&&Ue.RightsManagementLicenseData&&(Fe=x.b.PdfJs,Ne=!0),We=function(e,t,n,r,a,i,o,c){var s,u,d=ge(e),l=new P.b("PreviewAttachmentInSxSE2E",{timeout:he}),f=Date.now(),b=!1;c&&(b=!!we&&we===c,we=c);var p={previewMethod:Z(t),isCloudy:n?"cloudy":"classic",isChangingFromEditing:r?"changingFromEdit":"",officeFileType:Object(G.a)(d),actionSource:x.c[a],attachmentFileType:i,isRepeat:o,downloadAllowed:!!e.download.url,fromSameReadingPane:b},m="";Object(V.i)("doc-SxS-jsApi-ODB-Base")&&(m+="doc-SxS-jsApi-ODB-Base;");Object(V.i)("doc-SxS-jsApi-ODB-BaseNoEditString")&&(m+="doc-SxS-jsApi-ODB-BaseNoEditString;");Object(V.i)("doc-SxS-jsApi-ODB-Readonly")&&(m+="doc-SxS-jsApi-ODB-Readonly;");Object(V.i)("doc-SxS-jsApi-ODB-Basecf")&&(m+="doc-SxS-jsApi-ODB-Basecf;");return p.associatedFlights=m,p.hostName=window.location.hostname,p.hideEmailOption=null===(s=Q.u.tryImportForRender())||void 0===s?void 0:s.getHideReadingPaneOption(),l.addCustomData(p),l.addCosmosOnlyData(JSON.stringify({attachmentId:null===(u=null==e?void 0:e.id)||void 0===u?void 0:u.Id,fileType:(null==d?void 0:d.substring(0,4))||"",fileSize:e.model.Size})),Object(P.s)("PreviewAttachmentInSxSUsage",p,{excludeFromKusto:!0}),{perfDatapoint:l,perfDatapointCreatedTime:f}}(Ce,Fe,e.isCloudy,Object(d.l)(Se).editState.mode!==d.c.View,o,e.fileType,ae.repeatTracker.contains(e.attachmentId.Id),!Object(d.l)(Se).shouldShow&&function(){var e,t,n,a,i,o=null===(e=O.ab.tableViews.get(O.ab.selectedTableViewId))||void 0===e?void 0:e.tableQuery,c=o&&(Object(O.T)(o)||Object(p.c)(o)),s=Object(h.d)(),u=Object(S.a)(),d=null===(t=null==u?void 0:u.itemId)||void 0===t?void 0:t.Id;if(d)return d;var l=Object(m.b)(),f=l.conversationReadingPaneViewState,b=l.deeplinkId;if(b)return b.id;if(s&&s.type===h.a.SecondaryReadingPane){var v=s.data;return null===(n=null==v?void 0:v.id)||void 0===n?void 0:n.Id}if(f&&Object(I.a)(f.conversationId.Id))return f.conversationId.Id;var w=Object(O.J)(),g=w&&Object(r.j)([],Object(r.g)(w.selectedRowKeys.keys())),j=null==w?void 0:w.isInVirtualSelectAllMode,P=null===(i=null===(a=O.ab.expandedConversationViewState)||void 0===a?void 0:a.selectedNodeIds)||void 0===i?void 0:i.length;return 1===(null==g?void 0:g.length)&&P<=1&&!j&&!c?O.b.getRowClientItemId(g[0],w).Id:null}()),Ve=We.perfDatapoint,Be=We.perfDatapointCreatedTime,Ge=function(){Ve.addCustomData({autoHide:!0})},xe.eventManager.on(Q.a,Ge),He={id:(new Date).getTime()+"_"+Math.floor(1e3*Math.random()),attachmentId:e.attachmentId},je(He,Se),c.label=4;case 4:return c.trys.push([4,30,31,32]),[4,ae.canCloseSxS(Se)];case 5:if(c.sent()||Ve.addCustomData({exitEditMode:"notSaved"}),te(),a&&!n||i(s,o,t,u,Se,ve),_e=null==t?void 0:t.Id,ze=_e&&Object(K.v)(_e),Oe.setPreviewLoading(xe,"",Le),ae.showSxS(Object(d.l)(Se).shouldShow?null:f,{previewMode:Fe,attachmentId:e.attachmentId,selectionSource:o,isCloudy:e.isCloudy,saveToCloudStatus:Re,textPreviewReadMode:0},{editAllowed:Te.allowEdit&&!(Object(q.d)("sxsHideEdit")&&(Object(d.l)(Se).shouldShow?Object(d.l)(Se).customization:f)===d.f.DeepLink),itemId:t,isDraft:n},null,Se,{itemId:_e,fileId:e.attachmentId.Id,fileType:ge(Ce),sender:null===(w=null===(v=(null==ze?void 0:ze.From)||(null==ze?void 0:ze.Sender))||void 0===v?void 0:v.Mailbox)||void 0===w?void 0:w.EmailAddress,startTime:(new Date).getTime()}),Object(d.L)(null),$e=void 0,a)return[3,25];switch(Fe){case x.b.Image:return[3,6];case x.b.Wac:return[3,8];case x.b.GoogleDoc:return[3,10];case x.b.NativeView:return[3,11];case x.b.PdfJs:return[3,13];case x.b.Audio:return[3,15];case x.b.Video:return[3,16];case x.b.Text:return[3,17];case x.b.ItemAttachment:return[3,19];case x.b.CalendarEvent:return[3,20]}return[3,22];case 6:return[4,g()];case 7:return c.sent(),[3,23];case 8:return[4,j()];case 9:return c.sent(),[3,23];case 10:return Oe.setIframePreviewState(xe,Ce.model.AttachLongPathName,Le),[3,23];case 11:return[4,D()];case 12:return c.sent(),[3,23];case 13:return[4,M()];case 14:return c.sent(),[3,23];case 15:return Oe.setAudioPreviewState(xe,Ce.download.url,Le),[3,23];case 16:return Oe.setVideoPreviewState(xe,Ce.download.url,Le),[3,23];case 17:return[4,B()];case 18:return c.sent(),[3,23];case 19:return Object(de.a)(e.attachmentId,Ve),Oe.setCustomPreviewState(xe,Le),[3,23];case 20:return[4,ee()];case 21:return c.sent(),[3,23];case 22:throw new Error("Unsupported preview method");case 23:return[4,ae.waitForPreviewLoadOrThrowError(Se)];case 24:$e=c.sent(),c.label=25;case 25:return te(),Pe(Se),a?n?[4,d.t.import()]:[3,27]:[3,29];case 26:return c.sent()(be,Se),[3,29];case 27:return[4,d.s.import()];case 28:c.sent()(be,pe,me,Se),c.label=29;case 29:return Je=null==$e?void 0:$e.errorObject,Ke=null==$e?void 0:$e.loadedTime,Je&&Ve.addCustomData({errorObject:Je}),Ke?(Ye=Ke-Be,Ve.end(Ye)):Ve.end(),ae.repeatTracker.add(e.attachmentId.Id),[3,32];case 30:return qe=c.sent(),Ve.endWithError(se(qe)?"UserError":"ServerError",qe),[3,32];case 31:return xe.eventManager.off(Q.a,Ge),[7];case 32:return[2]}}))}))}var he=18e4,we=null;function ge(e){return 8!==e.attachmentClass&&9!==e.attachmentClass&&Object(B.c)(e.model.Name||"")||e.model.ContentType||""}var Se=n(1996),Ie=n(2603);function Oe(e){return Object(r.c)(this,void 0,void 0,(function(){var t;return Object(r.f)(this,(function(n){switch(n.label){case 0:return(t=e.viewState&&Object(Se.a)(e.viewState.attachmentId))&&Object(C.d)(t.model)?[4,Ie.n.import()]:[3,2];case 1:return n.sent()(t.model,e.parentItemId),[2];case 2:return e.onBeforePreview&&e.onBeforePreview(),[4,ve(e.viewState,e.parentItemId,e.isDraft,e.isEdit,e.attachmentSelectionSource,e.createImageGallery,{method:f.a.CopyMailReadingPaneContainer},e.instrumentationContext,e.targetWindow)];case 3:return n.sent(),[2]}}))}))}var je=n(8357);function Pe(e){var t,n;return Object(r.c)(this,void 0,void 0,(function(){var a,i;return Object(r.f)(this,(function(r){switch(r.label){case 0:return a=null,Object(V.i)("mail-popout-projection")?"IMG"!==(null===(n=null===(t=e)||void 0===t?void 0:t.tagName)||void 0===n?void 0:n.toUpperCase())?[3,2]:[4,je.b.import()]:[3,4];case 1:return i=r.sent(),a=i(e),[3,3];case 2:a=e,r.label=3;case 3:return[3,7];case 4:return e instanceof HTMLElement?[4,je.b.import()]:[3,6];case 5:return i=r.sent(),a=i(e),[3,7];case 6:a=e,r.label=7;case 7:return[2,a]}}))}))}function xe(e,t,n,a){var o,c,s;return Object(r.c)(this,void 0,void 0,(function(){var u,l,b,p,m,v,w,g,S,I,O,j,P;return Object(r.f)(this,(function(r){switch(r.label){case 0:return u=(null===(c=null===(o=a)||void 0===o?void 0:o.ownerDocument)||void 0===c?void 0:c.defaultView)||window,l=u===window?"primaryTab":Object(h.f)(u),b=u!==window,oe.a.run(u,l),p=Object(d.l)(l),[4,d.A.import()];case 1:return m=r.sent(),[4,d.z.import()];case 2:return v=r.sent(),[4,Pe(a)];case 3:(w=r.sent())||(w=p.viewState),g={downloadUrl:e.downloadUrl,downloadShouldOpenNewTab:!1,useHighContrastCommandBar:!1,id:e.id},S={id:(new Date).getTime()+"_"+Math.floor(1e3*Math.random()),attachmentId:e.id},m(S,l),r.label=4;case 4:return r.trys.push([4,8,,9]),[4,d.F.import()];case 5:return I=r.sent(),[4,Q.k.import()];case 6:return O=r.sent(),[4,C.h.import()];case 7:return j=r.sent(),P=null===(s=j(e.id))||void 0===s?void 0:s.info.allowDownload,p.pendingPreviewOperation&&S.id===p.pendingPreviewOperation.id||ce("Preview changed before loading finished"),i({method:f.a.CopyMailReadingPaneContainer},d.b.ReadingPane,null,null,l,b),O(w,e.previewUrl,t,P,!P&&!Object(L.e)().printWithoutDownloadEnabled,g),I(p.shouldShow?null:d.f.Mail,{previewMode:x.b.Image,attachmentId:e.id,selectionSource:d.b.ReadingPane,isCloudy:!1,saveToCloudStatus:0,textPreviewReadMode:0},{editAllowed:!1,itemId:n,isDraft:!1},null,l),Object(d.L)(null),v(l),[3,9];case 8:return r.sent(),[3,9];case 9:return[2]}}))}))}function ye(e,t,n,a,o,c,s,u,l,f,b){return void 0===l&&(l=null),void 0===f&&(f=null),void 0===b&&(b=d.f.Mail),Object(r.c)(this,void 0,void 0,(function(){function p(){O.pendingPreviewOperation&&A.id===O.pendingPreviewOperation.id||ce("Preview changed before loading finished")}var m,v,h,w,g,S,I,O,j,y,C,T,A,D,E,R,M,k,L;return Object(r.f)(this,(function(r){switch(r.label){case 0:return u=u||window,m=u!==window,v=Object(d.k)(u),oe.a.run(u,v),h=e(),[4,Q.u.import()];case 1:return w=r.sent(),[4,d.G.import()];case 2:g=r.sent(),S=g.onPreviewOperationStart,I=g.onPreviewOperationFinished,O=Object(d.l)(v),j=O.viewState,y={downloadUrl:null,downloadShouldOpenNewTab:!1,useHighContrastCommandBar:!1,id:null,fileName:l,openInNewTabUrl:f},C=function(e,t){var n=new P.b("PreviewLinkInSxSE2E");return n.addCustomData({previewMethod:Z(e),actionSource:d.b[t]}),n}(x.b.Wac,n),T=function(){C.addCustomData({autoHide:!0})},j.eventManager.on(Q.a,T),A={id:(new Date).getTime()+"_"+Math.floor(1e3*Math.random()),attachmentId:null},S(A,v),r.label=3;case 3:return r.trys.push([3,10,11,12]),[4,g.canCloseSxS(v)];case 4:r.sent(),p(),i(a,n,t,o,v,m),w.setPreviewLoading(j,"",y),g.showSxS(O.shouldShow?null:b,{previewMode:x.b.Wac,attachmentId:null,selectionSource:n,isCloudy:!0,saveToCloudStatus:0,textPreviewReadMode:0},{editAllowed:!1,itemId:t,isDraft:!1},c,v),Object(d.L)(c,s),r.label=5;case 5:return r.trys.push([5,7,,8]),[4,h];case 6:return D=r.sent(),p(),D.jsApiInfo&&(E=Object(H.a)(),D.jsApiInfo.owaSessionId=E,R=ie(n,!0),D.jsApiInfo.sessionOrigin=R,y.fileName=D.jsApiInfo.fileName,function(e,t,n){var r=Object(B.c)(t.fileName);e.addCustomData({useJsApi:"true",officeFileType:Object(G.a)(r),owaSessionId:t.owaSessionId,extraInfo:n}),e.addCosmosOnlyData(JSON.stringify({fileType:(null==r?void 0:r.substring(0,4))||""}))}(C,D.jsApiInfo,D.extraInfo)),w.setWacPreviewState(j,D.wacUrl,D.jsApiInfo,D.accessToken,D.accessTokenTtl,D.additionalParameters,D.deprecatedTokenAndParameters,(new Date).getTime(),s,y),[3,8];case 7:throw M=r.sent(),(null==(k=M)?void 0:k.errorMessage)?(w.setPreviewError(j,k.errorMessage),k.error):(w.setPreviewError(j,M.message||""+M),M);case 8:return[4,g.waitForPreviewLoadOrThrowError(v)];case 9:return r.sent(),p(),I(v),C.end(),[3,12];case 10:return L=r.sent(),C.endWithError(se(L)?"UserError":"ServerError",L),[3,12];case 11:return j.eventManager.off(Q.a,T),[7];case 12:return[2]}}))}))}n.d(t,"previewAttachment",(function(){return Oe})),n.d(t,"previewAttachmentInSxS",(function(){return ve})),n.d(t,"previewImageInSxS",(function(){return xe})),n.d(t,"previewLinkInSxS",(function(){return ye})),n.d(t,"initializeItemReadingPaneInSxS",(function(){return l}))},7898:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2119),a=n(2043);function i(){var e=Object(a.d)(),t=Object(r.b)(),n=e?function(e,t){switch(e.type){case a.a.Primary:return t.primaryComposeId;case a.a.MailCompose:return e.data;default:return null}}(e,t):t.primaryComposeId,i=n?t.viewStates.get(n):null;return i&&!i.isInlineCompose?i:null}},869:function(e,t,n){"use strict";var r=n(31),a={ChannelData:"ChannelData",SubscriptionAdded:"SubscriptionAdded",SubscriptionRemoved:"SubscriptionRemoved",SubscriptionUpdated:"SubscriptionUpdated",NotificationData:"NotificationData",TraceWarn:"TraceWarn",TraceError:"TraceError"};n.d(t,"h",(function(){return o})),n.d(t,"i",(function(){return c})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return u})),n.d(t,"g",(function(){return d})),n.d(t,"e",(function(){return l})),n.d(t,"f",(function(){return f})),n.d(t,"d",(function(){return b})),n.d(t,"a",(function(){return a}));var i=new r.c((function(){return Promise.all([n.e(4),n.e(21),n.e(739)]).then(n.bind(null,18223))})),o=new r.a(i,(function(e){return e.subscribe})),c=new r.a(i,(function(e){return e.unsubscribe})),s=new r.b(i,(function(e){return e.getChannelId})),u=new r.a(i,(function(e){return e.getChannelReady})),d=new r.a(i,(function(e){return e.setup})),l=new r.a(i,(function(e){return e.handleNotification})),f=new r.a(i,(function(e){return e.initializeNotificationManager})),b=new r.b(i,(function(e){return e.getNotificationEmitter}))}}]);
//# sourceMappingURL=owa.MailBoot~AttachmentPreviewSxS.js.map
self.scriptsLoaded['owa.MailBoot~AttachmentPreviewSxS.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~AttachmentPreviewSxS.js'] = (new Date()).getTime();