self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~HtmlEditorLazyPlugins~HtmlRecipientEditor.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[268],{10095:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(16760))},11937:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(16762),i=n(16763),a=n(16764),u=n(16765),l=n(16766),s=n(16767),c=n(16768),d=n(16769),f=n(16770),v=r(r(r(r(r(r(r(r(r({},u.ListFeatures),s.QuoteFeatures),f.TableFeatures),d.StructuredNodeFeatures),o.AutoLinkFeatures),c.ShortcutFeatures),i.CursorFeatures),l.MarkdownFeatures),a.EntityFeatures);t.default=function(){return v}},16760:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(16761);t.ContentEdit=r.default;var o=n(11937);t.getAllFeatures=o.default},16761:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(11937),o=function(){function e(e,t){this.settingsOverride=e,this.additionalFeatures=t}return e.prototype.getName=function(){return"ContentEdit"},e.prototype.initialize=function(e){var t=this,n=[],o=r.default();Object.keys(o).forEach((function(e){var r=o[e],i=t.settingsOverride&&void 0!==t.settingsOverride[e];(i&&t.settingsOverride[e]||!i&&!r.defaultDisabled)&&n.push(r)})),n.concat(this.additionalFeatures||[]).forEach((function(t){return e.addContentEditFeature(t)}))},e.prototype.dispose=function(){},e}();t.default=o},16762:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2634),o=n(2001),i=/[.+=\s:;"',>]+$/i,a=5,u={keys:[13,32,257],shouldHandleEvent:s,handleEvent:function(e,t){var n=t.getDocument().createElement("a"),i=s(e,t),a=t.getContentSearcherOfCursor();n.textContent=i.originalUrl,n.href=i.normalizedUrl,t.runAsync((function(t){t.addUndoSnapshot((function(){return r.replaceWithNode(t,i.originalUrl,n,!1,a),o.clearEventDataCache(e),n}),"AutoLink",!0)}))}},l={keys:[8],shouldHandleEvent:function(e,t){return t.getContentSearcherOfCursor(e).getInlineElementBefore()instanceof o.LinkInlineElement},handleEvent:function(e,t){e.rawEvent.preventDefault(),r.removeLink(t)},defaultDisabled:!0};function s(e,t){return 0==e.eventType||7==e.eventType&&"Paste"==e.source?o.cacheGetEventData(e,"LINK_DATA",(function(){var n=7==e.eventType&&"Paste"==e.source&&e.data,r=o.matchLink((n.text||"").trim()),u=t.getContentSearcherOfCursor(e);if(r&&u.getRangeFromText(r.originalUrl,!1))return r;var l=u&&u.getWordBefore();if(l&&l.length>a){var s=(l.match(i)||[])[0]||"",c=l.substring(0,l.length-s.length);return["()","{}","[]"].forEach((function(e){c[c.length-1]==e[1]&&c.indexOf(e[0])<0&&(c=c.substr(0,c.length-1))})),o.matchLink(c)}return null})):null}t.AutoLinkFeatures={autoLink:u,unlinkWhenBackspaceAfterLink:l}},16763:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2001),o={keys:[37,39],allowFunctionKeys:!0,shouldHandleEvent:function(e,t,n){var o,i;if(!(n&&(o=t.getSelectionRange())&&o.collapsed&&(i=r.Position.getStart(o))&&t.isPositionAtBeginning(i)))return!1;var a="rtl"==r.getComputedStyle(i.element,"direction"),u=e.rawEvent;return!a&&37==u.which||a&&39==u.which},handleEvent:function(e){e.rawEvent.preventDefault()},defaultDisabled:!r.Browser.isChrome};t.CursorFeatures={noCycleCursorMove:o}},16764:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2001),o={keys:[13],shouldHandleEvent:function(e,t){return a(e,t)},handleEvent:function(e,t){a(e,t,1)}},i={keys:[27],shouldHandleEvent:function(e,t){return a(e,t)},handleEvent:function(e,t){a(e,t,3)}};function a(e,t,n){var o=r.cacheGetEventData(e,"READONLY_ENTITY_ELEMENT",(function(){var n=e.rawEvent.target,o=n&&t.getElementAtCursor(r.getEntitySelector(),n);return o&&!o.isContentEditable?o:null}));return o&&void 0!==n&&t.triggerPluginEvent(15,{operation:n,rawEvent:e.rawEvent,entity:r.getEntityFromElement(o)}),o}var u={keys:[13],shouldHandleEvent:function(e,t){return c(e,t,!0,!1)},handleEvent:function(e,t){var n;e.rawEvent.preventDefault();var o=t.getSelectionRange(),i=r.Position.getEnd(o).normalize().node,a=t.getDocument().createElement("BR");i.parentNode.insertBefore(a,i.nextSibling);var u,l=t.getBlockElementAtNode(i);l&&(u=l.collapseToSingleElement(),null===(n=a.parentNode)||void 0===n||n.removeChild(a)),t.getSelectionRange().deleteContents(),u.nextSibling&&t.select(u.nextSibling,0)}},l={keys:[8],shouldHandleEvent:function(e,t){return c(e,t,!1,!0)},handleEvent:function(e,t){c(e,t,!1,!0,5)}},s={keys:[46],shouldHandleEvent:function(e,t){return c(e,t,!0,!0)},handleEvent:function(e,t){c(e,t,!0,!0,4)}};function c(e,t,n,o,i){var a=r.cacheGetEventData(e,"NEIGHBOR_ENTITY_ELEMENT_"+n+"_"+o,(function(){var e=t.getSelectionRange();if(o&&!e.collapsed)return null;var i=r.Position.getEnd(e).normalize(),a=null;if(0==i.offset||i.isAtEnd){var u=t.getBodyTraverser(i.node),l=n?0==i.offset?u.currentInlineElement:u.getNextInlineElement():i.isAtEnd?u.currentInlineElement:u.getPreviousInlineElement(),s=l&&l.getContainerNode();if(!o){var c=t.getBlockElementAtNode(i.node);c&&c.contains(s)||(s=null)}a=s&&t.getElementAtCursor(r.getEntitySelector(),s)}return a}));return a&&void 0!==i&&t.triggerPluginEvent(15,{operation:i,rawEvent:e.rawEvent,entity:r.getEntityFromElement(a)}),a}t.EntityFeatures={clickOnEntity:o,escapeFromEntity:i,enterBeforeReadonlyEntity:u,backspaceAfterEntity:l,deleteBeforeEntity:s}},16765:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6551),o=n(2634),i=n(2001),a={keys:[9],shouldHandleEvent:function(e,t){return!e.rawEvent.shiftKey&&h(e,t)},handleEvent:function(e,t){o.setIndentation(t,0),e.rawEvent.preventDefault()}},u={keys:[9],shouldHandleEvent:function(e,t){return e.rawEvent.shiftKey&&h(e,t)},handleEvent:function(e,t){o.setIndentation(t,1),e.rawEvent.preventDefault()}},l={keys:[8],shouldHandleEvent:function(e,t){var n=t.getElementAtCursor("LI",null,e),r=t.getSelectionRange();return n&&r&&i.isPositionAtBeginningOf(i.Position.getStart(r),n)},handleEvent:function(e,t){if(t.getElementAtCursor("LI",null,e).previousSibling){var n=v(t);t.runAsync((function(e){var t=e.getDocument().createElement("BR");e.insertNode(t),e.select(t,-3),o.experimentCommitListChains(e,n)}))}else g(e,t)},defaultDisabled:!0},s={keys:[8],shouldHandleEvent:function(e,t){var n=t.getElementAtCursor("LI",null,e);return n&&i.isNodeEmpty(n)&&!n.previousSibling},handleEvent:g},c={keys:[13],shouldHandleEvent:function(e,t){var n=t.getElementAtCursor("LI",null,e);return!e.rawEvent.shiftKey&&n&&i.isNodeEmpty(n)},handleEvent:function(e,t){t.addUndoSnapshot((function(){return g(e,t)}),null,!0)},defaultDisabled:!i.Browser.isIE&&!i.Browser.isChrome},d={keys:[32],shouldHandleEvent:function(e,t){if(!h(e,t)){var n=t.getContentSearcherOfCursor(e),r=n.getSubStringBefore(4);return/^(\*|-|[0-9]{1,2}\.)$/.test(r)&&!n.getNearestNonTextInlineElement()}return!1},handleEvent:function(e,t){t.runAsync((function(e){e.addUndoSnapshot((function(){var t,n=e.getContentSearcherOfCursor(),i=n.getSubStringBefore(4),a=n.getRangeFromText(i,!0);if(a){if(0==i.indexOf("*")||0==i.indexOf("-"))E(e,a),o.toggleBullet(e);else if(0==i.indexOf("1."))E(e,a),o.toggleNumbering(e);else if(e.isFeatureEnabled("ListChain")&&(t=e.getSelectedRegions())&&1==t.length){var u=parseInt(i);E(e,a),r.default(e,1,u)}}else;}),null,!0)}))}},f={keys:[13,9,46,8,258],shouldHandleEvent:function(e,t){return t.queryElements("li",1).length>0},handleEvent:function(e,t){var n=v(t);t.runAsync((function(e){return o.experimentCommitListChains(e,n)}))}};function v(e){return e.isFeatureEnabled("ListChain")?i.VListChain.createListChains(e.getSelectedRegions()):[]}function E(e,t){t.deleteContents();var n=t.startContainer;if(3==(null==n?void 0:n.nodeType)&&""==n.nodeValue&&!n.nextSibling){var r=e.getDocument().createElement("BR");e.insertNode(r),e.select(r,-2)}}function g(e,t){var n=h(e,t);if(n){var r=n[0],a=i.getTagOfNode(r);"UL"==a?o.toggleBullet(t):"OL"==a&&o.toggleNumbering(t),t.focus(),e.rawEvent.preventDefault()}}function h(e,t){var n=t.getElementAtCursor("LI,TABLE",null,e),r=n&&"LI"==i.getTagOfNode(n)&&t.getElementAtCursor("UL,OL",n);return r?[r,n]:null}t.ListFeatures={autoBullet:d,indentWhenTab:a,outdentWhenShiftTab:u,outdentWhenBackspaceOnEmptyFirstLine:s,outdentWhenEnterOnEmptyLine:c,mergeInNewLineWhenBackspaceOnFirstChar:l,maintainListChain:f}},16766:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2001),o="â€‹";function i(e,t,n,r){return{keys:[e],shouldHandleEvent:function(e,n){return e.rawEvent.shiftKey===r&&!!a(e,n,t)},handleEvent:function(e,r){r.runAsync((function(r){!function(e,t,n,r){t.addUndoSnapshot((function(){var i=a(e,t,n);if(i){var u=i.cloneRange();u.setStart(u.startContainer,u.startOffset+1),i.setEnd(i.endContainer,i.endOffset+1);var l=t.getDocument().createElement(r);l.appendChild(u.extractContents()),i.deleteContents();var s=t.getDocument().createTextNode(o);i.insertNode(s),i.insertNode(l),t.select(s,-1)}}),"Format",!0)}(e,r,t,n)}))}}}function a(e,t,n){return r.cacheGetEventData(e,"MARKDOWN_RANGE",(function(){var o,i;return t.getContentSearcherOfCursor(e).forEachTextInlineElement((function(e){if(i&&o)return!0;var t=e.getTextContent();if(0==t[t.length-1].trim().length)return!1;if(t[t.length-1]===n)return!1;if(i||(i=e.getStartPosition().move(t.length)),t[0]==n)o=e.getStartPosition();else for(var r=t.length-1;r>0;r--){if(o)return!0;if(t[r]==n&&0==t[r-1].trim().length)return o=e.getStartPosition().move(r),!0}})),!!o&&!!i&&r.createRange(o,i)}))}var u=i(56,"*","b",!0),l=i(189,"_","i",!0),s=i(192,"~","s",!0),c=i(192,"`","code",!1);t.MarkdownFeatures={markdownBold:u,markdownItalic:l,markdownStrikethru:s,markdownInlineCode:c}},16767:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2001),o="BLOCKQUOTE",i=[o,"LI","TD","TH"].join(","),a={keys:[8],shouldHandleEvent:function(e,t){var n=l(e,t);return n&&r.isNodeEmpty(n)&&!n.previousSibling},handleEvent:s},u={keys:[13],shouldHandleEvent:function(e,t){var n=l(e,t);return!e.rawEvent.shiftKey&&n&&r.isNodeEmpty(n)},handleEvent:function(e,t){return t.addUndoSnapshot((function(){return s(e,t)}),null,!0)}};function l(e,t){return r.cacheGetEventData(e,"QUOTE_CHILD",(function(){var e=t.getElementAtCursor(i);if(e&&r.getTagOfNode(e)==o){var n=t.getFocusedPosition(),a=n&&t.getBlockElementAtNode(n.normalize().node);if(a){var u=a.getStartNode()==e?a.getStartNode():a.collapseToSingleElement();return r.isNodeEmpty(u)?u:null}}return null}))}function s(e,t){t.addUndoSnapshot((function(){var n,i=l(e,t);r.getTagOfNode(i)==o&&(i=r.wrap(r.toArray(i.childNodes))),n=r.splitBalancedNodeRange(i),r.unwrap(n),t.select(i,0)})),e.rawEvent.preventDefault()}t.QuoteFeatures={unquoteWhenBackspaceOnEmptyFirstLine:a,unquoteWhenEnterOnEmptyLine:u}},16768:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2001),o=n(2634);function i(e,t,n){return{winKey:e,macKey:t,action:n}}var a=[i(4162,8258,o.toggleBold),i(4169,8265,o.toggleItalic),i(4181,8277,o.toggleUnderline),i(4186,8282,(function(e){return e.undo()})),i(4185,24666,(function(e){return e.redo()})),i(4286,8382,o.toggleBullet),i(4287,8383,o.toggleNumbering),i(20670,24766,(function(e){return o.changeFontSize(e,0)})),i(20668,24764,(function(e){return o.changeFontSize(e,1)}))],u={allowFunctionKeys:!0,keys:[66,73,85,89,90,188,190,191],shouldHandleEvent:l,handleEvent:function(e,t){var n=l(e);n&&(n.action(t),e.rawEvent.preventDefault(),e.rawEvent.stopPropagation())}};function l(e){return r.cacheGetEventData(e,"DEFAULT_SHORT_COMMAND",(function(){var t=e.rawEvent,n=0!=e.eventType||t.altKey?0:t.which|(t.metaKey&&8192)|(t.shiftKey&&16384)|(t.ctrlKey&&4096);return n&&a.filter((function(e){return(r.Browser.isMac?e.macKey:e.winKey)==n}))[0]}))}t.ShortcutFeatures={defaultShortcut:u}},16769:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2001),o=r.Browser.isEdge?"<div><span><br></span></div>":"<div><br></div>",i={TD:"TABLE",TH:"TABLE",LI:"OL,UL"},a=Object.keys(i).join(","),u={keys:[13],shouldHandleEvent:l,handleEvent:function(e,t){var n=l(e,t),i=r.fromHtml(o,t.getDocument())[0];t.addUndoSnapshot((function(){n.parentNode.insertBefore(i,n),"TABLE"==r.getTagOfNode(n)&&t.select(new r.Position(i,0).normalize())})),e.rawEvent.preventDefault()},defaultDisabled:!0};function l(e,t){return r.cacheGetEventData(e,"FIRST_STRUCTURE",(function(){var n=e.rawEvent.shiftKey?null:t.getElementAtCursor(a);if(n){var o=t.getSelectionRange();if(o&&o.collapsed&&r.isPositionAtBeginningOf(r.Position.getStart(o),n)&&!t.getBodyTraverser(n).getPreviousBlockElement())return t.getElementAtCursor(i[r.getTagOfNode(n)])}return null}))}t.StructuredNodeFeatures={insertLineBeforeStructuredNodeFeature:u}},16770:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2634),o=n(2001),i={keys:[9],shouldHandleEvent:u,handleEvent:function(e,t){for(var n=e.rawEvent.shiftKey,i=u(e,t),a=new o.VTable(i),l=n?-1:1,s=a.row,c=a.col+l;;c+=l){if(c<0||c>=a.cells[s].length){if((s+=l)<0){t.select(a.table,-2);break}if(s>=a.cells.length){r.editTable(t,1);break}c=n?a.cells[s].length-1:0}var d=a.getCell(s,c);if(d.td){t.select(d.td,0);break}}e.rawEvent.preventDefault()}},a={keys:[38,40],shouldHandleEvent:u,handleEvent:function(e,t){var n,r=u(e,t),i=new o.VTable(r),a=38==e.rawEvent.which,l=a?-1:1,s=e.rawEvent.shiftKey,c=null===(n=t.getDocument().defaultView)||void 0===n?void 0:n.getSelection(),d=null;if(c){for(var f=c.anchorNode,v=c.anchorOffset,E=i.row;E>=0&&E<i.cells.length;E+=l){var g=i.getCell(E,i.col);if(g.td&&g.td!=r){d=g.td;break}}t.runAsync((function(e){var t,n=e.getElementAtCursor();if(o.contains(i.table,n)&&!o.contains(r,n,!0)){var u=d?new o.Position(d,0):new o.Position(i.table,a?-2:-3);if(s){u=1==u.node.nodeType&&o.isVoidHtmlElement(u.node)?new o.Position(u.node,u.isAtEnd?-3:-2):u;var l=null===(t=e.getDocument().defaultView)||void 0===t?void 0:t.getSelection();null==l||l.setBaseAndExtent(f,v,u.node,u.offset)}else e.select(u)}}))}},defaultDisabled:!o.Browser.isChrome&&!o.Browser.isSafari};function u(e,t){return o.cacheGetEventData(e,"TABLECELL_FOR_TABLE_FEATURES",(function(){var e=t.getFocusedPosition(),n=e&&t.getElementAtCursor("TD,TH,LI",e.node);return n&&("LI"==o.getTagOfNode(n)?null:n)}))}t.TableFeatures={tabInTable:i,upDownInTable:a}}}]);
//# sourceMappingURL=owa.MailBoot~HtmlEditorLazyPlugins~HtmlRecipientEditor.js.map
self.scriptsLoaded['owa.MailBoot~HtmlEditorLazyPlugins~HtmlRecipientEditor.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~HtmlEditorLazyPlugins~HtmlRecipientEditor.js'] = (new Date()).getTime();