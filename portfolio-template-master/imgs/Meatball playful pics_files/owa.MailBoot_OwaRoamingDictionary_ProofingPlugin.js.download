self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~OwaRoamingDictionary~ProofingPlugin.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[296],{10041:function(e,t,n){"use strict";var o=Object.prototype.hasOwnProperty,r="~";function i(){}function s(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,n,o,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new s(n,o||e,i),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function u(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),u.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)o.call(e,t)&&n.push(r?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},u.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,s=new Array(i);o<i;o++)s[o]=n[o].fn;return s},u.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},u.prototype.emit=function(e,t,n,o,i,s){var a=r?r+e:e;if(!this._events[a])return!1;var c,u,l=this._events[a],p=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),p){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,o),!0;case 5:return l.fn.call(l.context,t,n,o,i),!0;case 6:return l.fn.call(l.context,t,n,o,i,s),!0}for(u=1,c=new Array(p-1);u<p;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var h,d=l.length;for(u=0;u<d;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),p){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,n);break;case 4:l[u].fn.call(l[u].context,t,n,o);break;default:if(!c)for(h=1,c=new Array(p-1);h<p;h++)c[h-1]=arguments[h];l[u].fn.apply(l[u].context,c)}}return!0},u.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},u.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},u.prototype.removeListener=function(e,t,n,o){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return c(this,i),this;var s=this._events[i];if(s.fn)s.fn!==t||o&&!s.once||n&&s.context!==n||c(this,i);else{for(var a=0,u=[],l=s.length;a<l;a++)(s[a].fn!==t||o&&!s[a].once||n&&s[a].context!==n)&&u.push(s[a]);u.length?this._events[i]=1===u.length?u[0]:u:c(this,i)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&c(this,t)):(this._events=new i,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=r,u.EventEmitter=u,e.exports=u},10042:function(e,t,n){(function(e,t){!function(e){function n(){}function o(e,t){if(e=void 0===e?"utf-8":e,t=void 0===t?{fatal:!1}:t,-1===i.indexOf(e.toLowerCase()))throw new RangeError("Failed to construct 'TextDecoder': The encoding label provided ('"+e+"') is invalid.");if(t.fatal)throw Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}function r(e){for(var t=0,n=Math.min(65536,e.length+1),o=new Uint16Array(n),r=[],i=0;;){var s=t<e.length;if(!s||i>=n-1){if(r.push(String.fromCharCode.apply(null,o.subarray(0,i))),!s)return r.join("");e=e.subarray(t),i=t=0}if(0==(128&(s=e[t++])))o[i++]=s;else if(192==(224&s)){var a=63&e[t++];o[i++]=(31&s)<<6|a}else if(224==(240&s)){a=63&e[t++];var c=63&e[t++];o[i++]=(31&s)<<12|a<<6|c}else if(240==(248&s)){65535<(s=(7&s)<<18|(a=63&e[t++])<<12|(c=63&e[t++])<<6|63&e[t++])&&(s-=65536,o[i++]=s>>>10&1023|55296,s=56320|1023&s),o[i++]=s}}}if(e.TextEncoder&&e.TextDecoder)return!1;var i=["utf-8","utf8","unicode-1-1-utf-8"];Object.defineProperty(n.prototype,"encoding",{value:"utf-8"}),n.prototype.encode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to encode: the 'stream' option is unsupported.");t=0;for(var n=e.length,o=0,r=Math.max(32,n+(n>>>1)+7),i=new Uint8Array(r>>>3<<3);t<n;){var s=e.charCodeAt(t++);if(55296<=s&&56319>=s){if(t<n){var a=e.charCodeAt(t);56320==(64512&a)&&(++t,s=((1023&s)<<10)+(1023&a)+65536)}if(55296<=s&&56319>=s)continue}if(o+4>i.length&&(r+=8,r=(r*=1+t/e.length*2)>>>3<<3,(a=new Uint8Array(r)).set(i),i=a),0==(4294967168&s))i[o++]=s;else{if(0==(4294965248&s))i[o++]=s>>>6&31|192;else if(0==(4294901760&s))i[o++]=s>>>12&15|224,i[o++]=s>>>6&63|128;else{if(0!=(4292870144&s))continue;i[o++]=s>>>18&7|240,i[o++]=s>>>12&63|128,i[o++]=s>>>6&63|128}i[o++]=63&s|128}}return i.slice?i.slice(0,o):i.subarray(0,o)},Object.defineProperty(o.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(o.prototype,"fatal",{value:!1}),Object.defineProperty(o.prototype,"ignoreBOM",{value:!1});var s=r;"function"==typeof t&&t.from?s=function(e){return t.from(e.buffer,e.byteOffset,e.byteLength).toString("utf-8")}:"function"==typeof Blob&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&(s=function(e){var t=URL.createObjectURL(new Blob([e],{type:"text/plain;charset=UTF-8"}));try{var n=new XMLHttpRequest;return n.open("GET",t,!1),n.send(),n.responseText}catch(t){return r(e)}finally{URL.revokeObjectURL(t)}}),o.prototype.decode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to decode: the 'stream' option is unsupported.");return e=e instanceof Uint8Array?e:e.buffer instanceof ArrayBuffer?new Uint8Array(e.buffer):new Uint8Array(e),s(e)},e.TextEncoder=n,e.TextDecoder=o}("undefined"!=typeof window?window:void 0!==e?e:this)}).call(this,n(108),n(1552).Buffer)},11816:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var o=n(12);function r(){return Object(o.i)()?"https://augloop-dogfood.officeppe.com":"https://augloop.office.com"}},11817:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var o=n(24),r="mc-officeEditorALEnabled",i="mc-officeEditorTonalEnabled",s="turingEmailFlight";function a(){var e=Object(o.i)(r),t=Object(o.i)(i),n=Object(o.i)(s),a=[];return t&&a.push(i),e&&a.push(r),n&&a.push(s),a}},11872:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.SingleItemWorkflow=t.createRuntime=t.runtime=void 0;var i=n(16446);Object.defineProperty(t,"runtime",{enumerable:!0,get:function(){return i.runtime}}),Object.defineProperty(t,"createRuntime",{enumerable:!0,get:function(){return i.createRuntime}}),r(n(11880),t),r(n(11877),t);var s=n(16499);Object.defineProperty(t,"SingleItemWorkflow",{enumerable:!0,get:function(){return s.SingleItemWorkflow}})},11873:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayOperators=void 0,function(e){e.some="some",e.every="every",e.none="none"}(t.arrayOperators||(t.arrayOperators={}))},11874:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.comparisonOperators=void 0,function(e){e.eq="eq",e.ne="ne",e.ge="ge",e.gt="gt",e.lt="lt",e.le="le"}(t.comparisonOperators||(t.comparisonOperators={}))},11875:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logicalOperators=void 0,function(e){e.All="All",e.Any="Any"}(t.logicalOperators||(t.logicalOperators={}))},11876:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.now=void 0;t.now=void 0!==e&&e.hrtime?function(){var t=e.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return Date.now()}}).call(this,n(226))},11877:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LambdaSource=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.Local=1]="Local",e[e.Custom=2]="Custom",e[e.Remote=3]="Remote",e[e.BatchedRemote=4]="BatchedRemote"}(t.LambdaSource||(t.LambdaSource={}))},11878:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenCache=void 0;var o=n(5235),r=function(){function e(e){void 0===e&&(e=33e5),this.tokenCache=new Map,this.requestMap=new Map,this.requestRecordMap=new Map,this.tokenExpirationMs=e}return e.prototype.updateAuthToken=function(e,t){var n=this,r=JSON.stringify(t),i=this.requestRecordMap.get(r);return(void 0===i||this.isTokenExpired(i))&&(i={requestPromise:e.requestAuthToken(t).then((function(e){if(!e||!e.Token)throw new Error("No token available for request "+r);n.tokenCache.set(r,e.Token)})),requestTime:o.Utils.getCurrentTimeMs()},this.requestRecordMap.set(r,i)),i.requestPromise},e.prototype.getAuthTokenEntries=function(e,t){var n=this;return Array.from(this.tokenCache.keys()).map((function(e){var t=n.requestMap.get(e);return void 0===t&&(t=JSON.parse(e),n.requestMap.set(e,t)),{requestKey:e,request:t}})).filter((function(e){var n=e.request;return!t||n.DocId===t})).map((function(t){var o=t.requestKey,r=t.request;return n.isTokenExpired(n.requestRecordMap.get(o))&&n.updateAuthToken(e,r),{ticket:r.Tickets[0],token:n.tokenCache.get(o)}}))},e.prototype.isTokenExpired=function(e){return o.Utils.getCurrentTimeMs()>e.requestTime+this.tokenExpirationMs},e}();t.TokenCache=r},11879:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketWorker=void 0;var o=n(16476),r=n(4128),i=n(5235),s=function(){function e(){this.hasBeenOpened=!1,this.hadEgressError=!1,this.lastEgressTime=0,this.lastPongTime=0,this.remainingPingFailures=3,this.pendingEgress=[]}return e.prototype.init=function(t,n,i){var s=this;this.ws=new o(t),this.logOp=new r.Operation({operationName:e.className,success:!0}).start();var a=function(e){s.logPingLatencyOp.stop(),s.logPingLatencyOp.success=e,r.Log.info(572838091,r.LogCategory.CoreDefault,s.logPingLatencyOp),s.logPingLatencyOp=void 0};this.ws.addEventListener("open",(function(t){e.logCountLimiter.log((function(){s.logOp.resourceId="OnOpen",s.logOp.resultDescription="",s.logOp.success=!0,s.logOp.stop(),r.Log.info(572838092,r.LogCategory.CoreDefault,s.logOp)})),s.hasBeenOpened=!0,s.pendingEgress.forEach((function(e){s.egress(e)})),s.pendingEgress=[],s.pingInterval=setInterval((function(){s.logPingLatencyOp&&(--s.remainingPingFailures,a(!1)),s.remainingPingFailures>0&&s.hasBeenOpened&&s.lastPongTime<s.lastEgressTime&&(s.ws.send(e.pingPongMessage,(function(e){e&&(--s.remainingPingFailures,a(!1))})),s.logPingLatencyOp=new r.Operation({operationName:"Ping",success:!0,dimension0:s.ws.bufferedAmount>=0?s.ws.bufferedAmount.toString().length.toString():void 0}).start())}),3e4)})),this.ws.addEventListener("message",(function(t){s.logPingLatencyOp&&"string"==typeof t.data&&1===t.data.length&&t.data[0]===e.pingPongMessage?(a(!0),s.lastPongTime=Date.now()):n(t.data)})),this.ws.addEventListener("error",(function(t){s.errorMessage=t.message,e.logCountLimiter.log((function(){s.logOp.resourceId="OnError",s.logOp.resultDescription=s.errorMessage,s.logOp.success=!1,s.logOp.stop(),r.Log.info(572838093,r.LogCategory.CoreDefault,s.logOp)})),s.ws.close()})),this.ws.addEventListener("close",(function(t){e.logCountLimiter.log((function(){s.logOp.resourceId="OnClose",s.logOp.resultDescription=t?"code: "+t.code+". reason: "+t.reason:"",s.logOp.success=!0,s.logOp.stop(),r.Log.info(572838094,r.LogCategory.CoreDefault,s.logOp)})),s.pingInterval&&(clearInterval(s.pingInterval),s.pingInterval=void 0),i(s.errorMessage)}))},e.prototype.egress=function(t){var n=this;this.lastEgressTime=Date.now(),this.hasBeenOpened?this.ws.send(t,(function(t){t&&!n.hadEgressError&&(n.hadEgressError=!0,e.logCountLimiter.log((function(){n.logOp.resourceId="OnFirstEgressError",n.logOp.resultDescription=t.message,n.logOp.success=!1,n.logOp.stop(),r.Log.info(572838095,r.LogCategory.CoreDefault,n.logOp)})))})):this.pendingEgress.push(t)},e.prototype.close=function(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=void 0),this.ws.close()},e.className="WebSocketWorker",e.logCountLimiter=new i.LogCountLimiter(e.className),e.pingPongMessage="~",e}();t.WebSocketWorker=s},11880:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DiagnosticLevel=t.DataCategories=void 0,function(e){e[e.ProductServiceUsage=2]="ProductServiceUsage",e[e.ProductServicePerformance=4]="ProductServicePerformance"}(t.DataCategories||(t.DataCategories={})),function(e){e[e.BasicEvent=10]="BasicEvent",e[e.FullEvent=100]="FullEvent",e[e.RequiredServiceDataEvent=110]="RequiredServiceDataEvent"}(t.DiagnosticLevel||(t.DiagnosticLevel={}))},11881:function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.SessionHealth=t.SessionHealthImpact=t.SessionHealthReason=t.SessionHealthSource=void 0;var i,s,a,c=n(16481),u=n(11876);!function(e){e[e.Unknown=0]="Unknown",e[e.Core=1]="Core",e[e.Workflow=2]="Workflow",e[e.SessionExtension=3]="SessionExtension",e[e.Client=4]="Client",e[e.ClientRuntime=5]="ClientRuntime"}(i=t.SessionHealthSource||(t.SessionHealthSource={})),function(e){e[e.Unknown=0]="Unknown",e[e.Core=1]="Core",e[e.Workflow=2]="Workflow",e[e.SessionExtension=3]="SessionExtension",e[e.Client=4]="Client",e[e.Network=5]="Network",e[e.AugLoopDependency=6]="AugLoopDependency",e[e.WorkflowDependency=7]="WorkflowDependency",e[e.ClientRuntime=8]="ClientRuntime"}(s=t.SessionHealthReason||(t.SessionHealthReason={})),function(e){e[e.Unknown=0]="Unknown",e[e.None=1]="None",e[e.MissingInput=2]="MissingInput",e[e.MissingOutput=3]="MissingOutput"}(a=t.SessionHealthImpact||(t.SessionHealthImpact={}));var l=function(e){function t(t,n){var o,r,c=e.call(this,{source:i[t.source],reason:s[t.reason],reasonDependency:t.reasonDependency,subReason:t.subReason,sessionHealthEventName:t.sessionHealthEventName,impact:a[t.impact],success:t.success,durationMs:null!==(o=t.durationMs)&&void 0!==o?o:0,count:"number"==typeof t.count?t.count:1,message:t.message,affectedWorkflows:(null!==(r=t.affectedWorkflows)&&void 0!==r?r:[]).join(","),resourceId:t.resourceId,dimension0:t.dimension0,dimension1:t.dimension1,dimension2:t.dimension2,dimension3:t.dimension3,cv:t.cv,resultSignature:t.resultSignature,resultDescription:t.resultDescription})||this;return c.eventName="SessionHealth",n&&c.setClientMetadata(n),c}return r(t,e),t.prototype.setClientMetadata=function(e){return e&&(this.clientAppName=e.appName,this.clientAppPlatform=e.appPlatform,this.clientAppVersion=e.appVersion,this.clientFlights=e.flights,this.clientReleaseAudienceGroup=e.releaseAudienceGroup,this.clientReleaseChannel=e.releaseChannel,this.clientReleaseFork=e.releaseFork,this.clientRuntimeVersion=e.runtimeVersion,this.clientSessionId=e.sessionId),this},t.prototype.setReason=function(e){return this.reason=s[e],this},t.prototype.setSource=function(e){return this.source=i[e],this},t.prototype.setImpact=function(e){return this.impact=a[e],this},t.prototype.setAffectedWorkflows=function(e){return this.affectedWorkflows=(null!=e?e:[]).join(","),this},t.prototype.getAffectedWorkflows=function(){return this.affectedWorkflows.split(",")},t.prototype.start=function(){return this.startTime=u.now(),this},t.prototype.stop=function(){var e=u.now();return this.durationMs=Math.round(e-this.startTime),this},t}(c.SessionHealthEvent);t.SessionHealth=l},11882:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenProvisionResponse=t.TokenProvisionMessage=t.AnnotationResultsMessage=t.SessionDeleteMessage=t.SyncResponse=t.MicroSyncMessage=t.SyncMessage=t.AnnotationReleaseResponse=t.AnnotationReleaseMessage=t.AnnotationResultStateMessage=t.AnnotationActivationResponse=t.AnnotationActivationMessage=t.CacheDumpRequestResponse=t.CacheDumpRequestMessage=t.SessionCloseMessage=t.SessionInitResponse=t.SessionInitMessage=t.TimeoutErrorResponse=t.ErrorResponse=t.Response=t.Message=void 0;var o=n(2936),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Message"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Message=r;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Response"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Response=i;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_ErrorResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.ErrorResponse=s;var a=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_TimeoutErrorResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_ErrorResponse","AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.TimeoutErrorResponse=a;var c=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionInitMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SessionInitMessage=c;var u=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionInitResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SessionInitResponse=u;var l=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionCloseMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SessionCloseMessage=l;var p=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_CacheDumpRequestMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.CacheDumpRequestMessage=p;var h=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_CacheDumpRequestResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.CacheDumpRequestResponse=h;var d=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationActivationMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AnnotationActivationMessage=d;var f=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationActivationResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AnnotationActivationResponse=f;var g=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationResultStateMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AnnotationResultStateMessage=g;var y=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationReleaseMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AnnotationReleaseMessage=y;var m=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationReleaseResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AnnotationReleaseResponse=m;var v=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SyncMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SyncMessage=v;var S=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_MicroSyncMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.MicroSyncMessage=S;var b=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SyncResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SyncResponse=b;var T=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionDeleteMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SessionDeleteMessage=T;var C=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationResultsMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_SyncMessage","AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AnnotationResultsMessage=C;var w=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_TokenProvisionMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.TokenProvisionMessage=w;var _=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_TokenProvisionResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.TokenProvisionResponse=_},11883:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BatchManager=void 0;var o=n(4128),r=n(6271),i=function(){function e(e,t){this.batchesByGroupingKey=new Map,this.submit=e,this.onSummary=t}return e.prototype.addBatchItem=function(e,t,n,r,i,s){var a=this,c=t.delayMs,u=t.maxInputSize,l=t.estimateSize,p=t.groupingKeyExtractor,h=l(e),d=p(e);if(t.split&&h>u){var f;try{f=t.split(e)}catch(e){var g=new Error("Split error: "+e.message);return void(s?s(g):o.Log.error(573366352,o.LogCategory.CoreDefault,g))}if(f&&Array.isArray(f.inputs)&&f.inputs.length>1){for(var y,m=[],v=s?function(e,t){if(y=y||e,m.push(t),m.length===f.inputs.length){var n;try{n=f.join(m)}catch(e){return void s(new Error("Join error: "+e.message))}s(y,n)}}:void 0,S=0;S<f.inputs.length;S++){var b=f.inputs[S];this.addBatchItem(b,t,n,r,i&&S===f.inputs.length-1,v)}return}}var T=this.batchesByGroupingKey.get(d);T&&T.size+h>u&&(clearTimeout(T.timeout),this.executeBatch(d,T,t),T=void 0),T||(T={items:[],size:0,hasItemsWithCallbacks:!1,context:n},this.batchesByGroupingKey.set(d,T)),T.items.push({input:e,size:h,callback:s}),T.size+=h,T.hasItemsWithCallbacks=T.hasItemsWithCallbacks||!!s,T.cv=r,T.groupComplete=i,clearTimeout(T.timeout),T.groupComplete?this.executeBatch(d,T,t):T.timeout=setTimeout((function(){a.executeBatch(d,T,t)}),c)},e.prototype.removeAllBatchedItems=function(){this.batchesByGroupingKey.forEach((function(e){e.timeout&&clearTimeout(e.timeout)})),this.batchesByGroupingKey.clear()},e.prototype.executeBatch=function(e,t,n){var i=this;this.batchesByGroupingKey.delete(e);var s,a=t.items,c=function(e){return e<0?"Negative":0===e?"0":1===e?"1":"Magnitude "+e.toString().length},u=new o.Operation({operationName:"ExecuteBatch",cv:t.cv,resourceId:t.context.name,dimension0:"Count "+c(a.length),dimension1:"Size "+c(t.size)}).start(),l=function(e,n,i){var s;if(n&&n.exceptionType===r.ExceptionType.NoOutput)u.success=!0,o.Log.info(573366353,o.LogCategory.CoreDefault,u.stop());else{var c=e+" error: "+(n?n.message||n:"Unknown error");s=n||new Error(c),u.success=!1,u.resultDescription="Batch of "+a.length+" items of size "+t.size+" with "+c,u.resultSignature=e+" Error",o.Log.error(573366354,o.LogCategory.CoreDefault,u.stop())}if(t.hasItemsWithCallbacks)for(var l=0,p=a;l<p.length;l++){var h=p[l];h.callback&&h.callback(s,i)}};try{s=n.multiplex(a.map((function(e){return e.input})))}catch(e){return void l("Multiplex",e)}this.submit(s.input,t,(function(e,r){var c;if(e||r&&("exceptionType"in r||r instanceof Error))l("Submit",e||r,r);else if(t.hasItemsWithCallbacks||n.summaryExtractor){var p=void 0;if(t.hasItemsWithCallbacks)try{if((p=s.demultiplex(r)).length!==a.length)throw new Error("Mismatched output length")}catch(e){return void l("Demultiplex",e)}var h=void 0,d=void 0;if(n.summaryExtractor)try{d=(c=n.summaryExtractor(r))[0],h=c[1]}catch(e){return void l("SummaryExtractor",e)}if(u.success=!0,o.Log.info(573366342,o.LogCategory.CoreDefault,u.stop()),t.hasItemsWithCallbacks)for(var f=0;f<a.length;f++)a[f].callback&&a[f].callback(void 0,p[f]);h&&i.onSummary(d,h,t.context)}else u.success=!0,o.Log.info(573366343,o.LogCategory.CoreDefault,u.stop())}))},e}();t.BatchManager=i},11884:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLargerThan=t.estimateSize=void 0;t.estimateSize=function(e){return o(e,Number.POSITIVE_INFINITY)};t.isLargerThan=function(e,t){return o(e,t)>t};var o=function(e,t){for(var n=0,o=[],r=[e];r.length>0;){var i=r.pop(),s=typeof i;if("boolean"===s)n+=4;else if("string"===s)n+=2*i.length;else if("number"===s)n+=8;else if("object"===s&&i&&-1===o.indexOf(i))if(i instanceof Uint8Array)n+=i.length;else for(var a in o.push(i),i)r.push(i[a]);if(n>t)return n}return n}},11885:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenRefreshManager=t.TokenType=void 0,function(e){e[e.Anonymous=0]="Anonymous",e[e.Host=1]="Host"}(t.TokenType||(t.TokenType={}));var o=function(){function e(){this.timers=new Map}return e.prototype.scheduleRefresh=function(t,n,o){var r=this.timers.get(t);r||(r={numberOfAttempts:0},this.timers.set(t,r)),r.timeoutId&&(clearTimeout(r.timeoutId),r.timeoutId=void 0);var i=1e3*n-e.tokenExpirationBufferMs;i>0?r.numberOfAttempts=0:(++r.numberOfAttempts,i=e.tokenRefreshBackoffIntervalMs),r.numberOfAttempts<=e.tokenRefreshMaximumAttempts&&(r.timeoutId=setTimeout((function(){return o()}),i))},e.prototype.clearTimeouts=function(){this.timers.forEach((function(e){clearTimeout(e.timeoutId)})),this.timers=new Map},e.tokenExpirationBufferMs=24e4,e.tokenRefreshBackoffIntervalMs=3e4,e.tokenRefreshMaximumAttempts=3,e}();t.TokenRefreshManager=o},12149:function(e,t,n){"use strict";function o(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}const r=65279;function i(e){if(!e)return[];const t=function(e){const t=atob(e),n=Uint8Array.from(t,e=>e.charCodeAt(0)),o=new Uint16Array(n.length/2);if((n[1]<<8|n[0])!==r)throw new Error("Unexpected string encoding");for(let e=0;e<n.length;e+=2){const t=n[e+1],r=n[e],i=t<<8|r;o[e/2]=i}return o.slice(1)}(e);let n="";return t.forEach(e=>{n+=String.fromCharCode(e)}),n.split("\r\n").filter(e=>e)}function s(e){return function(e){let t="";return e.forEach(e=>{t+=String.fromCharCode(e)}),btoa(t)}(function(e){const t=new Uint16Array(e.length+1),n=new Uint8Array(2*t.length);t[0]=r;for(let n=0;n<e.length;n++)t[n+1]=e.charCodeAt(n);for(let e=0;e<n.length;e+=2){const o=t[e/2],r=o>>8,i=255&o;n[e]=i,n[e+1]=r}return n}(e.join("\r\n")+"\r\n"))}function a(e,t,n){var o;const r={isFaulted:!1};try{const i=JSON.parse(e),s=null===(o=null==i?void 0:i.diagnostics_data)||void 0===o?void 0:o.http_status_code;if(r.resultCode=s,!function(e){if(!e)return!1;return e>=200&&e<300}(s))throw new Error(`Received error status code: ${s||0}`);const a=i.settings;if(t!==c.WriteSettingItem){if(!a)throw new Error("Settings not defined in response");a.forEach(e=>{e.id===n&&(r.value=e.value)})}}catch(e){r.isFaulted=!0,r.fault={errorMessage:e.errorMessage}}return r}var c;function u(e,{response:t},n){return{requestType:e,response:a(t.body,e,n)}}!function(e){e[e.ReadSetting=0]="ReadSetting",e[e.WriteSettingItem=1]="WriteSettingItem"}(c||(c={}));const l={AppName:"RoamingSvcSoapWebClient",AppVersion:"1.0.0",DefaultKnowledge:-1,KnowledgeId_Null:-1,WebClient_POST_TimeoutMsecs:3e4};var p;!function(e){e[e.Uninitialized=0]="Uninitialized",e[e.NormalOrTransientCondition=1e3]="NormalOrTransientCondition",e[e.Success=1001]="Success",e[e.WriteFailed=1002]="WriteFailed",e[e.ServerUnavailable=1003]="ServerUnavailable",e[e.IntermittentCondition=2e3]="IntermittentCondition",e[e.Throttled=2001]="Throttled",e[e.SemiPersistentCondition=3e3]="SemiPersistentCondition",e[e.ServerError=3001]="ServerError",e[e.ServiceDisabled=3002]="ServiceDisabled",e[e.UserFlaggedAsDisabled=3003]="UserFlaggedAsDisabled",e[e.UserNotLicensed=3004]="UserNotLicensed",e[e.PersistentCondition=4e3]="PersistentCondition",e[e.Redirect=4001]="Redirect",e[e.ReconstructClient=4002]="ReconstructClient",e[e.ReconstructServer=4003]="ReconstructServer",e[e.UserNotFound=4004]="UserNotFound",e[e.UnsupportedClient=4005]="UnsupportedClient",e[e.UnsupportedProtocol=4006]="UnsupportedProtocol",e[e.DuplicateWrites=4007]="DuplicateWrites",e[e.InvalidDataValue=4008]="InvalidDataValue",e[e.InvalidListItemData=4009]="InvalidListItemData",e[e.InvalidListItemKey=4010]="InvalidListItemKey",e[e.InvalidSettingId=4011]="InvalidSettingId",e[e.MalformedRequest=4012]="MalformedRequest",e[e.MustNotSpecifyContext=4013]="MustNotSpecifyContext",e[e.MustSpecifyContext=4014]="MustSpecifyContext",e[e.SettingTooLarge=4015]="SettingTooLarge",e[e.TypeMismatch=4016]="TypeMismatch",e[e.InvalidListAction=4017]="InvalidListAction",e[e.ClearSettingData=4018]="ClearSettingData"}(p||(p={}));const h=e=>new Promise(t=>setTimeout(t,e)),d=(e,t)=>Promise.race([e,h(t).then(()=>{throw new Error("TIMEOUT")})]);var f=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};function g(e,t,n,o,r){return f(this,void 0,void 0,(function*(){if(!n)throw new Error("action cannot be null or empty");const i={headers:{"Content-Type":"application/json",Authorization:e,"X-CorrelationId":o.correlationId,"X-Office-Application":`${o.hostApplication}`,"X-Office-Platform":o.hostPlatform,"X-Office-Version":o.hostVersion},method:"ReadSettings"===n?"GET":"PUT"};"WriteSettings"===n&&(i.body=`"${o.value}"`);const s=`${t}/${o.settingId}?rs=${o.hostCulture}`,a=fetch(s,i);let c;try{c=yield d(a,l.WebClient_POST_TimeoutMsecs)}catch(e){throw new Error("WCC: HTTP POST timed out")}if(!c)throw new Error("WCC: No response");if(!c.ok)throw new Error(`WCC: HTTP POST failed: ${c}`);const u={response:{body:yield c.text(),status:c.status,statusText:c.statusText}};return null==r||r.verbose(`WCC: HTTP POST successful: ${u}`),u}))}var y=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};const m={BlackForest:"https://roaming.osi.office.de/rs/v1/settings",Gallatin:"https://roaming.officeapps.partner.office365.cn/rs/v1/settings",PPE:"https://roaming.edog.officeapps.live.com/rs/v1/settings",PROD:"https://roaming.officeapps.live.com/rs/v1/settings",UsGov:"https://roaming.osi.office365.us/rs/v1/settings",UsGovDoD:"https://roaming.osi.apps.mil/rs/v1/settings"};class v{constructor(e,t,n){if(this.accessToken=t,this.logger=n,!e)throw new Error("Environment cannot be null or empty!");if(!m[e])throw new Error(`Environment is invalid. Valid values are [${Object.keys(m)}]`);if(!t)throw new Error("access token cannot be null or empty");this.endpoint=m[e]}read(e){return y(this,void 0,void 0,(function*(){try{const t=yield g(this.accessToken,this.endpoint,"ReadSettings",e,this.logger);return u(c.ReadSetting,t,e.settingId)}catch(e){throw new Error(`exception thrown during Read operation: ${e.message}`)}}))}write(e){return y(this,void 0,void 0,(function*(){try{const t=yield g(this.accessToken,this.endpoint,"WriteSettings",e,this.logger);return u(c.WriteSettingItem,t,e.settingId)}catch(e){throw new Error(`exception thrown during Write operation: ${e.message}`)}}))}}var S=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};function b(e,t,n){return S(this,void 0,void 0,(function*(){if(e){const o=yield e();if(!o)throw new Error("No auth token");return new v(t,o,n)}throw new Error("AuthTokenCallback undefined")}))}const T=1065;var C=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};var w=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};var _,M=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};!function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED",e[e.LOAD_ERROR=3]="LOAD_ERROR"}(_||(_={}));class O{constructor(e,t,n,o,r,i,s){this.authTokenCallback=e,this.environment=t,this.hostApplication=n,this.hostVersion=o,this.hostPlatform=r,this.hostCulture=i,this.logger=s,this.wordSet=new Set,this.lowerCaseWordSet=new Set,this.loadState=_.NOT_LOADED}loadWordListFromRoamingService(e){return M(this,void 0,void 0,(function*(){let t;this.loadState=_.LOADING;try{t=yield function(e,t,n,o,r,i,s,a){var c;return C(this,void 0,void 0,(function*(){const u=yield b(e,t,a);if(u){const e={hostApplication:n,hostVersion:o,hostPlatform:r,hostCulture:i,correlationId:s,settingId:T},t=yield u.read(e);if(t&&t.response){if(t.response.isFaulted)throw new Error(`Got fault in response. ResultCode: ${t.response.resultCode}. ErrorMessage: ${null===(c=t.response.fault)||void 0===c?void 0:c.errorMessage}`);return t.response.value||""}throw new Error("No response from service")}throw new Error("Web Service was not created")}))}(this.authTokenCallback,this.environment,this.hostApplication,this.hostVersion,this.hostPlatform,this.hostCulture,e,this.logger)}catch(e){return this.loadState=_.LOAD_ERROR,{success:!1,errorMessage:e.message}}if(!t)return this.loadState=_.LOADED,this.wordSet=new Set,this.lowerCaseWordSet=new Set,{success:!0};try{const e=i(t);return this.wordSet=new Set(e),this.lowerCaseWordSet=new Set(e.map(e=>e.toLocaleLowerCase())),this.loadState=_.LOADED,{success:!0}}catch(e){return this.loadState=_.LOAD_ERROR,{success:!1,errorMessage:e.message}}}))}saveWordListToRoamingService(e){return M(this,void 0,void 0,(function*(){if(this.loadState!==_.LOADED)return{success:!1,errorMessage:"No dictionary previously loaded"};const t=Array.from(this.wordSet).sort(o);let n="";try{n=s(t)}catch(e){return{success:!1,errorMessage:e.message}}if(n)try{return yield function(e,t,n,o,r,i,s,a,c){return w(this,void 0,void 0,(function*(){const u=yield b(e,t,c);if(u){const e={hostApplication:o,hostVersion:r,hostPlatform:i,hostCulture:s,correlationId:a,settingId:T,value:n},t=yield u.write(e);if(t&&t.response){if(t.response.isFaulted)throw new Error(`Received fault when writing setting. ResultCode: ${t.response.resultCode}`);return}throw new Error("No response received")}throw new Error("Web Service was not created")}))}(this.authTokenCallback,this.environment,n,this.hostApplication,this.hostVersion,this.hostPlatform,this.hostCulture,e,this.logger),{success:!0}}catch(e){return{success:!1,errorMessage:e.message}}return{success:!1,errorMessage:"Nothing to save"}}))}testWord(e,t){return t?this.wordSet.has(e):this.lowerCaseWordSet.has(e.toLocaleLowerCase())}getWordList(){return Array.from(this.wordSet)}addWord(e){if(e&&!this.wordSet.has(e)){this.wordSet.add(e);const t=e.toLocaleLowerCase();return this.lowerCaseWordSet.has(t)||this.lowerCaseWordSet.add(t),!0}return!1}removeWord(e){if(e&&this.wordSet.has(e)){this.wordSet.delete(e);const t=e.toLocaleLowerCase();return this.lowerCaseWordSet.has(t)&&this.lowerCaseWordSet.delete(t),!0}return!1}getLoadState(){return this.loadState}}n.d(t,"b",(function(){return O})),n.d(t,"a",(function(){return _}))},16446:function(e,t,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.createRuntime=t.runtime=t.ClientRuntime=t.getTypeFromSchema=t.Workflow=void 0;var r,i=n(7596),s=n(4128),a=n(6271),c=n(11877),u=n(16470),l=n(16474),p=n(16477),h=n(16478),d=n(16479),f=n(11879),g=n(16480),y=n(16491),m=n(11883),v=n(11884),S=n(16492),b=n(5235),T=n(16496),C=n(16497),w=n(11885);!function(e){e[e.Restricted=0]="Restricted",e[e.Unrestricted=1]="Unrestricted",e[e.Suppressed=2]="Suppressed"}(r||(r={}));var _=function(){function e(){this.canaryTextTileEventSubmittedByDocSessionId=new Set,this.stateByDocSessionId=new Map,this.executionQueueByDocSessionId=new Map,this.executionCountByDocSessionId=new Map}return e.prototype.getOutputSchema=function(){return this.lambdas[this.lambdas.length-1].outputSchema},e.prototype.scheduleExecution=function(t,n){var o;o=e.trackingByDocSessionIdEnabled?this.docSessionIdExtractor?this.docSessionIdExtractor(t):void 0:this.docIdExtractor?this.docIdExtractor(t):void 0;var i=this.getStateForDocSessionId(o);if(i===r.Restricted){var s=this.getExecutionQueueForDocSessionId(o);s.push(n),1===s.length&&n()}else i===r.Unrestricted?n():r.Suppressed},e.prototype.onStart=function(e){this.incrementExecutionCountForDocSessionId(e)},e.prototype.onFinish=function(e,t){if(this.decrementExecutionCountForDocSessionId(e),t===a.ExceptionType.Authentication)this.stateByDocSessionId.set(e,r.Suppressed),this.executionQueueByDocSessionId.delete(e);else if(this.stateByDocSessionId.get(e)===r.Restricted){var n=this.getExecutionQueueForDocSessionId(e);if(n.shift(),void 0===t){this.stateByDocSessionId.set(e,r.Unrestricted),this.executionQueueByDocSessionId.delete(e);for(var o=0,i=n;o<i.length;o++){(0,i[o])()}}else if(n.length>0){(0,n[0])()}}},e.prototype.onRefresh=function(e){this.stateByDocSessionId=new Map,this.triggerOnRefresh&&(e?(this.executionQueueByDocSessionId.delete(e),this.executionCountByDocSessionId.delete(e)):(this.executionQueueByDocSessionId=new Map,this.executionCountByDocSessionId=new Map)),this.canaryTextTileEventSubmittedByDocSessionId.delete(e)},e.prototype.getStateForDocSessionId=function(t){var n=this.stateByDocSessionId.get(t);return void 0===n&&(n=e.executionQueuesEnabled?r.Restricted:r.Unrestricted,this.stateByDocSessionId.set(t,n)),n},e.prototype.getExecutionQueueForDocSessionId=function(e){var t=this.executionQueueByDocSessionId.get(e);return void 0===t&&(t=[],this.executionQueueByDocSessionId.set(e,t)),t},e.prototype.incrementExecutionCountForDocSessionId=function(e){var t=this.executionCountByDocSessionId.get(e)||0;this.executionCountByDocSessionId.set(e,t+1)},e.prototype.decrementExecutionCountForDocSessionId=function(e){var t=this.executionCountByDocSessionId.get(e)||0;t<=1?this.executionCountByDocSessionId.delete(e):this.executionCountByDocSessionId.set(e,t-1)},e.executionQueuesEnabled=!0,e.trackingByDocSessionIdEnabled=!0,e}();t.Workflow=_;t.getTypeFromSchema=function(e){return{category:a.TypeCategory.Schema,schema:{name:e}}};var M="Tiling.TextTileEvent",O=function(e,t){return e===M&&t&&t.type==a.Tiling.TextTileEventType.Refresh},k=function(e,t){return"ClpSlideTile"===e&&t&&t.eventType==a.Ppt.SlideTileEventType.Refresh},R=function(e,t){return O(e,t)||k(e,t)},A=function(e,t){var n,o;return e===M?null===(o=null===(n=t.tile)||void 0===n?void 0:n.metadata)||void 0===o?void 0:o.docSessionId:"ClpSlideTile"===e?t.docId:void 0},E=function(){function e(e,t,n){this.inputSchemasToWorkflows=new Map,this.inputSchemasToReduceWorkflows=new Map,this.reduceWorkflowsGroupingKeyExtractors=new Map,this.defaultWorkflowOptions={canProduceNullResult:!1,shouldSendResultsToHost:!0,enabledByDefault:!1,throttleSettings:{shouldBeThrottled:!1},triggerOnRefresh:!1},this.resultCache=new h.ResultCache,this.reduceTimerCache=new p.ReduceTimerCache,this.lookupTableCache=new Map,this.sessionsByDocSessionId=new Map,this.throttling=new y.ExecutionWithThrottling,this.lastTileRefreshSeq=-1,this.lastTileRefreshSeqByDocSessionId=new Map,this.dropOnlySequencedSyncsOnReseedEnabled=!0,this.tileRefreshByDocSessionIdEnabled=!0,this.workerFactory=e||function(){return new f.WebSocketWorker},this.sessionManagerFactory=t||this.createDefaultSessionManagerFactory(),this.sessionFactory=n||function(e){return new S.Session(e)}}return e.prototype.init=function(e,t,o,r){var i=this,a=new s.Operation({operationName:"InitRuntime",resourceId:e});a.start(),this.modelDownloader=r.modelDownloader,this.clientMetadata=t,this.clientMetadata&&(this.clientMetadata.runtimeVersion=n(16498).version),this.hostCallbacks=o,s.Log.addLogger(new d.TelemetryLogger(this.hostCallbacks));var c=r.telemetryAggregationIntervalSec;if(void 0===c&&(c=30),c>0){var p=function(e,t,n){return new s.LoggingAggregator(e,(function(e){return e.success&&n.indexOf(e[t])>=0}),[t,"resourceId","success","resultSignature","dimension0","dimension1","dimension2","dimension3"],["durationMs"],c)};s.Log.addAggregator(p("Operation","operationName",["ExecuteLambda","ExecuteWorkflow","ExecuteBatch","ProcessResponse"])),s.Log.addAggregator(p("SessionHealth","sessionHealthEventName",["ProcessMessage","SendMessage"]))}this.batchOptions=r.batchOptions;var h=[];return h.push(this.isFeatureEnabled("DisableWebSocket").then((function(n){if(!!n)return!1;return!(["Outlook Mac","Outlook Win32","PowerPoint Mac","PowerPoint Web","PowerPoint Win32","Word Mac","Word Win32"].indexOf(t.appName+" "+t.appPlatform)>=0)||l.testWebSocketConnection(b.Utils.convertServiceUrlToWebSocket(e),i.clientMetadata)})).then((function(t){e&&(i.serviceUrl=t?b.Utils.convertServiceUrlToWebSocket(e):e,i.executeRemoteLambda=t?l.executeRemoteLambda:u.executeRemoteLambda,i.clearRemoteLambdaTokenCache=t?l.clearTokenCache:u.clearTokenCache,i.serviceProtocol=i.serviceUrl.split(":")[0].toLowerCase())}))),h.push(this.isFeatureEnabled("WorkflowQueuesDisabled").then((function(e){_.executionQueuesEnabled=!e}))),h.push(this.isFeatureEnabled("WorkflowTrackingByDocSessionIdDisabled").then((function(e){_.trackingByDocSessionIdEnabled=!e}))),h.push(this.isFeatureEnabled("DropOnlySequencedSyncsOnReseedDisabled").then((function(e){i.dropOnlySequencedSyncsOnReseedEnabled=!e}))),h.push(this.isFeatureEnabled("TileRefreshByDocSessionIdDisabled").then((function(e){i.tileRefreshByDocSessionIdEnabled=!e}))),Promise.all(h).then((function(){i.serviceUrl&&r.initSession&&i.createSession(),i.logOperation(a,!0)})).catch((function(e){i.logOperation(a,!1,"Error",e?e.message:"(no error)")}))},e.prototype.getServiceProtocol=function(){return this.serviceProtocol},e.prototype.registerSchemas=function(e,t){return Promise.resolve()},e.prototype.registerSimpleLocalWorkflow=function(e,t,n){return void 0===n&&(n=this.defaultWorkflowOptions),t.source=t.source||c.LambdaSource.Custom,this.registerHardcodedWorkflow(e,[t],this.inputSchemasToWorkflows,n)},e.prototype.registerSimpleRemoteWorkflow=function(e,t,n,o,r){void 0===r&&(r=this.defaultWorkflowOptions);var i=[];return t&&(t.source=c.LambdaSource.Custom,i.push(t)),n.source=n.func?c.LambdaSource.Custom:c.LambdaSource.Remote,i.push(n),o&&(o.source=c.LambdaSource.Custom,i.push(o)),this.registerHardcodedWorkflow(e,i,this.inputSchemasToWorkflows,r)},e.prototype.registerMultipleLambdasWorkflow=function(e,t,n){return void 0===n&&(n=this.defaultWorkflowOptions),this.registerHardcodedWorkflow(e,t,this.inputSchemasToWorkflows,n)},e.prototype.registerReduceWorkflow=function(e,t,n,o,r){return void 0===o&&(o=10),void 0===r&&(r=this.defaultWorkflowOptions),this.reduceWorkflowsGroupingKeyExtractors.set(t.inputSchema,n),this.resultCache.setBucketSize(t.inputSchema,o),t.source=t.source||c.LambdaSource.Custom,this.registerHardcodedWorkflow(e,[t],this.inputSchemasToReduceWorkflows,r)},e.prototype.registerMultipleLambdasReduceWorkflow=function(e,t,n,o,r){return void 0===o&&(o=10),void 0===r&&(r=this.defaultWorkflowOptions),this.reduceWorkflowsGroupingKeyExtractors.set(t[0].inputSchema,n),this.resultCache.setBucketSize(t[0].inputSchema,o),this.registerHardcodedWorkflow(e,t,this.inputSchemasToReduceWorkflows,r)},e.prototype.registerLocalWorkflow=function(e){this.getSession().registerLocalWorkflow(e)},e.prototype.activateAnnotation=function(e,t){return this.getSession().activateAnnotation(e,t)},e.prototype.updateAnnotationConfig=function(e,t){this.getSession().updateAnnotationConfig(e,t)},e.prototype.releaseAnnotation=function(e){return this.getSession().releaseAnnotation(e)},e.prototype.setAnnotationState=function(e,t,n){this.getSession().setAnnotationState(e,t,n)},e.prototype.submit=function(e,t,n){this.submitToWorkflows(e,t,n,this.inputSchemasToWorkflows)},e.prototype.submitOperation=function(e,t){this.getSession().submitOperation(e,t)},e.prototype.submitOperations=function(e,t){this.getSession().submitOperations(e,t)},e.prototype.submitCustomMessage=function(e){return this.getSession().submitCustomMessage(e)},e.prototype.submitSeedOperations=function(e,t){this.getSession().submitSeedOperations(e,t)},e.prototype.submitSeedGroupOperations=function(e,t,n){this.getSession().submitSeedGroupOperations(e,t,n)},e.prototype.flushTelemetry=function(e){s.Log.flushAggregators(e)},e.prototype.requestCacheDump=function(e){return this.getSession().requestCacheDump(e)},e.prototype.forceReconnectSession=function(){return this.getSession().forceReconnect()},e.prototype.setSessionCloseCallback=function(e){this.getSession().setSessionCloseCallback(e)},e.prototype.closeSession=function(){this.getSession().close()},e.prototype.createSession=function(e){var t=e?e.docSessionId:void 0,n=this.sessionsByDocSessionId.get(t);if(n&&!1===n.isClosed)throw new Error("docSessionId already exists");var r=o({},this.clientMetadata);r.docSessionId=t,e&&e.flights&&(r.flights=r.flights?r.flights+";"+e.flights:e.flights);var i=this.sessionFactory({hostCallbacks:this.hostCallbacks,sessionManager:this.sessionManagerFactory(r),batchOptions:this.batchOptions,extensionConfigs:(null==e?void 0:e.extensionConfigs)||[],clientMetadata:r,modelDownloader:this.modelDownloader});return this.sessionsByDocSessionId.set(t,i),e&&e.onSessionConnect&&i.setConnectCallback(e.onSessionConnect),e&&e.onSessionDisconnect&&i.setDisconnectCallback(e.onSessionDisconnect),e&&e.onSessionReconnect&&i.setReconnectCallback(e.onSessionReconnect),e&&e.onSessionClose&&i.setSessionCloseCallback(e.onSessionClose),i.initialize?i.initialize():Promise.resolve(i)},e.prototype.getSession=function(e){return this.sessionsByDocSessionId.get(e)},e.prototype.createDefaultSessionManagerFactory=function(){var e=this;return function(t){var n=new w.TokenRefreshManager,o=new T.SessionStats,r=function(){s.Log.error(573321615,s.LogCategory.CoreDefault,"Unexpectedly not set sendMessage")},i=new C.SessionInitializer((function(){return o}),t,n,(function(e,t){r(e,t)}),{getAuthToken:e.getAuthToken.bind(e),overrideSessionInitMessage:e.hostCallbacks.overrideSessionInitMessage}),a=new g.WebSocketSessionManager(b.Utils.convertServiceUrlToWebSocket(e.serviceUrl),o,e.workerFactory,i,t,e.dropOnlySequencedSyncsOnReseedEnabled);return r=a.sendMessage.bind(a),a.on("disconnect",(function(){return n.clearTimeouts()})),a.on("connect",(function(t,n,o,r){t&&e.hostCallbacks.setSessionData&&e.hostCallbacks.setSessionData(n,o,r)})),a}},e.prototype.getAuthToken=function(){return this.hostCallbacks.requestAuthToken({Tickets:[]}).then((function(e){if(e)return e.Token})).catch((function(){}))},e.prototype.getGroupingKey=function(e,t,n){var o=this.reduceWorkflowsGroupingKeyExtractors.get(n);if(null==o)throw new Error("Reduce workflow does not have a grouping extractor");return o(t,e)},e.prototype.submitToWorkflows=function(e,t,n,o){if(void 0===o&&(o=this.inputSchemasToWorkflows),this.hostCallbacks){var r;r=n?s.CorrelationVector.fromString(n):new s.CorrelationVector,this.handleTileRefresh(e,t,r);for(var i,a=0,c=o.get(e)||[];a<c.length;a++){var u=c[a];R(e,t)&&!u.triggerOnRefresh||(u.useCanaryTextTile&&e===M&&!u.canaryTextTileEventSubmittedByDocSessionId.has(A(e,t))&&(this.submitToWorkflow(M,{type:(i=t).type,tile:{metadata:{docSessionId:i.tile.metadata.docSessionId,docId:i.tile.metadata.docId,seqnoCLPRefresh:i.tile.metadata.seqnoCLPRefresh,tileId:"A56B3127DBDFD0D6"},elements:[{text:"B91153AE828B4E48"}]}},r,u,o),u.canaryTextTileEventSubmittedByDocSessionId.add(A(e,t))),this.submitToWorkflow(e,t,r,u,o))}}},e.prototype.submitToWorkflow=function(e,n,o,r,i){var c=this,u={messageType:a.MessageType.Input,correlationVector:o.newChild(),payload:n,payloadSchema:t.getTypeFromSchema(r.lambdas[0].inputSchema),clientMetadata:this.clientMetadata},l=new s.Operation({cv:u.correlationVector.toString(),operationName:"ExecuteWorkflow",resourceId:r.name});l.start(),r.scheduleExecution(n,(function(){try{if(u.payload&&u.payload.tile&&u.payload.tile.metadata&&u.payload.tile.metadata.tileId){var t=u.payload.tile.metadata.tileId;c.throttling.execute(t,r,(function(){return c.executeWorkflow(l,u,n,r,e,i)}))}else c.executeWorkflow(l,u,n,r,e,i)}catch(e){l.success=!1,l.resultSignature="ExecuteException",l.resultDescription=e?e.message:"(no error)",s.Log.error(573321616,s.LogCategory.CoreDefault,l.stop())}}))},e.prototype.handleTileRefresh=function(e,t,n){var o=this;if(R(e,t)){var r=this.tileRefreshByDocSessionIdEnabled?A(e,t):void 0,i=function(e,t){var n,o;return O(e,t)?null===(o=null===(n=t.tile)||void 0===n?void 0:n.metadata)||void 0===o?void 0:o.seqnoCLPRefresh:(k(e,t),-1)}(e,t);if(this.tileRefreshByDocSessionIdEnabled){var a=this.lastTileRefreshSeqByDocSessionId.get(r);if(a>=0&&i<=a)return}else if(i<=this.lastTileRefreshSeq)return;var c=new s.Operation({cv:n.toString(),operationName:"TileRefresh",resultDescription:"",success:!0});if(c.start(),this.tileRefreshByDocSessionIdEnabled&&!r)return c.success=!1,c.resultDescription="NoDocSessionId",void s.Log.info(573420545,s.LogCategory.CoreDefault,c.stop());this.inputSchemasToReduceWorkflows.forEach((function(e,t){e.some((function(e){return e.triggerOnRefresh}))&&(o.tileRefreshByDocSessionIdEnabled?(o.resultCache.clear(t,{primary:r}),o.resultCache.clear(o.getForcedDocLevelSchema(t),{primary:r}),o.reduceTimerCache.clear(t,r)):(o.resultCache.clear(t),o.resultCache.clear(o.getForcedDocLevelSchema(t)),o.reduceTimerCache.clear(t)),e.some((function(e){return!e.triggerOnRefresh}))&&(c.resultDescription+="X_"),c.resultDescription+=t+" ")})),this.clearRemoteLambdaTokenCache();var u=[];this.inputSchemasToWorkflows.forEach((function(e){return u.push.apply(u,e)})),this.inputSchemasToReduceWorkflows.forEach((function(e){return u.push.apply(u,e)}));for(var l=0,p=u;l<p.length;l++){var h=p[l];this.tileRefreshByDocSessionIdEnabled?h.onRefresh(r):h.onRefresh()}this.tileRefreshByDocSessionIdEnabled?this.lastTileRefreshSeqByDocSessionId.set(r,i):this.lastTileRefreshSeq=i,s.Log.info(573321617,s.LogCategory.CoreDefault,c.stop())}},e.prototype.executeWorkflow=function(e,t,n,o,r,c){var u=this,l=o.docIdExtractor?o.docIdExtractor(t.payload):void 0,p=_.trackingByDocSessionIdEnabled?o.docSessionIdExtractor(n):l,h=this.tileRefreshByDocSessionIdEnabled?this.lastTileRefreshSeqByDocSessionId.get(p):this.lastTileRefreshSeq;o.onStart(p);var d=function(t){var l=u.tileRefreshByDocSessionIdEnabled?u.lastTileRefreshSeqByDocSessionId.get(p):u.lastTileRefreshSeq;if(o.triggerOnRefresh&&l!==h)return e.success=!0,e.resultSignature="TileRefreshIgnore",void s.Log.info(573321618,s.LogCategory.CoreDefault,e.stop());var d=t.messageType==a.MessageType.Exception&&t.payload.exceptionType==a.ExceptionType.NoOutput,f=d&&o.canProduceNullResult,g=f?o.lambdas[o.lambdas.length-1].outputSchema:t.payloadSchema.schema.name,y=f?null:t.payload;t.messageType===a.MessageType.Input||f?(o.shouldSendResultsToHost&&(c===u.inputSchemasToReduceWorkflows?u.hostCallbacks.onResult("Reduce.Input",n,g,y):u.hostCallbacks.onResult(r,n,g,y)),e.success=!0,e.resultSignature=d?"NoOutput":"ValidOutput"):d?(e.success=!0,e.resultSignature="NoOutput"):(e.success=!1,e.resultSignature="Exception",e.resultDescription=i.getMessageExceptionDescription(t)),c!==u.inputSchemasToReduceWorkflows&&u.updateResultCacheForReduceWorkflows(r,n,g,y,t.correlationVector.toString()),t.moreResults||(e.stop(),s.Log.info(573321619,s.LogCategory.CoreDefault,e),o.onFinish(p,t.payload&&t.payload.exceptionType?i.getMessageExceptionType(t):void 0))};o.preExecutionPromise.then((function(){for(var e={lookupTable:u.lookupTableCache.get(o.name),docId:l},n=d,r=o.lambdas.length-1;r>=0;r--)n=u.createLambdaExecutionStep(o.name,o.lambdas[r],e,n,d);n(t)}))},e.prototype.getForcedDocLevelSchema=function(e){return"~"+e},e.prototype.updateResultCacheForReduceWorkflows=function(e,t,n,o,r){var i=this,c=this.inputSchemasToReduceWorkflows.get(n);if(c){var u;"docId"===e?(u=this.getGroupingKey(e,t,n),this.resultCache.setResult(this.getForcedDocLevelSchema(n),u,o),u.secondary="*"):(u=this.getGroupingKey(e,t,n),!function(e,t){return e===M&&t&&t.type==a.Tiling.TextTileEventType.Delete||"ClpSlideTile"===e&&t&&t.eventType==a.Ppt.SlideTileEventType.Delete}(e,t)||null==u.primary||null==u.secondary?this.resultCache.setResult(n,u,o):this.resultCache.clear(void 0,u));var l=c.some((function(e){return e.deferReduceUntilIdle})),p=[];this.inputSchemasToWorkflows.forEach((function(e){return p.push.apply(p,e.filter((function(e){return e.getOutputSchema()===n})))}));var h=c.map((function(e){return e.deferReduceUntilIdleMaxDelayMs||0})).reduce((function(e,t){return Math.max(e,t)}));this.reduceTimerCache.setReduceTimer(n,u.primary,(function(){var e=i.resultCache.getResults(n,u);if(e.push.apply(e,i.resultCache.getResults(i.getForcedDocLevelSchema(n),{primary:u.primary})),Array.isArray(e)){var t={id:u.primary,values:e,isReduceInput:!0};i.submitToWorkflows(n,t,r,i.inputSchemasToReduceWorkflows)}else s.Log.error(573321620,s.LogCategory.CoreDefault,'Cached results have unexpected type "'+typeof e+'"')}),500,(function(){return l&&p.some((function(e){return e.executionCountByDocSessionId.get(u.primary)>0}))}),h)}},e.prototype.isFeatureEnabled=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n="None"),this.hostCallbacks&&this.hostCallbacks.isFeatureEnabled?this.hostCallbacks.isFeatureEnabled("Microsoft.Office.AugLoop."+e,n).catch((function(){return Promise.resolve(t)})):Promise.resolve(t)},e.prototype.areLicenseFeaturesEnabled=function(e){return this.hostCallbacks&&this.hostCallbacks.areLicenseFeaturesEnabled?this.hostCallbacks.areLicenseFeaturesEnabled(e).catch((function(){return Promise.resolve(!1)})):Promise.resolve(!1)},e.prototype.isWorkflowEnabled=function(e,t,n,o,r){var i=this;if(t.some((function(e){return e.source===c.LambdaSource.Remote}))){if(!this.serviceUrl)return r.resultDescription="Disabled because no service URL available for remote workflow",Promise.resolve(!1);if(this.clientMetadata&&this.clientMetadata.privateMode&&t.some((function(e){return e.source===c.LambdaSource.Remote&&!e.canRunInPrivateMode})))return r.resultDescription="Disabled because we are running in private mode",Promise.resolve(!1)}return(!this.clientMetadata||"Mac"!==this.clientMetadata.appPlatform&&"Win32"!==this.clientMetadata.appPlatform)&&(o=!0,r.resultDescription="Enabled by default due to platform name"),(o?Promise.resolve(!0):this.isFeatureEnabled("WorkflowEnabled."+e)).then((function(t){return t?i.isFeatureEnabled("WorkflowDisabled."+e).then((function(e){return e?(r.resultDescription="Disabled because explicitly disabled",!1):!n||i.areLicenseFeaturesEnabled(n).then((function(e){return e||(r.resultDescription="Disabled because license check failed"),e}))})):(r.resultDescription="Disabled because not explicitly enabled",!1)}))},e.prototype.registerHardcodedWorkflow=function(e,n,o,r){var i=this;if(void 0===o&&(o=this.inputSchemasToWorkflows),!e||e.length>40)throw new Error("Workflow name has invalid length");if(!1===new RegExp(/^[A-Z][a-zA-Z0-9_]+$/).test(e))throw new Error("Workflow name has invalid format");o.forEach((function(t){if(t.some((function(t){return t.name===e})))throw new Error("Workflow name already registered.")}));var c=new s.Operation({operationName:"WorkflowRegistration",resourceId:e,success:!0});return c.setClientMetadata(this.clientMetadata),c.start(),this.isWorkflowEnabled(e,n,r.licenseFeatures,r.enabledByDefault,c).then((function(u){if(c.resultSignature=u?"Enabled":"Disabled",c.stop(),s.Log.info(573321621,s.LogCategory.CoreDefault,c),u){var l=n[0].inputSchema,p=o.get(l);p||(p=[],o.set(l,p));var h=Promise.resolve();r.lookupTableLambda&&(h=new Promise((function(n,o){var c=new s.CorrelationVector,u={messageType:a.MessageType.Input,correlationVector:c,payloadSchema:t.getTypeFromSchema(r.lookupTableLambda.inputSchema),clientMetadata:i.clientMetadata,payload:{}},l=function(t){t.messageType===a.MessageType.Input&&t.payload&&i.lookupTableCache.set(e,t.payload),n()};i.createLambdaExecutionStep("",r.lookupTableLambda,{},l,l)(u)})));var d=new _;d.name=e,d.lambdas=n,d.canProduceNullResult=r.canProduceNullResult,d.shouldSendResultsToHost=r.shouldSendResultsToHost,d.triggerOnRefresh=r.triggerOnRefresh,d.throttleSettings=r.throttleSettings||i.defaultWorkflowOptions.throttleSettings,d.docIdExtractor=r.docIdExtractor,d.docSessionIdExtractor=function(e){return e.isReduceInput?e.id:A(l,e)},d.deferReduceUntilIdle=r.deferReduceUntilIdle,d.deferReduceUntilIdleMaxDelayMs=r.deferReduceUntilIdleMaxDelayMs,d.useCanaryTextTile=r.useCanaryTextTile,d.preExecutionPromise=h,p.push(d)}}))},e.prototype.logOperation=function(e,t,n,o){e.stop(),e.success=t,e.resultSignature=n,e.resultDescription=o,s.Log.info(573321622,s.LogCategory.CoreDefault,e)},e.prototype.handleLambdaError=function(e,t,n,o,r){null!=e.exceptionType?i.setMessageException(t,e):e instanceof Error?i.setMessageException(t,{exceptionType:o,message:e.message}):i.setMessageException(t,{exceptionType:a.ExceptionType.Unknown,message:e?e.toString():void 0}),this.logOperation(n,!1,"Exception",i.getMessageExceptionDescription(t)),r(t)},e.prototype.handleLambdaOutput=function(e,n,o,r,s,c){e&&e.exceptionType!==a.ExceptionType.NoOutput?null!=e.exceptionType?this.handleLambdaError(e,n,o,e.exceptionType,c):e instanceof Error?this.handleLambdaError(e,n,o,a.ExceptionType.LambdaErrorCallback,c):(n.payload=e,n.payloadSchema=t.getTypeFromSchema(r),this.logOperation(o,!0),s(n)):(i.setMessageException(n,{exceptionType:a.ExceptionType.NoOutput}),this.logOperation(o,!0,"NoOutput"),c(n))},e.prototype.executeCustomLambdaStep=function(e,t,n,o,r,s){var c=this;if(null==n.func)i.setMessageException(e,{exceptionType:a.ExceptionType.LambdaThrow,message:"No lambda function set"}),this.logOperation(t,!1,"Error",i.getMessageExceptionDescription(e)),s(e);else{try{n.func(e.payload,n.config,o,(function(o){c.handleLambdaOutput(o,e,t,n.outputSchema,r,s)}),(function(n,o){c.handleLambdaOutput(n,e,t,o,s,s)}))}catch(n){this.handleLambdaError(n,e,t,a.ExceptionType.LambdaThrow,s)}}},e.prototype.executeLocalLambdaStep=function(e,t,n,o,r){var s=this;null==this.hostCallbacks.executeLocalLambda?(i.setMessageException(e,{exceptionType:a.ExceptionType.LambdaThrow,message:"No local lambda host callback set"}),this.logOperation(t,!1,"Error",i.getMessageExceptionDescription(e)),r(e)):this.hostCallbacks.executeLocalLambda(n.inputSchema,e.payload,n.outputSchema).then((function(i){s.handleLambdaOutput(i,e,t,n.outputSchema,o,r)})).catch((function(n){s.handleLambdaError(n,e,t,a.ExceptionType.LambdaThrow,r)}))},e.prototype.executeRemoteLambdaStep=function(e,n,o,r,s,u){var l=this;if(this.serviceUrl){n.resourceId+="."+this.serviceProtocol;var p=function(t,r){t?l.handleLambdaError(t,e,n,t.exceptionType||a.ExceptionType.LambdaErrorCallback,u):l.handleLambdaOutput(r,e,n,o.outputSchema,s,u)};if(r.authTickets=o.authTickets,o.source===c.LambdaSource.Remote)this.executeRemoteLambda(this.serviceUrl,e,t.getTypeFromSchema(o.inputSchema),t.getTypeFromSchema(o.outputSchema),e.correlationVector,this.clientMetadata,this.hostCallbacks,r,p);else{this.batchedRemoteLambdaManager||(this.batchedRemoteLambdaManager=new m.BatchManager((function(e,n,o){var r=n.context,i=r.remoteLambda,s=r.lambdaContext;l.executeRemoteLambda(l.serviceUrl,{messageType:a.MessageType.Input,correlationVector:{id:n.cv},payload:e,payloadSchema:t.getTypeFromSchema(i.inputSchema),clientMetadata:l.clientMetadata},t.getTypeFromSchema(i.remoteInputSchema),t.getTypeFromSchema(i.remoteOutputSchema),{id:n.cv},l.clientMetadata,l.hostCallbacks,s,o)}),(function(e,t,n){var o=n.lambdaContext;l.updateResultCacheForReduceWorkflows("docId",o.docId,e,t)})));var h=o.batchOptions,d=this.normalizeBatchOptions(h),f=d.groupingKeyExtractor;d.groupingKeyExtractor=function(e){return o.name+"-"+f(e)};var g={name:o.name,remoteLambda:o,lambdaContext:r};this.batchedRemoteLambdaManager.addBatchItem(e.payload,d,g,e.correlationVector.id.length>127?e.correlationVector.id.substring(0,127)+"!":e.correlationVector.id,void 0,p)}}else i.setMessageException(e,{exceptionType:a.ExceptionType.LambdaThrow,message:"No URL for remote lambda"}),this.logOperation(n,!1,"Error",i.getMessageExceptionDescription(e)),u(e)},e.prototype.createLambdaExecutionStep=function(e,t,n,o,r){var u=this;return function(l){var p=new s.Operation({cv:l.correlationVector.toString(),operationName:"ExecuteLambda",resourceId:t.name,dimension0:e});p.start(),t.source===c.LambdaSource.Custom?u.executeCustomLambdaStep(l,p,t,n,o,r):t.source===c.LambdaSource.Local?u.executeLocalLambdaStep(l,p,t,o,r):t.source===c.LambdaSource.Remote||t.source===c.LambdaSource.BatchedRemote?u.executeRemoteLambdaStep(l,p,t,n,o,r):(i.setMessageException(l,{exceptionType:a.ExceptionType.LambdaThrow,message:"Unknown/No lambda location set"}),u.logOperation(p,!1,"Error",i.getMessageExceptionDescription(l)),r(l))}},e.prototype.normalizeBatchOptions=function(e){if(!e)throw new Error("Expected batchConfig");var t=o({},e);return e.estimateSize||(t.estimateSize=v.estimateSize),t},e}();t.ClientRuntime=E,t.runtime=new E;t.createRuntime=function(){return new E}},16447:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserType=t.AuthTokenType=void 0,function(e){e[e.EditorLowPrivilege=0]="EditorLowPrivilege",e[e.AugLoopLowPrivilege=1]="AugLoopLowPrivilege",e[e.Anonymous=2]="Anonymous",e[e.ClientAssertion=3]="ClientAssertion",e[e.ClientAssertionV2=4]="ClientAssertionV2",e[e.AutoClpLowPrivilege=5]="AutoClpLowPrivilege",e[e.AutoClpAppOnlyLowPrivilege=6]="AutoClpAppOnlyLowPrivilege",e[e.Substrate=7]="Substrate",e[e.WacAutoClpUserInfo=8]="WacAutoClpUserInfo",e[e.OwaExchange=9]="OwaExchange",e[e.SmartCompose=10]="SmartCompose",e[e.WritingAnalyticsLowPrivilege=11]="WritingAnalyticsLowPrivilege",e[e.DWEngineLowPrivilege=12]="DWEngineLowPrivilege",e[e.SubstrateApp=13]="SubstrateApp",e[e.CortanaAppPop=14]="CortanaAppPop",e[e.OfficeAppsAppOnly=15]="OfficeAppsAppOnly",e[e.PPTFrontdoorAppPop=16]="PPTFrontdoorAppPop",e[e.EditorAppOnlyLowPrivilege=17]="EditorAppOnlyLowPrivilege"}(t.AuthTokenType||(t.AuthTokenType={})),function(e){e[e.Unknown=0]="Unknown",e[e.Consumer=1]="Consumer",e[e.Enterprise=2]="Enterprise"}(t.UserType||(t.UserType={}))},16448:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLogicalCondition=t.isComparisonCondition=t.isArrayCondition=void 0;var o=n(11873),r=n(11874),i=n(11875);t.isArrayCondition=function(e){return e.operator in o.arrayOperators};t.isComparisonCondition=function(e){return e.operator in r.comparisonOperators};t.isLogicalCondition=function(e){return e.operator in i.logicalOperators}},16449:function(e,t,n){"use strict";var o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,r++)o[r]=i[s];return o};Object.defineProperty(t,"__esModule",{value:!0}),t.getTypesFromLambdas=t.functionReviver=t.functionReplacer=void 0;var r=function(e,t,n){var r=this;this.reviver=function(e,t){if("string"==typeof t){var n=t.match(/function[^\(]*\(([^\)]*)\)\s*{([\w\W]*?)}$/)||t.match(/\(([^\)]*)\)\s*=>\s*{([\w\W]*?)}$/);if(n){var i=n[1].split(",").map((function(e){return e.replace(/\s+/,"")})),s=r.functionName?n[2].concat("//# sourceURL="+r.functionName+".js"):n[2];return r.debuggable&&(s="debugger;".concat(s)),r.dependencyArguments&&(i=i.concat(Array.from(r.dependencyArguments))),Function.apply(void 0,o(i,[s]))}}return t},this.functionName=e,this.debuggable=n,this.dependencyArguments=t};t.functionReplacer=function(e,t){return"function"==typeof t?t.toString():t};t.functionReviver=function(e,t,n){return void 0===t&&(t=null),void 0===n&&(n=!1),new r(e,t,n).reviver};t.getTypesFromLambdas=function(e){for(var t=[],n=0,o=e;n<o.length;n++){var r=o[n];r.inputSchema&&t.push(r.inputSchema),r.outputSchema&&t.push(r.outputSchema),r.configSchema&&t.push(r.configSchema)}return t}},16450:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnvironmentNameTranslation=t.Environment=void 0,function(e){e.dev="dev",e.int="int",e.test="test",e.dogfood="dogfood",e.prod="prod",e.gcc="gcc",e.dod="dod",e.gccHigh="gcchigh"}(t.Environment||(t.Environment={})),t.EnvironmentNameTranslation={gcc:"fairfax"}},16451:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggingLevel=void 0,function(e){e[e.error=0]="error",e[e.warn=1]="warn",e[e.info=3]="info",e[e.metric=4]="metric",e[e.verbose=5]="verbose",e[e.debug=6]="debug"}(t.LoggingLevel||(t.LoggingLevel={}))},16452:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isStopWorkflowMessage=t.setStopAndFilterWorkflowMessage=t.isExceptionMessage=t.setMessageException=t.getMessageExceptionType=t.getMessageExceptionDescription=t.filterWorkflowSchema=t.exceptionSchema=void 0;var o=n(6271);t.exceptionSchema={category:o.TypeCategory.Schema,schema:{name:"Exception",path:"message-schema.proto"}},t.filterWorkflowSchema={category:o.TypeCategory.Schema,schema:{name:"Filter",path:"message-schema.proto"}};t.getMessageExceptionDescription=function(e,t){if(void 0===t&&(t=!1),null==e)return"Invalid message passed";if(null==e.payload)return o.ExceptionType[o.ExceptionType.NoOutput]+": Payload is null";if(null==e.payload.exceptionType)return"Payload is not an exception";var n=o.ExceptionType[e.payload.exceptionType];return n+=e.payload.message?": "+e.payload.message:": No description",n+=t&&e.payload.data?"\n"+e.payload.data.toString():""};t.getMessageExceptionType=function(e){return null==e||null==e.payload||null==e.payload.exceptionType?o.ExceptionType.Unknown:e.payload.exceptionType};t.setMessageException=function(e,n){if(null==e)throw new Error("Cannot set exception on null message");e.payload=n,e.payloadSchema=t.exceptionSchema,e.messageType=o.MessageType.Exception};t.isExceptionMessage=function(e){return null==e||null==e.messageType||e.messageType==o.MessageType.Exception};t.setStopAndFilterWorkflowMessage=function(e,n){if(null==e)throw new Error("Cannot set filter on null message");var r={condition:n};e.payload=r,e.payloadSchema=t.filterWorkflowSchema,e.messageType=o.MessageType.StopAndFilterWorkflow};t.isStopWorkflowMessage=function(e){return(e||{}).messageType==o.MessageType.StopAndFilterWorkflow}},16453:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdentityProvider=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.LiveId=1]="LiveId",e[e.OrgId=2]="OrgId",e[e.ActiveDirectory=3]="ActiveDirectory",e[e.ADAL=4]="ADAL",e[e.SSPI=5]="SSPI",e[e.OAuth2=6]="OAuth2",e[e.Badger=7]="Badger"}(t.IdentityProvider||(t.IdentityProvider={}))},16454:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WaitOnStrategy=void 0,function(e){e[e.All=0]="All",e[e.Any=1]="Any"}(t.WaitOnStrategy||(t.WaitOnStrategy={}))},16455:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExceptionType=t.MessageType=void 0,function(e){e[e.Input=0]="Input",e[e.Exception=1]="Exception",e[e.WaitOn=2]="WaitOn",e[e.StopAndFilterWorkflow=3]="StopAndFilterWorkflow"}(t.MessageType||(t.MessageType={})),function(e){e[e.Unknown=0]="Unknown",e[e.NoOutput=1]="NoOutput",e[e.Authentication=2]="Authentication",e[e.JoinTimedOut=3]="JoinTimedOut",e[e.LambdaThrow=4]="LambdaThrow",e[e.LambdaErrorCallback=5]="LambdaErrorCallback"}(t.ExceptionType||(t.ExceptionType={}))},16456:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Oart=void 0,function(e){!function(e){e[e.shape=0]="shape",e[e.groupShape=1]="groupShape",e[e.graphicFrame=2]="graphicFrame",e[e.connector=3]="connector",e[e.picture=4]="picture",e[e.ink=5]="ink"}(e.DrawingElementType||(e.DrawingElementType={}))}(t.Oart||(t.Oart={}))},16457:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Ppt=void 0,function(e){!function(e){e[e.Undefined=0]="Undefined",e[e.Delete=1]="Delete",e[e.Add=2]="Add",e[e.Change=3]="Change",e[e.Refresh=4]="Refresh"}(e.SlideTileEventType||(e.SlideTileEventType={}))}(t.Ppt||(t.Ppt={}))},16458:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JobState=void 0,function(e){e[e.Submitted=0]="Submitted",e[e.Pending=1]="Pending",e[e.Running=2]="Running",e[e.Completed=3]="Completed",e[e.Failed=4]="Failed",e[e.Aborted=5]="Aborted"}(t.JobState||(t.JobState={}))},16459:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tiling=void 0,function(e){!function(e){e[e.Unknown=0]="Unknown",e[e.Text=1]="Text",e[e.Slide=2]="Slide"}(e.TileType||(e.TileType={})),function(e){e[e.Generic=0]="Generic",e[e.Title=1]="Title",e[e.SmartArt=2]="SmartArt",e[e.TableCell=3]="TableCell",e[e.TextBox=4]="TextBox",e[e.Notes=5]="Notes"}(e.TextTileType||(e.TextTileType={})),function(e){e[e.Undefined=0]="Undefined",e[e.Word=1]="Word",e[e.Phrase=2]="Phrase",e[e.Sentence=3]="Sentence",e[e.Paragraph=4]="Paragraph"}(e.TextTileElementUnit||(e.TextTileElementUnit={})),function(e){e[e.Undefined=0]="Undefined",e[e.Bullet=1]="Bullet",e[e.Numbered=2]="Numbered"}(e.ListType||(e.ListType={})),function(e){e[e.Undefined=0]="Undefined",e[e.AlphaLcParenBoth=1]="AlphaLcParenBoth",e[e.AlphaUcParenBoth=2]="AlphaUcParenBoth",e[e.AlphaLcParenR=3]="AlphaLcParenR",e[e.AlphaUcParenR=4]="AlphaUcParenR",e[e.AlphaLcPeriod=5]="AlphaLcPeriod",e[e.AlphaUcPeriod=6]="AlphaUcPeriod",e[e.ArabicParenBoth=7]="ArabicParenBoth",e[e.ArabicParenR=8]="ArabicParenR",e[e.ArabicPeriod=9]="ArabicPeriod",e[e.ArabicPlain=10]="ArabicPlain",e[e.RomanLcParenBoth=11]="RomanLcParenBoth",e[e.RomanUcParenBoth=12]="RomanUcParenBoth",e[e.RomanLcParenR=13]="RomanLcParenR",e[e.RomanUcParenR=14]="RomanUcParenR",e[e.RomanLcPeriod=15]="RomanLcPeriod",e[e.RomanUcPeriod=16]="RomanUcPeriod",e[e.CircleNumDbPlain=17]="CircleNumDbPlain",e[e.CircleNumWdBlackPlain=18]="CircleNumWdBlackPlain",e[e.CircleNumWdWhitePlain=19]="CircleNumWdWhitePlain",e[e.ArabicDbPeriod=20]="ArabicDbPeriod",e[e.ArabicDbPlain=21]="ArabicDbPlain",e[e.Ea1ChsPeriod=22]="Ea1ChsPeriod",e[e.Ea1ChsPlain=23]="Ea1ChsPlain",e[e.Ea1ChtPeriod=24]="Ea1ChtPeriod",e[e.Ea1ChtPlain=25]="Ea1ChtPlain",e[e.Ea1JpnChsDbPeriod=26]="Ea1JpnChsDbPeriod",e[e.Ea1JpnKorPlain=27]="Ea1JpnKorPlain",e[e.Ea1JpnKorPeriod=28]="Ea1JpnKorPeriod",e[e.Arabic1Minus=29]="Arabic1Minus",e[e.Arabic2Minus=30]="Arabic2Minus",e[e.Hebrew2Minus=31]="Hebrew2Minus",e[e.ThaiAlphaPeriod=32]="ThaiAlphaPeriod",e[e.ThaiAlphaParenR=33]="ThaiAlphaParenR",e[e.ThaiAlphaParenBoth=34]="ThaiAlphaParenBoth",e[e.ThaiNumPeriod=35]="ThaiNumPeriod",e[e.ThaiNumParenR=36]="ThaiNumParenR",e[e.ThaiNumParenBoth=37]="ThaiNumParenBoth",e[e.HindiAlphaPeriod=38]="HindiAlphaPeriod",e[e.HindiNumPeriod=39]="HindiNumPeriod",e[e.HindiNumParenR=40]="HindiNumParenR",e[e.HindiAlpha1Period=41]="HindiAlpha1Period"}(e.ListNumeration||(e.ListNumeration={})),function(e){e[e.Undefined=0]="Undefined",e[e.Delete=1]="Delete",e[e.Add=2]="Add",e[e.Change=3]="Change",e[e.Refresh=4]="Refresh"}(e.TextTileEventType||(e.TextTileEventType={}))}(t.Tiling||(t.Tiling={}))},16460:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypeCategory=void 0,function(e){e[e.Undefined=0]="Undefined",e[e.Schema=1]="Schema",e[e.Boolean=2]="Boolean",e[e.Number=3]="Number",e[e.String=4]="String",e[e.Buffer=5]="Buffer",e[e.Function=6]="Function"}(t.TypeCategory||(t.TypeCategory={}))},16461:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SerializationProfile=t.Pattern=void 0,function(e){e[e.PubSub=0]="PubSub",e[e.RequestReply=1]="RequestReply"}(t.Pattern||(t.Pattern={})),function(e){e[e.JSONB=0]="JSONB",e[e.JSON=1]="JSON",e[e.JSOND=2]="JSOND",e[e.Disabled=3]="Disabled",e[e.COMPRESSEDJSON=4]="COMPRESSEDJSON"}(t.SerializationProfile||(t.SerializationProfile={}))},16462:function(e,t,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.elementTypeFrom=t.arrayTypeFrom=t.isArrayType=t.schemaRefToString=t.typeToString=t.areTypesEqual=t.isTypePrimitive=t.MessageSchema=t.TypeSchema=t.FunctionType=t.BufferType=t.StringType=t.NumberType=t.BooleanType=t.UndefinedType=void 0;var r=n(6271);t.UndefinedType={category:r.TypeCategory.Undefined},t.BooleanType={category:r.TypeCategory.Boolean},t.NumberType={category:r.TypeCategory.Number},t.StringType={category:r.TypeCategory.String},t.BufferType={category:r.TypeCategory.Buffer},t.FunctionType={category:r.TypeCategory.Function},t.TypeSchema={category:r.TypeCategory.Schema,schema:{name:"Type",path:"type-schema.proto"}},t.MessageSchema={category:r.TypeCategory.Schema,schema:{name:"BufferMessage",path:"message-schema.proto"}};t.isTypePrimitive=function(e){if(null==e)return!1;switch(e.category){case r.TypeCategory.Boolean:case r.TypeCategory.Number:case r.TypeCategory.String:return!0;default:return!1}};t.areTypesEqual=function(e,n){return t.typeToString(e)===t.typeToString(n)};t.typeToString=function(e){if(void 0===e)return"";if(null===e)return"null";var t,n=Object.keys(e).sort().map((function(t){return s(t,e[t])})).filter((function(e){return!!e}));return t="{".concat(n.join(",")).concat("}"),Number(t),t};var i=function(e){if(void 0===e)return"";if(null===e)return"null";var t=Object.keys(e).sort().map((function(t){return s(t,e[t])})).filter((function(e){return!!e}));return"{".concat(t.join(",")).concat("}")},s=function(e,t){return"schema"===e?'"'+e+'":'+i(t):"path"===e?"":"nestedArrayLevel"===e?t?'"'+e+'":'+t:"":void 0===t?"":"string"==typeof t?'"'+e+'":"'+t+'"':'"'+e+'":'+t};t.schemaRefToString=i;t.isArrayType=function(e){return!!e&&e.nestedArrayLevel>0};t.arrayTypeFrom=function(e){var n=o({},e);return n.nestedArrayLevel=t.isArrayType(e)?e.nestedArrayLevel+1:1,n};t.elementTypeFrom=function(e){var n=o({},e);return n.nestedArrayLevel=t.isArrayType(e)?e.nestedArrayLevel-1:0,n}},16463:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkflowKind=void 0,function(e){e[e.SingleItem=0]="SingleItem",e[e.Reduce=1]="Reduce",e[e.Grid=2]="Grid",e[e.DynamicText=3]="DynamicText"}(t.WorkflowKind||(t.WorkflowKind={}))},16464:function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.gatewayType=t.matchmakerType=t.executeOnStopWorkflow=t.isBuiltInLambda=t.BuiltInLambdaType=void 0,function(e){e.Expression="Expression",e.MessageOutput="MessageOutput",e.Edge="Edge",e.EnterWorkflow="EnterWorkflow",e.ExitWorkflow="ExitWorkflow",e.Join="Join",e.SerializePayload="SerializePayload",e.DeserializePayload="DeserializePayload",e.Inline="Inline"}(o=t.BuiltInLambdaType||(t.BuiltInLambdaType={}));t.isBuiltInLambda=function(e){return!!o[e]};t.executeOnStopWorkflow=function(e){return t.isBuiltInLambda(e)&&e!=o.Inline||e==t.matchmakerType},t.matchmakerType="Matchmaker",t.gatewayType="Gateway"},16465:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CorrelationVector=void 0;var o=function(){function e(e){this.childCount=0,this.id=e||function(){for(var e=0;e<i;e++)s[e]=r[Math.floor(Math.random()*r.length)];return s.join("")}()}return e.fromString=function(t,n){if(!t)throw new Error("Received invalid correlation vector string");var o;return o=-1===t.indexOf(".0",t.length-2)?new e(t):new e(t.substring(0,t.length-2)),n&&(o.childCount=n),o},e.prototype.newChild=function(){return++this.childCount,new e(this.id+"."+this.childCount.toString())},e.prototype.toString=function(){return this.id.length>127?this.id.substr(0,127)+"!":this.id},e}();t.CorrelationVector=o;var r=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],i=22,s=new Array(i)},16466:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.LogCategory=t.tagIdToString=t.argsToString=t.Log=void 0;var o,r,i=n(7596),s=void 0!==e&&e.env?e.env.SERVICE_NAME:"client",a="abcdefghijklmnopqrstuvwxyz0123456789",c={97:0,98:1,99:2,100:3,101:4,102:5,103:6,104:7,105:8,106:9,107:10,108:11,109:12,110:13,111:14,112:15,113:16,114:17,115:18,116:19,117:20,118:21,119:22,120:23,121:24,122:25,48:26,49:27,50:28,51:29,52:30,53:31,54:32,55:33,56:34,57:35},u=[],l=new Map,p=new Map,h=new Map;!function(e){e.defineCoreLogCategory=function(e){return{root:"Core",name:e}},e.defineWorkflowLogCategory=function(e){return{root:"Workflow",name:e}},e.clearLoggers=function(){u=[],p.clear()},e.addLogger=function(e){u.push(e),Object.keys(i.LoggingLevel).map((function(e){return i.LoggingLevel[e]})).filter((function(t){return t<=e.level})).forEach((function(t){p.has(t)?p.get(t).push(e):p.set(t,[e])}))},e.setCorrelationContextCallback=function(e){o=e},e.addAggregator=function(e){e.init((function(e,t){g(e,t)})),l.set(e.eventName,e)},e.flushAggregators=function(e){l.forEach((function(t){t.flush(e)}))},e.setTagLevelOverride=function(e,t){var n=y(e);h.set(n,t)},e.resetTagLevelOverrides=function(){h.clear()},e.error=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];f(e,t,i.LoggingLevel.error,n)},e.warn=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];f(e,t,i.LoggingLevel.warn,n)},e.info=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];f(e,t,i.LoggingLevel.info,n)},e.verbose=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];f(e,t,i.LoggingLevel.verbose,n)},e.debug=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];f(e,t,i.LoggingLevel.debug,n)},e.metric=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];f(e,t,i.LoggingLevel.metric,n)},e.dynamic=function(e){g(e)}}(r=t.Log||(t.Log={}));t.argsToString=function(e){return e.map((function(e){return e instanceof Error?JSON.stringify({message:e.message,name:e.name,stack:e.stack}):"object"==typeof e?JSON.stringify(e):e})).join(" ")};var d=function(e){return void 0!==e?p.get(e)||[]:u},f=function(e,n,o,r){o=h.get(e)||o;var i=d(o);if(0!=i.length){var s=t.tagIdToString(e),a=function(e){return e.map((function(e){return"function"==typeof e?e():e}))}(r);if(1==a.length&&"object"==typeof a[0]){var c=a[0];c.tagId=s,"Operation"===c.eventName&&"Workflow"===n.root&&(c.eventName="WorkflowOperation"),c.traceLevel=o;var u=l.get(c.eventName);u?u.add(c):g(c,!1,i)}else g({eventName:"Log",tagId:s,category:n.root+"."+n.name,traceLevel:o,message:t.argsToString(a)},!1,i)}},g=function(e,t,n){var r,i,a;if(void 0===t&&(t=!1),null==n&&(n=d(e.traceLevel)),n.length>0){if(e.serviceName=s,!t&&o){var c=o();if(c){e.cv=e.cv?e.cv:c.cv.toString(),e.sessionKey=e.sessionKey?e.sessionKey:c.sessionKey,e.workflow=e.workflow?e.workflow:c.workflow;var u=null===(r=c.clientMetadata)||void 0===r?void 0:r.appName;e.clientAppName=e.clientAppName?e.clientAppName:u;var l=null===(i=c.clientMetadata)||void 0===i?void 0:i.appPlatform;e.clientAppPlatform=e.clientAppPlatform?e.clientAppPlatform:l;var p=null===(a=c.clientMetadata)||void 0===a?void 0:a.releaseAudienceGroup;e.clientReleaseAudienceGroup=e.clientReleaseAudienceGroup?e.clientReleaseAudienceGroup:p}}for(var h=0,f=n;h<f.length;h++){f[h].log(e)}}};t.tagIdToString=function(e){return a[e>>24&63]+a[e>>18&63]+a[e>>12&63]+a[e>>6&63]+a[e>>0&63]};var y=function(e){return e&&5===e.length?c[e.charCodeAt(0)]<<24|c[e.charCodeAt(1)]<<18|c[e.charCodeAt(2)]<<12|c[e.charCodeAt(3)]<<6|c[e.charCodeAt(4)]:-1},m=function(){function e(){}return e.CoreDefault=r.defineCoreLogCategory("Default"),e.WorkflowDefault=r.defineWorkflowLogCategory("Default"),e}();t.LogCategory=m}).call(this,n(226))},16467:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggingAggregator=void 0;var o="|",r="b~",i="b~true",s="n~",a=/\|\~/g,c="_",u=function(){this.count=0,this.measureSums=new Map},l=function(e,t,n,l,p){var h=this;this.buckets=new Map,this.init=function(e){h.log=e},this.add=function(e){if(h.condition&&h.condition(e)){for(var t=[],n=0,i=h.dimensions;n<i.length;n++){var l=i[n];if(void 0===e[l])t.push(null);else{var p="";"boolean"==typeof e[l]?p=r:"number"==typeof e[l]&&(p=s),t.push(""+p+e[l].toString().replace(a,c))}}var d=t.join(o),f=h.buckets.get(d);if(!f){(f=new u).traceLevel=e.traceLevel;for(var g=0,y=h.avgMeasures;g<y.length;g++){var m=y[g];f.measureSums.set(m,0)}h.buckets.set(d,f)}f.count++;for(var v=0,S=h.avgMeasures;v<S.length;v++)e[m=S[v]]&&f.measureSums.set(m,f.measureSums.get(m)+e[m])}else h.log(e,!1)},this.flush=function(e){void 0===e&&(e=!1),h.buckets.forEach((function(e,t){for(var n={traceLevel:e.traceLevel,eventName:h.eventName,count:e.count},a=t.split(o),c=0;c<h.dimensions.length;c++){var u=h.dimensions[c],l=a[c];0===l.indexOf(r)?n[u]=l===i:0===l.indexOf(s)?n[u]=parseInt(l.slice(s.length),10):n[u]=l}for(var p=0,d=h.avgMeasures;p<d.length;p++){var f=d[p];n[f]=Math.round(e.measureSums.get(f)/e.count)}h.log(n,!0)})),h.buckets.clear(),e&&(h.condition=null,clearInterval(h.interval))},this.eventName=e,this.condition=t,this.dimensions=n,this.avgMeasures=l,p>0&&(this.interval=setInterval(this.flush,1e3*p))};t.LoggingAggregator=l},16468:function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Operation=void 0;var i=n(16469),s=n(11876),a=function(e){function t(t,n,o){var r=e.call(this,t)||this;return r.eventName="Operation",t&&null!=t.count||(r.count=1),n&&r.setClientMetadata(n),o&&r.setUserContext(o),r}return r(t,e),t.prototype.setClientMetadata=function(e){e&&(this.clientAppName=e.appName,this.clientAppPlatform=e.appPlatform,this.clientAppVersion=e.appVersion,this.clientFlights=e.flights,this.clientReleaseAudienceGroup=e.releaseAudienceGroup,this.clientReleaseChannel=e.releaseChannel,this.clientReleaseFork=e.releaseFork,this.clientRuntimeVersion=e.runtimeVersion,this.clientSessionId=e.sessionId,this.clientDeviceId=e.deviceId)},t.prototype.setUserContext=function(e){e&&(this.userId=e.puid||e.oid,this.userType=e.userType&&e.userType.toString())},t.prototype.start=function(){return this.startTime=s.now(),this},t.prototype.stop=function(){var e=s.now();return this.durationMs=Math.round(e-this.startTime),this},t}(i.OperationEvent);t.Operation=a},16469:function(e,t){var n={util:{},roots:{default:{}}},o=(n.util,n.roots.default||(n.roots.default={}));o.OperationEvent=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.count=0,e.prototype.cv="",e.prototype.serviceName="",e.prototype.sessionKey="",e.prototype.durationMs=0,e.prototype.success=!1,e.prototype.resultDescription="",e.prototype.resultSignature="",e.prototype.operationName="",e.prototype.resourceId="",e.prototype.dimension0="",e.prototype.dimension1="",e.prototype.dimension2="",e.prototype.dimension3="",e.prototype.clientAppName="",e.prototype.clientAppPlatform="",e.prototype.clientRuntimeVersion="",e.prototype.clientAppVersion="",e.prototype.clientReleaseAudienceGroup="",e.prototype.clientReleaseChannel="",e.prototype.clientReleaseFork="",e.prototype.clientSessionId="",e.prototype.clientFlights="",e.prototype.clientIPRange="",e.prototype.clientDocSessionId="",e.prototype.clientDeviceId="",e.prototype.userType="",e.prototype.userId="",e}(),e.exports=o},16470:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.executeRemoteLambda=t.clearTokenCache=void 0;var o,r=n(4128),i=n(6271),s=n(16471),a=n(11878);t.clearTokenCache=function(){o=new a.TokenCache},t.clearTokenCache();var c=function(e,t,n,a,u,l,p,h,d,f){var g={method:"POST",headers:{"content-type":"application/json","X-CorrelationId":u},body:JSON.stringify({payload:t.payload,payloadSchema:n,requestedSchema:a,clientMetadata:l,tokens:o.getAuthTokenEntries(p,d.docId)})};s.internalFetch(e,g,(function(s,g){s?f(new Error("Fetch error in remote lambda request to "+e+": "+s)):401===g.status?h>0?(r.Log.info(572838109,r.LogCategory.CoreDefault,"Auth token required for remote lambda request"),g.json().then((function(e){return o.updateAuthToken(p,{Tickets:[e],DocId:d.docId})})).then((function(){c(e,t,n,a,u,l,p,h-1,d,f)})).catch((function(e){f({exceptionType:i.ExceptionType.Authentication,message:e.message})}))):f({exceptionType:i.ExceptionType.Authentication,message:"Remote lambda request retry with authentication token failed"}):g.ok?g.json().then((function(e){if(Array.isArray(e))if(e.length>0)for(var n=0,o=0,r=e;o<r.length;o++){var i=r[o];t.moreResults=++n<e.length,f(null,i)}else f(new Error("No output"));else f(new Error("Did not receive a valid response for remote lambda request"))})).catch((function(e){f({exceptionType:i.ExceptionType.LambdaThrow,message:e.message})})):f(new Error("Remote lambda request failed with status "+g.status))}))};t.executeRemoteLambda=function(e,t,n,r,s,a,u,l,p){Array.isArray(l.authTickets)?o.updateAuthToken(u,{Tickets:l.authTickets,DocId:l.docId}).then((function(){c(e,t,n,r,s.id,a,u,1,l,p)})).catch((function(e){p({exceptionType:i.ExceptionType.Authentication,message:e.message})})):c(e,t,n,r,s.id,a,u,1,l,p)}},16471:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.internalFetch=void 0;var o=n(16472),r=n(16473);t.internalFetch=function(e,t,n){var o=new r.Request(e,t);return i.add(o,n)};var i=new o.SequentialFetchQueue(r,2e4,12e4)},16472:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SequentialFetchQueue=void 0;var o=function(){function e(e,t,n){if(this.requestInProgress=!1,this.queuedRequests=[],null==e)throw new Error("No request.");this.fetch=e,this.fetchTimeout=t,this.queueTimeout=n}return e.prototype.tryProcessNextRequest=function(){if(this.requestInProgress=!1,this.queuedRequests.length>0){var e=this.queuedRequests.shift(),t=e[0],n=e[1],o=e[2];clearTimeout(o),this.add(t,n)}},e.prototype.add=function(e,t){var n=this;if(this.requestInProgress){var o=setTimeout((function(){t(new Error("Timed out waiting in queue"),null),n.queuedRequests.shift()}),this.queueTimeout);this.queuedRequests.push([e,t,o])}else{this.requestInProgress=!0,new Promise((function(t,o){var r=!1,i=setTimeout((function(){r=!0,o(new Error("Fetch timed out"))}),n.fetchTimeout);n.fetch(e).then((function(e){r||(clearTimeout(i),t(e))})).catch((function(e){r||(clearTimeout(i),o(e))}))})).then((function(e){t(null,e),n.tryProcessNextRequest()})).catch((function(e){t(e,null),n.tryProcessNextRequest()}))}},e}();t.SequentialFetchQueue=o},16473:function(e,t){var n=function(e){function t(){this.fetch=!1,this.DOMException=e.DOMException}return t.prototype=e,new t}("undefined"!=typeof self?self:this);!function(e){!function(t){var n={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(n.arrayBuffer)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],r=ArrayBuffer.isView||function(e){return e&&o.indexOf(Object.prototype.toString.call(e))>-1};function i(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function s(e){return"string"!=typeof e&&(e=String(e)),e}function a(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n.iterable&&(t[Symbol.iterator]=function(){return t}),t}function c(e){this.map={},e instanceof c?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function u(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function l(e){return new Promise((function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function p(e){var t=new FileReader,n=l(t);return t.readAsArrayBuffer(e),n}function h(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function d(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:n.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:n.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:n.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():n.arrayBuffer&&n.blob&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=h(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):n.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||r(e))?this._bodyArrayBuffer=h(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},n.blob&&(this.blob=function(){var e=u(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?u(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(p)}),this.text=function(){var e,t,n,o=u(this);if(o)return o;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=l(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),o=0;o<t.length;o++)n[o]=String.fromCharCode(t[o]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},n.formData&&(this.formData=function(){return this.text().then(y)}),this.json=function(){return this.text().then(JSON.parse)},this}c.prototype.append=function(e,t){e=i(e),t=s(t);var n=this.map[e];this.map[e]=n?n+", "+t:t},c.prototype.delete=function(e){delete this.map[i(e)]},c.prototype.get=function(e){return e=i(e),this.has(e)?this.map[e]:null},c.prototype.has=function(e){return this.map.hasOwnProperty(i(e))},c.prototype.set=function(e,t){this.map[i(e)]=s(t)},c.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},c.prototype.keys=function(){var e=[];return this.forEach((function(t,n){e.push(n)})),a(e)},c.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),a(e)},c.prototype.entries=function(){var e=[];return this.forEach((function(t,n){e.push([n,t])})),a(e)},n.iterable&&(c.prototype[Symbol.iterator]=c.prototype.entries);var f=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function g(e,t){var n,o,r=(t=t||{}).body;if(e instanceof g){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new c(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new c(t.headers)),this.method=(n=t.method||this.method||"GET",o=n.toUpperCase(),f.indexOf(o)>-1?o:n),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function y(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var n=e.split("="),o=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(o),decodeURIComponent(r))}})),t}function m(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new c(t.headers),this.url=t.url||"",this._initBody(e)}g.prototype.clone=function(){return new g(this,{body:this._bodyInit})},d.call(g.prototype),d.call(m.prototype),m.prototype.clone=function(){return new m(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new c(this.headers),url:this.url})},m.error=function(){var e=new m(null,{status:0,statusText:""});return e.type="error",e};var v=[301,302,303,307,308];m.redirect=function(e,t){if(-1===v.indexOf(t))throw new RangeError("Invalid status code");return new m(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function S(e,o){return new Promise((function(r,i){var s=new g(e,o);if(s.signal&&s.signal.aborted)return i(new t.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function u(){a.abort()}a.onload=function(){var e,t,n={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new c,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var n=e.split(":"),o=n.shift().trim();if(o){var r=n.join(":").trim();t.append(o,r)}})),t)};n.url="responseURL"in a?a.responseURL:n.headers.get("X-Request-URL");var o="response"in a?a.response:a.responseText;r(new m(o,n))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.onabort=function(){i(new t.DOMException("Aborted","AbortError"))},a.open(s.method,s.url,!0),"include"===s.credentials?a.withCredentials=!0:"omit"===s.credentials&&(a.withCredentials=!1),"responseType"in a&&n.blob&&(a.responseType="blob"),s.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),s.signal&&(s.signal.addEventListener("abort",u),a.onreadystatechange=function(){4===a.readyState&&s.signal.removeEventListener("abort",u)}),a.send(void 0===s._bodyInit?null:s._bodyInit)}))}S.polyfill=!0,e.fetch||(e.fetch=S,e.Headers=c,e.Request=g,e.Response=m),t.Headers=c,t.Request=g,t.Response=m,t.fetch=S}({})}(n),delete n.fetch.polyfill,(t=n.fetch).default=n.fetch,t.fetch=n.fetch,t.Headers=n.Headers,t.Request=n.Request,t.Response=n.Response,e.exports=t},16474:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testWebSocketConnection=t.executeRemoteLambda=t.clearTokenCache=void 0;var o,r=n(4128),i=n(6271),s=n(16475),a=n(11878),c=n(11879);t.clearTokenCache=function(){o=new a.TokenCache},t.clearTokenCache();var u=new s.WebSocketRequestManager(3e4,(function(){return new c.WebSocketWorker}),50),l=function(e,t,n,s,a,c,p,h,d,f){var g={payload:t.payload,payloadSchema:n,requestedSchema:s,clientMetadata:c,tokens:o.getAuthTokenEntries(p,d.docId)},y="";s&&s.schema&&(y=s.schema.name);var m=!1;u.addRequest(e,g,a,y,(function(u,g,y){if(!m)if(m=!0,null!=g)if(g.exceptionType===i.ExceptionType.Authentication)try{var v=JSON.parse(g.data);h>0?(r.Log.info(572838108,r.LogCategory.CoreDefault,"Auth token required for remote lambda WebSocket request"),o.updateAuthToken(p,{Tickets:[v],DocId:d.docId}).then((function(){l(e,t,n,s,a,c,p,h-1,d,f)})).catch((function(e){f({exceptionType:i.ExceptionType.Authentication,message:e.message})}))):f({exceptionType:i.ExceptionType.Authentication,message:"Remote lambda request retry with authentication token failed"})}catch(e){f({exceptionType:i.ExceptionType.Authentication,message:e.message})}else f(new Error("Error in remote lambda WebSocket request to "+e+": "+g));else t.moreResults=!1,f(null,u)}))};t.executeRemoteLambda=function(e,t,n,r,s,a,c,u,p){Array.isArray(u.authTickets)?o.updateAuthToken(c,{Tickets:u.authTickets,DocId:u.docId}).then((function(){l(e,t,n,r,s.id,a,c,1,u,p)})).catch((function(e){p({exceptionType:i.ExceptionType.Authentication,message:e.message})})):l(e,t,n,r,s.id,a,c,1,u,p)};t.testWebSocketConnection=function(e,t){return u.testConnection(e,t)}},16475:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketRequestManager=void 0;var o=n(4128),r=n(6271),i=n(5235),s=function(){function e(e,t,n,o,r,i){this.requestId=e,this.correlationId=t,this.schemaName=n,this.data=o,this.callback=r,this.requestTimeoutInMs=i,this.ended=!1,this.startTime=0}return e.prototype.startRequest=function(){this.startTime=i.Utils.getCurrentTimeMs()},e.prototype.getMsUntilTimeout=function(){var e=i.Utils.getCurrentTimeMs()-this.startTime;return this.requestTimeoutInMs-e},e.prototype.endRequest=function(e){this.ended||(this.invokeCallback(null,e,!0),this.ended=!0)},e.prototype.addResponseData=function(e){this.invokeCallback(e,null,!1)},e.prototype.invokeCallback=function(e,t,n){var o=this;new Promise((function(){return o.callback(e,t,n)})).catch((function(e){}))},e}(),a=function(){function e(e,t,n){this.requestCounter=0,this.activeRequests=[],this.pendingRequests=[],this.requestTimeoutInMs=e,this.workerFactory=t,this.maxActiveRequests=n}return e.prototype.testConnection=function(e,t){var n=this,i=!1,s=new o.Operation({cv:(new o.CorrelationVector).toString(),operationName:"WebSocketTest",resourceId:e});return s.success=!0,s.start(),new Promise((function(a){var c={payload:{},payloadSchema:{category:r.TypeCategory.Schema,schema:{name:"HealthCheckRequest"}},requestedSchema:{category:r.TypeCategory.Schema,schema:{name:"HealthCheckResponse"}},clientMetadata:t};n.addRequest(e,c,s.cv,"HealthCheckRequest",(function(e,t,n){t&&(s.success=!1,s.resultSignature="Error",s.resultDescription=t.message||t),e&&"OK"===e.status&&(i=!0),n&&(s.success&&!i&&(s.success=!1,s.resultSignature="NoResponseData"),s.stop(),o.Log.info(572838101,o.LogCategory.CoreDefault,s),a(s.success))}))}))},e.prototype.addRequest=function(e,t,n,o,r){var i=(this.requestCounter++).toString(),a=new s(i,n,o,t,r,this.requestTimeoutInMs);this.getWorker(e),this.pendingRequests.push(a),this.egressPendingRequests()},e.prototype.egressPendingRequests=function(){for(;this.pendingRequests.length>0&&this.activeRequests.length<this.maxActiveRequests;){var e=this.pendingRequests.shift();if(this.activeRequests.push(e),1===this.activeRequests.length){var t=e.getMsUntilTimeout();setTimeout(this.onTimeout.bind(this),t)}e.startRequest(),this.worker&&this.worker.egress(this.createRequestMessage(e.data,e.requestId,e.correlationId))}},e.prototype.createRequestMessage=function(e,t,n){return JSON.stringify({correlationId:n,requestId:t,body:e})},e.prototype.onTimeout=function(){for(;this.activeRequests.length>0;){var e=this.activeRequests[0],t=e.getMsUntilTimeout();if(!(t<=0))return void setTimeout(this.onTimeout.bind(this),t);var n=new Error("Request timed out");e.endRequest(n),this.activeRequests.shift(),this.egressPendingRequests()}},e.prototype.onMessage=function(e){try{for(var t=JSON.parse(e),n=0;n<this.activeRequests.length;n++){var r=this.activeRequests[n];if(r.requestId===t.requestId){t.end?(this.activeRequests.splice(n,1),r.endRequest(t.error),this.egressPendingRequests()):t.body&&r.addResponseData(t.body);break}}}catch(e){o.Log.error(572838102,o.LogCategory.CoreDefault,e)}},e.prototype.onClose=function(e){for(var t=new Error("Connection closed: "+e),n=0,o=this.activeRequests;n<o.length;n++){o[n].endRequest(t)}this.activeRequests=[];for(var r=0,i=this.pendingRequests;r<i.length;r++){i[r].endRequest(t)}this.pendingRequests=[],this.worker=void 0},e.prototype.getWorker=function(e){return this.worker||(this.worker=this.workerFactory(),this.worker.init(e,this.onMessage.bind(this),this.onClose.bind(this))),this.worker},e}();t.WebSocketRequestManager=a},16476:function(e,t,n){(function(t){var n=null;"undefined"!=typeof WebSocket?n=WebSocket:"undefined"!=typeof MozWebSocket?n=MozWebSocket:void 0!==t?n=t.WebSocket||t.MozWebSocket:"undefined"!=typeof window?n=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(n=self.WebSocket||self.MozWebSocket),e.exports=n}).call(this,n(108))},16477:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReduceTimerCache=void 0;var o=function(){function e(){this.cache=new Map}return e.prototype.setReduceTimer=function(e,t,n,o,r,i){var s=this;void 0===o&&(o=500),void 0===r&&(r=function(){return!1}),void 0===i&&(i=5e3),this.cache.has(e)||this.cache.set(e,new Map);var a=this.cache.get(e);a.has(t)&&clearTimeout(a.get(t).timer);var c=function(){var c=a.get(t),u=Date.now()-c.start;r()&&u<i?c.timer=setTimeout(c.timerCallback,Math.min(o,i-u)):(a.size>1?a.delete(t):s.cache.delete(e),n())};a.set(t,{start:Date.now(),timerCallback:c,timer:setTimeout(c,o)})},e.prototype.clear=function(e,t){this.cache.forEach((function(n,o){e&&e!==o||n.forEach((function(e,n){t&&t!==n||clearTimeout(e.timer)}))})),this.cache.clear()},e}();t.ReduceTimerCache=o},16478:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResultCache=void 0;var o=function(){function e(){this.cache=new Map,this.bucketSizes=new Map}return e.prototype.setBucketSize=function(e,t){this.bucketSizes.set(e,t)},e.prototype.setResult=function(e,t,n){if(t.primary){var o=this.cache.get(e);o||(o=new Map,this.cache.set(e,o));var r=o.get(t.primary);if(r||(r=t.secondary?new Map:[],o.set(t.primary,r)),t.secondary){r.set(t.secondary,n)}else{var i=r;i.length==this.getBucketSize(e)&&i.shift(),i.push(n)}}},e.prototype.getResults=function(e,t){var n=this.cache.get(e);if(n){var o=n.get(t.primary);if(o){if(!t.secondary)return o;var r=Array.from(o.values());if(r.length>0)return r}}return[]},e.prototype.clear=function(e,t){t?this.cache.forEach((function(n,o){if(!e||e===o)if(t.secondary){var r=n.get(t.primary);r&&r.delete(t.secondary)}else n.delete(t.primary)})):e?this.cache.delete(e):this.cache.clear()},e.prototype.getBucketSize=function(e){return this.bucketSizes.get(e)||10},e}();t.ResultCache=o},16479:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TelemetryLogger=void 0;var o=n(7596),r=n(11880),i=function(){function e(e){this.level=o.LoggingLevel.info,this.hostCallbacks=e}return e.prototype.log=function(t){var n=this;if(null!=this.hostCallbacks&&null!=this.hostCallbacks.sendTelemetryEvent){var o=function(t,o){var i=o.charAt(0).toUpperCase()+o.slice(1);n.hostCallbacks.sendTelemetryEvent(e.augLoopAriaTenantToken,"Office_AugLoop_Client_"+i,{ResourceId:t.resourceId,ResultDescription:t.resultDescription,ResultSignature:t.resultSignature,Dimension0:t.dimension0,Dimension1:t.dimension1,Dimension2:t.dimension2,Dimension3:t.dimension3},"Office.System.Activity",{CV:t.cv,Duration:1e3*t.durationMs,Count:t.count,AggMode:2,Success:t.success},!1,r.DataCategories.ProductServiceUsage|r.DataCategories.ProductServicePerformance,r.DiagnosticLevel.RequiredServiceDataEvent)};if("Operation"===t.eventName){o(t,t.operationName)}else if("SessionHealth"===t.eventName){o(t,t.sessionHealthEventName)}}},e.augLoopAriaTenantToken="3de4087d4de34817b1c376e3d1e6e293-983c4292-5ba9-485a-ab10-9797863c788b-6770",e}();t.TelemetryLogger=i},16480:function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketSessionManager=void 0;var i=n(4128),s=n(11881),a=n(5689),c=n(2936),u=n(10041),l=n(5235),p=n(16486),h=n(16487),d=n(16488),f=function(e){function t(t,n,o,r,s,c){var u;void 0===c&&(c=!0);var f=e.call(this)||this;return f.cvParent=new i.CorrelationVector,f.logOp=new i.Operation({operationName:"SessionState",success:!0}).start(),f.sessionStateChangeLogCountLimiter=new l.LogCountLimiter("SessionState"),f.stats=n,f.allStates=((u={})[h.SessionState.Initing]=new h.InitingState(f),u[h.SessionState.Running]=new h.RunningState(f),u[h.SessionState.Disconnected]=new h.DisconnectedState(f),u[h.SessionState.Closed]=new h.ClosedState(f),u),f.setState(h.SessionState.Initing),f.messageEndpoint=new a.MessageEndpoint("c"),f.messageEndpoint.setClientMetadata(s),f.messageEndpoint.setEgress(f.egress.bind(f)),f.messageEndpoint.onMessage(a.SessionCloseMessage.getTypeName(),f.onSessionClose.bind(f)),f.webSocketWorkerManager=new d.WebSocketWorkerManager(t,o,r,f.ingress.bind(f),f.onConnectionClose.bind(f)),f.messageQueue=new p.MessageQueue({sendMessage:function(e,t,n){return f.state.sendMessage(e,t,n)},sendBytes:f.sendBytes.bind(f),canSendMessage:function(){return f.state.canSendMessage()},dropOnlySequencedSyncsOnReseed:c}),r.on("connect",(function(e,t,n,o,r){f.setState(h.SessionState.Running,"",{isSessionReseedingStarted:e&&t}),f.emit("connect",e,n,o,r)})),r.on("reconnect",(function(){return f.emit("reconnect")})),f.resetNextSyncSequenceId=function(){return f.emit("resetNextSyncSequenceId")},f}return r(t,e),t.prototype.setState=function(e,t,n){var o=this;if(!this.state||e!==this.state.stateName){var r="undefined";this.state&&(r=h.SessionState[this.state.stateName]);var s="undefined"===r&&e===h.SessionState.Initing||this.state.possibleNextStates.indexOf(e)>=0;this.sessionStateChangeLogCountLimiter.log((function(){o.logOp.stop(),o.logOp.resourceId="New state: "+(s?h.SessionState[e]:r),o.logOp.resultDescription="Previous state: "+r,o.logOp.resultSignature=t+(o.state&&!s?"Unexpected state change":""),o.logOp.success=s,i.Log.info(573167323,i.LogCategory.CoreDefault,o.logOp)})),s&&(this.state=this.allStates[e],this.logOp.start(),this.state.onEnter(n))}},t.prototype.init=function(e,t){return this.extensionConfigs=e,this.customInitPromise=t,this.webSocketWorkerManager.init(this.extensionConfigs,this.customInitPromise,!0)},t.prototype.sendMessage=function(e,n){this.retrySendMessage(e,n,t.maxRetries)},t.prototype.sendBytes=function(e){this.state.sendBytes(e)},t.prototype.onMessage=function(e,t){this.messageEndpoint.onMessage(e,t)},t.prototype.getCorrelationVector=function(){return this.cvParent},t.prototype.forceReconnect=function(e){return this.extensionConfigs=e||this.extensionConfigs,this.webSocketWorkerManager.close(!1),this.webSocketWorkerManager.init(this.extensionConfigs)},t.prototype.closeSession=function(){this.sendMessage(new a.SessionCloseMessage),this.webSocketWorkerManager.close(!0),this.onSessionClose(void 0,(function(){}))},t.prototype.ingress=function(e){var t,n=this;try{t=JSON.parse(e)}catch(e){i.Log.error(573167324,i.LogCategory.CoreDefault,new s.SessionHealth({sessionHealthEventName:"ProcessMessage",resourceId:"Unknown",success:!1,resultSignature:"ParseError",resultDescription:e.message,durationMs:0,source:s.SessionHealthSource.ClientRuntime,reason:s.SessionHealthReason.Client,impact:s.SessionHealthImpact.MissingOutput,affectedWorkflows:["All"],message:""}))}t&&this.messageEndpoint.ingress(t,(function(e,t){return n.egress(e||t,(function(){}))}))},t.prototype.egress=function(e,t){e&&this.webSocketWorkerManager.egress(e).then((function(){return t()})).catch((function(e){return t(e)}))},t.prototype.onSessionClose=function(e,t){this.setState(h.SessionState.Closed),this.onConnectionClose(void 0),e&&this.emit("sessionClose",e),t()},t.prototype.onConnectionClose=function(e){this.state.onConnectionClose(),this.stats.lastConnectionClose=l.Utils.getCurrentTimeMs(),this.emit("disconnect",e)},t.prototype.retrySendMessage=function(e,n,o){var r=this,i=t.maxRetries-o;this.state.sendMessage(e,(function(t,i){t&&o>0&&r.canBeRetried(e)&&r.isTransientError(t)?r.retrySendMessage(e,n,o-1):n&&n(t,i)}),i)},t.prototype.canBeRetried=function(e){return!c.SchemaObject.matchesTypesFor(e,[a.SessionInitMessage.getTypeName(),a.MicroSyncMessage.getTypeName()])},t.prototype.isTransientError=function(e){var t=e.error;return t!==a.SendMessageErrorReason.SyncMessageUnsupportedBatch&&t!==a.SendMessageErrorReason.UnexpectedSeedMessage&&t!==a.SendMessageErrorReason.UnsupportedSyncMessage&&t!==a.SendMessageErrorReason.AnnotationTokenNotFound&&t!==p.ClientSendMessageErrorReason.ArrivedBeforeReseeding&&t!==p.ClientSendMessageErrorReason.DroppedAsOldestInQueue},t.maxRetries=2,t}(u.EventEmitter);t.WebSocketSessionManager=f},16481:function(e,t){var n={util:{},roots:{default:{}}},o=(n.util,n.roots.default||(n.roots.default={}));o.SessionHealthEvent=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.cv="",e.prototype.serviceName="",e.prototype.sessionKey="",e.prototype.clientAppName="",e.prototype.clientAppPlatform="",e.prototype.clientRuntimeVersion="",e.prototype.clientAppVersion="",e.prototype.clientReleaseAudienceGroup="",e.prototype.clientReleaseChannel="",e.prototype.clientReleaseFork="",e.prototype.clientSessionId="",e.prototype.clientFlights="",e.prototype.clientIPRange="",e.prototype.clientDocSessionId="",e.prototype.clientDeviceId="",e.prototype.userType="",e.prototype.userId="",e.prototype.sessionHealthEventName="",e.prototype.source="",e.prototype.reason="",e.prototype.reasonDependency="",e.prototype.subReason="",e.prototype.impact="",e.prototype.success=!1,e.prototype.durationMs=0,e.prototype.count=0,e.prototype.message="",e.prototype.affectedWorkflows="",e.prototype.resourceId="",e.prototype.dimension0="",e.prototype.dimension1="",e.prototype.dimension2="",e.prototype.dimension3="",e.prototype.resultDescription="",e.prototype.resultSignature="",e}(),e.exports=o},16482:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageEndpoint=t.extractMessageNameFromTypeName=t.ProcessMessageErrorReason=t.SendMessageErrorReason=void 0;var o,r,i=n(4128),s=n(11881),a=n(2936),c=n(11882),u=n(16483);function l(e){for(var t,n=0,o=["AugLoop_Excel_Session_Protocol_","AugLoop_Powerpoint_Session_Protocol_","AugLoop_Session_Protocol_"];n<o.length;n++){var r=o[n];if(0===e.indexOf(r)){t=r;break}}if(!t)return"MalformedMessageName";var i=e.indexOf("Message",e.length-"Message".length)===e.length-"Message".length;return e.slice(t.length,i?-"Message".length:void 0)}!function(e){e.ClientDisconnected="Client disconnected.",e.UnsupportedSyncMessage="SyncMessages with seq = -1 are not supported anymore.",e.UnexpectedSeedMessage="Unexpected seed message",e.SyncMessageUnsupportedBatch="SyncMessage with unsupported batching.",e.AnnotationTokenNotFound="Token not found"}(o=t.SendMessageErrorReason||(t.SendMessageErrorReason={})),function(e){e.ProvisionTokenValidationError="Token provision message didn't pass token validation."}(r=t.ProcessMessageErrorReason||(t.ProcessMessageErrorReason={})),t.extractMessageNameFromTypeName=l;var p=5e3,h=function(){function e(e){this.nextMessageId=1,this.pendingResponseCallbacks=new u.Cache({sweepInterval:p}),this.pendingMessageCallbacks=new u.Cache({sweepInterval:p}),this.messageCallbacks=new Map,this.messageIdPrefix=e,this.source="c"===e?s.SessionHealthSource.ClientRuntime:s.SessionHealthSource.Core,this.stats={sendMessageCount:0,sendMessageClientDisconnectedErrors:0,sendMessageErrors:0,sendMessageDurationMsMax:0,processMessageCount:0,processMessageProvisionTokenErrors:0,processMessageErrors:0,processMessageDurationMsMax:0}}return e.prototype.setClientMetadata=function(e){this.clientMetadata=e},e.prototype.setEgress=function(e){this.egress=e},e.prototype.ingress=function(e,t){var n=a.SchemaObject.getBaseTypesFor(e),o=a.SchemaObject.getTypeNameFor(e);o===c.Response.getTypeName()||n&&n.indexOf(c.Response.getTypeName())>=0?(this.processResponse(e),t()):this.processMessage(e,t),o===c.SessionCloseMessage.getTypeName()&&this.clearAllPendingResponses()},e.prototype.sendMessage=function(e,t,n,o){var r=this;void 0===o&&(o=0);var u=new s.SessionHealth({sessionHealthEventName:"SendMessage",source:this.source,reason:s.SessionHealthReason.Client,impact:this.source===s.SessionHealthSource.ClientRuntime?s.SessionHealthImpact.MissingInput:s.SessionHealthImpact.MissingOutput,success:!0,message:"",affectedWorkflows:["All"],cv:e.cv,resourceId:l(a.SchemaObject.getTypeNameFor(e)),dimension0:o.toString()}).start(),p=function(){if(u.setClientMetadata(r.clientMetadata),u.success)i.Log.info(572836e3,i.LogCategory.CoreDefault,u.stop());else{var e="ErrorWithoutPendingResponse"===u.resultSignature||"ResponseCallbackException"===u.resultSignature||"We called into done callback"!==u.message;u.message=JSON.stringify({errorNotPropagatedToDoneCallback:e}),i.Log.error(572836001,i.LogCategory.CoreDefault,u.stop())}};e.messageId=""+this.messageIdPrefix+this.nextMessageId++;var h=a.SchemaObject.getTypeNameFor(e)===c.SessionCloseMessage.getTypeName();if(!n&&!h){var d=function(n,o){var i;if(n?(u.success=!1,u.resultSignature=n.error,u.resultDescription="Error for "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+n.error):u.resultSignature="Success",t)try{u.message="We called into done callback",t(n,o)}catch(e){u.success=!1,u.resultSignature="ResponseCallbackException",u.resultDescription="Web"===(null===(i=r.clientMetadata)||void 0===i?void 0:i.appPlatform)?JSON.stringify({message:e.message,stack:e.stack}):JSON.stringify({message:e.message})}r.pendingMessageCallbacks.del(e.messageId),p(),r.updateSendMessageStats(u.success,u.durationMs,n?new Error(n.error):void 0)};this.pendingResponseCallbacks.put(e.messageId,d,1e4,(function(){d(new c.TimeoutErrorResponse({error:"Timeout waiting for response"}),void 0)}))}this.egress(e,(function(t){var n,o;if(t){var i=r.pendingResponseCallbacks.get(e.messageId);i?(r.pendingResponseCallbacks.del(e.messageId),i(new c.ErrorResponse({error:t.message}))):h?(u.success=null!==(o=null===(n=t.message)||void 0===n?void 0:n.endsWith("Client disconnected."))&&void 0!==o&&o,u.resultSignature="ErrorSendingSessionCloseMessage",u.resultDescription="Error for "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+t.message,p()):(u.success=!1,u.resultSignature="ErrorWithoutPendingResponse",u.resultDescription="Error for "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+t.message,p())}}))},e.prototype.onMessage=function(e,t){this.messageCallbacks.set(e,t)},e.prototype.getStats=function(){return this.stats},e.prototype.hasMessageCallback=function(e){return this.messageCallbacks.has(e)},e.prototype.cancelPendingResponseCallbacks=function(){var e=this;this.pendingResponseCallbacks.forEach((function(t,n){t&&(e.pendingResponseCallbacks.del(n),t(new c.ErrorResponse({error:"Cancelled"})))}))},e.prototype.clearAllPendingResponses=function(){if(0!=this.pendingResponseCallbacks.size()){var e=new i.Operation({operationName:"PurgePendingResponses",resultDescription:this.pendingResponseCallbacks.size().toString(),success:!0});i.Log.info(572836002,i.LogCategory.CoreDefault,e),this.pendingResponseCallbacks.clear()}},e.prototype.processMessage=function(e,t){var n,o=this,r=new s.SessionHealth({sessionHealthEventName:"ProcessMessage",source:this.source,reason:s.SessionHealthReason.Client,impact:this.source===s.SessionHealthSource.ClientRuntime?s.SessionHealthImpact.MissingOutput:s.SessionHealthImpact.MissingInput,success:!0,message:"",affectedWorkflows:["All"],cv:e.cv}).start(),u=function(){if(r.setClientMetadata(o.clientMetadata),r.success)i.Log.info(572836003,i.LogCategory.CoreDefault,r.stop());else{var e="UnsupportedMessage"===r.resourceId||"Timeout"===r.resultSignature||"OnResponseInvokedMoreThanOnce"===r.resultSignature||"MessageCallbackException"===r.resultSignature||"We called into messageCallback"!==r.message;r.message=JSON.stringify({errorHappenedOutsideRegisteredMessageCallback:e}),i.Log.error(572836032,i.LogCategory.CoreDefault,r.stop())}},p=this.messageCallbacks.get(a.SchemaObject.getTypeNameFor(e));p?r.resourceId=l(a.SchemaObject.getTypeNameFor(e)):p=function(t,n){r.resourceId="UnsupportedMessage",n(new c.ErrorResponse({error:"Message type "+a.SchemaObject.getTypeNameFor(e)+" is not supported"}))};this.pendingMessageCallbacks.put(e.messageId,void 0,1e4,(function(){r.success=!1,r.resultSignature="Timeout",r.resultDescription="Timeout processing message callback",u(),i.Log.error(572836033,i.LogCategory.CoreDefault,"Timeout processing "+r.resourceId),o.updateProcessMessageStats(!1,r.durationMs,new Error("timeout"))}));var h=!1;try{r.message="We called into messageCallback",p(e,(function(n,i){o.pendingMessageCallbacks.del(e.messageId),h?(r.success=!1,r.resultSignature="OnResponseInvokedMoreThanOnce",r.resultDescription="Invoked onResponse for "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+" more than once"):n?(r.success=!1,r.resultSignature=n.error,r.resultDescription="Error for "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+n.error):r.resultSignature="Success",h=!0,u(),n&&!a.SchemaObject.matchesTypesFor(n,[c.ErrorResponse.getTypeName()])&&(n=new c.ErrorResponse({error:"Internal Server Error"})),o.updateProcessMessageStats(r.success,r.durationMs,n?new Error(n.error):void 0),n?(n.messageId=e.messageId,t(n)):i?(i.messageId=e.messageId,t(void 0,i)):t()}))}catch(o){this.pendingMessageCallbacks.del(e.messageId),r.success=!1,r.resultSignature="MessageCallbackException",r.resultDescription="Web"===(null===(n=this.clientMetadata)||void 0===n?void 0:n.appPlatform)?JSON.stringify({message:o.message,stack:o.stack}):JSON.stringify({message:o.message}),u(),this.updateProcessMessageStats(!1,r.durationMs,o),t()}},e.prototype.processResponse=function(e){var t,n=new i.Operation({operationName:"ProcessResponse"});n.success=!0,n.setClientMetadata(this.clientMetadata),n.start();var o=this.pendingResponseCallbacks.get(e.messageId);o?(this.pendingResponseCallbacks.del(e.messageId),a.SchemaObject.matchesTypesFor(e,[c.ErrorResponse.getTypeName()])?o(e):o(void 0,e)):(n.resultSignature="NoPendingMessage",n.resultDescription=""+e.messageId,n.success=!1),"Production"!==(null===(t=this.clientMetadata)||void 0===t?void 0:t.releaseAudienceGroup)&&(n.resourceId=l(a.SchemaObject.getTypeNameFor(e)),i.Log.info(572836034,i.LogCategory.CoreDefault,n.stop()))},e.prototype.updateSendMessageStats=function(e,t,n){this.stats.sendMessageCount++,this.stats.sendMessageDurationMsMax=Math.max(t,this.stats.sendMessageDurationMsMax),e||n?e&&n&&i.Log.warn(572836036,i.LogCategory.CoreDefault,"Succeeded send message provided error object."):i.Log.warn(572836035,i.LogCategory.CoreDefault,"Failed send message did not provide error object."),e||(n&&n.message===o.ClientDisconnected?this.stats.sendMessageClientDisconnectedErrors++:this.stats.sendMessageErrors++)},e.prototype.updateProcessMessageStats=function(e,t,n){this.stats.processMessageCount++,this.stats.processMessageDurationMsMax=Math.max(t,this.stats.processMessageDurationMsMax),e||n?e&&n&&i.Log.warn(572836038,i.LogCategory.CoreDefault,"Succeeded process message provided error object."):i.Log.warn(572836037,i.LogCategory.CoreDefault,"Failed process message did not provide error object."),e||(n&&n.message===r.ProvisionTokenValidationError?this.stats.processMessageProvisionTokenErrors++:this.stats.processMessageErrors++)},e}();t.MessageEndpoint=h},16483:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cache=void 0;var o=n(16484);Object.defineProperty(t,"Cache",{enumerable:!0,get:function(){return o.Cache}})},16484:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cache=void 0;var o=function(){function e(e){if(this.cache=new Map,this.options=e||{sweepInterval:100},null!=this.options.idleDurationMs&&this.options.idleDurationMs<=0)throw new Error("Idle duration must be positive");if(this.interval=this.options.sweepInterval||100,this.interval<=0)throw new Error("Sweep interval must be a positive number")}return e.prototype.put=function(e,t,n,o,r){if(null==n||n<=0)throw new Error("Cache timeout must be a positive number");(null==r||r<=0)&&(r=this.options.idleDurationMs);var i={value:t,lastUsed:r?Date.now():void 0,expire:n+Date.now(),idleDurationMs:r,expireCallback:o};return this.cache.set(e,i),this.timeout||(this.timeout=setInterval(this.onInterval.bind(this),this.interval),this.timeout.unref&&this.timeout.unref()),t},e.prototype.del=function(e){if(this.options.delCallback){var t=this.cache.get(e);t&&this.options.delCallback(e,t.value)}var n=this.cache.delete(e);return 0===this.size()&&this.clear(),n},e.prototype.clear=function(){this.timeout&&(clearInterval(this.timeout),this.timeout=void 0),this.cache.clear()},e.prototype.get=function(e){var t=this.cache.get(e);if(t)return this.options.idleDurationMs&&(t.lastUsed=Date.now()),t.value},e.prototype.keys=function(){return this.cache.keys()},e.prototype.forEach=function(e){this.cache.forEach((function(t,n){e(t.value,n)}))},e.prototype.size=function(){return this.cache.size},e.prototype.updateExpireTime=function(e,t){return!!(this.cache.has(e)&&t>=0)&&(this.cache.get(e).expire=t+Date.now(),!0)},e.prototype.onInterval=function(){var e=this,t=Date.now();this.cache.forEach((function(n,o){if(n.idleDurationMs&&n.lastUsed<t-n.idleDurationMs)return e.del(o),void(e.options.idleCallback&&e.options.idleCallback(o,n.value));n.expire<t&&(e.del(o),n.expireCallback&&n.expireCallback(o,n.value))}))},e}();t.Cache=o},16485:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationResultState=t.currentProtocolVersion=void 0,t.currentProtocolVersion=2,function(e){e[e.Idle=0]="Idle",e[e.Pending=1]="Pending"}(t.AnnotationResultState||(t.AnnotationResultState={}))},16486:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageQueue=t.ClientSendMessageErrorReason=void 0;var o,r=n(5689),i=n(2936),s=n(967),a=n(5235),c=n(4128);!function(e){e.ArrivedBeforeReseeding="Message is dropped from queue since it arrived before reseeding is started",e.DroppedAsOldestInQueue="Message is dropped as oldest in full queue"}(o=t.ClientSendMessageErrorReason||(t.ClientSendMessageErrorReason={}));var u=1e3,l=function(){function e(e){this.logOp=new c.Operation({operationName:"MessageQueue",success:!0}),this.messageQueueLogCountLimiter=new a.LogCountLimiter("MessageQueue"),this.queue=new s(u),this.callbacks=e}return e.prototype.push=function(e,t,n){var i=this,s=this.queue;if(s.length===u){this.messageQueueLogCountLimiter.log((function(){i.logOp.resourceId="QueueFull",i.logOp.durationMs=0,c.Log.warn(573187741,c.LogCategory.CoreDefault,i.logOp)}));var l=s.shift();l.onResponse&&l.onResponse(new r.ErrorResponse({error:o.DroppedAsOldestInQueue}))}s.push({message:e,onResponse:t,timeQueued:a.Utils.getCurrentTimeMs(),attemptNumber:n})},e.prototype.sendOnSessionInitialized=function(e){var t=this,n=this.queue.length,s=0;if(n>0){for(var u=a.Utils.getCurrentTimeMs()-this.queue.get(0).timeQueued;this.queue.length>0&&this.callbacks.canSendMessage();){var l=this.queue.shift();e&&l.message instanceof r.SyncMessage&&i.SchemaObject.matchesTypesFor(l.message,[r.SyncMessage.getTypeName()])&&(!this.callbacks.dropOnlySequencedSyncsOnReseed||l.message.seq>=0)?(s++,l.onResponse&&l.onResponse(new r.ErrorResponse({error:o.ArrivedBeforeReseeding}))):l.message instanceof Uint8Array?this.callbacks.sendBytes(l.message):this.callbacks.sendMessage(l.message,l.onResponse,l.attemptNumber)}this.messageQueueLogCountLimiter.log((function(){t.logOp.resourceId="SendOnSessionInitialized",t.logOp.resultDescription="Queue size before: "+n+", after: "+t.queue.length+". droppedSyncMessages: "+s,t.logOp.durationMs=u,c.Log.warn(573187742,c.LogCategory.CoreDefault,t.logOp)}))}},e}();t.MessageQueue=l},16487:function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.ClosedState=t.DisconnectedState=t.RunningState=t.InitingState=t.BaseState=t.queueBytes=t.queueMessage=t.sendMessageNow=t.SessionState=void 0;var i,s=n(5689),a=n(2936);!function(e){e[e.Initing=0]="Initing",e[e.Running=1]="Running",e[e.Disconnected=2]="Disconnected",e[e.Closed=3]="Closed"}(i=t.SessionState||(t.SessionState={}));t.sendMessageNow=function(e,t,n,o){t&&(t.cv||(t.cv=e.cvParent.newChild().toString()),e.messageEndpoint.sendMessage(t,(function(t,o){t||a.SchemaObject.getTypeNameFor(o)!==s.SyncResponse.getTypeName()||(e.stats.lastSyncMessage=Date.now()),n&&n(t,o)}),void 0,o))};t.queueMessage=function(e,t,n,o){t&&(e.messageQueue.push(t,n,o),e.webSocketWorkerManager.init(void 0,e.customInitPromise))};t.queueBytes=function(e,t){t&&(e.messageQueue.push(t),e.webSocketWorkerManager.init(void 0,e.customInitPromise))};var c=function(){function e(e){this.context=e}return e.prototype.onEnter=function(e){},e.prototype.sendMessage=function(e,t,n){},e.prototype.sendBytes=function(e){},e.prototype.canSendMessage=function(){return!1},e.prototype.onConnectionClose=function(){},e}();t.BaseState=c;var u=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateName=i.Initing,t.possibleNextStates=[i.Running,i.Disconnected,i.Closed],t}return r(n,e),n.prototype.sendMessage=function(e,n,o){a.SchemaObject.matchesTypesFor(e,[s.SessionInitMessage.getTypeName()])?t.sendMessageNow(this.context,e,n,o):t.queueMessage(this.context,e,n)},n.prototype.sendBytes=function(e){t.queueBytes(this.context,e)},n.prototype.onConnectionClose=function(){this.context.setState(i.Disconnected)},n}(c);t.InitingState=u;var l=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateName=i.Running,t.possibleNextStates=[i.Disconnected,i.Closed],t}return r(n,e),n.prototype.onEnter=function(e){e&&e.isSessionReseedingStarted&&this.context.resetNextSyncSequenceId(),this.context.messageQueue.sendOnSessionInitialized(e&&e.isSessionReseedingStarted)},n.prototype.sendMessage=function(e,n,o){t.sendMessageNow(this.context,e,n,o)},n.prototype.sendBytes=function(e){e&&this.context.webSocketWorkerManager.egressBytes(e)},n.prototype.canSendMessage=function(){return!0},n.prototype.onConnectionClose=function(){this.context.setState(i.Disconnected)},n}(c);t.RunningState=l;var p=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateName=i.Disconnected,t.possibleNextStates=[i.Initing,i.Closed],t}return r(n,e),n.prototype.onEnter=function(e){this.context.messageEndpoint.cancelPendingResponseCallbacks()},n.prototype.sendMessage=function(e,n,o){a.SchemaObject.matchesTypesFor(e,[s.SessionInitMessage.getTypeName()])?(this.context.setState(i.Initing),t.sendMessageNow(this.context,e,n,o)):t.queueMessage(this.context,e,n,o)},n.prototype.sendBytes=function(e){t.queueBytes(this.context,e)},n}(c);t.DisconnectedState=p;var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state=i.Closed,t.possibleNextStates=[],t}return r(t,e),t}(c);t.ClosedState=h},16488:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketWorkerManager=t.calculateTimeToWaitForNextTry=void 0;var o=n(2936),r=n(5689),i=n(4128),s=n(5235),a=n(16489);t.calculateTimeToWaitForNextTry=function(e,t){var n=0,o=s.Utils.getCurrentTimeMs()?s.Utils.getCurrentTimeMs()-t:0,r=[1e3,2e3,5e3,1e4,6e4];return n=r[Math.max(0,Math.min(r.length-1,e-1))],n=Math.max(n-o,1e3)};var c=function(){function e(t,n,o,r,i){this.logCountLimiter=new s.LogCountLimiter(e.className),this.isWorkerReady=!1,this.permanentlyClosed=!1,this.currentReconnectAttempt=0,this.lastInitializationAttemptTimeMs=0,this.alreadyLoggedReconnectAttempt=!1,this.globalUrl=t,this.workerFactory=n,this.sessionInitializer=o,this.ingress=r,this.onClose=i}return e.prototype.init=function(t,n,o){var r=this;if(void 0===o&&(o=!1),this.permanentlyClosed)return Promise.reject("permanentlyClosed");if(this.isWorkerReady||this.pendingInitPromise)return this.pendingInitPromise?this.pendingInitPromise:Promise.resolve();this.extensionConfigs=t||this.extensionConfigs;var s=function(){if(o||!r.alreadyLoggedReconnectAttempt){var t=o?e.initialAttemptTimeout:e.reconnectAttemptTimeout;r.connTimeout=setTimeout((function(){var e=new i.Operation({operationName:"ConnectionFailingOrSlow",dimension0:o?"Initial":"Reconnect",dimension1:t.toString(),dimension2:r.currentReconnectAttempt.toString()});i.Log.info(572838096,i.LogCategory.CoreDefault,e),r.alreadyLoggedReconnectAttempt=!o,r.connTimeout=void 0}),t)}};return n?this.pendingInitPromise=n().catch((function(e){i.Log.error(572838097,i.LogCategory.CoreDefault,"Error occurred during calling the custom init promise: "+e)})).then((function(){s(),r.initInternal()})):(this.pendingInitPromise=Promise.resolve(),s(),this.initInternal()),this.pendingInitPromise},e.prototype.egress=function(e){var t=this;return!this.isWorkerReady&&this.pendingInitPromise?this.pendingInitPromise.then((function(){t.egressInternal(e)})):(this.egressInternal(e),Promise.resolve())},e.prototype.egressBytes=function(e){var t=this;return!this.isWorkerReady&&this.pendingInitPromise?this.pendingInitPromise.then((function(){t.egressBytesInternal(e)})):(this.egressBytesInternal(e),Promise.resolve())},e.prototype.close=function(e){this.worker&&this.worker.close(),this.isWorkerReady=!1,this.worker=null,this.permanentlyClosed=e||this.permanentlyClosed},e.prototype.initInternal=function(){var e=this;this.isWorkerReady=!1,this.permanentlyClosed||(this.currentReconnectAttempt>0?setTimeout((function(){e.tryToConnectAndInitializeSession()}),t.calculateTimeToWaitForNextTry(this.currentReconnectAttempt,this.lastInitializationAttemptTimeMs)):this.tryToConnectAndInitializeSession())},e.prototype.egressInternal=function(e){var t;this.isWorkerReady||o.SchemaObject.matchesTypesFor(e,[r.SessionInitMessage.getTypeName()])?(o.SchemaObject.matchesTypesFor(e,[r.MicroSyncMessage.getTypeName()])?(this.castBinaryData(e),t=a.JSOND.serialize(e)):t=JSON.stringify(e),this.worker.egress(t)):o.SchemaObject.matchesTypesFor(e,[r.Response.getTypeName()])||i.Log.error(572838098,i.LogCategory.CoreDefault,new i.Operation({operationName:"UnexpectedEgressCall",resultDescription:"isWorkerReady: "+this.isWorkerReady}))},e.prototype.egressBytesInternal=function(e){this.isWorkerReady?this.worker.egress(e):i.Log.error(572838099,i.LogCategory.CoreDefault,new i.Operation({operationName:"UnexpectedEgressBytesCall",resultDescription:"isWorkerReady: "+this.isWorkerReady}))},e.prototype.tryToConnectAndInitializeSession=function(){var e=this;this.currentReconnectAttempt++,this.lastInitializationAttemptTimeMs=s.Utils.getCurrentTimeMs();var t=function(n){e.permanentlyClosed||(e.connect(e.sliceUrl?e.sliceUrl:e.globalUrl),e.sessionInitializer.initSession({isTokenRefresh:!1,isReconnectOnSameSlice:!!e.sliceUrl,extensionConfigs:e.extensionConfigs,onResponse:function(o,r){if(e.logCountLimiter.log((function(){n.success=!o,n.resultDescription=o?o.error:"",n.resourceId=r?r.sliceUrl:"",n.stop(),i.Log.info(572838100,i.LogCategory.CoreDefault,n)})),o||!e.worker)e.sliceUrl=void 0,e.close(),e.initInternal();else if(r.forceReconnect){e.close();var s=new i.Operation({operationName:"ForcedReconnect"}).start();s.resultSignature="globalUrl: "+e.globalUrl+". sliceUrl: "+e.sliceUrl,e.sliceUrl=void 0,setTimeout((function(){t(s)}),1e3)}else void 0!==e.connTimeout&&clearTimeout(e.connTimeout),e.sliceUrl=r.sliceUrl,e.ready()}}))},n=new i.Operation({operationName:"TryToConnectAndInitializeSession",resultSignature:"Reconnection attempt #"+this.currentReconnectAttempt}).start();t(n)},e.prototype.connect=function(e){var t=this;this.worker=this.workerFactory(),this.worker.init(e,this.ingress,(function(e){t.onClose(e),t.close()}))},e.prototype.ready=function(){this.isWorkerReady=!0,this.pendingInitPromise=void 0,this.currentReconnectAttempt=0},e.prototype.castBinaryData=function(e){if(e){if(Array.isArray(e.__binaryMembers__))for(var t=0,n=e.__binaryMembers__;t<n.length;t++){var o=n[t];ArrayBuffer.isView(e[o])||(e[o]=new Uint8Array(e[o]))}for(var r=0,i=Object.keys(e);r<i.length;r++){var s=i[r];"object"==typeof e[s]&&null!==e[s]&&this.castBinaryData(e[s])}}},e.initialAttemptTimeout=1e5,e.reconnectAttemptTimeout=2e4,e.className="WebSocketWorkerManager",e}();t.WebSocketWorkerManager=c},16489:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JSOND=void 0;var o=n(16490);Object.defineProperty(t,"JSOND",{enumerable:!0,get:function(){return o.JSOND}})},16490:function(e,t,n){"use strict";(function(e){var o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0}),t.JSOND=void 0,"undefined"==typeof TextEncoder&&n(10042);var r=function(){function t(){}return t.deserialize=function(n,o){if(void 0===o&&(o=function(e){return e}),n[0]!==t.IDENTIFIERBYTE)throw"Invalid Binary: Incorrect Identifier";for(var r=1,i=[],s=new DataView(n.buffer,n.byteOffset,n.byteLength);r<n.byteLength;){if(r+4>n.byteLength)throw"Invalid Binary: Error reading fragment length";var a=s.getUint32(r);if(r+a+4>n.byteLength)throw"Invalid Binary: Fragment out of range";void 0!==e&&e.from?i.push(e.from(n.buffer,n.byteOffset+r+4,a)):i.push(new Uint8Array(n.buffer,n.byteOffset+r+4,a)),r+=4+a}if(i.length<1)throw"Invalid Binary: No fragments found";var c=t.textDecoder.decode(i[0]);return JSON.parse(c,(function(e,n){if("string"==typeof n){if(n.substring(0,t.BINARYKEYWORD.length)===t.BINARYKEYWORD){var r=parseInt(n.substring(t.BINARYKEYWORD.length),10);if("number"!=typeof r||r>=i.length-1)throw"Invalid Binary: Binary index out of range";return o(i[r+1])}if(n.substring(0,t.ESCAPEKEYWORD.length)===t.ESCAPEKEYWORD)return n.substring(t.ESCAPEKEYWORD.length)}return n}))},t.serialize=function(e){var n,r,i=[void 0],s=JSON.stringify(e,(function(e,n){return ArrayBuffer.isView(n)?(i.push(n),""+t.BINARYKEYWORD+(i.length-2)):n&&"Buffer"===n.type&&Array.isArray(n.data)?(i.push(new Uint8Array(n.data)),""+t.BINARYKEYWORD+(i.length-2)):"string"==typeof n&&n.substring(0,t.ESCAPEKEYWORD.length)===t.ESCAPEKEYWORD?t.ESCAPEKEYWORD+n:n}));i[0]=t.textEncoder.encode(s);var a=i.reduce((function(e,t){return e+4+t.byteLength}),0),c=new Uint8Array(a+1);c[0]=t.IDENTIFIERBYTE;var u=1,l=new DataView(c.buffer,c.byteOffset,c.byteLength);try{for(var p=o(i),h=p.next();!h.done;h=p.next()){var d=h.value;l.setUint32(u,d.byteLength),c.set(d,u+4),u+=4+d.byteLength}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=p.return)&&r.call(p)}finally{if(n)throw n.error}}return c},t.IDENTIFIERBYTE=3,t.BINARYKEYWORD=":b",t.ESCAPEKEYWORD=":",t.textDecoder=new TextDecoder,t.textEncoder=new TextEncoder,t}();t.JSOND=r}).call(this,n(1552).Buffer)},16491:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExecutionWithThrottling=void 0;var o=n(5235),r=function(){function e(){this.throttleInfoMap=new Map}return e.prototype.execute=function(e,t,n){var r=this;if(t.throttleSettings.shouldBeThrottled&&t.throttleSettings.throttlingInterval>0){var i=this.getWorkflowThrottleInfo(t.name);if(null==i.currentTileId)i.currentTileId=e,i.timeOfPreviousStartedEvent=o.Utils.getCurrentTimeMs(),n();else if(i.currentTileId===e){var s=o.Utils.getCurrentTimeMs(),a=this.delayTime(i,s,t.throttleSettings.throttlingInterval);a>0?(i.latestCallback=n,null==i.lastTimeout&&(i.lastTimeout=setTimeout((function(){var e=r.getWorkflowThrottleInfo(t.name);e.lastTimeout=void 0,e.timeOfPreviousStartedEvent=o.Utils.getCurrentTimeMs(),e.latestCallback()}),a))):(i.timeOfPreviousStartedEvent=s,n())}else null!=i.lastTimeout&&(clearTimeout(i.lastTimeout),i.latestCallback(),i.lastTimeout=void 0),i.currentTileId=e,i.timeOfPreviousStartedEvent=o.Utils.getCurrentTimeMs(),n()}else n()},e.prototype.delayTime=function(e,t,n){var o=t-e.timeOfPreviousStartedEvent;return Math.max(n-o,0)},e.prototype.getWorkflowThrottleInfo=function(e){var t=this.throttleInfoMap.get(e);return t||(t={currentTileId:void 0,timeOfPreviousStartedEvent:-1,latestCallback:function(){},lastTimeout:void 0},this.throttleInfoMap.set(e,t)),t},e}();t.ExecutionWithThrottling=r},16492:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Session=void 0;var o=n(5689),r=n(2936),i=n(16493),s=n(11883),a=n(11884),c=n(16494),u=n(16495),l=function(){function e(e){this.annotationActivationTrackers=new Map,this.annotationCallbacks=new Map,this.annotationResultStates=new Map,this.tokensByAnnotationType=new Map,this.nextSyncSequenceId=1,this.allowSeed=!0,this.allowGroupSeed=!0,this.seedGroupSize=0,this.hasSessionConnected=!1,this.isSessionClosed=!1,this.isSessionConnected=!1,this.hostCallbacks=e.hostCallbacks,this.sessionManager=e.sessionManager,this.operationBatchConfig=e.batchOptions?this.getOperationBatchConfig(e.batchOptions):void 0,this.extensionConfigs=e.extensionConfigs,this.clientMetadata=e.clientMetadata,this.modelDownloader=e.modelDownloader,this.sessionManager.on("sessionClose",this.onSessionClose.bind(this)),this.sessionManager.on("reconnect",this.onReconnect.bind(this)),this.sessionManager.on("connect",this.onConnect.bind(this)),this.sessionManager.on("disconnect",this.onDisconnect.bind(this)),this.sessionManager.on("resetNextSyncSequenceId",this.resetNextSyncSequenceId.bind(this)),this.sessionManager.onMessage(o.AnnotationResultsMessage.getTypeName(),this.onAnnotationResults.bind(this)),this.sessionManager.onMessage(o.AnnotationResultStateMessage.getTypeName(),this.onAnnotationResultStateMessage.bind(this))}return e.prototype.initialize=function(){var e=this;return this.sessionManager.init(this.extensionConfigs,this.hostCallbacks.onInitSession?this.hostCallbacks.onInitSession:void 0).then((function(){return e}))},Object.defineProperty(e.prototype,"isConnected",{get:function(){return this.isSessionConnected},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasConnected",{get:function(){return this.hasSessionConnected},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isClosed",{get:function(){return this.isSessionClosed},enumerable:!1,configurable:!0}),e.prototype.registerLocalWorkflow=function(e){this.localWorkflowManager||(this.localWorkflowManager=new u.LocalWorkflowExecutionManager(this,this.modelDownloader)),this.localWorkflowManager.registerLocalWorkflow(e)},e.prototype.activateAnnotation=function(e,t){var n,o=new i.AnnotationActivationTracker(this.getSessionManager.bind(this),e,t);if(t&&t.callback){var r=this.annotationCallbacks.get(e);r||(r=new Map,this.annotationCallbacks.set(e,r)),r.set(o.token,t.callback)}var s=null!==(n=this.tokensByAnnotationType.get(e))&&void 0!==n?n:[];return-1===s.indexOf(o.token)&&s.push(o.token),this.tokensByAnnotationType.set(e,s),this.annotationActivationTrackers.set(o.token,o),o.activate(!1),o.asPromise()},e.prototype.updateAnnotationConfig=function(e,t){throw new Error("Not Yet Implemented")},e.prototype.releaseAnnotation=function(e){var t=this.annotationActivationTrackers.get(e);if(t){this.annotationActivationTrackers.delete(e);var n=this.annotationCallbacks.get(t.annotationType);return n&&(n.delete(e),0==n.size&&this.annotationCallbacks.delete(t.annotationType)),t.release()}return Promise.resolve(!1)},e.prototype.setAnnotationState=function(e,t,n){var o={state:n};this.submitOperation(new r.UpdateAnnotationMetaDataOperation({parentPath:e,items:[{id:t}],M_:o}))},e.prototype.setAnnotationMetadata=function(e,t,n){this.submitOperation(new r.UpdateAnnotationMetaDataOperation({parentPath:e,items:[{id:t}],M_:n}))},e.prototype.submitOperation=function(e,t){this.submitOperations([e],t)},e.prototype.submitOperations=function(e,t){var n=this,i=function(e){return r.SchemaObject.getTypeNameFor(e)===r.SignalOperation.getTypeName()},a=e.filter((function(e){return i(e)})),c=e.filter((function(e){return!i(e)}));if(a.length>0&&this.getSessionManager().sendMessage(new o.SyncMessage({cv:t,ops:a})),c.length>0)if(this.operationBatchConfig){if(!this.batchedOperationsManager){this.batchedOperationsManager=new s.BatchManager((function(e,t,r){n.getSessionManager().sendMessage(new o.SyncMessage({cv:t.cv,seq:n.nextSyncSequenceId++,ops:e}),(function(e){r(e?new Error(e.error):void 0)}))}))}this.batchedOperationsManager.addBatchItem(c,this.operationBatchConfig,{name:"SubmitOperations"},t)}else this.getSessionManager().sendMessage(new o.SyncMessage({cv:t,seq:this.nextSyncSequenceId++,ops:c}));this.localWorkflowManager&&this.localWorkflowManager.runLocalWorkflows(e)},e.prototype.submitSeedOperations=function(e,t){if(!this.allowSeed)throw new Error("Cannot submit seed operations more than once per session");this.allowSeed=!1,this.allowGroupSeed=!1,this.operationBatchConfig?this.sendSeedMessagesViaBatchManager(e,!0,t):this.getSessionManager().sendMessage(new o.SyncMessage({cv:t,seq:0,ops:e}))},e.prototype.submitSeedGroupOperations=function(e,t,n){if(!this.allowGroupSeed)throw new Error("Seed operations are not allowed for this session");t&&(this.allowGroupSeed=!1),this.allowSeed=!1,this.operationBatchConfig?this.sendSeedMessagesViaBatchManager(e,!!t,n):(this.seedGroupSize++,this.getSessionManager().sendMessage(new o.SyncMessage({cv:n,seq:0,ops:e,groupId:"Seed",groupSize:t?this.seedGroupSize:void 0,groupComplete:t||void 0})))},e.prototype.submitCustomMessage=function(e){var t=this;return new Promise((function(n,o){t.getSessionManager().sendMessage(e,(function(e,t){e?o(e):n(t)}))}))},e.prototype.requestCacheDump=function(e){var t=this;if(e)throw new Error("NYI");return new Promise((function(e,n){t.getSessionManager().sendMessage(new o.CacheDumpRequestMessage,(function(t,o){t?n(t):e(o)}))}))},e.prototype.forceReconnect=function(e){return this.extensionConfigs=e,this.getSessionManager().forceReconnect(e)},e.prototype.close=function(){this.isSessionClosed=!0,this.getSessionManager().closeSession()},e.prototype.getClientMetadata=function(){return this.clientMetadata},e.prototype.setSessionCloseCallback=function(e){this.sessionCloseCallback=e},e.prototype.setConnectCallback=function(e){this.connectCallback=e},e.prototype.setDisconnectCallback=function(e){this.disconnectCallback=e},e.prototype.setReconnectCallback=function(e){this.reconnectCallback=e},e.prototype.onAnnotationResults=function(e,t){t(void 0,new o.Response);for(var n=0,r=e.ops;n<r.length;n++){var i=r[n];this.callAnnotationCallbacks(i,e.annotationType),this.hostCallbacks.onAnnotationResult&&this.hostCallbacks.onAnnotationResult(i)}},e.prototype.onAnnotationResultStateMessage=function(e,t){var n;t(void 0,new o.Response);for(var r=0,i=e.updates;r<i.length;r++){var s=i[r],a=s.annotationType,c=s.state;if(this.tokensByAnnotationType.has(a)){var u=void 0;u=this.annotationResultStates.has(a)?this.annotationResultStates.get(a):c===o.AnnotationResultState.Idle?o.AnnotationResultState.Pending:o.AnnotationResultState.Idle;for(var l=0,p=this.tokensByAnnotationType.get(a);l<p.length;l++){var h=p[l],d=this.annotationActivationTrackers.get(h);(null===(n=d.options)||void 0===n?void 0:n.stateUpdateCallback)&&d.options.stateUpdateCallback(u,c)}}}},e.prototype.resetNextSyncSequenceId=function(){this.nextSyncSequenceId=1},e.prototype.onReconnect=function(){this.isSessionConnected=!0,this.annotationActivationTrackers.forEach((function(e){e.activate(!0)})),this.reconnectCallback&&this.reconnectCallback()},e.prototype.onSessionClose=function(e){this.isSessionClosed=!0,this.isSessionConnected=!1,this.sessionCloseCallback&&this.sessionCloseCallback(e)},e.prototype.onConnect=function(e,t,n,o){this.hasSessionConnected&&e&&(this.allowSeed=!0,this.allowGroupSeed=!0,this.seedGroupSize=0,this.seedBatchedOperationsManager&&(this.seedBatchedOperationsManager.removeAllBatchedItems(),this.seedBatchedOperationsManager=void 0),this.batchedOperationsManager&&(this.batchedOperationsManager.removeAllBatchedItems(),this.batchedOperationsManager=void 0)),this.isSessionConnected=!0,this.hasSessionConnected=!0,this.connectCallback&&this.connectCallback(e,t,n,o)},e.prototype.onDisconnect=function(e){this.isSessionConnected=!1,this.disconnectCallback&&this.disconnectCallback(e)},e.prototype.getSessionManager=function(){return this.sessionManager||(this.sessionManager=new c.EmptySessionManager),this.sessionManager},e.prototype.callAnnotationCallbacks=function(e,t){if(0!==this.annotationCallbacks.size){var n=this.annotationCallbacks.get(t);n&&n.forEach((function(t){t(e)}))}},e.prototype.getOperationBatchConfig=function(e){return{delayMs:e.delayMs,maxInputSize:e.maxInputSize,estimateSize:a.estimateSize,groupingKeyExtractor:function(){return"operations"},multiplex:function(e){return{input:e.filter((function(e){return e.length})).reduce((function(e,t){return e.concat(t)}),[]),demultiplex:function(){return[[]]}}},split:function(e){if(!(e.length<=1))return{inputs:e.reduce((function(e,t){return e.push([t]),e}),[]),join:function(){return[]}}}}},e.prototype.sendSeedMessagesViaBatchManager=function(e,t,n){var r=this;if(!this.seedBatchedOperationsManager){this.seedBatchedOperationsManager=new s.BatchManager((function(e,t,n){r.seedGroupSize++,r.getSessionManager().sendMessage(new o.SyncMessage({cv:t.cv,seq:0,ops:e,groupId:"Seed",groupSize:t.groupComplete?r.seedGroupSize:void 0,groupComplete:t.groupComplete?t.groupComplete:void 0}),(function(e){n(e?new Error(e.error):void 0)}))}))}this.seedBatchedOperationsManager.addBatchItem(e,this.operationBatchConfig,{name:"SubmitSeedOperations"},n,t)},e}();t.Session=l},16493:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationActivationTracker=void 0;var o=n(5689),r=function(){function e(t,n,o){var r=this;this.sessionManager=t,this.annotationType=n,this.options=o,this.token=n+"-"+e.nextActivationResultBatchId++,this.promise=new Promise((function(e,t){r.resolve=e,r.reject=t}))}return e.prototype.asPromise=function(){return this.promise},e.prototype.activate=function(e){var t=this;this.sessionManager().sendMessage(new o.AnnotationActivationMessage({annotationType:this.annotationType,token:this.token,config:this.options?this.options.config:void 0,ignoreExistingAnnotations:e}),(function(e,n){t.complete(e?new Error(e.error):void 0)}))},e.prototype.release=function(){var e=this;return new Promise((function(t,n){e.sessionManager().sendMessage(new o.AnnotationReleaseMessage({token:e.token}),(function(e,o){e?n(new Error(e.error)):t(o.lastRelease)}))}))},e.prototype.complete=function(e){this.isComplete||(this.isComplete=!0,e?this.reject(e):this.resolve({token:this.token}))},e.nextActivationResultBatchId=1,e}();t.AnnotationActivationTracker=r},16494:function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.EmptySessionManager=void 0;var i=n(4128),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.init=function(){return Promise.resolve()},t.prototype.sendMessage=function(e,t){},t.prototype.onMessage=function(e,t){},t.prototype.forceReconnect=function(){return Promise.resolve()},t.prototype.closeSession=function(){},t.prototype.sendBytes=function(e){},t.prototype.getCorrelationVector=function(){return new i.CorrelationVector},t.prototype.setState=function(e){},t}(n(10041).EventEmitter);t.EmptySessionManager=s},16495:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalWorkflowExecutionManager=void 0;var o=n(2936),r=n(7596),i=n(4128),s=n(5689),a=function(){function e(e,t){this.localWorkflows=[],this.session=e,this.nextAnnotationId=1,this.nextSignalId=1,this.modelDownloader=t}return e.prototype.getNextClientAnnotationId=function(){return"#AC"+this.nextAnnotationId++},e.prototype.getNextClientSignalId=function(){return"#SC"+this.nextSignalId++},e.prototype.registerLocalWorkflow=function(e){var t=new i.Operation({operationName:"WorkflowRegistration",resourceId:e.id}).start();if(0===e.inputTypes.length)throw new Error("Invalid workflow params");var n=e.factory(),o={workflow:e,workflowLambda:n,initPromise:this.initWorkflow(e.kind,n)};this.localWorkflows.push(o),t.success=!0,i.Log.info(572838110,i.LogCategory.CoreDefault,t.stop())},e.prototype.runLocalWorkflows=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(o.SchemaObject.getTypeNameFor(r)!==o.DeleteOperation.getTypeName())for(var s=0,a=r.items;s<a.length;s++){var c=a[s];if(c.body)for(var u=0,l=this.localWorkflows;u<l.length;u++){var p=l[u];if(o.SchemaObject.matchesTypesFor(c.body,p.workflow.inputTypes)){var h={parentPath:r.parentPath,id:c.id,body:c.body,revId:c.revId,source:c.source};this.executeLocalWorkflow(p,[h],this.session.getClientMetadata()).catch((function(e){i.Log.error(572838111,i.LogCategory.CoreDefault,e)}))}}}}},e.prototype.getResourceAsArrayBuffer=function(e,t){return this.modelDownloader?this.modelDownloader.getResourceAsArrayBuffer(e,t):Promise.reject(new Error("Resource Downloader never created"))},e.prototype.getResourceAsURL=function(e,t){return this.modelDownloader?this.modelDownloader.getResourceAsURL(e,t):Promise.reject(new Error("Resource Downloader never created"))},e.prototype.getToken=function(e,t){throw new Error("Not implemented")},e.prototype.initWorkflow=function(e,t){if(e==r.WorkflowKind.SingleItem){var n={getResourceAsArrayBuffer:this.getResourceAsArrayBuffer.bind(this),getResourceAsURL:this.getResourceAsURL.bind(this)};return t.init(n)}return Promise.resolve()},e.prototype.executeLocalWorkflow=function(e,t,n){var a=this;return new Promise((function(c,u){var l=e.workflow,p=new i.Operation({operationName:"ExecuteWorkflow",resourceId:l.id});p.start();var h=function(e){return e?(p.resultDescription=e,p.resultSignature="Exception",i.Log.error(572838112,i.LogCategory.CoreDefault,p.stop())):(p.success=!0,i.Log.info(572838113,i.LogCategory.CoreDefault,p.stop())),e},d={getToken:a.getToken.bind(a),clientMetadata:n,site:{getResourceAsArrayBuffer:a.getResourceAsArrayBuffer.bind(a),getResourceAsURL:a.getResourceAsURL.bind(a)}},f={getResourceAsArrayBuffer:a.getResourceAsArrayBuffer.bind(a),getResourceAsURL:a.getResourceAsURL.bind(a)},g={setAnnotations:function(e,n,r,i){if(t[0].body===e){var c,p=t[0];if(Array.isArray(r))if(l.outputTypes&&l.outputTypes.includes(n))if(p)for(var d=0,f=r;d<f.length;d++){var g=f[d];o.SchemaObject.matchesTypesFor(g,[o.Annotation.getTypeName()])?o.SchemaObject.getTypeNameFor(g)!==n&&(c="Workflow produced inconsistent annotation types in setAnnotations call ("+o.SchemaObject.getTypeNameFor(g)+" did not match expected "+n+")"):c="Workflow produced an output that is not an annotation "+o.SchemaObject.getTypeNameFor(g)}else c="No item provided";else c="Workflow said it would output one of ["+l.outputTypes+"] but instead output "+n;else c="Workflow produced an invalid annotation array";if(c)u(h(c));else{var y;y=i&&i.isSessionAnnotation?["session"]:i&&i.ancestorType?p.parentPath:p.parentPath.concat(p.id);for(var m=[],v=0,S=r;v<S.length;v++){g=S[v];m.push({id:a.getNextClientAnnotationId(),source:l.id,body:g})}a.session.onAnnotationResults(new s.AnnotationResultsMessage({annotationType:n,ops:[{parentPath:y,items:m}]}),(function(){}))}}else u(h("Expected obj to be "+t[0].body+" but instead it was "+e))},submitSignals:function(e){var t=e.map((function(e){return{id:a.getNextClientSignalId(),source:l.id,body:e}})),n=new o.SignalOperation({parentPath:["session"],items:t});a.session.submitOperations([n])},done:function(e){h(e?e.message:null),e?u(e):c()},addAnnotation:function(){throw Error("Not implemented")},addSiblingAnnotation:function(){throw Error("Not implemented")},addSessionAnnotation:function(){throw Error("Not implemented")}},y=e.workflowLambda;if(l.kind===r.WorkflowKind.SingleItem){1!==t.length&&h("Single item workflows expect a single input"),d.delta=t[0].delta;try{var m=y;e.initPromise||(e.initPromise=m.init(f)),e.initPromise.then((function(){m.execute(t[0].body,d,g)})).catch((function(e){h(e)}))}catch(e){h(e)}}else h("Only single item workflows supported currently")}))},e}();t.LocalWorkflowExecutionManager=a},16496:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SessionStats=void 0;var o=function(){};t.SessionStats=o},16497:function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.SessionInitializer=void 0;var i=n(4128),s=n(5689),a=n(5235),c=n(11885),u=function(e){function t(t,n,o,r,i){var s=e.call(this)||this;return s.getSessionStats=t,s.clientMetadata=n,s.tokenRefreshManager=o,s.sendMessage=r,s.options=i||{},s.options.overrideSessionInitMessage=s.options.overrideSessionInitMessage||function(e){return e},s}return r(t,e),t.prototype.initSession=function(e){var t=this;e.onResponse=e.onResponse||function(){};var n=a.Utils.getCurrentTimeMs(),o=this.getSessionStats().lastConnectionClose&&n-this.getSessionStats().lastConnectionClose,r=this.getSessionStats().lastSyncMessage&&n-this.getSessionStats().lastSyncMessage,c=new i.Operation({operationName:"SessionInit"}),u={sessionKey:this.sessionKey,sessionId:this.clientMetadata.sessionId,timeSinceLastConnectionClose:o,timeSinceLastSyncMessage:r,isTokenRefresh:e.isTokenRefresh,error:void 0},l=this.options.overrideSessionInitMessage(new s.SessionInitMessage({protocolVersion:s.currentProtocolVersion,clientMetadata:this.clientMetadata,sessionKey:this.sessionKey,origin:this.origin,authToken:this.anonymousToken,extensionConfigs:e.extensionConfigs}));this.sendMessage(l,(function(n,o){if(c.success=!n,c.resultSignature=t.getSessionStats().lastConnectionClose?"Reconnect":"FirstConnect",c.resourceId=null==o?void 0:o.sliceUrl,(null==o?void 0:o.sessionKey)&&u.sessionKey!==o.sessionKey&&(u.sessionKey=o.sessionKey),n&&(u.error=n.error),c.resultDescription=JSON.stringify(u),i.Log.info(572838103,i.LogCategory.CoreDefault,c),e.onResponse(n,o),!(n||e.isReconnectOnSameSlice&&o.forceReconnect)){if(!o.anonymousToken||!o.tokenExpirationSeconds)return void i.Log.error(572838104,i.LogCategory.CoreDefault,"AL Anonymous token was not generated for the session");t.anonymousToken=o.anonymousToken,t.onSuccessfulSessionInitOnServerSide(o)}}))},t.prototype.onSuccessfulSessionInitOnServerSide=function(e){this.tokenRefreshManager.scheduleRefresh(c.TokenType.Anonymous,e.tokenExpirationSeconds,this.initSession.bind(this,{isTokenRefresh:!0})),this.initHostAuthToken();var t=!!this.sessionKey,n=this.sessionKey!==e.sessionKey;this.emit("connect",n,t,e.sessionUrlBase+"/"+e.sessionKey,e.origin,this.anonymousToken),this.sessionKey=e.sessionKey,this.origin=e.origin,t&&this.emit("reconnect")},t.prototype.initHostAuthToken=function(){var e=this;this.options.getAuthToken&&this.options.getAuthToken().then((function(t){t?e.sendTokenProvisionMessage(t):i.Log.info(572838105,i.LogCategory.CoreDefault,"Host auth token provision failed")})).catch((function(e){i.Log.error(572838106,i.LogCategory.CoreDefault,"Error happened while attempting to fetch host token: "+e)}))},t.prototype.sendTokenProvisionMessage=function(e){var t=new s.TokenProvisionMessage({authToken:e});this.sendMessage(t,this.onTokenProvisionResponse.bind(this))},t.prototype.onTokenProvisionResponse=function(e,t){!e&&t&&t.tokenExpirationSeconds&&this.tokenRefreshManager.scheduleRefresh(c.TokenType.Host,t.tokenExpirationSeconds,this.initHostAuthToken.bind(this))},t}(n(10041).EventEmitter);t.SessionInitializer=u},16498:function(e){e.exports=JSON.parse('{"version":"2.18.26"}')},16499:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SingleItemWorkflow=void 0;var o=n(7596),r=function(){function e(e,t){var n,r;this.kind=o.WorkflowKind.SingleItem,this.id=e,t&&(this.inputTypes=null!==(n=t.inputTypes)&&void 0!==n?n:this.inputTypes,this.outputTypes=null!==(r=t.outputTypes)&&void 0!==r?r:this.outputTypes)}return e.create=function(t){return new e(t)},e.prototype.setInputTypes=function(e){return this.inputTypes=e,this},e.prototype.setOutputTypes=function(e){return this.outputTypes=e,this},e.prototype.setLambdaType=function(e){return this.factory=function(){return new e},this},e.prototype.setLambda=function(e,t){return this.factory=function(){return{init:t||function(e){return Promise.resolve()},execute:e,dispose:function(){}}},this},e}();t.SingleItemWorkflow=r},2936:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(7524),t),r(n(7525),t),r(n(7526),t),r(n(7527),t),r(n(7528),t),r(n(3763),t),r(n(7529),t),r(n(7530),t)},3592:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var o="EditorProofing_UpsellClicked"},3763:function(e,t,n){"use strict";var o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,r++)o[r]=i[s];return o};Object.defineProperty(t,"__esModule",{value:!0}),t.SchemaObject=void 0;var r=function(){function e(t){e.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_SchemaObject"},e.getBaseTypes=function(){return[]},e.getTypeNameFor=function(e){return e&&e.H_?e.H_.T_:void 0},e.getBaseTypesFor=function(e){return e&&e.H_&&e.H_.B_?e.H_.B_:[]},e.getAllTypesFor=function(t){var n=e.getTypeNameFor(t);return n?o([n],e.getBaseTypesFor(t)):[]},e.matchesTypesFor=function(t,n){if(!Array.isArray(n)||0===n.length)return!0;for(var o=e.getTypeNameFor(t),r=t&&t.H_&&t.H_.B_?t.H_.B_:void 0,i=0,s=n;i<s.length;i++){var a=s[i];if(a===o)return!0;if(r&&r.indexOf(a)>=0)return!0}return!1},e.assign=function(e,t,n){if(n)for(var o=0,r=Object.keys(n);o<r.length;o++){var i=r[o];t[i]=n[i]}return t.H_=e.H_,t},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SchemaObject=r},4004:function(e,t,n){"use strict";n.d(t,"f",(function(){return s})),n.d(t,"d",(function(){return a})),n.d(t,"h",(function(){return c})),n.d(t,"g",(function(){return u})),n.d(t,"c",(function(){return l})),n.d(t,"b",(function(){return p})),n.d(t,"e",(function(){return h}));var o=n(31),r=(n(3592),n(3337));n.d(t,"a",(function(){return r.a}));var i=new o.c((function(){return Promise.all([n.e(0),n.e(1),n.e(2),n.e(3),n.e(5),n.e(6),n.e(8),n.e(20),n.e(70),n.e(211),n.e(320),n.e(777)]).then(n.bind(null,6768))})),s=new o.a(i,(function(e){return e.showEditorOptions})),a=new o.a(i,(function(e){return e.getUserOptions})),c=new o.a(i,(function(e){return e.updateSettingDirectly})),u=(new o.a(i,(function(e){return e.tryStartTrial})),new o.a(i,(function(e){return e.startPremiumPreviewTimeBased}))),l=new o.a(i,(function(e){return e.getDefaultOptions})),p=new o.a(i,(function(e){return e.getAllOverriddenOptions})),h=new o.a(i,(function(e){return e.openUpsellUrlFromSettingsDialog}))},4128:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Operation=t.LoggingAggregator=t.LogCategory=t.Log=t.CorrelationVector=void 0;var o=n(16465);Object.defineProperty(t,"CorrelationVector",{enumerable:!0,get:function(){return o.CorrelationVector}});var r=n(16466);Object.defineProperty(t,"Log",{enumerable:!0,get:function(){return r.Log}}),Object.defineProperty(t,"LogCategory",{enumerable:!0,get:function(){return r.LogCategory}});var i=n(16467);Object.defineProperty(t,"LoggingAggregator",{enumerable:!0,get:function(){return i.LoggingAggregator}});var s=n(16468);Object.defineProperty(t,"Operation",{enumerable:!0,get:function(){return s.Operation}})},5235:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LogCountLimiter=t.Utils=void 0;var o=n(4128),r=function(){function e(){}return e.convertServiceUrlToWebSocket=function(e){var t=e.split(":"),n=t[0].toLowerCase();return 0==n.indexOf("http")?(n=n.replace("http","ws"),t[0]=n,t.join(":")):e},e.getCurrentTimeMs=function(){return Date.now?Date.now():(new Date).getTime()},e}();t.Utils=r;var i=function(){function e(e){this.maxNumberOfLogs=40,this.numberOfLogs=0,this.id=e}return e.prototype.log=function(e){if(this.numberOfLogs<this.maxNumberOfLogs&&(this.numberOfLogs++,e(),this.numberOfLogs===this.maxNumberOfLogs)){var t=new o.Operation({operationName:"OnLastLog",success:!0,resourceId:this.id,resultDescription:"Limit for number of logs for id: "+this.id+" reached - all next logs will be dropped"});o.Log.warn(572838107,o.LogCategory.CoreDefault,t)}},e}();t.LogCountLimiter=i},5689:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(16482),t),r(n(16485),t),r(n(11882),t)},6271:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageType=t.ExceptionType=void 0,r(n(16453),t),r(n(16454),t);var i=n(16455);Object.defineProperty(t,"ExceptionType",{enumerable:!0,get:function(){return i.ExceptionType}}),Object.defineProperty(t,"MessageType",{enumerable:!0,get:function(){return i.MessageType}}),r(n(16456),t),r(n(16457),t),r(n(16458),t),r(n(16459),t),r(n(16460),t)},718:function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],o=t[1];return 3*(n+o)/4-o},t.toByteArray=function(e){var t,n,o=u(e),s=o[0],a=o[1],c=new i(function(e,t,n){return 3*(t+n)/4-n}(0,s,a)),l=0,p=a>0?s-4:s;for(n=0;n<p;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;2===a&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,c[l++]=255&t);1===a&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t);return c},t.fromByteArray=function(e){for(var t,n=e.length,r=n%3,i=[],s=0,a=n-r;s<a;s+=16383)i.push(l(e,s,s+16383>a?a:s+16383));1===r?(t=e[n-1],i.push(o[t>>2]+o[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],i.push(o[t>>10]+o[t>>4&63]+o[t<<2&63]+"="));return i.join("")};for(var o=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)o[a]=s[a],r[s.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var r,i,s=[],a=t;a<n;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(o[(i=r)>>18&63]+o[i>>12&63]+o[i>>6&63]+o[63&i]);return s.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},7524:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationState=void 0,function(e){e[e.Undefined=0]="Undefined",e[e.Created=10]="Created",e[e.Sent=20]="Sent",e[e.Duplicated=30]="Duplicated",e[e.Seen=40]="Seen",e[e.Tried=50]="Tried",e[e.Kept=60]="Kept",e[e.Rejected=70]="Rejected"}(t.AnnotationState||(t.AnnotationState={}))},7525:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},7526:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GridConstants=t.OpenType=t.BlobRefType=void 0,function(e){e[e.None=0]="None",e[e.HttpsGetDownloadUrl=1]="HttpsGetDownloadUrl"}(t.BlobRefType||(t.BlobRefType={})),function(e){e[e.NewDocument=0]="NewDocument",e[e.EditDocument=1]="EditDocument",e[e.ViewOnlyDocument=2]="ViewOnlyDocument"}(t.OpenType||(t.OpenType={}));var o=function(){function e(){}return e.lowerIndexBound=1,e.maxNumberOfRows=1048576,e.maxNumberOfColumns=16384,e.firstColumnName="A",e.lastColumnName="XFD",e}();t.GridConstants=o},7527:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BinaryClassificationAnnotation=t.Annotation=void 0;var o=n(3763),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return Object.defineProperty(e.prototype,"metadata",{get:function(){return this.M_},set:function(e){this.M_=e},enumerable:!1,configurable:!0}),e.getTypeName=function(){return"AugLoop_Core_Annotation"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Annotation=r;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return Object.defineProperty(e.prototype,"metadata",{get:function(){return this.M_},set:function(e){this.M_=e},enumerable:!1,configurable:!0}),e.getTypeName=function(){return"AugLoop_Core_BinaryClassificationAnnotation"},e.getBaseTypes=function(){return["AugLoop_Core_Annotation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.BinaryClassificationAnnotation=i},7528:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SignalOperation=t.MicroSyncOperation=t.DeltaUpdateOperation=t.VisibilityOperation=t.FocusOperation=t.PurgeOperation=t.DeleteOperation=t.UpdateOperation=t.UpdateAnnotationMetaDataOperation=t.MoveOperation=t.AddOperation=t.OperationWithSiblingContext=t.Operation=t.ItemDelta=void 0;var o=n(3763),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_ItemDelta"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.ItemDelta=r;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Operation"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Operation=i;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_OperationWithSiblingContext"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.OperationWithSiblingContext=s;var a=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_AddOperation"},e.getBaseTypes=function(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AddOperation=a;var c=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_MoveOperation"},e.getBaseTypes=function(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.MoveOperation=c;var u=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_UpdateAnnotationMetaDataOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.UpdateAnnotationMetaDataOperation=u;var l=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_UpdateOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.UpdateOperation=l;var p=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_DeleteOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.DeleteOperation=p;var h=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_PurgeOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.PurgeOperation=h;var d=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_FocusOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.FocusOperation=d;var f=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_VisibilityOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.VisibilityOperation=f;var g=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_DeltaUpdateOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.DeltaUpdateOperation=g;var y=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_MicroSyncOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.MicroSyncOperation=y;var m=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Signals_SignalOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SignalOperation=m},7529:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Signal=void 0;var o=n(3763),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Signals_Signal"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Signal=r},7530:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DynamicContext=t.GridNeighborhoodContext=t.GridCell=t.Document=t.Session=t.TileGroup=t.Binary=t.Blob=void 0;var o=n(3763),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Blob"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Blob=r;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Binary"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Binary=i;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_TileGroup"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.TileGroup=s;var a=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Session"},e.getBaseTypes=function(){return["AugLoop_Core_TileGroup"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Session=a;var c=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Document"},e.getBaseTypes=function(){return["AugLoop_Core_TileGroup"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Document=c;var u=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_GridCell"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.GridCell=u;var l=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_GridNeighborhoodContext"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.GridNeighborhoodContext=l;var p=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_DynamicContext"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.DynamicContext=p},7596:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(11873),t),r(n(16447),t),r(n(11874),t),r(n(16448),t),r(n(16449),t),r(n(16450),t),r(n(16451),t),r(n(16452),t),r(n(16461),t),r(n(16462),t),r(n(16463),t),r(n(16464),t),r(n(11875),t)},967:function(e,t,n){"use strict";function o(e){if(this._capacity=i(e),this._length=0,this._front=0,r(e)){for(var t=e.length,n=0;n<t;++n)this[n]=e[n];this._length=t}}o.prototype.toArray=function(){for(var e=this._length,t=new Array(e),n=this._front,o=this._capacity,r=0;r<e;++r)t[r]=this[n+r&o-1];return t},o.prototype.push=function(e){var t=arguments.length,n=this._length;if(t>1){var o=this._capacity;if(n+t>o){for(var r=0;r<t;++r){this._checkCapacity(n+1),this[i=this._front+n&this._capacity-1]=arguments[r],n++,this._length=n}return n}for(var i=this._front,r=0;r<t;++r)this[i+n&o-1]=arguments[r],i++;return this._length=n+t,n+t}return 0===t?n:(this._checkCapacity(n+1),this[r=this._front+n&this._capacity-1]=e,this._length=n+1,n+1)},o.prototype.pop=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1,n=this[t];return this[t]=void 0,this._length=e-1,n}},o.prototype.shift=function(){var e=this._length;if(0!==e){var t=this._front,n=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,n}},o.prototype.unshift=function(e){var t=this._length,n=arguments.length;if(n>1){if(t+n>(r=this._capacity)){for(var o=n-1;o>=0;o--){this._checkCapacity(t+1);var r=this._capacity;this[s=(this._front-1&r-1^r)-r]=arguments[o],t++,this._length=t,this._front=s}return t}var i=this._front;for(o=n-1;o>=0;o--){var s;this[s=(i-1&r-1^r)-r]=arguments[o],i=s}return this._front=i,this._length=t+n,t+n}if(0===n)return t;this._checkCapacity(t+1);r=this._capacity;return this[o=(this._front-1&r-1^r)-r]=e,this._length=t+1,this._front=o,t+1},o.prototype.peekBack=function(){var e=this._length;if(0!==e)return this[this._front+e-1&this._capacity-1]},o.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},o.prototype.get=function(e){var t=e;if(t===(0|t)){var n=this._length;if(t<0&&(t+=n),!(t<0||t>=n))return this[this._front+t&this._capacity-1]}},o.prototype.isEmpty=function(){return 0===this._length},o.prototype.clear=function(){for(var e=this._length,t=this._front,n=this._capacity,o=0;o<e;++o)this[t+o&n-1]=void 0;this._length=0,this._front=0},o.prototype.toString=function(){return this.toArray().toString()},o.prototype.valueOf=o.prototype.toString,o.prototype.removeFront=o.prototype.shift,o.prototype.removeBack=o.prototype.pop,o.prototype.insertFront=o.prototype.unshift,o.prototype.insertBack=o.prototype.push,o.prototype.enqueue=o.prototype.push,o.prototype.dequeue=o.prototype.shift,o.prototype.toJSON=o.prototype.toArray,Object.defineProperty(o.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),o.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(i(1.5*this._capacity+16))},o.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var n=this._front,o=this._length;n+o>t&&function(e,t,n,o,r){for(var i=0;i<r;++i)n[i+o]=e[i+t],e[i+t]=void 0}(this,0,this,t,n+o&t-1)};var r=Array.isArray;function i(e){if("number"!=typeof e){if(!r(e))return 16;e=e.length}return t=Math.min(Math.max(16,e),1073741824),t>>>=0,t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16);var t}e.exports=o}}]);
//# sourceMappingURL=owa.MailBoot~OwaRoamingDictionary~ProofingPlugin.js.map
self.scriptsLoaded['owa.MailBoot~OwaRoamingDictionary~ProofingPlugin.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~OwaRoamingDictionary~ProofingPlugin.js'] = (new Date()).getTime();