self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailFolderNotifications.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[922],{18373:function(e,n,i){"use strict";i.r(n);var t=i(1),a={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"subscribeToHierarchyNotifications"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"subscribeToHierarchyNotifications"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"EventType"}},{kind:"Field",name:{kind:"Name",value:"folderId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"parentFolderId"}},{kind:"Field",name:{kind:"Name",value:"itemCount"}},{kind:"Field",name:{kind:"Name",value:"unreadCount"}}]}}]}}]},d=i(1250),o=i(2314),r=i(3147),l=i(3455),c=i(4246),u=i(613),s=i(3257),m=i(979),F=i(4364),k=i(180),f=i(1244);function v(){var e=Object(c.a)({FolderShape:Object(s.a)({BaseShape:"IdOnly",AdditionalProperties:[Object(m.a)({FieldURI:"TotalCount"}),Object(m.a)({FieldURI:"UnreadCount"})]}),Paging:null,ParentFolderIds:[Object(u.a)({Id:Object(f.a)("msgfolderroot")})],ReturnParentFolder:!0,ShapeName:null,Traversal:"Deep"});return Object(F.a)({Header:Object(k.b)(),Body:e}).then((function(e){var n,i,t;return null===(t=null===(i=null===(n=null==e?void 0:e.Body)||void 0===n?void 0:n.ResponseMessages)||void 0===i?void 0:i.Items)||void 0===t?void 0:t[0]}))}var b=i(23);function N(e){switch(e.EventType){case"Reload":case"QueryResultChanged":v().then((function(e){"Success"==(null==e?void 0:e.ResponseClass)?e.RootFolder.Folders.forEach((function(e){Object(l.a)(e.UnreadCount,e.TotalCount,e.FolderId.Id,!1)})):b.g.warn(j+"ResponseNotSuccess")})).catch((function(e){b.g.warn(j+":"+e.message)}));break;case"RowModified":Object(r.b)(e.unreadCount,e.itemCount,e.folderId,e.displayName,e.parentFolderId),o.h.import().then((function(n){n(e)}));break;case"RowAdded":Object(r.a)(e.folderId,e.parentFolderId,e.displayName,e.unreadCount,e.itemCount),o.h.import().then((function(n){n(e)}));break;default:return}}function h(){return Object(t.c)(this,void 0,void 0,(function(){var e;return Object(t.f)(this,(function(n){switch(n.label){case 0:return[4,Object(d.a)()];case 1:return e=n.sent(),e.subscribe({query:a}).subscribe({next:function(e){return N(e.data.subscribeToHierarchyNotifications)},error:function(e){b.g.warn("Hierarchy notification error "+e)}}),[2]}}))}))}var j="UpdateFolderCountsAction:";var O={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"FolderUpdateNotification"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"UnreadCount"}},{kind:"Field",name:{kind:"Name",value:"TotalCount"}},{kind:"Field",name:{kind:"Name",value:"DisplayName"}},{kind:"Field",name:{kind:"Name",value:"ParentFolderId"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"Id"}},{kind:"Field",name:{kind:"Name",value:"ChangeKey"}}]}}]}}]},p={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"NewFolder"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"FolderId"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"Id"}},{kind:"Field",name:{kind:"Name",value:"ChangeKey"}}]}},{kind:"Field",name:{kind:"Name",value:"ParentFolderId"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"Id"}},{kind:"Field",name:{kind:"Name",value:"ChangeKey"}}]}},{kind:"Field",name:{kind:"Name",value:"DisplayName"}},{kind:"Field",name:{kind:"Name",value:"DistinguishedFolderId"}},{kind:"Field",name:{kind:"Name",value:"FolderClass"}},{kind:"Field",name:{kind:"Name",value:"UnreadCount"}},{kind:"Field",name:{kind:"Name",value:"TotalCount"}},{kind:"Field",name:{kind:"Name",value:"hasChildren"}},{kind:"Field",name:{kind:"Name",value:"childFolderIds"}}]}}]},I=i(31),g=i(6643),C=i(12),y=i(4727),S=Object(I.e)(r.a,"onNewFolderNotificationClone",(function(e){return Object(t.c)(void 0,void 0,void 0,(function(){var n,i,a,o,r,l,c;return Object(t.f)(this,(function(u){switch(u.label){case 0:return Object(C.h)("gqlfolders")?(n=e.displayName,i=e.parentFolderId,a=e.folderId,o=e.unreadCount,r=e.totalCount,[4,Object(g.a)(i,a)]):[2];case 1:return(l=u.sent())?[4,Object(d.a)()]:[2];case 2:return(c=u.sent()).writeFragment({id:Object(y.a)(a,c),fragment:p,data:{id:a,UnreadCount:o,TotalCount:r,DisplayName:n,FolderId:{Id:a,ChangeKey:null},ParentFolderId:Object(t.a)({},l),DistinguishedFolderId:null,childFolderIds:[],hasChildren:!1,type:"Folder:#Exchange",FolderClass:"IPF.Note",__typename:"MailFolder"}}),[2]}}))}))})),w=Object(I.e)(r.b,"onUpdateFolderNotificationClone",(function(e){return Object(t.c)(void 0,void 0,void 0,(function(){var n,i,a,o,r,l,c,u;return Object(t.f)(this,(function(t){switch(t.label){case 0:return Object(C.h)("gqlfolders")?(n=e.folderId,i=e.unreadCount,a=e.totalCount,o=e.displayName,r=e.parentFolderId,[4,Object(d.a)()]):[2];case 1:return l=t.sent(),(c=l.readFragment({id:Object(y.a)(n,l),fragment:O}))?[4,Object(g.a)(r,n)]:[2];case 2:return(u=t.sent())?(c&&l.writeFragment({id:Object(y.a)(n,l),fragment:O,data:{UnreadCount:i,TotalCount:a,DisplayName:o,ParentFolderId:u}}),[2]):[2]}}))}))}));i.d(n,"subscribeToHierarchyNotification",(function(){return h})),i.d(n,"onNewFolderNotificationOrchestrator",(function(){return S})),i.d(n,"onUpdateFolderNotificationOrchestrator",(function(){return w}))},3257:function(e,n,i){"use strict";i.d(n,"a",(function(){return a}));var t=i(1);function a(e){return Object(t.a)({__type:"FolderResponseShape:#Exchange"},e)}},4246:function(e,n,i){"use strict";i.d(n,"a",(function(){return a}));var t=i(1);function a(e){return Object(t.a)({__type:"FindFolderRequest:#Exchange"},e)}},4364:function(e,n,i){"use strict";var t=i(33),a=i(1);function d(e,n){var i;return void 0===e||e.__type||(i=e,e=Object(a.a)({__type:"FindFolderJsonRequest:#Exchange"},i)),Object(t.a)("FindFolder",e,n)}i.d(n,"a",(function(){return d}))},4727:function(e,n,i){"use strict";function t(e,n){var i={__typename:"MailFolder",id:e};return n.cache.identify(i)}i.d(n,"a",(function(){return t}))},5655:function(e,n,i){"use strict";i.d(n,"a",(function(){return t})),i.d(n,"b",(function(){return a}));var t={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"FolderChildFolderIds"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"childFolderIds"}},{kind:"Field",name:{kind:"Name",value:"hasChildren"}},{kind:"Field",name:{kind:"Name",value:"FolderId"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"Id"}},{kind:"Field",name:{kind:"Name",value:"ChangeKey"}}]}}]}}]},a={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"FolderParentFolder"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"ParentFolderId"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"Id"}}]}}]}}]}},6643:function(e,n,i){"use strict";i.d(n,"a",(function(){return l}));var t=i(1),a=i(5655),d=i(1250),o=i(4727),r=i(6644);function l(e,n){return Object(t.c)(this,void 0,void 0,(function(){var i,l,c;return Object(t.f)(this,(function(u){switch(u.label){case 0:return[4,Object(d.a)()];case 1:return i=u.sent(),[4,Object(r.a)(n,e)];case 2:return u.sent(),(l=i.readFragment({id:Object(o.a)(e,i),fragment:a.a}))?((c=l.childFolderIds).includes(n)||i.writeFragment({id:Object(o.a)(e,i),fragment:a.a,data:{childFolderIds:Object(t.j)(Object(t.j)([],Object(t.g)(c)),[n]),hasChildren:!0,FolderId:l.FolderId}}),[2,l.FolderId]):[2,null]}}))}))}},6644:function(e,n,i){"use strict";i.d(n,"a",(function(){return r}));var t=i(1),a=i(5655),d=i(1250),o=i(4727);function r(e,n){return Object(t.c)(this,void 0,void 0,(function(){var i,r,l,c,u,s;return Object(t.f)(this,(function(m){switch(m.label){case 0:return[4,Object(d.a)()];case 1:return i=m.sent(),(r=i.readFragment({id:Object(o.a)(e,i),fragment:a.b}))?(l=r.ParentFolderId.Id)==n?[2]:(c=i.readFragment({id:Object(o.a)(l,i),fragment:a.a}))?(u=Object(t.j)([],Object(t.g)(c.childFolderIds)),(s=u.indexOf(e))>-1&&(u.splice(s,1),i.writeFragment({id:Object(o.a)(l,i),fragment:a.a,data:{childFolderIds:Object(t.j)([],Object(t.g)(u)),hasChildren:u.length>0,FolderId:c.FolderId}})),[2]):[2,null]:[2]}}))}))}}}]);
//# sourceMappingURL=owa.MailFolderNotifications.js.map
self.scriptsLoaded['owa.MailFolderNotifications.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailFolderNotifications.js'] = (new Date()).getTime();