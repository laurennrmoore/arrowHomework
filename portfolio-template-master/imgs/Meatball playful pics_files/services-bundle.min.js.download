!function(e){function t(t){for(var i,s,a=t[0],c=t[1],u=t[2],p=0,d=[];p<a.length;p++)s=a[p],r[s]&&d.push(r[s][0]),r[s]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);for(l&&l(t);d.length;)d.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],i=!0,a=1;a<n.length;a++){var c=n[a];0!==r[c]&&(i=!1)}i&&(o.splice(t--,1),e=s(s.s=n[0]))}return e}var i={},r={8:0},o=[];function s(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=i,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var a=window.swcJsonp=window.swcJsonp||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var u=0;u<a.length;u++)t(a[u]);var l=c;o.push([595,0]),n()}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(56),r=window;t.swcWindow=r,r.swc=r.swc||r.SkypeWebControl||{};var o=r.swc;t.swc=o,r.swc.shared=r.swc.shared||{},r.swc.scriptLoader=r.swc.scriptLoader||new i.ScriptLoader,r.SKYPE=r.SKYPE||{},r.SkypeWebControl=r.swc,r.swc.vendors=r.swc.vendors||{},t.SKYPE=r.SKYPE||{}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(51),s=n(18),a=function(){function e(){}return Object.defineProperty(e,"ECS",{get:function(){return i({},{frameless:""},r.swc.EcsConfig)},set:function(e){r.swc.EcsConfig=e},enumerable:!0,configurable:!0}),e.getPlatformId=function(){return o.PlatformUtils.getPlatformId()},e.getPlatformName=function(){return o.PlatformUtils.getPlatformName()},e.getClientVersion=function(){if(e.CLIENT_VERSION!==e.DEFAULT_CLIENT_VERSION)return e.CLIENT_VERSION;for(var t=e.ECS.version.split("."),n=t.length,i=0;i<4-n;i++)t.splice(t.length-1,0,"0");return e.CLIENT_VERSION=e.getPlatformId()+"/"+t.join("."),e.CLIENT_VERSION},e.getVersion=function(){if(e.VERSION!==e.DEFAULT_VERSION)return e.VERSION;for(var t=e.ECS.version.split("."),n=t.length,i=0;i<4-n;i++)t.splice(t.length-1,0,"0");return e.VERSION=t.join("."),e.VERSION},e.getChatClientInfo=function(){if(this.CHAT_CLIENT_INFO)return this.CHAT_CLIENT_INFO;var t=r.swc.EcsHeaderConfig&&r.swc.EcsHeaderConfig.CountryCode?r.swc.EcsHeaderConfig.CountryCode:"NR";return this.CHAT_CLIENT_INFO="os=Windows; osVer=10; proc=Win32; lcid=en-us; deviceType=1; country="+t+"; clientName=swc; clientVer="+e.getUiVersion(),this.CHAT_CLIENT_INFO},e.getUiVersion=function(){return this.UI_VERSION?this.UI_VERSION:(this.UI_VERSION=e.getClientVersion()+"//swc",this.UI_VERSION)},e.getClientInfo=function(){if(this.SYSTEM_INFO)return this.SYSTEM_INFO;var t=s.UNKNOWN_VERSION;try{t=window.navigator.platform}catch(e){}return this.SYSTEM_INFO=e.getUiVersion()+"os="+s.default.getOsName()+"; osVer="+s.default.getOsVersion()+"; proc="+t+"; deviceType="+s.default.getDeviceType()+"; browser="+s.default.getBrowserName()+"; browserVer="+s.default.getBrowserVersion(),this.SYSTEM_INFO},e.APPNAME="SWC",e.LOCALE="en-us",e.PES_LOCALE="en",e.ORIGIN="SkypeLWC",e.ORIGIN_CALLING="SkypeCalling",e.MSG_MAX_LENGTH=2e3,e.PLATFORM_ID=912,e.BUTTON_MARKER_CLASS=".skype-button",e.CHAT_MARKER_CLASS=".skype-chat",e.RECENTS_MARKER_CLASS=".skype-recents",e.LOGIN_CLIENT_ID="919866",e.LOGIN_PAGE_URL="https://login.skype.com/login",e.LOGIN_THEME="skype-white",e.LOGOUT_PAGE_URL="https://login.skype.com/logout",e.LOGIN_POPUP_URL="https://demoplayground.skype.com/joinlwc?t=",e.LOGIN_POPUP_FEATURES="width=600, height=620, menubar=no, status=no, titlebar=no, toolbar=no",e.LOGOUT_POPUP_FEATURES="width=1, height=1, menubar=no, status=no, titlebar=no, toolbar=no",e.TEAMS_URL="https://api.teams.skype.com/",e.TEAMS_AUTH_URL="https://authsvc.teams.microsoft.com/v1.0",e.TEAMS_PROFILE_URL="https://teams.microsoft.com/",e.TEAMS_MIDDLE_TIER_URL="https://teams.microsoft.com/api/mt/amer",e.TEAMS_CSA_URL="https://chatsvcagg.teams.microsoft.com",e.SHAREPOINT_URL="https://microsoft-my.sharepoint.com/",e.AMS_HOST_URL="https://api.asm.skype.com/v1/",e.APS_HOST_URL="https://api.aps.skype.com/v1/",e.CDN_SERVICE_HOST="secure.skypeassets.com",e.OA_URL="https://pro.skype.com/v1/onboarding",e.OA_URL_INT="https://havana-latest.skype.com/v1/onboarding",e.URLP_SERVICE_URL="https://urlp.asm.skype.com",e.ECS_GRAPH_URL="https://skypegraph.skype.com/",e.MS_GRAPH_URL="https://graph.microsoft.com/v1.0/me/",e.MS_APP_CLIENT_ID="b8d5facb-2aee-4653-98cb-4acc8f0d0e97",e.MS_APP_REDIRECT_URL_DEMO="https://latest-swc.cdn.skype.com/demo/connect.html",e.MS_APP_REDIRECT_URL_OUTLOOK="https://latest-swc.cdn.skype.com/demo/msauth.html",e.MS_AUTHORIZE_URL="https://login.microsoftonline.com/common/oauth2/v2.0/authorize",e.ECS_GRAPH_ETAG=null,e.ECS_GRAPH_SERVICE_SETTINGS=null,e.INVITE_HOST_URL_INT="https://latest-join.skype.com/api/v1/",e.INVITE_HOST_URL="https://join.skype.com/api/v1/",e.CHAT_CLIENT_INFO="",e.CHAT_GUEST_HOST_URL="https://client-s.gateway.messenger.live.com/v1/",e.CHAT_HOST_URL="https://client-s.gateway.messenger.live.com/v1/",e.CHAT_JOIN_URL="https://latest-join.skype.com/api/v2/conversation",e.SKYPE_CALLER_ID="lwc",e.CONTACTS_HOST_URL="https://edge.skype.com/pcs-df/contacts/v2/",e.CONTACTS_SCD_HOST_URL="https://scd.skype.com/contacts/v3/",e.AGENTS_HOST_URL="https://join.skype.com/",e.AVATAR_SERVICE_URL="https://avatar.skype.com/v1/",e.STRATUS_DOMAIN_HOST_URL="https://profile.skype.com/profile/v1/",e.WX_HOST_URL="https://wx.skype.com/api/v1/scom/",e.USER_OPTIONS_SERVICE={OLD:"https://options.skype.com/",PROD:"https://edge.skype.com/",INT:"https://optionsservice-test-northeurope.cloudapp.net:443/"},e.ECS_CLIENT_NAME="skype",e.ECS_TEAM_NAME="lwc",e.ECS_CLIENT_VERSION="1.00",e.GET_HELP_URL="https://support.skype.com/en/faq/FA34704/what-is-skype-web-control",e.PRIVACY_AND_COOKIES_URL="https://go.microsoft.com/fwlink/?LinkId=521839",e.TERMS_OF_USE_URL="https://go.microsoft.com/fwlink/?LinkID=246338",e.CONCIERGE_BOT_MRI="28:concierge",e.CONCIERGE_BOT_DF_MRI="28:concierge_df",e.BRB_BOT_MRI="28:a62068e3-63e9-4ffc-89a6-14d841e224d2",e.BRB_BOT_MRI_TEAMS="28:5932bde2-77dd-4eb7-a704-d1da88e37485",e.BRB_START_MESSAGE="Sending feedback details...",e.NEW_CHAT_COMPOSER_ID="newChatComposerId",e.DEFAULT_VERSION="0.0.0.0",e.DEFAULT_CLIENT_VERSION=e.getPlatformId()+"/"+e.DEFAULT_VERSION,e.CLIENT_VERSION=e.DEFAULT_CLIENT_VERSION,e.VERSION=e.DEFAULT_VERSION,e.DEFAULT_AVATAR_URI="https://swc.cdn.skype.com/assets/img/defaultAvatar.png",e.MSG_DELETED_CLASSIC_SKYPE="Edited previous message: ",e.UI_VERSION="",e.SYSTEM_INFO="",e.MESSAGE_PROPERTIES={GLOBAL:{ACTIVITY_DATA:"activityData",PINNED:"pinned",PROTOTYPE_SKYPEX:"prototype_skypex"},PER_USER:{EMOTIONS:"emotions",POLL:"poll",TRANSLATIONS:"translations",ACTIVITY_DATA:"activityData",SMS_REPORT:"smsdeliveryreports"}},e.CHAT_SERVICE_COMMANDS={SET_MESSAGE_PROPERTY:"setMessageProperty",REMOVE_MESSAGE_PROPERTY:"removeMessageProperty",REMOVE_ALL_MESSAGES:"removeAllMessage",SET_IS_FAVORITE:"setIsFavorite",SMS_PRICE:"getSmsPrice"},e}();t.Configuration=a},,function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(88),s=n(13),a=n(16),c=n(0),u=n(97),l=function(e){function t(){var t=e.call(this)||this;return t.sessionId="",t.backend=a.MessagingBackend.UNDETERMINED,t.style="",t.translatorEnabled=!1,t.frameless=!1,t.callingReady=!1,t.standaloneCalling=!1,t.largeEmoticonClass=!1,t.isParallelView=!1,t.parentProtocol="n/a",t.bridge(),t}return r(t,e),Object.defineProperty(t,"get",{get:function(){return c.swc.shared.app||(c.swc.shared.app=new t),c.swc.shared.app},enumerable:!0,configurable:!0}),t.prototype.getCurrentLocale=function(e){return u.LocaleInfo.instance.getLocale(e)},t.prototype.copy=function(e){e&&Object.getOwnPropertyNames(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);i&&i.writable&&(t[n]=i.value||t[n])})},t.prototype.isTeams=function(){return this.backend===a.MessagingBackend.TEAMS},Object.defineProperty(t.prototype,"theme",{get:function(){return this._theme},set:function(e){e!==this._theme&&(this._theme=e,this.publish("theme",e))},enumerable:!0,configurable:!0}),t.prototype.bridge=function(){var e=this;c.swc.Eventing.registerEvent(o.ApiEventsBridgeTheme.response,function(t){return e.theme=t}),c.swc.Eventing.triggerEvent(o.ApiEventsBridgeTheme.request)},t}(s.default);t.default=l},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(43)),i(n(64)),i(n(65)),i(n(66)),i(n(67)),i(n(68))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(1),o=n(21),s=n(178),a=n(179),c=n(129),u=n(151),l=n(11),p=n(24),d=n(0),f=n(166),h=n(180),g=n(182),m=n(185),v=n(188),y=n(130),_=n(131),b=n(190),T=n(193),S=n(132),w=n(196),P=n(199),C=n(201),E=n(202),O=n(204),I=n(135),M=n(207),k=n(137),A=n(209),R=n(210),N=n(211),L=n(165),D=n(115),U=n(214),x=n(217),F=n(218),j=n(219),H=n(222),B=n(150),G=n(223),z=n(139),W=n(235),V=n(236),q=n(240),K=n(243),J=n(246),Y=n(247),Q=n(250),X=n(251),$=n(253),Z=n(254),ee=n(255),te=n(257),ne=n(167),ie=n(263),re=n(265),oe=n(266),se=n(275),ae=n(309),ce=n(310),ue=function(){function e(){this.activeEndpoints=[]}return Object.defineProperty(e,"unreadCounterStore",{get:function(){return this._unreadCounterStore||(this._unreadCounterStore=new J.UnreadCounterStore(e.mePerson.mri)),this._unreadCounterStore},enumerable:!0,configurable:!0}),e.ready=function(){try{return e.initPromise.then(function(){return e})}catch(e){return Promise.reject("Initialize services first")}},Object.defineProperty(e,"initPromise",{get:function(){return e._initPromise.promise},enumerable:!0,configurable:!0}),e.setExternalLogin=function(t){e._externalLogin||(e._externalLogin=t)},Object.defineProperty(e,"presenceService",{get:function(){return N.UnifiedPresenceService},enumerable:!0,configurable:!0}),e.completePostSignInActions=function(t,n){n.userSettings&&n.userSettings.forceDisplayName&&e.mePerson.forceDisplayName(n.userSettings.forceDisplayName),i.default.get.isTeams()?e.signInManager&&e.signInManager.isAadSupported()&&e.presenceService.startPolling():e.contactsManager.fetchMyContacts(),(new R.PresenceProxyOperator).registerServices(),e.notificationSettingsStore.registerProxy(),e.unreadCounterStore.subscribe(function(e){d.swc.Eventing.triggerEvent("unreadConversationsUpdate",e,null,!0)});var r=function(){return d.swc.Eventing.triggerEvent("swc:recents:loaded")};e.conversations.prefetchRecents().then(function(t){r();var n=[];Object.keys(e.conversations.getAll()).forEach(function(t){var i=e.conversations.get(t);i.isUnread&&n.push(i)}),e.notificationsManager.enableNotifications(),e.notificationsManager.registerUnreadIConversationsSummary(n)}).catch(function(e){r()}).then(function(){return e._polling});var o=t||i.default.get.getCurrentLocale(),s=window.document.dir.length>0?window.document.dir:"ltr";e.signInManager.isAadSupported()&&e.avatarService,d.swc.Telemetry&&(d.swc.Telemetry.Context.ServiceManager.setUsername(e.signInManager.currentUserName),d.swc.Telemetry.Context.ServiceManager.setGuest(e.signInManager.userIdentityType===p.IdentityType.GUEST),d.swc.Telemetry.Context.ServiceManager.setIdentityType(e.signInManager.userIdentityType),d.swc.Telemetry.Context.ServiceManager.setCommercial(e.signInManager.isAadSupported()),d.swc.Telemetry.Context.ServiceManager.setLanguage(o),d.swc.Telemetry.Context.ServiceManager.setRTLMode(s),d.swc.Telemetry.Context.ServiceManager.setBackend(i.default.get.backend),d.swc.Telemetry.Context.ServiceManager.setIsFrame(!i.default.get.frameless))},e.readyAndSignedIn=function(){var t=e.signInManager;return t.onceSignedIn().then(function(){return t.isAadSupported()?D.TokenType.Aad:D.TokenType.Skype})},Object.defineProperty(e,"teamsMiddleTier",{get:function(){return e._teamsMiddleTierPromise||(e._teamsMiddleTierPromise=e.readyAndSignedIn().then(function(t){return t===D.TokenType.Aad?new C.TeamsMiddleTierClient(r.Configuration.TEAMS_MIDDLE_TIER_URL,e.signInManager.aad):Promise.reject("Not supported for Consumer")})),e._teamsMiddleTierPromise},enumerable:!0,configurable:!0}),Object.defineProperty(e,"teamsChatServiceAggregatorClient",{get:function(){return!e._teamsChatServiceAggregatorClient&&e.signInManager.isAadSupported()&&(e._teamsChatServiceAggregatorClient=new P.ChatServiceAggregatorClient(r.Configuration.ECS.teamsCsaUrl||r.Configuration.TEAMS_CSA_URL,e.signInManager.aad,r.Configuration.ECS.teamsCsaHeaders)),e._teamsChatServiceAggregatorClient},enumerable:!0,configurable:!0}),Object.defineProperty(e,"userService",{get:function(){return e._userService||(e._userService=e.readyAndSignedIn().then(function(){return e.teamsMiddleTier.then(function(e){return new ie.UserService(e)})})),e._userService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"i18n",{get:function(){return e._i18n},enumerable:!0,configurable:!0}),Object.defineProperty(e,"signInManager",{get:function(){return e._skypeSignInManager?e._skypeSignInManager:null},enumerable:!0,configurable:!0}),Object.defineProperty(e,"agentsManager",{get:function(){return this._agentsManager||(this._agentsManager=new a.SkypeAgentsManager),this._agentsManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"cbl",{get:function(){if(!this._cbl){var e=d.swc.SDK.platformId,t=new oe.CblManager;this._cbl=t.get(e)}return this._cbl},enumerable:!0,configurable:!0}),Object.defineProperty(e,"sessionStorage",{get:function(){return K.getSessionStorage()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"polling",{get:function(){return e._polling||(i.default.get.isTeams()?(e._polling=w.getTeamsPolling(),e._polling.start(),r.Configuration.ECS.isLongPollTabActivationEnabled&&r.Configuration.ECS.cnsPollingDisabled&&T.enableLongPollTabActivation(w.getTeamsPolling())):e._polling=new S.Polling),e._polling},enumerable:!0,configurable:!0}),Object.defineProperty(e,"localStorage",{get:function(){return K.getLocalStorage()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"conversations",{get:function(){return e._conversationsManager||(e._conversationsManager=new se.default),e._conversationsManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"viewports",{get:function(){return e._viewports||(e._viewports=new re.ViewportManager)},enumerable:!0,configurable:!0}),Object.defineProperty(e,"teamsGraphService",{get:function(){return new X.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"skypeGraphService",{get:function(){return new q.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"microsoftGraphService",{get:function(){return new j.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"stratusService",{get:function(){return e._stratusService||(e._stratusService=i.default.get.isTeams()?new Q.default:new Y.default),e._stratusService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"amsManager",{get:function(){if(!e._amsManager)if(i.default.get.isTeams()){var t=!(!e._options||!e._options.fileSharing)&&!!e._options.fileSharing.forceEnterpriseAms;e._amsManager=new u.TeamsAmsManager(new V.SharepointService,new h.AmsService,t)}else e._amsManager=new c.SkypeAmsManager(new h.AmsService);return e._amsManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"webApi",{get:function(){return this._webApi},enumerable:!0,configurable:!0}),Object.defineProperty(e,"pesManager",{get:function(){return e._pesManager||(i.default.get.isTeams()?e._pesManager=new W.default:e._pesManager=new z.default),e._pesManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"mePersonManager",{get:function(){return e._mePersonManager||(e._mePersonManager=new s.default),e._mePersonManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"contactsManager",{get:function(){return e._contactsManager||(e._contactsManager=new M.SkypeContactsManager),e._contactsManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"searchManager",{get:function(){return e._searchManager||(i.default.get.isTeams()?e._searchManager=new A.TeamsSearchManager:e._searchManager=new k.default),e._searchManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"persons",{get:function(){return e._persons||(e._persons=new ae.default),e._persons},enumerable:!0,configurable:!0}),Object.defineProperty(e,"botsService",{get:function(){return new U.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"agentsService",{get:function(){return e._agentsService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"contactsService",{get:function(){return e._contactsService||(e._contactsService=i.default.get.isTeams()?new O.default:new I.default),e._contactsService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"userOptionsService",{get:function(){return e._userOptionsService||(e._userOptionsService=new te.UserOptionsService),e._userOptionsService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"notificationSettingsStore",{get:function(){return e._notificationSettingsStore||(e._notificationSettingsStore=new H.default),e._notificationSettingsStore},enumerable:!0,configurable:!0}),Object.defineProperty(e,"trouterService",{get:function(){return e._trouterService||(e._trouterService=new ee.Trouter),e._trouterService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"capabilitiesService",{get:function(){if(!e._capabilitiesService){var t=e.signInManager.aad;if(e.signInManager.isAadSupported()){var n=new ne.TeamsUserPolicyService(t,new f.LocalCacheStorage(e.signInManager.currentUserName));e._capabilitiesService=new v.TeamsCapabilitiesService(n)}else e._capabilitiesService=new y.SkypeCapabilitiesService}return e._capabilitiesService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"outlookContactsService",{get:function(){return e._outlookContactsService||(e._outlookContactsService=new E.default),e._outlookContactsService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"translatorService",{get:function(){return Z.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"oa",{get:function(){return G},enumerable:!0,configurable:!0}),Object.defineProperty(e,"wx",{get:function(){return e._wx},enumerable:!0,configurable:!0}),Object.defineProperty(e,"mePerson",{get:function(){return e._mePerson},enumerable:!0,configurable:!0}),Object.defineProperty(e,"notificationsManager",{get:function(){return e._notificationsManager||(e._notificationsManager=new B.default),e._notificationsManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"avatarService",{get:function(){return e._avatarService||(e._avatarService=new m.default),e._avatarService},enumerable:!0,configurable:!0}),e.setEverOpenedChats=function(t){e._everOpenedChats=t},e.signinStateHandler=function(){switch(this.signInManager.state){case o.SigninState.SignedOut:this.webApi.reset(),this.persons.dispose(),this._mePerson=null;break;case o.SigninState.SignedIn:this._mePerson||(this._mePerson=new F.default("8:"+this.signInManager.currentUserName))}},e.recentVisibilityHandler=function(t){if(e._isRecentsVisible=t,t){var n=Date.now().toString();e.localStorage.setItem("swc-recentslastseen",n),this._webApi.startEndpointActivation()}else e.isActive()||this._webApi.stopEndpointActivation()},e.chatShownHandler=function(t,n){if(n&&n.currentConversationId){if(t)return e._isChatShown=!0,void this.webApi.startEndpointActivation();e._isChatShown=!1;for(var i=Object.getOwnPropertyNames(e._everOpenedChats),r=0;r<i.length;r++){if(e._everOpenedChats[i[r]].onStage){e._isChatShown=!0;break}}e._isChatShown?this.webApi.startEndpointActivation():e.isActive()||this.webApi.stopEndpointActivation()}},e.focusHandler=function(t){e._isFocused=t,e._isFocused?this.webApi.startEndpointActivation():e.isActive()||this.webApi.stopEndpointActivation()},e.callingStateHandler=function(t){var n=!1;if(t)switch(t.status){case 2:case 3:case 4:case 9:n=!0}e._isInCall=n,n?this.webApi.startEndpointActivation():e.isActive()||this.webApi.stopEndpointActivation()},e.updateListOfActiveEndpoints=function(e){},e.isActive=function(){return(e._isInCall||e._isFocused)&&(e._isRecentsVisible||e._isChatShown)},e._isInitialized=!1,e._everOpenedChats={},e._wx=new x.WX,e._agentsService=new g.default,e._pesInitialized=!1,e.isZombie=!0,e.initManagers=function(t,n,r){if(e._initPromise=e._initPromise||new l.CancelablePromise,e._isInitialized)return e.initPromise;e._isInitialized=!0;var o=[Promise.resolve()];return e._i18n||(e._i18n=new L.I18N),o.push(e._i18n.init(t||i.default.get.getCurrentLocale())),e._options=r,e._skypeSignInManager||(e._skypeSignInManager=new ce.default(n.tokenProvider,n.initialToken,n.externalLogin||e._externalLogin,n.tokenType,n.enterpriseAuth),e.signInManager.subscribe("state",e.signinStateHandler.bind(e))),e._webApi||(i.default.get.isTeams()?e._webApi=new b.ConversationTeamsWebApi(e.teamsChatServiceAggregatorClient):e._webApi=new _.ConversationConsumerWebApi),e.notificationsManager.disableNotifications(),e.signInManager.onceSignedIn().then(function(){e.completePostSignInActions(t,r)}),d.swc.Eventing.registerEvent("inappActivityStarted",$.reportInappActivityStartEvent),d.swc.Eventing.registerEvent("recentsShown",function(){return e.recentVisibilityHandler(!0)}),d.swc.Eventing.registerEvent("recentsHidden",function(){return e.recentVisibilityHandler(!1)}),d.swc.Eventing.registerEvent("onControlShow",function(t){return e.chatShownHandler(!0,t)}),d.swc.Eventing.registerEvent("onControlHide",function(t){return e.chatShownHandler(!1,t)}),d.swc.Eventing.registerEvent("onControlClose",function(t){return e.chatShownHandler(!1,t)}),d.swc.Eventing.registerEvent("onFocused",function(t){return e.focusHandler(t)}),d.swc.Eventing.registerEvent("callStatusChanged",function(t){e.callingStateHandler(t),e.notificationsManager.callStateHandler(t)}),Promise.all(o).then(function(){e._initPromise.resolve()}),e._initPromise.promise},e.initPesManager=function(){e._pesInitialized||(e.signInManager.onceSignedIn().then(function(){e.pesManager.init()}),e._pesInitialized=!0)},e._isRecentsVisible=!1,e._isChatShown=!1,e._isFocused=!1,e._isInCall=!1,e}();t.ServicesManager=ue},,function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getComposedBlockClassName=function(){var e=this.blockClassName;return this.props.className&&(e+=" "+this.props.className),e},t}(n(6).Component);t.SwcBaseComponent=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(){function e(){}return e.throwError=function(e,t,n,r){var o=new Error(function(){if(!n||0===Object.getOwnPropertyNames(n).length)return e+(t?": "+t:"");if("string"==typeof n)return n;var i="";return Object.getOwnPropertyNames(n).forEach(function(e){i+=e+": "+n[e]+";"}),i}());i.swc.Eventing.triggerEvent("errorCode",e);try{i.swc.Telemetry.sendEvent.runtimeError(e,o.message,t,o.stack,r)}catch(e){}},e.throwHttpErrorCode=function(e,t){e+=1e3,i.swc.Eventing.triggerEvent("errorCode",e)},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(1),o=n(16),s=n(35),a=n(99),c=n(18),u=n(69),l={"<":"&lt;",">":"&gt;","&lt;":"<","&gt;":">","&LT;":"<","&GT;":">","&":"&amp;",'"':"&quot;","'":"&apos;","&amp;":"&","&quot;":'"',"&apos;":"'","&#39;":"'","&#96;":"`","&AMP;":"&","&QUOT;":'"',"&APOS;":"'"},p='(?:(?:\\s*title="[^"]+?"\\s*)|(?:\\s*tabindex="-1"\\s*)|(?:\\s*target="_blank"\\s*)){0,3}',d=a.default.multilineRegExp(["(&lt;a ",p,'href="((?:https?://|mailto:)[^"]+?)"',p,"&gt;)","((?:(?!&lt;/a&gt;)[\\s\\S])*)","(&lt;/a&gt;)"],"gi"),f={ALLOWED_TAGS:["span","canvas"],ALLOWED_ATTR:["id","type","data-item-id","class","data-is-animated"]},h={ALLOWED_TAGS:["b","i","s","hr","br","at","ss","h1","h2","h3","h4","h5","h6","span","div","quote","ul","li","ol","em","strong","br","canvas","p","title","description"],ALLOWED_ATTR:["tabindex","title","target","id","type","data-item-id","class","data-is-animated"]},g=function(){function e(){}return Object.defineProperty(e,"anchor",{get:function(){return e._anchor||(e._anchor=document.createElement("a"))},enumerable:!0,configurable:!0}),e.sanitizeMessageInputContent=function(t){return t=e.replaceBrWithNewline(t),t=e.normalizeMentions(t),t=s.default.dompurify.sanitize(t,{ALLOWED_TAGS:[],ALLOWED_ATTR:[]}),t=e.unescape(t)},e.map=function(e){return l[e]},e.modifyLinkAnchorOpening=function(e,t){return e.search(a.default.escapeSpecialChars(t))>-1?e:e.replace(/(<a|&lt;a)/,function(e){return e+" "+t})},e.validateUrl=function(t,n){var i=e.anchor;return i&&e.validateUrlFormat(t)&&e.validateURLProtocol(i,n)},e.validateURLProtocol=function(e,t){return(t||["https:"]).indexOf(e.protocol)>-1&&-1===["javascript:"].indexOf(e.protocol)},e.validateUrlFormat=function(e){return!!e.match(/^(https:\/\/)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)/g)},e.escapeBrackets=function(e){return e.replace(/([<>])/gi,this.map)},e.unescapeBrackets=function(e){return e.replace(/(&lt;|&gt;)/gi,this.map)},e.unescape=function(e){return e.replace(/(&lt;|&gt;|&amp;|&quot;|&apos;|&#39;|&#96;)/gi,this.map)},e.validateUnescapedLink=function(e){return this.escapeBrackets(e).replace(d,this.validateAnchor)},e.parseTopic=function(t){return t?(t?e.unescape(t):"").replace(/<[^a\/].*?>(.*?)<\/[^a].*?>/gi,"$1").replace(/(<.*?\.{3,})$/,"").trim():t},e.containsMention=function(e){return/<at id="(.*?)">.*?<\/at>/g.test(e)},e.containsEmoticon=function(e){return/<span(\sxmlns=".*")? class="emoticon\s?\w*\s?(animated)?"><canvas(\s?(data-[-a-z]*|height|width|id|textcontent)=".*")*?>.*<\/canvas><\/span>/i.test(e)},e.containsLargeEmoticon=function(e){return/<span(\sxmlns=".*")? class="emoticon\s?\w*\s?(animated)?\s+\w*large"><canvas(\s?(data-[-a-z]*|height|width|id|textcontent)=".*")*?>.*<\/canvas><\/span>/i.test(e)},e.getMessageSanitizedContent=function(e,t){var n={ALLOWED_TAGS:[],ALLOWED_ATTR:[]};return t&&t.noLinks?n=h:t&&t.noFormatting?n=f:(n={ALLOWED_TAGS:h.ALLOWED_TAGS.concat(["a"]),ALLOWED_ATTR:h.ALLOWED_ATTR.concat(["href"])},i.default.get.backend===o.MessagingBackend.TEAMS&&(n.ALLOWED_TAGS.push("img"),n.ALLOWED_ATTR.push("src","style","alt"))),s.default.dompurify.sanitize(e,n)},e.normalizeUrl=function(t){var n=e.anchor;return n.href=t,e.validateUrl(t)&&n.href},e.validateAnchor=function(t,n,i,r,o){var s=e.unescapeBrackets(n),a=e.unescapeBrackets(o);return 0!==i.indexOf("mailto:")&&(s=e.modifyLinkAnchorOpening(s,'target="_blank"')),s=e.modifyLinkAnchorOpening(s,'tabindex="-1"'),(s=e.modifyLinkAnchorOpening(s,'title="'+i+'"'))+r+a},e.webify=function(e){return e.replace(/(\r?\n)|(&lt;br\s?\/&gt;)/gm,"<br/>")},e.attachActionToLinks=function(e,t,n,i){if(1===e.nodeType&&(c.default.isIe()&&(e.matches=Element.prototype.matches),e.matches(t)))for(var r=e.querySelectorAll("a"),o=0;o<r.length;o++){var s=r[o];if(s.href.indexOf(n)>1){var a=u.default.getQueryParameter(s.href,n);a&&(s.setAttribute("data-swc-payload",a),s.addEventListener("click",i))}}},e.getSenderIdFromUrl=function(e){if(!e)return e;var t=e.match(/\/(\d+:[^?\/]*)/);return t&&t[1]?t[1]:(e.match(/(\d+:[^?\/]*)/),e)},e.extractMsgContent=function(e){return 0!==e.indexOf(r.Configuration.MSG_DELETED_CLASSIC_SKYPE)?e:e.slice(r.Configuration.MSG_DELETED_CLASSIC_SKYPE.length,e.length)},e.sanitizeTopic=function(e){return s.default.dompurify.sanitize(e,{ALLOWED_TAGS:h.ALLOWED_TAGS.concat(["img","a"]),ALLOWED_ATTR:h.ALLOWED_ATTR.concat(["src","href"])})},e.getMessagePreviewContent=function(t){return t=e._dropNewLineTag(t),t=e._dropAnchorTag(t),t=e._dropImgTag(t)},e.modCanvas=function(t){if(e.containsEmoticon(t))for(var n=0,i=!1;!i;){var r=t.indexOf("<canvas",n);if(-1===r)i=!0;else{var o=t.indexOf(' id="',r);if(-1===o)return t;t=t.substring(0,o+5)+"p"+t.substring(o+5),n=r+8}}return t},e.replaceBrWithNewline=function(e){return e.replace(/<br\s*\/?><br\s*\/?>/g,"\n\n").replace(/<br\s*\/?>/g,"  \n")},e.normalizeMentions=function(e){return e.replace(/<\s*span[^>]*data-mention-id[^>]*>(.*?)<\s*\/\s*span>/g,function(e,t){return"@("+t.substring(1,t.length)+")"})},e._dropNewLineTag=function(e){return e.replace(/<br\s*\/?>/gm," ")},e._dropAnchorTag=function(e){return e.replace(/<\/*a.*?>/g," ")},e._dropImgTag=function(e){return e.replace(/<img .*?>/g,"")},e}();t.MessageUtils=g},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i=n(11),r=n(0),o=n(8),s=n(48),a=n(152),c=500;t.default=function(e,t,n,i){return 0,new Promise(function(r,o){var s=function(a){u(e,t.timeout,n,i).then(function(e){e.callCount=a,r(e)}).catch(function(e){0===e.status&&a<t.retryCount?setTimeout(function(){s(a+1)},c):o(e)})};s(1)})};var u=function(t,n,c,u){var p=Date.now(),d=u?u.method:null,f=u&&u.headers&&u.headers.hasOwnProperty("BehaviorOverride"),h=function(e){var n=Date.now()-p;return e.ok||(404===e.status&&f?r.swc.Telemetry.sendEvent.serviceQos(t,c+"",n,e,d,399):(a.reportServiceFault(t,e,n),o.default.throwHttpErrorCode(e.status,e.statusText),r.swc.Telemetry.sendEvent.serviceQos(t,c+"",n,e,d))),Promise.resolve(e)},g=function(e){var n=Date.now()-p;return 404===e.status&&f?r.swc.Telemetry.sendEvent.serviceQos(t,c+"",n,e,d,399):(a.reportServiceFault(t,e,n),r.swc.Telemetry.sendEvent.serviceQos(t,c+"",n,e,d)),Promise.reject(e)};return s.get().onceOnline().then(function(){var t=e(c,u),r=new i.CancelablePromise(t);return l(r,n).then(h,g)},function(e){return Promise.reject(e)})},l=function(e,t){var n=setTimeout(function(){n=null,e.cancel({ok:!1,status:0,statusText:"Timeout"})},t),i=function(){n&&clearTimeout(n)};return e.promise.then(i,i),e.promise}}).call(this,n(52))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=function(){function e(e){var t=this;this._isCanceled=!1,this._status=i.Pending,this.cancel=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t._isCanceled||(t._isCanceled=!0,e[0]=e[0]||{},e[0].isCanceled=!0,t._status=i.Rejected,t._reject.apply(t._promise,e))},this._promise=new Promise(function(n,r){t._resolve=n,t._reject=r,e&&(e.then(function(e){t._isCanceled||(t._status=i.Resolved,n(e))},function(e){t._status=i.Rejected,r(e)}),e.catch(function(e){t._status=i.Rejected,t._isCanceled?r({isCanceled:!0}):r(e)}))})}return Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCanceled",{get:function(){return this._isCanceled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),e.prototype.resolve=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._status!==i.Resolved&&(this._status=i.Resolved,this._resolve.apply(this._promise,e))},e.prototype.cancelQuitely=function(){this.status===i.Pending&&(this.promise.then(function(){},function(){}),this.cancel())},e}();t.CancelablePromise=r,function(e){e[e.Pending=0]="Pending",e[e.Resolved=1]="Resolved",e[e.Rejected=2]="Rejected"}(i=t.PromiseStatus||(t.PromiseStatus={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.guid={generate:function(){var e=new Uint16Array(8);(window.crypto||window.msCrypto).getRandomValues(e);var t=0,n=function(){return(4369|e[t++]).toString(16)};return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()},isGuid:function(e){return/^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$/.test(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){var e=this;this.callbacks={},this.subscribe=function(t,n){void 0===e.callbacks[t]&&(e.callbacks[t]=new Array),e.callbacks[t].push(n)},this.unsubscribe=function(t,n){if(void 0!==e.callbacks[t]){var i=e.callbacks[t].indexOf(n);i>-1&&e.callbacks[t].splice(i,1)}},this.publish=function(t,n){void 0!==e.callbacks[t]&&e.callbacks[t].map(function(e){return e}).forEach(function(e){e(n)})}}return e.prototype.dispose=function(){for(var e in this.callbacks)this.callbacks.hasOwnProperty(e)&&(this.callbacks[e]=null);this.callbacks={}},e}();t.default=i},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.UNDETERMINED=10]="UNDETERMINED",e[e.SKYPE=100]="SKYPE",e[e.TEAMS=300]="TEAMS"}(t.MessagingBackend||(t.MessagingBackend={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(90),r=n(4),o=n(155),s=n(0),a=n(9),c=n(38),u=function(){function e(){var e=this;this.encoder=new i.Encoder,this.decodeContent=function(t){return e.encoder.decode(t)}}return e.prototype.generate=function(e){return null},e.prototype._createMessageModel=function(e,t,n){var i;void 0===n&&(n=!1);var u=new o.default(n),l=void 0!==t?t:e.content;n?e.customType&&(u.customType=e.customType):(u.senderId=a.MessageUtils.getSenderIdFromUrl(e.from),u.sender=s.swc.services.persons.getPerson(u.senderId));var p=s.swc.services.mePersonManager.isMe(c.default.normalizePersonId(u.senderId));u.id=e.id,u.content=l?this.decodeContent(l):"";var d=e.skypeeditedid?e.skypeeditedid:e.id,f=new Date(Number(d));u.timestamp=isNaN(f.valueOf())?new Date(e.originalarrivaltime):f,u.originalTimestamp=new Date(e.originalarrivaltime),u.composeTime=new Date(e.composetime),u.skypeEditedId=e.skypeeditedid,u.key=e.skypeeditedid||e.clientmessageid||e.id||"0",u.direction=n||!p?r.Direction.Incoming:r.Direction.Outgoing,u.rawMessageType=e.messagetype,u.clientMessageId=e.clientmessageid,u.amsreferences=e.amsreferences,u.editedTimestamp=e.properties&&e.properties.edittime?new Date(parseInt(e.properties.edittime,10)):null,u.deletedTimestamp=e.properties&&e.properties.deletetime?new Date(parseInt(e.properties.deletetime,10)):null;var h=!!e.skypeeditedid||!!u.editedTimestamp,g=!l&&!!e.skypeeditedid||!!u.deletedTimestamp;if(u.properties=e.properties,u.isEdited=h,u.isDeleted=g,u.version=Number(e.version),u.imdisplayname=e.imdisplayname,e.properties&&e.properties.files)try{var m=void 0;m="string"==typeof e.properties.files?JSON.parse(e.properties.files):e.properties.files,(i=u.files).pushObservable.apply(i,m)}catch(e){}return u},e.prototype._generateOutgoingModel=function(e){var t,n=new o.default(!1,e);if(n.id=e.clientmessageid,n.timestamp=new Date(e.composetime),n.originalTimestamp=n.timestamp,n.key=e.clientmessageid,n.senderId=s.swc.services.mePersonManager.mePerson.mri,n.direction=r.Direction.Outgoing,n.content=this.decodeContent(e.content),n.processedContent=e.processedcontent,n.rawMessageType=e.messagetype,n.clientMessageId=e.clientmessageid,n.amsreferences=e.amsreferences,e.properties&&(n.properties=e.properties,"string"==typeof e.properties))try{var i=JSON.parse(e.properties).files||[];(t=n.files).pushObservable.apply(t,i)}catch(e){}return n},e.prototype.parseContentFor=function(e,t){var n=new RegExp("<"+t+">(.+?)</"+t+">","i"),i=e.match(n);return i?i[1]:""},e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r,o,s=n(0),a=n(27),c=n(12),u={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"};!function(e){e.Desktop="Desktop",e.Mobile="Mobile",e.Tablet="Tablet"}(i=t.DeviceType||(t.DeviceType={})),function(e){e.MSIE="MSIE",e.CHROME="Chrome",e.FIREFOX="Firefox",e.SAFARI="Safari",e.EDGE="Edge",e.EDGE_CHROMIUM="Anaheim",e.ELECTRON="Electron",e.SKYPE_SHELL="SkypeShell",e.PHANTOMJS="PhantomJS",e.UNKNOWN="Unknown"}(r=t.BrowserVendor||(t.BrowserVendor={})),function(e){e.WINDOWS="Windows",e.MACOSX="Mac OS X",e.WINDOWS_PHONE="Windows Phone",e.WINDOWS_RT="Windows RT",e.IOS="iOS",e.ANDROID="Android",e.LINUX="Linux",e.UNKNOWN="Unknown"}(o=t.OperatingSystem||(t.OperatingSystem={})),t.UNKNOWN_VERSION="U";var l=function(){function e(){}return e.getDeviceType=function(){return window.navigator.userAgent.match(/(android|ipod|windows phone|wpdesktop|windows ce|blackberry\w*|meego|webos|palm|symbian|pda|\w*?mobile\w*?|\w*?phone\w*?)/i)?i.Mobile:window.navigator.userAgent.match(/tablet|ipad/i)?i.Tablet:i.Desktop},e.getUserAgent=function(){return a.default.getWindow().navigator.userAgent},e.userAgentContainsString=function(e){return this.getUserAgent().indexOf(e)>-1},e.isChrome=function(){return this.userAgentContainsString(r.CHROME)&&!this.userAgentContainsString(r.EDGE)},e.isIe=function(){return this.userAgentContainsString("Trident")},e.isEdge=function(){return this.userAgentContainsString(r.EDGE)},e.isOpera=function(){return this.userAgentContainsString("OPR/")},e.testSupporedList=function(t){if(!t)return!1;t.constructor!==Array&&"string"==typeof t&&(t=[t]);for(var n=e.getBrowserName().toLocaleLowerCase(),i=0;i<t.length;i++)if(t[i].toLowerCase().indexOf(n)>-1)return!0;return!1},e.getBrowserName=function(){return this.isOpera()?r.UNKNOWN:this.userAgentContainsString(r.PHANTOMJS)?r.PHANTOMJS:this.isEdge()?r.EDGE:this.userAgentContainsString(r.ELECTRON)?r.ELECTRON:this.userAgentContainsString(r.CHROME)?this.userAgentContainsString("Edg")?r.EDGE_CHROMIUM:r.CHROME:this.userAgentContainsString(r.FIREFOX)?r.FIREFOX:this.userAgentContainsString(r.SAFARI)?r.SAFARI:this.userAgentContainsString(r.SKYPE_SHELL)?r.SKYPE_SHELL:this.isIe()?r.MSIE:r.UNKNOWN},e.getBrowserVersion=function(){var e,n,i,o,s,a=this;return this.isIe()?(o=a.getUserAgent(),(s=o.match(new RegExp(r.MSIE+" ([\\d,.]+)")))?s[1]:(i=o.match(new RegExp("rv:([\\d,.]+)")))?i[1]:void 0):((e=this.getBrowserName())===r.SAFARI&&(e="Version"),(n=a.getUserAgent().match(new RegExp(e+"/([\\d,.]+)")))?n[1]:t.UNKNOWN_VERSION)},e.getScreenInfo=function(){var e=a.default.getWindow(),t=a.default.getWindow().navigator;return{width:a.default.getWindow().screen&&a.default.getWindow().screen.width||0,height:a.default.getWindow().screen&&a.default.getWindow().screen.height||0,pixelRatio:a.default.getWindow().devicePixelRatio||0,colorDepth:a.default.getWindow().screen&&a.default.getWindow().screen.colorDepth||0,isTouchEnabled:Object.prototype.hasOwnProperty.call(e,"ontouchstart")||t.MaxTouchPoints>0}},e.getOsName=function(){var e=this.getUserAgent();return e.match(/windows\sphone\s\d+\.\d+/i)?o.WINDOWS_PHONE:e.match(/ arm;/i)?o.WINDOWS_RT:e.match(/(iPad|iPhone|iPod)(?=.*like Mac OS X)/i)?o.IOS:e.match(/android/i)?o.ANDROID:e.match(/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|cros)/i)?o.LINUX:e.match(/(macintosh|mac os x)/i)?o.MACOSX:e.match(/(windows|win32)/i)?o.WINDOWS:o.UNKNOWN},e.getOsVersion=function(e){var n=this;void 0===e&&(e=!1);var i;return this.getOsName()===o.WINDOWS?function(e){var i=n.getUserAgent().match(new RegExp("Windows NT ([\\d,.]+)"));if(i){if(e)return i[1];if(u[i[1]])return u[i[1]]}return t.UNKNOWN_VERSION}(e):this.getOsName()===o.MACOSX&&(i=n.getUserAgent().match(new RegExp(o.MACOSX+" ([\\d,_,.]+)")))?i[1].replace(/_/g,"."):t.UNKNOWN_VERSION},e.getDeviceId=function(){var e=s.swc.services.localStorage,t=e.getItem("swc-deviceId");return t||(t=c.guid.generate(),e.setItem("swc-deviceId",t)),t},e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.OneOnOne="1on1",e.Chat="chat",e.Space="space",e.Topic="topic",e.SfbInterop="sfbinterop",e.SfbInteropChat="sfbinteropchat",e.Meeting="meeting"}(t.ThreadType||(t.ThreadType={})),function(e){e.EventMessage="EventMessage"}(t.EventType||(t.EventType={})),function(e){e.Text="Text",e.RichText="RichText",e.RichTextUriObject="RichText/UriObject",e.RichTextMedia_GenericFile="RichText/Media_GenericFile",e.ControlClearTyping="Control/ClearTyping",e.ControlTyping="Control/Typing",e.ControlLiveState="Control/LiveState",e.SystemMessage="SystemMessage",e.InviteFreeRelationshipChangedInitialized="InviteFreeRelationshipChanged/Initialized",e.SignalFlamingo="Signal/Flamingo",e.RichTextHtml="RichText/Html",e.EventCall="Event/Call"}(t.MessagePayloadType||(t.MessagePayloadType={})),function(e){e.Audio="Audio",e.Video="Video"}(t.PresenceCapabilities||(t.PresenceCapabilities={})),function(e){e.Online="Online",e.Busy="Busy",e.Offline="Offline",e.Undefined="Undefined",e.OnThePhone="OnThePhone",e.Away="Away",e.Idle="Idle",e.OutToLunch="OutToLunch",e.BeRightBack="BeRightBack",e.DoNotDisturb="DoNotDisturb"}(t.PresenceStatus||(t.PresenceStatus={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(81),o=function(){function e(){this.requests={}}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e)},enumerable:!0,configurable:!0}),e.prototype.async=function(e,t,n){var r=this;return this.requests[t]=this.requests[t]||new Promise(function(o,s){var a=n&&setTimeout(s,n),c=function(n){n&&n.refId&&n.refId===t&&(a&&clearTimeout(a),i.swc.Eventing.unregisterEvent("proxy:resolve",c),o(r.create(e,n)))};i.swc.Eventing.registerEvent("proxy:resolve",c)}),i.swc.Eventing.triggerEvent("proxy:request",t),this.requests[t]},e.prototype.create=function(e,t){return new e(t)},e}();t.ProxyFactory=o;var s=function(){return function(e){var t=this;this.data={},this.callCount=0,this.exec=function(e,t){return i.swc.Eventing.triggerEvent(e,t)},this.reg=function(e,t){return i.swc.Eventing.registerEvent(e,t)},this.unreg=function(e,t){return i.swc.Eventing.unregisterEvent(e,t)},this.createCID=function(){return r.hashCode((t.callCount++).toString()+t.refId)},this.refId=e.refId,this.data=e,this.init()}}();t.Proxy=s;var a=function(){function e(){var e=this;this.connections={},this.answer=function(t){var n=e.connections[t];n&&i.swc.Eventing.triggerEvent("proxy:resolve",Object.assign(n,{refId:t}))},i.swc.Eventing.registerEvent("proxy:request",this.answer)}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e)},enumerable:!0,configurable:!0}),e.prototype.connect=function(e,t,n){this.connections[e]||(this.connections[e]=t||{},n&&n(),this.answer(e))},e.prototype.disconnect=function(e){delete this.connections[e]},e}();t.ProxyConnector=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.SignedOut=0]="SignedOut",e[e.SigningIn=1]="SigningIn",e[e.SignedIn=2]="SignedIn",e[e.SigningOut=3]="SigningOut"}(t.SigninState||(t.SigninState={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(57),o=n(41),s=n(0),a=n(47),c=n(114),u={allowedDomains:["swc.cdn.skype.com","latest-swc.cdn.skype.com"]},l=function(){function e(){}return e.combine=function(e,t,n){return e.lastIndexOf("/")!==e.length-1&&"/"!==t.substring(0,1)?e+"/"+t:this.getAppPath(n)+e+t},e.getAbsoluteUrl=function(e,t,n){var i=this.getCompletePath(e,t),r="css"===t?"css/":"";return e===o.PackageName.SDK_LOADER?this.combine(n.loaderUrl,i,n):e===o.PackageName.CONNECT?this.combine(n.loaderUrl,i,n):this.combine(r,i,n)},e.getCompletePath=function(e,t){return i||(i=new r.ConfigFactory),e+((void 0!==i.getDefinitionFromUrl().IsMinified?i.getDefinitionFromUrl().IsMinified:s.swc.EcsConfig.isMinified)?".min":"")+"."+t},e.setQueryParameters=function(e,t){return e+"?"+this.buildQueryParameters(t)},e.buildQueryParameters=function(e){var t=[];return Object.keys(e).forEach(function(n){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]))}),t.join("&")},e.getHost=function(){try{var e=window.location.hostname;return!e&&e.length>0?e:("file:"===window.location.protocol.toLowerCase()&&(e="local"),e)}catch(e){return null}},e.getVendorPath=function(t){return e.getCDNPath(t)+"/vendors"},e.getConnectPagePath=function(t){return e.getAppPath(t)+"connect.html"},e.getAppPath=function(t){var n=a.getBranchParentFolder(t.version);return e.getCDNPath(t)+"/"+n+"/"+t.version+"/"},e.getCDNPath=function(t){var n=t.domain;return e.validateUriOrDie(n,u),n},e.validateUriOrDie=function(e,t){if(!c.UrlValidator.instance.validate(e,t))throw new Error("Invalid URI!")},e.appendQueryParam=function(e,t,n){return e+(-1===e.indexOf("?")?"?":"&")+encodeURIComponent(t)+"="+encodeURIComponent(n)},e}();t.UrlHelper=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NA="n/a"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.UNDETERMINED=10]="UNDETERMINED",e[e.GUEST=100]="GUEST",e[e.SKYPE=200]="SKYPE",e[e.DL_TOKEN=300]="DL_TOKEN",e[e.TEAMS=400]="TEAMS"}(t.IdentityType||(t.IdentityType={}))},function(e,t,n){"use strict";function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}n.r(t),n.d(t,"AbilityHelpers",function(){return te}),n.d(t,"setupIFrame",function(){return ne});var o,s,a={title:"Latest accessibility announcements",historyLength:10,parent:void 0},c=function(){function e(e){this._props=a,this._announcements=[],this._mainWindow=e}var t=e.prototype;return t.setup=function(e){this._props=i({},this._props,e),e.parent&&this._container&&this._container.parentElement!==e.parent&&e.parent.appendChild(this._container),e.title&&this._container&&this._container.setAttribute("aria-label",e.title),e.historyLength&&this._shrinkHistory()},t.dispose=function(){var e=this;this._container&&(this._cleanupTimer&&(this._mainWindow.clearTimeout(this._cleanupTimer),this._cleanupTimer=void 0),this._announcements.forEach(function(t){t.timer&&(e._mainWindow.clearTimeout(t.timer),t.timer=void 0)}),this._announcements=[],this._container.parentNode&&(this._container.parentNode.removeChild(this._container),this._container=void 0))},t.announce=function(e,t){if(e.trim()&&(this._container||this._init(),this._container)){var n=document.createElement("div");n.setAttribute("role",t?"alert":"log"),n.setAttribute("aria-live",t?"assertive":"polite");var i=n.style;i.position="absolute",i.left=i.top=i.right=i.bottom="0";var r={node:n};r.timer=this._mainWindow.setTimeout(function(){delete r.timer,r.node.innerText=e},100),this._announcements.push(r),this._container.appendChild(n),this._shrinkHistory()}},t._shrinkHistory=function(){if(this._container)for(;this._announcements.length>this._props.historyLength;){var e=this._announcements.shift();e&&(e.timer&&this._mainWindow.clearTimeout(e.timer),this._container.removeChild(e.node))}},t._init=function(){if(!this._container){this._container=document.createElement("div"),this._container.setAttribute("role","list"),this._container.setAttribute("aria-label",this._props.title);var e=this._container.style;e.position="absolute",e.overflow="hidden",e.width=e.height="1px",e.right=e.bottom="0",e.opacity="0",e.zIndex="-1",(this._props.parent||this._mainWindow.document.body).appendChild(this._container)}},e}();function u(e,t){var n=e.__abilityHelpers||{};Object.keys(t).forEach(function(e){var i=t[e];void 0===i?n&&delete n[e]:n[e]=i}),0===Object.keys(n).length?delete e.__abilityHelpers:e.__abilityHelpers=n}function l(e){return e.__abilityHelpers}function p(e,t,n,i){var r=t.defaultView;if(!r||r===e)throw new Error("setupIFrameToMainWindowEventsDispatcher() is called on a wrong document.");i.forEach(function(i){switch(i.type){case o.Document:t.addEventListener(i.name,s,i.capture);break;case o.Window:r.addEventListener(i.name,s,i.capture)}function s(o){var s=document.createEvent("HTMLEvents");s.initEvent(n,!0,!0),s.originalEvent=o,s.targetDetails={descriptor:i,target:o.target,document:t,window:r},e.dispatchEvent(s)}})}!function(e){e[e.Document=0]="Document",e[e.Window=1]="Window"}(o||(o={}));try{document.createTreeWalker(document,NodeFilter.SHOW_ELEMENT),s=!1}catch(e){s=!0}function d(e,t,n){if(t.nodeType===Node.ELEMENT_NODE){var i=s?n:{acceptNode:n};return e.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,i,!1)}}var f="ability-helpers:mutation-event";function h(e){"undefined"!=typeof MutationObserver&&new MutationObserver(function(t){var n={},i={},r={},o={},s=t,a=Array.isArray(s),c=0;for(s=a?s:s[Symbol.iterator]();;){var u;if(a){if(c>=s.length)break;u=s[c++]}else{if((c=s.next()).done)break;u=c.value}for(var p=u,f=p.removedNodes,h=p.addedNodes,m=0;m<f.length;m++)L(f[m],p.target);for(var v=0;v<h.length;v++)L(h[v],void 0,p.target)}for(var y=0,_=Object.keys(n);y<_.length;y++){var b=_[y],T=n[b];T.removedFrom&&g(T.removedFrom,{root:T.root,removed:!0}),T.addedTo&&g(T.addedTo,{root:T.root,removed:!1})}for(var S=0,w=Object.keys(i);S<w.length;S++){var P=w[S],C=i[P];C.removedFrom&&g(C.removedFrom,{layer:C.layer,removed:!0}),C.addedTo&&g(C.addedTo,{layer:C.layer,removed:!1})}for(var E=0,O=Object.keys(r);E<O.length;E++){var I=O[E],M=r[I];M.removedFrom&&g(M.removedFrom,{list:M.list,removed:!0}),M.addedTo&&g(M.addedTo,{list:M.list,removed:!1})}for(var k=0,A=Object.keys(o);k<A.length;k++){var R=A[k],N=o[R];N.removedFrom&&g(N.removedFrom,{item:N.item,removed:!0}),N.addedTo&&g(N.addedTo,{item:N.item,removed:!1})}function L(t,n,i){D(t,n,i);var r=d(e,t,function(e){return D(e,n,i)});if(r)for(;r.nextNode(););}function D(e,t,s){var a=l(e);return a&&(a.modalityRoot&&function(e,t,i){var r=n[e.id];r||(r=n[e.id]={root:e});t&&(r.removedFrom=t);i&&(r.addedTo=i)}(a.modalityRoot,t,s),a.modalityLayer&&function(e,t,n){var r=i[e.internalId];r||(r=i[e.internalId]={layer:e});t&&(r.removedFrom=t);n&&(r.addedTo=n)}(a.modalityLayer,t,s),a.list&&function(e,t,n){var i=r[e.id];i||(i=r[e.id]={list:e});t&&(i.removedFrom=t);n&&(i.addedTo=n)}(a.list,t,s),a.listItem&&function(e,t,n){var i=o[e.id];i||(i=o[e.id]={item:e});t&&(i.removedFrom=t);n&&(i.addedTo=n)}(a.listItem,t,s)),NodeFilter.FILTER_SKIP}}).observe(e,{childList:!0,subtree:!0})}function g(e,t){var n=document.createEvent("HTMLEvents");n.initEvent(f,!0,!0),n.details=t,e.dispatchEvent(n)}var m="ability-helpers:list-related",v=0,y=function(){function e(e,t,n,i){this._ah=i,this._element=e,this._context=t,this._focus=n}var t=e.prototype;return t.prev=function(e){var t=this._ah.focusable.findPrevListItem(!1,!1,this._element,this._context);return t&&(this._context=t,e||this._focus(t)),t},t.next=function(e){var t=this._ah.focusable.findNextListItem(!1,!1,this._element,this._context);return t&&(this._context=t,e||this._focus(t)),t},t.pageUp=function(e){for(var t=this._ah.focusable.findPrevListItem(!1,!1,this._element,this._context),n=null;t;)n=t,t=S(t)?this._ah.focusable.findPrevListItem(!1,!1,this._element,t):null;return n&&(this._context=n,e||(T.scrollIntoView(n,!1),this._focus(n))),n},t.pageDown=function(e){for(var t=this._ah.focusable.findNextListItem(!1,!1,this._element,this._context),n=null;t;)n=t,t=S(t)?this._ah.focusable.findNextListItem(!1,!1,this._element,t):null;return n&&(this._context=n,e||(T.scrollIntoView(n,!0),this._focus(n))),n},t.home=function(e){var t=this._ah.focusable.findFirstListItem(this._element);return t&&(this._context=t,e||this._focus(t)),t},t.end=function(e){var t=this._ah.focusable.findLastListItem(this._element);return t&&(this._context=t,e||this._focus(t)),t},e}(),_=function(){function e(e,t,n){this._ah=n,this.id="list"+ ++v,this._props=t,this._element=e,this._add()}var t=e.prototype;return t.dispose=function(){this._remove()},t.move=function(e){this._remove(),this._element=e,this._curItem=void 0,this._add()},t.getCurrentItem=function(){return this._curItem?this._curItem:this._findCurrentItem()},t.setCurrentItem=function(e){this._curItem=e,this._setInformativeStyle()},t.getElement=function(){return this._element},t._findCurrentItem=function(){var e=this;if(this._element.ownerDocument){var t,n=d(this._element.ownerDocument,this._element,function(t){return o.call(e,t)});if(n){if(this._props.bottomUp){for(var i=null,r=this._element.lastElementChild;r;r=r.lastElementChild)i=r;i&&o.call(this,i)!==NodeFilter.FILTER_ACCEPT&&(n.currentNode=i,n.previousNode())}else n.nextNode();return t&&t!==this._curItem&&this.setCurrentItem(t),t}}function o(e){var n=l(e);return n&&n.listItem?this._ah.focusable.isFocusable(n.listItem.getElement())&&(t||(t=n.listItem),void 0===this._curItem||n.listItem===this._curItem)?(t=n.listItem,NodeFilter.FILTER_ACCEPT):NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP}},t._add=function(){this._setInformativeStyle()},t._remove=function(){this._element.style.removeProperty("--ah-list")},t._setInformativeStyle=function(){this._element.style.setProperty("--ah-list",this._curItem?this._curItem.id:"no-current")},e}(),b=function(){function e(e){this.id="li"+ ++v,this._element=e,this._add()}var t=e.prototype;return t.dispose=function(){this._remove()},t.move=function(e){this._remove(),this._element=e,this._add()},t.getElement=function(){return this._element},t._add=function(){this._element.tabIndex=0,this._element.style.setProperty("--ah-list-item",this.id)},t._remove=function(){this._element.style.removeProperty("--ah-list-item")},e}(),T=function(){function e(t,n){var i=this;this._init=function(){i._initTimer=void 0,i._mainWindow.document.addEventListener(f,i._onMutation),i._mainWindow.addEventListener(m,i._onIFrameEvent)},this._onIFrameEvent=function(e){if(e.targetDetails)switch(e.targetDetails.descriptor.name){case f:i._onMutation(e.originalEvent)}},this._onMutation=function(t){if(t.target){var n=t.details;if(n.list)n.list.setCurrentItem(void 0);else if(n.item){var i=e._getList(t.target);i&&t.details.removed&&i.getCurrentItem()===n.item&&i.setCurrentItem(void 0)}}},this._ah=n,this._mainWindow=t,this._initTimer=this._mainWindow.setTimeout(this._init,0)}var t=e.prototype;return t.dispose=function(){this._initTimer&&(this._mainWindow.clearTimeout(this._initTimer),this._initTimer=void 0),this._mainWindow.document.removeEventListener(f,this._onMutation),this._mainWindow.removeEventListener(m,this._onIFrameEvent)},t.add=function(e,t){var n=t||{};u(e,{list:new _(e,n,this._ah)}),this._ah.focusDeloser.add(e,{onFocusLost:n.onFocusLost})},t.remove=function(e){var t=l(e);t&&t.list&&(this._ah.focusDeloser.remove(e),t.list.dispose(),u(e,{list:void 0}))},t.move=function(e,t){var n=l(e),i=n&&n.list;i&&(i.move(t),u(t,{list:i}),u(e,{list:void 0}),this._ah.focusDeloser.move(e,t))},t.addItem=function(e){var t=l(e);if(!t||!t.listItem){var n=new b(e);u(e,{listItem:n}),g(e,{item:n})}},t.removeItem=function(e){var t=l(e),n=t&&t.listItem;n&&(n.dispose(),u(e,{listItem:void 0}),g(e,{item:n,removed:!0}))},t.moveItem=function(e,t){var n=l(e),i=n&&n.listItem;i&&(i.move(t),u(t,{listItem:i}),u(e,{listItem:void 0}),g(e,{item:i,removed:!0}),g(t,{item:i}))},t.setActionable=function(e,t){var n=!1!==t||void 0;u(e,{listActionable:n}),n?e.style.setProperty("--ah-list-actionable","yes"):e.style.removeProperty("--ah-list-actionable")},t.setCurrent=function(t,n){var i=e._getList(t);if(i){if(!n)return i.setCurrentItem(void 0),!0;var r=e.getItemFor(n);if(r&&r.list===i)return i.setCurrentItem(r.listItem),!0}return!1},e._getList=function(e){for(var t=e;t;t=t.parentElement){var n=l(t);if(n&&n.list)return n.list}},e.getItemFor=function(e){if(e.ownerDocument){for(var t,n,i,r=e;r;r=r.parentElement){var o=l(r);if(o&&(!n&&o.listItem&&(n=o.listItem,i=r),n&&o.list)){t=o.list;break}}if(t&&n)return{list:t,listItem:n,isListItem:e===i}}},e.findActionable=function(e){if(!e.ownerDocument)return null;var t=d(e.ownerDocument,e,function(e){var t=l(e);return t&&t.listActionable?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});return t?t.nextNode():null},e.scrollIntoView=function(t,n){var i=e.getItemFor(t);if(i){var r=i.list.getElement(),o=r.getBoundingClientRect(),s=i.listItem.getElement().getBoundingClientRect();r.scrollTop+=n?s.top-o.top:s.bottom-o.bottom}},e}();function S(e){var t=T.getItemFor(e);if(!t)return!1;var n=t.list.getElement().getBoundingClientRect(),i=e.getBoundingClientRect();return i.left>=n.left&&i.top>=n.top&&i.right<=n.right&&i.bottom<=n.bottom}var w="ability-helpers:modality-layer-related",P=0,C={},E=function(){function e(e,t,n,i){this._isAccessible=!0,this._isFocused=!1,this._ah=i,this.internalId="ml"+ ++P,this.userId=t,this._element=e,this._props=n,this._setAccessibilityProps(),this._setInformativeStyle()}var t=e.prototype;return t.setup=function(e){this._props=i({},this._props,e),this._setAccessibilityProps()},t.dispose=function(){this._remove()},t.move=function(e){this._remove(),this._element=e,this._setAccessibilityProps(),this._isAccessible=!this._isAccessible,this._isActive=!this._isActive,this.setAccessible(!this._isAccessible),this.setActive(!this._isActive)},t.setAccessible=function(e){var t=this;e!==this._isAccessible&&(this._isAccessible=e,this._setAccessibleTimer&&(window.clearTimeout(this._setAccessibleTimer),this._setAccessibleTimer=void 0),e?this._element.removeAttribute("aria-hidden"):this._setAccessibleTimer=window.setTimeout(function(){t._setAccessibleTimer=void 0,t._element.setAttribute("aria-hidden","true")},0),this._setInformativeStyle())},t.setActive=function(e){e!==this._isActive&&(this._isActive=e,this._setInformativeStyle())},t.isActive=function(){return!!this._isActive},t.isOthersAccessible=function(){return!!this._props.othersAccessible},t.isAlwaysAccessible=function(){return!!this._props.alwaysAccessible},t.isNoFocusFirst=function(){return!!this._props.noFocusFirst},t.isNoFocusDefault=function(){return!!this._props.noFocusDefault},t.getElement=function(){return this._element},t.setFocused=function(e){this._isFocused!==e&&(this._isFocused=e,e?this._props.onFocusIn&&this._props.onFocusIn():this._props.onFocusOut&&this._props.onFocusOut(!1),this._setInformativeStyle())},t.onBeforeFocusOut=function(){return!!this._props.onFocusOut&&this._props.onFocusOut(!0)},t._remove=function(){this._element.style.removeProperty("--ah-modality-layer")},t._setAccessibilityProps=function(){this._element.setAttribute("aria-label",this._props.accessibilityLabel),this._element.hasAttribute("tabindex")||(this._element.tabIndex=-1),this._element.tabIndex<0&&this._ah.outline.ignoreElement(this._element)},t._setInformativeStyle=function(){this._element.style.setProperty("--ah-modality-layer",this.internalId+","+this.userId+","+(this._isActive?"active":"inactive")+","+(this._isAccessible?"accessible":"inaccessible")+","+(this._isFocused?"focused":"not-focused"))},e}(),O=function(){function e(e){this._knownLayers={},this.id="root"+ ++P,this._element=e,this._add()}var t=e.prototype;return t.dispose=function(){this._updateLayersTimer&&(window.clearTimeout(this._updateLayersTimer),this._updateLayersTimer=void 0),this._remove()},t.move=function(e){this._remove(),this._element=e,this._add(),this.updateLayers()},t.getElement=function(){return this._element},t.getCurrentLayerId=function(){return this._curLayerId},t.setCurrentLayerId=function(e,t){this._curLayerId=e,this._setInformativeStyle(),t||this.updateLayers()},t.getLayers=function(){for(var e=[],t=0,n=Object.keys(this._knownLayers);t<n.length;t++){var i=n[t];e.push(this._knownLayers[i])}return e},t.updateLayers=function(){var e=this;this._updateLayersTimer||(this._updateLayersTimer=window.setTimeout(function(){e._updateLayersTimer=void 0,e._reallyUpdateLayers()},0))},t._add=function(){this._setInformativeStyle()},t._remove=function(){this._element.style.removeProperty("--ah-modality-layer-root")},t._reallyUpdateLayers=function(){if(this._element.ownerDocument){var e=[],t=d(this._element.ownerDocument,this._element,function(t){var n=l(t);return n&&n.modalityLayer?(e.push(n.modalityLayer),NodeFilter.FILTER_ACCEPT):NodeFilter.FILTER_SKIP});if(t)for(;t.nextNode(););for(var n=void 0===this._curLayerId,i=!1,r=this._knownLayers,o={},s={},a=0;a<e.length;a++){var c=e[a],u=c.userId,p=u===this._curLayerId;!n&&p&&(n=c.isOthersAccessible()),p&&(i=!0),o[u]=c}for(var f=0,h=Object.keys(r);f<h.length;f++){var g=h[f];g in o||(s[g]=r[g])}i||this.setCurrentLayerId(void 0,!0),this._knownLayers=o;for(var m=0;m<e.length;m++){var v=e[m],y=v.userId,_=void 0===this._curLayerId||y===this._curLayerId;v.setActive(_),v.setAccessible(v.isAlwaysAccessible()||n||_)}}},t._setInformativeStyle=function(){this._element.style.setProperty("--ah-modality-layer-root",this.id+","+(this._curLayerId||"undefined"))},e}(),I=function(){function e(t,n){var i=this;this._init=function(){i._initTimer=void 0,i._ah.focusedElement.subscribe(i._onElementFocused),i._mainWindow.document.addEventListener(f,i._onMutation),i._mainWindow.addEventListener(w,i._onIFrameEvent),M(i._mainWindow.document)},this._onIFrameEvent=function(e){if(e.targetDetails)switch(e.targetDetails.descriptor.name){case f:i._onMutation(e.originalEvent)}},this._onMutation=function(t){if(t.target&&t.details.layer){var n=e._getRootOnly(t.target);n&&n.updateLayers()}},this._onElementFocused=function(t){var n;if(i._focusOutTimer&&(i._mainWindow.clearTimeout(i._focusOutTimer),i._focusOutTimer=void 0),t){var r=e.getLayerFor(t);r&&(n=r.layer)}n?(i._curFocusInLayer&&n!==i._curFocusInLayer&&i._curFocusInLayer.setFocused(!1),i._curFocusInLayer=n,i._curFocusInLayer.setFocused(!0)):i._curFocusInLayer&&(i._focusOutTimer=i._mainWindow.setTimeout(function(){i._focusOutTimer=void 0,i._curFocusInLayer&&(i._curFocusInLayer.setFocused(!1),i._curFocusInLayer=void 0)},0))},this._ah=n,this._mainWindow=t,this._initTimer=this._mainWindow.setTimeout(this._init,0)}var t=e.prototype;return t.dispose=function(){this._initTimer&&(this._mainWindow.clearTimeout(this._initTimer),this._initTimer=void 0),this._focusOutTimer&&(this._mainWindow.clearTimeout(this._focusOutTimer),this._focusOutTimer=void 0),this._ah.focusedElement.unsubscribe(this._onElementFocused),this._mainWindow.document.removeEventListener(f,this._onMutation),this._mainWindow.removeEventListener(w,this._onIFrameEvent)},t.addRoot=function(e){var t=l(e);if(!t||!t.modalityRoot){var n=new O(e);u(e,{modalityRoot:n});for(var i=e;i;i=i.parentElement);g(e,{root:n})}},t.removeRoot=function(e){var t=l(e),n=t&&t.modalityRoot;n&&(g(e,{root:n,removed:!0}),u(e,{modalityRoot:void 0}),n.dispose())},t.moveRoot=function(e,t){var n=l(e),i=n&&n.modalityRoot;i&&(i.move(t),u(t,{modalityRoot:i}),u(e,{modalityRoot:void 0}),g(e,{root:i,removed:!0}),g(t,{root:i}))},t.addLayer=function(e,t,n){var i=l(e);if(i&&i.modalityLayer){if(i.modalityLayer.userId!==t)throw new Error("The element already has a modality layer with different id.")}else{var r=new E(e,t,n,this._ah);u(e,{modalityLayer:r}),this._ah.focusDeloser.add(e,{onFocusLost:n.onFocusLost}),g(e,{layer:r})}},t.removeLayer=function(e){var t=l(e),n=t&&t.modalityLayer;n&&(u(e,{modalityLayer:void 0}),this._ah.focusDeloser.remove(e),g(e,{layer:n,removed:!0}),n.dispose())},t.moveLayer=function(e,t){var n=l(e),i=n&&n.modalityLayer;i&&(i.move(t),u(t,{modalityLayer:i}),u(e,{modalityLayer:void 0}),this._ah.focusDeloser.move(e,t),g(e,{layer:i,removed:!0}),g(t,{layer:i}))},t.focusLayer=function(t,n,i){var r=e.getLayerFor(t);if(r){var o=this._ah.focusDeloser.getActions(r.layer.getElement());if(o)return void 0===n&&(n=r.layer.isNoFocusFirst()),!(n||!this._ah.keyboardNavigation.isNavigatingWithKeyboard()||!o.focusFirst())||(void 0===i&&(i=r.layer.isNoFocusDefault()),!(i||!o.focusDefault())||o.resetFocus())}return!1},e._getRootOnly=function(e){for(var t=e;t;t=t.parentElement){var n=l(t);if(n&&n.modalityRoot)return n.modalityRoot}},e.getLayerFor=function(e){if(e.ownerDocument){for(var t,n,i=e;i;i=i.parentElement){var r=l(i);if(r&&(!n&&r.modalityLayer&&(n=r.modalityLayer),n&&r.modalityRoot)){t=r.modalityRoot;break}}if(n&&t)return{layer:n,root:t}}},e.getRootId=function(t){var n=e.getLayerFor(t);return n&&n.root.id||"no-root"},e.getRootById=function(e){if("no-root"!==e)return C[e]},e}();function M(e){e.addEventListener(f,function(e){var t=e.details.root;t&&(e.details.removed?delete C[t.id]:C[t.id]=t)})}var k,A=["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","*[tabindex]","*[contenteditable]"].join(", "),R=function(){function e(e){this._ah=e}var t=e.prototype;return t.getInfo=function(e){var t=l(e),n=t&&t.focusable;return{isDefaultFocusable:!(!n||!n.default)||e.classList.contains("ability-helpers-default-focusable"),isIgnoredFocusable:!(!n||!n.ignored)}},t.setup=function(e,t){u(e,{focusable:{default:t.isDefaultFocusable,ignored:t.isIgnoredFocusable}});var n=[];t.isDefaultFocusable&&n.push("default"),t.isIgnoredFocusable&&n.push("ignored"),n.length?e.style.setProperty("--ah-focusable",n.join(",")):e.style.removeProperty("--ah-focusable")},t.isFocusable=function(e,t,n){return!(!e.matches||!e.matches(A)||!t&&-1===e.tabIndex)&&(this.isVisible(e)&&(!!n||this.isAccessible(e)))},t.isVisible=function(e){if(null===e.offsetParent)return!1;var t=e.ownerDocument&&e.ownerDocument.defaultView;return!!t&&"hidden"!==t.getComputedStyle(e).visibility},t.isAccessible=function(e){for(var t=e;t;t=t.parentElement){var n=l(t);if(n&&n.modalityLayer&&!n.modalityLayer.isActive())return!0;var i=t.getAttribute("aria-hidden");if(i&&"true"===i.toLowerCase())return!1;if((i=t.getAttribute("aria-disabled"))&&"true"===i.toLowerCase())return!1}return!0},t.findFirst=function(e,t,n){return this._findNextElement(e,e,!1,t,n)},t.findLast=function(e,t,n){return this._findLast(e,!1,t,n)},t.findNext=function(e,t,n,i){return this._findNext(!1,!1,e,t,n,i)},t.findPrev=function(e,t,n,i){return this._findNext(!1,!0,e,t,n,i)},t.findFirstListItem=function(e,t,n){return this._findNextElement(e,e,!0,t,n)},t.findLastListItem=function(e,t,n){return this._findLast(e,!0,t,n)},t.findNextListItem=function(e,t,n,i){return this._findNext(!0,!1,e,t,n,i)},t.findPrevListItem=function(e,t,n,i){return this._findNext(!0,!0,e,t,n,i)},t.findDefault=function(e){var t=this;if(!e.ownerDocument)return null;var n=d(e.ownerDocument,e,function(e){return t.getInfo(e).isDefaultFocusable&&t._ah.focusable.isFocusable(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});return n?n.nextNode():null},t._findNext=function(e,t,n,i,r,o){return o||(o=this._ah.focusedElement.getFocusedElement()),o&&o.ownerDocument&&(r=r||o.ownerDocument.body).contains(o)?this._findNextElement(r,o,e,n,i,t):null},t._findLast=function(e,t,n,i){for(var r=null,o=e.lastElementChild;o;o=o.lastElementChild)r=o;return r?this._acceptElement(r,t,n,i)===NodeFilter.FILTER_ACCEPT?r:this._findNextElement(e,r,t,n,i,!0):null},t._findNextElement=function(e,t,n,i,r,o){var s=this;if(!e.ownerDocument)return null;var a=d(e.ownerDocument,e,function(e){return s._acceptElement(e,n,i,r)});return a?(t&&(a.currentNode=t),o?a.previousNode():a.nextNode()):null},t._acceptElement=function(e,t,n,i){var r=I.getLayerFor(e);if(i||!r||r.root.getCurrentLayerId()===r.layer.userId||r.layer.isAlwaysAccessible()){var o=T.getItemFor(e);return!t&&o&&o.listItem!==o.list.getCurrentItem()?NodeFilter.FILTER_REJECT:(!t||o&&o.isListItem)&&this._ah.focusable.isFocusable(e,n)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}return r?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP},e}(),N=10,L=0,D=function(){function e(t,n,i){var r=this;this._isActive=!1,this._history=[[]],this._snapshotIndex=0,this.isActive=function(){return r._isActive},this.setSnapshot=function(e){r._snapshotIndex=e,r._history.length>e+1&&r._history.splice(e+1,r._history.length-e-1),r._history[e]||(r._history[e]=[]),r._setInformativeStyle()},this.focusFirst=function(){if(!r._element)return!1;var e=r._ah.focusable.findFirst(r._element,!1,!0);return!!e&&(r.clearHistory(!0),r._ah.focusedElement.focus(e),!0)},this.focusDefault=function(){if(!r._element)return!1;var e=r._ah.focusable.findDefault(r._element);return!!e&&(r._ah.focusedElement.focus(e),!0)},this.resetFocus=function(){if(!r._ah.focusable.isVisible(r._element))return!1;if(r._ah.focusable.isFocusable(r._element,!0,!0))r._ah.focusedElement.focus(r._element,!0);else{var t=r._element.getAttribute("tabindex"),n=r._element.getAttribute("aria-hidden");r._element.tabIndex=-1,r._element.setAttribute("aria-hidden","true"),e.lastResetElement=r._element,r._ah.focusedElement.focus(r._element,!0,!0),r._setOrRemoveAttribute(r._element,"tabindex",t),r._setOrRemoveAttribute(r._element,"aria-hidden",n)}return!0},this.clearHistory=function(e){var t=r._element;r._history[r._snapshotIndex]=t?r._history[r._snapshotIndex].filter(function(n){return!!e&&t.contains(n)}):[]},this._ah=i,this.id="fd"+ ++L,this._element=t,this._props=n,this._setInformativeStyle()}var t=e.prototype;return t.setup=function(e){this._props=i({},this._props,e)},t.move=function(e){this._remove(),this._element=e,this._setInformativeStyle()},t.dispose=function(){this._isActive=!1,this._history=[[]],this._snapshotIndex=0,this._remove()},t.setActive=function(e){this._isActive=e,this._setInformativeStyle()},t.getActions=function(){return{focusDefault:this.focusDefault,focusFirst:this.focusFirst,resetFocus:this.resetFocus,clearHistory:this.clearHistory,setSnapshot:this.setSnapshot,isActive:this.isActive}},t.unshift=function(e){var t=this._history[this._snapshotIndex];for((t=this._history[this._snapshotIndex]=t.filter(function(t){return t!==e})).unshift(e);t.length>N;)t.pop()},t.findAvailable=function(){var e=this;if(!this._ah.focusable.isVisible(this._element))return null;var t=this._history[this._snapshotIndex].slice(0);this.clearHistory(!0);for(var n=0;n<t.length;n++){var i=t[n];if(this._element.contains(i)){if(this._ah.focusable.isFocusable(i))return i}else{var r=function(){var t=[];if(i.id&&t.push("#"+i.id),i.className&&i.className.split(" ").forEach(function(e){(e=e.trim())&&t.push("."+e)}),t.length){t.unshift(i.tagName.toLowerCase());for(var n=e._element.querySelectorAll(t.join("")),r=0;r<n.length;r++){var o=n[r];if(o&&e._ah.focusable.isFocusable(o))return{v:o}}}}();if("object"==typeof r)return r.v}}if(this._ah.keyboardNavigation.isNavigatingWithKeyboard()){var o=this._ah.focusable.findFirst(this._element,!1,!0);if(o)return o}return this._ah.focusable.findDefault(this._element)},t.customFocus=function(e){return!!this._props.onFocusLost&&this._props.onFocusLost(e,this.getActions())},t._setOrRemoveAttribute=function(e,t,n){null===n?e.removeAttribute(t):e.setAttribute(t,n)},t._setInformativeStyle=function(){this._element.style.setProperty("--ah-focus-deloser",(this._isActive?"active":"inactive")+",snapshot-"+this._snapshotIndex)},t._remove=function(){this._element.style.removeProperty("--ah-focus-deloser")},e}(),U=function(){function e(e,t){var n=this;this._isInSomeDeloser=!1,this._history=[],this._isPaused=!1,this._init=function(){n._initTimer=void 0,n._ah.focusedElement.subscribe(n._onElementFocused)},this._onElementFocused=function(e){n._restoreFocusTimer&&(n._mainWindow.clearTimeout(n._restoreFocusTimer),n._restoreFocusTimer=void 0);var t=n._curFocusedElement;if(n._curFocusedElement=e,e&&(n._lastFocusedElement=e),!e)return t&&t===D.lastResetElement||n._scheduleRestoreFocus(),void(D.lastResetElement=void 0);var i=n._getFocusDeloser(e);if(i){n._isInSomeDeloser=!0;var r,o=I.getRootId(e);i!==n._curDeloser&&(n._curDeloser&&n._curDeloser.setActive(!1),n._curDeloser=i,i.setActive(!0));for(var s=-1,a=0;a<n._history.length;a++){var c=n._history[a];if(c.rootId===o){r=c,s=a;break}}if(r){n._history.splice(s,1);var u=r.history.indexOf(i);u>-1&&r.history.splice(u,1)}else r={rootId:o,history:[]};r.history.unshift(i),n._history.unshift(r);var l=I.getLayerFor(e);l&&l.root.getCurrentLayerId()!==l.layer.userId||i.unshift(e),r.history.splice(N,n._history.length-N),n._history.splice(N,n._history.length-N)}else n._isInSomeDeloser=!1,n._curDeloser=void 0},this._mainWindow=e,this._initTimer=this._mainWindow.setTimeout(this._init,0),this._ah=t}var t=e.prototype;return t.dispose=function(){this._initTimer&&(this._mainWindow.clearTimeout(this._initTimer),this._initTimer=void 0),this._ah.focusedElement.unsubscribe(this._onElementFocused)},t.getActions=function(e){for(var t=e;t;t=t.parentElement){var n=l(t);if(n&&n.focusDeloser)return n.focusDeloser.getActions()}},t.add=function(e,t){var n=l(e);n&&n.focusDeloser||u(e,{focusDeloser:new D(e,t||{},this._ah)})},t.remove=function(e){var t=l(e);if(t){var n=t.focusDeloser;n&&(this._history.forEach(function(e){e.history=e.history.filter(function(e){return e!==n})}),this._history=this._history.filter(function(e){return e.history.length>0}),n.isActive()&&this._scheduleRestoreFocus(),n.dispose(),u(e,{focusDeloser:void 0}))}},t.move=function(e,t){var n=l(e);n&&n.focusDeloser&&(n.focusDeloser.move(t),u(t,{focusDeloser:n.focusDeloser}),u(e,{focusDeloser:void 0}))},t.pause=function(){this._isPaused=!0,this._restoreFocusTimer&&(this._mainWindow.clearTimeout(this._restoreFocusTimer),this._restoreFocusTimer=void 0)},t.resume=function(e){this._isPaused=!1,e&&this._scheduleRestoreFocus()},t._getFocusDeloser=function(e){for(var t=e;t;t=t.parentElement){var n=l(t);if(n&&n.focusDeloser)return n.focusDeloser}},t._isLastFocusedAvailable=function(){return!(!this._lastFocusedElement||!this._lastFocusedElement.offsetParent)},t._scheduleRestoreFocus=function(){var e=this;this._isPaused||(this._restoreFocusTimer=this._mainWindow.setTimeout(function(){if(e._restoreFocusTimer=void 0,e._isInSomeDeloser&&!e._isLastFocusedAvailable()){if(e._curDeloser){if(e._lastFocusedElement&&e._curDeloser.customFocus(e._lastFocusedElement))return;var t=e._curDeloser.findAvailable();if(t&&e._ah.focusedElement.focus(t))return}e._focusAvailable()||(e._isInSomeDeloser=!1,e._curDeloser&&(e._curDeloser.setActive(!1),e._curDeloser=void 0))}},100))},t._focusAvailable=function(){for(var e=this._ah,t=0;t<this._history.length;t++){for(var n=this._history[t],i={},r=0;r<n.history.length;r++)if(m(n.history[r],i))return!0;var o=I.getRootById(n.rootId),s=o&&o.getLayers();if(s){var a=s,c=Array.isArray(a),u=0;for(a=c?a:a[Symbol.iterator]();;){var p;if(c){if(u>=a.length)break;p=a[u++]}else{if((u=a.next()).done)break;p=u.value}var d=l(p.getElement()),f=d&&d.focusDeloser;if(f&&m(f,i))return!0}}for(var h=0,g=Object.keys(i);h<g.length;h++){if(i[g[h]].resetFocus())return!0}}return!1;function m(t,n){if(t){var i=t.findAvailable();if(i)return e.focusedElement.focus(i),!0;t.id in n||(n[t.id]=t)}return!1}},e}();!function(e){e[e.Tab=9]="Tab",e[e.Enter=13]="Enter",e[e.Esc=27]="Esc",e[e.Space=32]="Space",e[e.PageUp=33]="PageUp",e[e.PageDown=34]="PageDown",e[e.End=35]="End",e[e.Home=36]="Home",e[e.Left=37]="Left",e[e.Up=38]="Up",e[e.Right=39]="Right",e[e.Down=40]="Down"}(k||(k={}));var x=function(){function e(){this._callbacks=[]}var t=e.prototype;return t.dispose=function(){this._callbacks=[]},t.subscribe=function(e){this._callbacks.indexOf(e)<0&&this._callbacks.push(e)},t.unsubscribe=function(e){var t=this._callbacks.indexOf(e);t>=0&&this._callbacks.splice(t,1)},t.setVal=function(e,t){this._val!==e&&(this._val=e,this._callCallbacks(e,t))},t.getVal=function(){return this._val},t._callCallbacks=function(e,t){this._callbacks.forEach(function(n){return n(e,t)})},e}(),F="ability-helpers:focused-element-related",j=H();function H(){var e=window,t=e.HTMLElement.prototype.focus,n=!1;return e.HTMLElement.prototype.focus=function(){n=!0},e.document.createElement("button").focus(),e.HTMLElement.prototype.focus=t,n}var B=function(e){function t(n,i){var r;return(r=e.call(this)||this)._init=function(){r._initTimer=void 0,t.replaceFocus(r._mainWindow.document),r._mainWindow.document.addEventListener("focusin",r._onFocusIn,!0),r._mainWindow.document.addEventListener("focusout",r._onFocusOut,!0),r._mainWindow.document.addEventListener("mousedown",r._onMouseDown,!0),r._mainWindow.addEventListener("keydown",r._onKeyDown,!0),r._mainWindow.addEventListener(F,r._onIFrameEvent,!0)},r._onFocusIn=function(e){r._setFocusedElement(e.target,e.relatedTarget||void 0)},r._onFocusOut=function(e){r._setFocusedElement(void 0,e.relatedTarget||void 0)},r._onIFrameEvent=function(e){if(e.targetDetails)switch(e.targetDetails.descriptor.name){case"mousedown":r._onMouseDown(e.originalEvent);break;case"focusin":r._setFocusedElement(e.targetDetails.target,e.originalEvent.relatedTarget||void 0);break;case"focusout":r._setFocusedElement(void 0,e.originalEvent.relatedTarget||void 0);break;case"keydown":r._onKeyDown(e.originalEvent)}},r._onMouseDown=function(e){var t=T.getItemFor(e.target);t&&t.list.getCurrentItem()!==t.listItem&&t.list.setCurrentItem(t.listItem)},r._onKeyDown=function(e){var t=r.getVal();if(t&&t.ownerDocument){switch(e.keyCode){case k.Tab:case k.Down:case k.Right:case k.Up:case k.Left:case k.Enter:case k.Space:case k.PageDown:case k.PageUp:case k.Home:case k.End:break;default:return}if(e.keyCode===k.Tab){var n=I.getLayerFor(t);if(!n)if(!T.getItemFor(t))return;var i=e.shiftKey?r._ah.focusable.findPrev():r._ah.focusable.findNext();if(n&&n.layer){var o=i&&I.getLayerFor(i);if((!o||n.root.id!==o.root.id||o.root.getCurrentLayerId()!==o.layer.userId)&&n.layer.onBeforeFocusOut())return void e.preventDefault()}i?(e.preventDefault(),G(i)):r._moveOutWithDefaultAction(n?n.root.getElement():t.ownerDocument.body,e.shiftKey)}else{var s=T.getItemFor(t);if(!s)return;if(e.keyCode===k.Enter||e.keyCode===k.Space){var a=s.listItem.getElement();return void(a===t&&(e.preventDefault(),e.stopImmediatePropagation(),(T.findActionable(a)||a).click()))}e.preventDefault(),e.stopImmediatePropagation();var c=new y(s.list.getElement(),t,function(e){return G(e)},r._ah);switch(e.keyCode){case k.Down:case k.Right:c.next();break;case k.Up:case k.Left:c.prev();break;case k.PageDown:c.pageDown();break;case k.PageUp:c.pageUp();break;case k.Home:c.home();break;case k.End:c.end()}}}},r._validateFocusedElement=function(e,t){if(r._insideListTimer&&(r._mainWindow.clearTimeout(r._insideListTimer),r._insideListTimer=void 0),e){var n=T.getItemFor(e),i=I.getLayerFor(e),o=i?i.root.getCurrentLayerId():void 0;if(!n||i&&void 0!==o&&i.layer.userId!==o)r._curList=void 0;else if(r._curList===n.list)n&&n.list.getCurrentItem()!==n.listItem&&n.list.setCurrentItem(n.listItem);else{r._curList=n.list;var s=n.list.getCurrentItem(),a=s?s.getElement():void 0;if(a&&a!==e&&!a.contains(e))return void r._ah.focusedElement.focus(a)}if(!i)return;var c=i.layer;if(o===c.userId)return;if(void 0===o||t.isFocusedProgrammatically)return void i.root.setCurrentLayerId(c.userId);if(c&&e.ownerDocument){var u=r._ah.focusable.findFirst(i.root.getElement());if(u){if(e.compareDocumentPosition(u)&document.DOCUMENT_POSITION_PRECEDING&&!(u=r._ah.focusable.findLast(e.ownerDocument.body)))throw new Error("Something went wrong.");r._ah.focusedElement.focus(u)}else e.blur()}}else r._curList&&(r._insideListTimer=r._mainWindow.setTimeout(function(){r._insideListTimer=void 0,r._curList=void 0},0))},r._ah=i,r._mainWindow=n,r._initTimer=r._mainWindow.setTimeout(r._init,0),r}r(t,e);var n=t.prototype;return n.dispose=function(){e.prototype.dispose.call(this),this._initTimer&&(this._mainWindow.clearTimeout(this._initTimer),this._initTimer=void 0),this._mainWindow.document.removeEventListener("focusin",this._onFocusIn,!0),this._mainWindow.document.removeEventListener("focusout",this._onFocusOut,!0),this._mainWindow.removeEventListener(F,this._onIFrameEvent,!0),this._mainWindow.removeEventListener("keydown",this._onKeyDown,!0),this._mainWindow.document.removeEventListener("mousedown",this._onMouseDown,!0)},n.getFocusedElement=function(){return this.getVal()},n.focus=function(e,n,i){return!!this._ah.focusable.isFocusable(e,n,i)&&(t._lastFocusedProgrammatically=e,e.focus(),!0)},n._setFocusedElement=function(e,n){var i={relatedTarget:n};if(e){if(function(e){return!!e.__shouldIgnoreFocus}(e))return;(j||t._lastFocusedProgrammatically)&&(i.isFocusedProgrammatically=e===t._lastFocusedProgrammatically,t._lastFocusedProgrammatically=void 0)}var r=this._nextVal={element:e,details:i};e!==this._val&&this._validateFocusedElement(e,i),this._nextVal===r&&this.setVal(e,i),this._nextVal=void 0},t.replaceFocus=function(e){var n=e.defaultView;if(!n)throw new Error("Wrong document for replaceFocus().");var i=n.HTMLElement.prototype.focus;function r(){return t._lastFocusedProgrammatically=this,i.apply(this,arguments)}i.__abilityHelpersFocus||(n.HTMLElement.prototype.focus=r,r.__abilityHelpersFocus=i)},n._moveOutWithDefaultAction=function(e,t){var n=this,i=e.ownerDocument&&e.ownerDocument.defaultView;if(i){this._removeMoveOutInput(),this._moveOutInput=i.document.createElement("input"),function(e){e.__shouldIgnoreFocus=!0}(this._moveOutInput);var r=this._moveOutInput.style;r.position="absolute",r.opacity="0",r.zIndex="-1",r.left=r.top="-100500px",this._moveOutInput.setAttribute("aria-hidden","true"),this._moveOutInput.addEventListener("focusout",function(){n._removeMoveOutInput()}),t&&e.firstChild?e.insertBefore(this._moveOutInput,e.firstChild):e.appendChild(this._moveOutInput),G(this._moveOutInput)}},n._removeMoveOutInput=function(){this._moveOutInput&&(this._moveOutInput.parentElement&&this._moveOutInput.parentElement.removeChild(this._moveOutInput),this._moveOutInput=void 0)},t}(x);function G(e){var t=e.focus;t.__abilityHelpersFocus?t.__abilityHelpersFocus.call(e):e.focus()}var z="ability-helpers:keyboard-navigation-related",W=function(e){function t(t,n){var i;return(i=e.call(this)||this)._isMouseUsed=!1,i._init=function(){i._initTimer=void 0,i._mainWindow.document.body.addEventListener("mousedown",i._onMouseDown,!0),i._mainWindow.addEventListener("keydown",i._onKeyDown,!0),i._mainWindow.addEventListener(z,i._onIFrameEvent,!0),i._ah.focusedElement.subscribe(i._onElementFocused)},i._onMouseDown=function(e){0===e.buttons||0===e.clientX&&0===e.clientY&&0===e.screenX&&0===e.screenY||(i._isMouseUsed=!0,i.setVal(!1,void 0))},i._onKeyDown=function(e){var t=i.isNavigatingWithKeyboard();t||e.keyCode!==k.Tab?t&&e.keyCode===k.Esc&&i._scheduleDismiss():i.setVal(!0,void 0)},i._onIFrameEvent=function(e){if(e.targetDetails)switch(e.targetDetails.descriptor.name){case"mousedown":i._onMouseDown(e.originalEvent);break;case"keydown":i._onKeyDown(e.originalEvent)}},i._onElementFocused=function(e,t){e&&(i._isMouseUsed?i._isMouseUsed=!1:i.isNavigatingWithKeyboard()||t.relatedTarget&&(t.isFocusedProgrammatically||void 0===t.isFocusedProgrammatically||i.setVal(!0,void 0)))},i._ah=n,i._mainWindow=t,i._initTimer=i._mainWindow.setTimeout(i._init,0),i}r(t,e);var n=t.prototype;return n.dispose=function(){e.prototype.dispose.call(this),this._initTimer&&(this._mainWindow.clearTimeout(this._initTimer),this._initTimer=void 0),this._dismissTimer&&(this._mainWindow.clearTimeout(this._dismissTimer),this._dismissTimer=void 0),this._mainWindow.document.body.removeEventListener("mousedown",this._onMouseDown,!0),this._mainWindow.removeEventListener("keydown",this._onKeyDown,!0),this._mainWindow.removeEventListener(z,this._onIFrameEvent,!0),this._ah.focusedElement.unsubscribe(this._onElementFocused)},n.isNavigatingWithKeyboard=function(){return this.getVal()||!1},n._scheduleDismiss=function(){var e=this;this._dismissTimer&&(this._mainWindow.clearTimeout(this._dismissTimer),this._dismissTimer=void 0);var t=this._ah.focusedElement.getFocusedElement();this._dismissTimer=this._mainWindow.setTimeout(function(){e._dismissTimer=void 0;var n=e._ah.focusedElement.getFocusedElement();t&&n&&t===n&&e.setVal(!1,void 0)},500)},t}(x);var V,q,K="ability-helpers:outline-related",J={areaClass:"focus-outline-area",outlineClass:"focus-outline",outlineColor:"#ff4500",outlineWidth:2,zIndex:2147483647};"onfullscreenchange"in document?(V="fullscreenchange",q="fullscreenElement"):"onwebkitfullscreenchange"in document?(V="webkitfullscreenchange",q="webkitFullscreenElement"):"onmozfullscreenchange"in document?(V="mozfullscreenchange",q="mozFullScreenElement"):"onmsfullscreenchange"in document&&(V="msfullscreenchange",q="msFullscreenElement");var Y=function(){function e(e,t,n,i){this.left=e,this.top=t,this.right=n,this.bottom=i}var t=e.prototype;return t.equalsTo=function(e){return this.left===e.left&&this.top===e.top&&this.right===e.right&&this.bottom===e.bottom},t.clone=function(){return new e(this.left,this.top,this.right,this.bottom)},e}(),Q=function(){function e(t,n){var i=this;this._isVisible=!1,this._allOutlineElements=[],this._init=function(){i._initTimer=void 0,i._ah.keyboardNavigation.subscribe(i._onKeyboardNavigationStateChanged),i._ah.focusedElement.subscribe(i._onElementFocused),i._mainWindow.addEventListener("scroll",i._onScroll,!0),i._mainWindow.addEventListener(K,i._onIFrameEvent,!0),V&&i._mainWindow.document.addEventListener(V,i._onFullScreenChanged)},this._onFullScreenChanged=function(e){if(q&&e.target){var t=e.target.body||e.target,n=i._getOutlineDOM(t);if(t.ownerDocument&&n){var r=t.ownerDocument[q];r?(r.appendChild(n.container),i._fullScreenElement=r):(t.ownerDocument.body.appendChild(n.container),i._fullScreenElement=void 0)}}},this._onKeyboardNavigationStateChanged=function(){i._onElementFocused(i._ah.focusedElement.getFocusedElement())},this._onElementFocused=function(e){!i._updateOutlinedElement(e)&&i._isVisible&&i._setOutlineVisibility(!1)},this._onIFrameEvent=function(e){if(e.targetDetails)switch(e.targetDetails.descriptor.name){case"scroll":i._onScroll(e.originalEvent);break;case V:i._onFullScreenChanged(e.originalEvent)}},this._onScroll=function(t){i._outlinedElement&&e._isParentChild(t.target,i._outlinedElement)&&(i._scrollTimer&&i._mainWindow.clearTimeout(i._scrollTimer),i._curPos=void 0,i._setOutlinePosition())},this._ah=n,this._mainWindow=t,this._mainWindow.setTimeout(this._init,0)}var t=e.prototype;return t.setup=function(e){J=i({},J,e);var t=this._mainWindow;t.__abilityHelpers&&(t.__abilityHelpers.outlineStyle||(t.__abilityHelpers.outlineStyle=X(this._mainWindow.document,J)))},t.ignoreElement=function(e,t){u(e,{outline:t?void 0:{ignored:!0}})},t.dispose=function(){var e=this;this._initTimer&&(this._mainWindow.clearTimeout(this._initTimer),this._initTimer=void 0),this._updateTimer&&(this._mainWindow.clearTimeout(this._updateTimer),this._updateTimer=void 0),this._scrollTimer&&(this._mainWindow.clearTimeout(this._scrollTimer),this._scrollTimer=void 0),this._ah.keyboardNavigation.unsubscribe(this._onKeyboardNavigationStateChanged),this._ah.focusedElement.unsubscribe(this._onElementFocused),this._mainWindow.removeEventListener("scroll",this._onScroll,!0),this._mainWindow.removeEventListener(K,this._onIFrameEvent,!0),V&&this._mainWindow.document.removeEventListener(V,this._onFullScreenChanged),this._allOutlineElements.forEach(function(t){return e._removeOutlineDOM(t.container)}),this._allOutlineElements=[]},t._shouldShowCustomOutline=function(e){var t=l(e);if(t&&t.outline&&t.outline.ignored)return!1;for(var n=e;n;n=n.parentElement)if(n.classList&&n.classList.contains(J.areaClass))return!0;return!1},t._updateOutlinedElement=function(e){var t=this;if(this._outlinedElement=void 0,this._updateTimer&&(this._mainWindow.clearTimeout(this._updateTimer),this._updateTimer=void 0),this._curPos=void 0,!this._ah.keyboardNavigation.isNavigatingWithKeyboard())return!1;if(e){if("INPUT"===e.tagName){if(!(e.type in{button:!0,checkbox:!0,file:!0,image:!0,radio:!0,range:!0,reset:!0,submit:!0}))return!1}else if("TEXTAREA"===e.tagName)return!1;return!!this._shouldShowCustomOutline(e)&&(this._updateTimer=this._mainWindow.setTimeout(function(){t._updateTimer=void 0,t._ah.keyboardNavigation.isNavigatingWithKeyboard()&&(t._outlinedElement=e,t._updateOutline())},0),!0)}return!1},t._updateOutline=function(){var e=this;this._setOutlinePosition(),this._updateTimer&&(this._mainWindow.clearTimeout(this._updateTimer),this._updateTimer=void 0),this._outlinedElement&&(this._updateTimer=this._mainWindow.setTimeout(function(){e._updateTimer=void 0,e._updateOutline()},30))},t._setOutlineVisibility=function(e){this._isVisible=e,this._curOutlineElements&&(e?this._curOutlineElements.container.classList.add(J.outlineClass+"_visible"):(this._curOutlineElements.container.classList.remove(J.outlineClass+"_visible"),this._curPos=void 0))},t._setOutlinePosition=function(){if(this._outlinedElement){var e=this._outlinedElement.getBoundingClientRect(),t=new Y(e.left,e.top,e.right,e.bottom);if(!this._curPos||!t.equalsTo(this._curPos)){var n=this._getOutlineDOM(this._outlinedElement),i=this._outlinedElement.ownerDocument&&this._outlinedElement.ownerDocument.defaultView;if(n&&i){this._curOutlineElements!==n&&(this._setOutlineVisibility(!1),this._curOutlineElements=n),this._curPos=t;var r=t.clone(),o=!1,s=n.container;if(s.parentElement){for(var a=this._outlinedElement.parentElement;a&&a!==this._fullScreenElement;a=a.parentElement){e=a.getBoundingClientRect();var c=a.ownerDocument&&a.ownerDocument.defaultView;if(!c)return;var u=c.getComputedStyle(a);"absolute"===u.position&&(o=!0),o&&"hidden"!==u.overflow||(e.left>r.left&&(r.left=e.left),e.top>r.top&&(r.top=e.top),e.right<r.right&&(r.right=e.right),e.bottom<r.bottom&&(r.bottom=e.bottom))}var l=s.parentElement.clientWidth,p=s.parentElement.clientHeight,d=J.outlineWidth;r.left=r.left>d?r.left-d:0,r.top=r.top>d?r.top-d:0,r.right=r.right<l-d?r.right+d:l,r.bottom=r.bottom<p-d?r.bottom+d:p;var f=r.right-r.left,h=r.bottom-r.top;if(f>2*d&&h>2*d){var g=n.left,m=n.top,v=n.right,y=n.bottom,_=this._fullScreenElement?0:i.pageXOffset,b=this._fullScreenElement?0:i.pageYOffset;g.style.left=m.style.left=y.style.left=r.left+_+"px",v.style.left=r.left+_+f-d+"px",g.style.top=v.style.top=m.style.top=r.top+b+"px",y.style.top=r.top+b+h-d+"px",g.style.height=v.style.height=h+"px",m.style.width=y.style.width=f+"px",this._setOutlineVisibility(!0)}else this._setOutlineVisibility(!1)}}}}},t._getOutlineDOM=function(e){var t=e.ownerDocument,n=t&&t.defaultView;if(t&&n&&n.__abilityHelpers){if(n.__abilityHelpers.outlineStyle||(n.__abilityHelpers.outlineStyle=X(t,J)),!n.__abilityHelpers.outline){var i={container:t.createElement("div"),left:t.createElement("div"),top:t.createElement("div"),right:t.createElement("div"),bottom:t.createElement("div")};i.container.className=J.outlineClass,i.left.className=J.outlineClass+"__left",i.top.className=J.outlineClass+"__top",i.right.className=J.outlineClass+"__right",i.bottom.className=J.outlineClass+"__bottom",i.container.appendChild(i.left),i.container.appendChild(i.top),i.container.appendChild(i.right),i.container.appendChild(i.bottom),t.body.appendChild(i.container),n.__abilityHelpers.outline=i}return n.__abilityHelpers.outline}},t._removeOutlineDOM=function(e){var t=e.ownerDocument&&e.ownerDocument.defaultView,n=t&&t.__abilityHelpers,i=n&&n.outline;n&&(n.outlineStyle&&n.outlineStyle.parentNode&&(n.outlineStyle.parentNode.removeChild(n.outlineStyle),delete n.outlineStyle),i&&(i.container.parentNode&&i.container.parentNode.removeChild(i.container),delete n.outline))},e._isParentChild=function(e,t){return t===e||!!(e.compareDocumentPosition(t)&document.DOCUMENT_POSITION_CONTAINED_BY)},e}();function X(e,t){var n=e.createElement("style");return n.type="text/css",n.appendChild(e.createTextNode(function(e){return"\n        ."+e.areaClass+" *, ."+e.areaClass+" *:focus {\n            outline: none !important;\n        }\n\n        ."+e.outlineClass+" {\n            display: none;\n            position: absolute;\n            background: "+e.outlineColor+";\n            width: 0;\n            height: 0;\n            left: 0;\n            top: 0;\n            z-index: "+e.zIndex+";\n        }\n\n        ."+e.outlineClass+"."+e.outlineClass+"_visible {\n            display: block;\n        }\n\n        ."+e.outlineClass+"__left {\n            position: absolute;\n            background: inherit;\n            width: "+e.outlineWidth+"px;\n            height: "+e.outlineWidth+"px;\n            border-top-left-radius: "+e.outlineWidth+"px;\n            border-bottom-left-radius: "+e.outlineWidth+"px;\n        }\n\n        ."+e.outlineClass+"__top {\n            position: absolute;\n            background: inherit;\n            width: "+e.outlineWidth+"px;\n            height: "+e.outlineWidth+"px;\n            border-top-left-radius: "+e.outlineWidth+"px;\n            border-top-right-radius: "+e.outlineWidth+"px;\n        }\n\n        ."+e.outlineClass+"__right {\n            position: absolute;\n            background: inherit;\n            width: "+e.outlineWidth+"px;\n            height: "+e.outlineWidth+"px;\n            border-top-right-radius: "+e.outlineWidth+"px;\n            border-bottom-right-radius: "+e.outlineWidth+"px;\n        }\n\n        ."+e.outlineClass+"__bottom {\n            position: absolute;\n            background: inherit;\n            width: "+e.outlineWidth+"px;\n            height: "+e.outlineWidth+"px;\n            border-bottom-left-radius: "+e.outlineWidth+"px;\n            border-bottom-right-radius: "+e.outlineWidth+"px;\n        }"}(t))),e.head.appendChild(n),n}var $=function(e){h(e.document),this.announcer=new c(e),this.keyboardNavigation=new W(e,this),this.focusedElement=new B(e,this),this.outline=new Q(e,this),this.focusDeloser=new U(e,this),this.focusable=new R(this),this.modalityLayer=new I(e,this),this.list=new T(e,this)};function Z(){var e=window;return e.__abilityHelpers||(e.__abilityHelpers={helpers:new $(e),mainWindow:e}),e.__abilityHelpers}var ee=Z(),te=ee.helpers;function ne(e){var t=e.defaultView;if(t&&!t.__abilityHelpers){t.__abilityHelpers={helpers:ee.helpers,mainWindow:ee.mainWindow};var n=ee.mainWindow;h(e),function(e,t){B.replaceFocus(t),p(e,t,F,[{type:o.Document,name:"focusin",capture:!0},{type:o.Document,name:"focusout",capture:!0},{type:o.Document,name:"mousedown",capture:!0},{type:o.Window,name:"keydown",capture:!0}])}(n,e),function(e,t){p(e,t,z,[{type:o.Document,name:"mousedown",capture:!0},{type:o.Window,name:"keydown",capture:!0}])}(n,e),function(e,t){var n=[{type:o.Window,name:"scroll",capture:!0}];V&&n.push({type:o.Document,name:V,capture:!1}),p(e,t,K,n);var i=t.defaultView;if(!i||!i.__abilityHelpers)throw new Error("Wrong document to set Outline up.");i.__abilityHelpers.outlineStyle||(i.__abilityHelpers.outlineStyle=X(t,J))}(n,e),function(e,t){M(t),p(e,t,w,[{type:o.Document,name:f,capture:!1}])}(n,e),function(e,t){p(e,t,m,[{type:o.Document,name:f,capture:!1}])}(n,e)}}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.getWindow=function(){return window},e.getDocument=function(){return window.document},e.getParentWithClass=function(e,t){for(;e&&!this.hasClass(e,t);)e=e.parentNode;return e},e.isInViewport=function(e,t){return t=t||this.getWindow(),e.bottom>0&&e.right>0&&e.top<t.innerHeight&&e.left<t.innerWidth},e.readDataset=function(e,t,n){return e.dataset?e.dataset[t]:e.getAttribute("data-"+n)},e.writeDataset=function(e,t,n,i){e.dataset?e.dataset[t]=i:e.setAttribute("data-"+n,i)},e.hasClass=function(e,t){if(e.classList)return e.classList.contains(t);for(var n=0,i=e.className?e.className.split(" "):[];n<i.length;n++){if(i[n]===t)return!0}return!1},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(3),o=n(1),s=n(24),a=n(16),c=n(0),u=n(19);t.TEAMS_NOTIFICATION_CHANNEL_ID="48:notifications";var l=function(e){void 0===e&&(e="");var t=e.match((i||(i=r.default.get.backend===a.MessagingBackend.TEAMS?/^(https?:.+?\.microsoft\.com\/V\d+\/)/i:/^(https?:.+?\.live\.com\/V\d+\/)/i),i));return t?t[1]:null};function p(e){return l(e).replace(/\/(v2)\/?$/i,"/v1/")}t.parseChatServiceHostUrl=p,t.parseChatServiceHostUrlForRedirects=function(e){var t=e.match(/^(https?:.+?\.microsoft\.com\/(V\d+\/)?)/i),n=null;return t&&(n=t[1],t[2]||(n+="v1/")),n&&(n=n.replace(/\/(v2)\/?$/i,"/v1/")),n},t.handle404Redirect=function(e,t,n){var i=e.headers.get("location");return 404===e.status&&i&&l(i)?(o.Configuration.CHAT_HOST_URL=p(i),n?t(i):t()):Promise.resolve(e)},t.getDomain=function(){return c.swc.services.signInManager.userIdentityType===s.IdentityType.GUEST&&o.Configuration.CHAT_GUEST_HOST_URL!==o.Configuration.CHAT_HOST_URL&&c.swc.Telemetry.sendEvent.serviceQos("webapi-guestInDogfood","",0,null,""),o.Configuration.CHAT_HOST_URL},t.getConversationIdFromUrl=function(e){var t=e&&e.match(/\/(\d+:[^\/]*)[\/]?/);return t&&t[1]?t[1]:void 0},t.reset=function(){o.Configuration.CHAT_HOST_URL=o.Configuration.CHAT_GUEST_HOST_URL},t.normalizePersonId=function(e){var t=e.match(/(\d+:)([\S]*)/);return t?t[2]:e},t.isThread=function(e){try{var t=e.threadtype;if(t&&(t===u.ThreadType.Space||t===u.ThreadType.Topic))return!0}catch(e){c.swc.Telemetry.sendEvent.runtimeError(104e3,"Checking thread error","checking thread",e.stack)}return!1},t.isThreadExtended=function(e){try{var t=(e.threadtype||e.threadType||e.threadProperties&&(e.threadProperties.threadtype||e.threadProperties.threadType)||e.properties&&(e.properties.threadtype||e.properties.threadType)||e.type||"").toLowerCase();if(t&&(t===u.ThreadType.Space||t===u.ThreadType.Topic))return!0}catch(e){}return!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(34),r=n(4),o=n(8),s=function(){function e(){}return e.strip=function(e){var t=e.match(this.idRegExp);return t?t[2]:e},e.detectConversationType=function(e){if(!e)return r.ConversationType.UNDEFINED;if(this.typeMapppings[e])return this.typeMapppings[e];var t,n=e.match(this.idRegExp);if(n&&(t=this.getTypeByPrefix(n[1])),t)return this.typeMapppings[e]=t,t;if(0===e.indexOf("https://join.skype.com/"))return this.typeMapppings[e]=r.ConversationType.JOIN,r.ConversationType.JOIN;if(/^(28:)?[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i.test(e))return this.typeMapppings[e]=r.ConversationType.AGENT,r.ConversationType.AGENT;if(/^(19:)?[\S]+[@]([\S].)?[\S]*thread\.skype/i.test(e))return this.typeMapppings[e]=r.ConversationType.GROUP,r.ConversationType.GROUP;return/(?:00|\+)?(^[^a-z][^A-Z])(\d+$)/i.test(e.replace(/\s+|[()\-\+]/gi,""))?(this.typeMapppings[e]=r.ConversationType.PHONE,r.ConversationType.PHONE):(this.typeMapppings[e]=r.ConversationType.PERSON,r.ConversationType.PERSON)},e.getSdkModeFromId=function(e){switch(this.detectConversationType(e)){case r.ConversationType.PERSON:return i.SDKMode.PERSON;case r.ConversationType.AGENT:return i.SDKMode.BOT;case r.ConversationType.JOIN:return i.SDKMode.JOIN_URL;case r.ConversationType.PHONE:return i.SDKMode.PHONE;case r.ConversationType.GROUP:return i.SDKMode.THREAD}return i.SDKMode.UNDEFINED},e.toFullIdentifier=function(e){var t=this.getPrefixForId(e);return 0===e.indexOf(t+":")?e:t?t+":"+e:e},e.addPrefix=function(e,t){return 0===t.indexOf(e+this.SPLITTER)?t:0===t.indexOf(this.SPLITTER)?e+t:e+this.SPLITTER+t},e.getNormalizeId=function(e){return e.match(this.idRegExp)?e.replace(/\d{1,2}:/,""):e},e.isEqual=function(e,t){return this.toFullIdentifier(e).toLowerCase()===this.toFullIdentifier(t).toLowerCase()},e.getPrefixForId=function(e){if(this.hasAlreadyPrefix(e))return"";var t=this.getSdkModeFromId(e);switch(t){case i.SDKMode.PERSON:return"8";case i.SDKMode.BOT:return"28";case i.SDKMode.THREAD:return"19";case i.SDKMode.PHONE:return"4";default:o.default.throwError(10502,"Unable to define conversation prefix",{id:e,sdkMode:t})}return""},e.getTypeByPrefix=function(e){if(!e)return r.ConversationType.UNDEFINED;switch(e.indexOf(":")>-1&&(e=e.replace(":","")),e){case"4":return r.ConversationType.PHONE;case"8":return r.ConversationType.PERSON;case"19":return r.ConversationType.GROUP;case"28":return r.ConversationType.AGENT;default:return r.ConversationType.UNDEFINED}},e.hasAlreadyPrefix=function(e){var t=/^\d+:/.exec(e);return!!t&&!!t[0]},e.SPLITTER=":",e.idRegExp=/(\d{1,2}:)([\S]*)/,e.typeMapppings={},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.SpacesApi="https://api.spaces.skype.com",e.Sharepoint="https://microsoft-my.sharepoint.com",e.Presence="https://presence.teams.microsoft.com",e.AggregationApi="https://chatsvcagg.teams.microsoft.com"}(t.AadAudience||(t.AadAudience={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SKYPE_TOKEN_KEY="skype|token",t.SKYPE_REGTOKEN_KEY="skype|registrationtoken",t.SKYPE_ENDPOINT_ID_KEY="skype|epid",t.SKYPE_ENDPOINT_KEY="skype|endpoint",t.SKYPE_HAS_HISTORY_KEY="skype|hasHistory",t.SKYPE_GRAPH_ACCESS_TOKEN_KEY="skype|graphAccessToken",t.SKYPE_ENDPOINT_OWNER_KEY="skype|endpointowner",t.SWC_SFB_DISMISSED_KEY="swc-sfb-dismissed"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="NFKD",r={"ª":"a","º":"o","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","ç":"c","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ù":"u","ú":"u","û":"u","ü":"u","ý":"y","ÿ":"y","ā":"a","ă":"a","ą":"a","ć":"c","ĉ":"c","ċ":"c","č":"c","ď":"d","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","ĥ":"h","ĩ":"i","ī":"i","ĭ":"i","į":"i","ĳ":"ij","ĵ":"j","ķ":"k","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l·","ń":"n","ņ":"n","ň":"n","ŉ":"ʼn","ō":"o","ŏ":"o","ő":"o","ŕ":"r","ŗ":"r","ř":"r","ś":"s","ŝ":"s","ş":"s","š":"s","ţ":"t","ť":"t","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","ŵ":"w","ŷ":"y","ź":"z","ż":"z","ž":"z","ſ":"s","ơ":"o","ư":"u","ǆ":"dz","ǈ":"Lj","ǉ":"lj","ǋ":"Nj","ǌ":"nj","ǎ":"a","ǐ":"i","ǒ":"o","ǔ":"u","ǖ":"u","ǘ":"u","ǚ":"u","ǜ":"u","ǟ":"a","ǡ":"a","ǧ":"g","ǩ":"k","ǫ":"o","ǭ":"o","ǰ":"j","ǳ":"dz","ǵ":"g","ǹ":"n","ǻ":"a","ȁ":"a","ȃ":"a","ȅ":"e","ȇ":"e","ȉ":"i","ȋ":"i","ȍ":"o","ȏ":"o","ȑ":"r","ȓ":"r","ȕ":"u","ȗ":"u","ș":"s","ț":"t","ȟ":"h","ȧ":"a","ȩ":"e","ȫ":"o","ȭ":"o","ȯ":"o","ȱ":"o","ȳ":"y","ʰ":"h","ʲ":"j","ʳ":"r","ʷ":"w","ʸ":"y","ˡ":"l","ˢ":"s","ˣ":"x"};function o(e,t){var n=e.substring(0,t).search(/\S+$/),i=e.substring(t).search(/\s/);return-1===n&&(n=t),-1===i?i=e.length:i+=t,{start:n,end:i}}t.toBoolean=function(e){return e?"true"===e.toLowerCase():null},t.wordAt=function(e,t){var n=o(e,t);return e.substring(n.start,n.end)},t.inject=function(e,t,n,i){return void 0===i&&(i=n),e.substr(0,n)+t+e.substr(i,e.length)},t.wordBoundariesAt=o,t.b64DecodeUnicode=function(e){return decodeURIComponent(Array.prototype.map.call(atob(e),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))},t.normalizeString=function(e){if(e=e.toLowerCase(),String.prototype.normalize)return e.normalize(i).replace(/[\u0300-\u036f]/g,"");var t=parseInt("0xD800",16),n=parseInt("0xDBFF",16),o=0,s="",a="",c=void 0;if(!e)return e;for(;o<e.length;)s+=e.charAt(o),((c=e.charCodeAt(o))<t||c>n)&&(a+=r.hasOwnProperty(s)?r[s]:s,s=""),o++;return a},t.startsWith=function(e,t){return 0===e.indexOf(t)},t.endsWith=function(e,t){return e.lastIndexOf(t)===e.length-t.length}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.PERSON=1]="PERSON",e[e.THREAD=2]="THREAD",e[e.BOT=3]="BOT",e[e.JOIN_URL=4]="JOIN_URL",e[e.PHONE=5]="PHONE"}(t.SDKMode||(t.SDKMode={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(){function e(){}return Object.defineProperty(e,"dompurify",{get:function(){return i.swcWindow.DOMPurify},enumerable:!0,configurable:!0}),e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(18),r={id:"flik",ariaLabelLocKey:"expressionPicker_mruMojiPack_ariaLabel",titleLocKey:"expressionPicker_mruMojiPack_title",mruLimit:10},o=function(){function e(){var e=this;this.CACHE_KEY="swx|pes",this.SAVED_DATA_VERSION="v1.0",this.FEATURED_IN_PREFIX="FeaturedIn-",this.pesCDNAuthentication={skypeServiceHost:"static.asm.skype.com",tokenSourceEndpoint:"/pes/v1/petoken",cdnServiceHost:"static-asm.secure.skypeassets.com",cookieSourceEndpoint:"/token/token_to_cookies",securedPathsPatter:"static[.]asm[.]skype[.]com",cdnTokenTtlMs:3e5,rewriteRules:[{from:"static.asm.skype.com",to:"static-asm.secure.skypeassets.com"},{from:"api.asm.skype.com",to:"static-asm.secure.skypeassets.com"}]},this.itemTypes={typeKeyName:"type",tab:{id:"tab",ariaLabelLocKey:"expressionPicker_mruTab_ariaLabel",titleLocKey:"expressionPicker_mruTab_title"},emoticon:{id:"emoticon",ariaLabelLocKey:"expressionPicker_mruEmoticonPack_ariaLabel",titleLocKey:"expressionPicker_mruEmoticonPack_title",mruLimit:27},moji:r,image:{id:"image"},message:{id:"message"},sticker:{id:"sticker"},flik:r},this.mru={TAB_ID:"mru",PACK_PREFIX:"mru:"},this.bingSearch={TAB_ID:"bing",PACK_PREFIX:"bing:"},this.giphyImageSearch={TAB_ID:"giphyImages",PACK_PREFIX:"giphy-imh:"},this.localSearch={TAB_ID:"localSearch",PACK_PREFIX:"local:",titleLocKey:"expressionPicker_localSearchPack_title",ariaLabelLocKey:"expressionPicker_localSearchPack_ariaLabel"},this.frameHeights={emoticons:{SMALL:20,LARGE:40,EXTRA_LARGE:60,SUPER_LARGE:120},moji:{THUMBNAIL:40,KEYFRAME:80},packs:{TAB:19}},this.profiles={emoticons:{getSmall:function(){return e.highDpi?"default_40_f":"default_20_f"},getLarge:function(){return e.highDpi?"default_80_f":"default_40_f"},getExtraLarge:function(){return e.highDpi?"default_120_f":"default_60_f"},getSuperLarge:function(){return e.highDpi?"default_240_f":"default_120_f"},getSmallAnimated:function(){return e.highDpi?"default_40_anim_f":"default_20_anim_f"},getLargeAnimated:function(){return e.highDpi?"default_80_anim_f":"default_40_anim_f"},getExtraLargeAnimated:function(){return e.highDpi?"default_120_anim_f":"default_60_anim_f"},getSuperLargeAnimated:function(){return e.highDpi?"default_240_anim_f":"default_120_anim_f"}},moji:{thumbnail:"thumbnail",content:"default"}}}return Object.defineProperty(e.prototype,"highDpi",{get:function(){return this._highDpi||(this._highDpi=i.default.getScreenInfo().pixelRatio>1),this._highDpi},enumerable:!0,configurable:!0}),e}();t.default=new o},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(43),r=function(){function e(){}return e._personIdRegExp=/(\d+:)([\S]*)/,e.normalizePersonId=function(t){var n=t&&t.match(e._personIdRegExp);return n?n[2]:t},e.parsePersonId=function(t){var n=t.match(e._personIdRegExp);return n?{id:n[2],type:parseInt(n[1],0)}:{id:t,type:null}},e.getContactType=function(e){var t=/\d{0,}[^:]/g.exec(e.mri);return t&&t[0]?parseInt(t[0],0):i.ContactType.Undefined},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(0),o=function(){function e(e,t,n){var i=this;this._createMessageModel=e,this._generateContent=t,this._subscribedCallbacks={},this.subscribeOnceToPersonsName=function(e){i._subscribedCallbacks[e.id]||(i._subscribedCallbacks[e.id]=i._onDisplayNameChanged.bind(i,e.id),e.subscribe("displayName",i._subscribedCallbacks[e.id]))},this._onDisplayNameChanged=function(e){i._messageModel.content=i._generateContent(i),i._initiator.unsubscribe("displayName",i._subscribedCallbacks[e])},this.getInitiatorFromContent(n.content),this.getTargetsFromContent(n.content),this._messageModel=this._createMessageModel(n,this._generateContent(this),!0),r.swc.Eventing.registerEvent("proxy:configuration:setLanguage:response",function(){i._messageModel.content=i._generateContent(i)})}return e.prototype.isSelfAction=function(){return 1===this._targets.length&&this._targets[0].id===this._initiator.id},e.prototype.getInitiatorFromContent=function(e){var t=e.match(/<initiator>(\d+:.+)<\/initiator>/i);t&&(this._initiator=r.swc.services.persons.getPerson(t[1]))},e.prototype.getTargetsFromContent=function(e){var t=this,n=/(?:<target>|<id>)(\d+:.+?)(?:<\/id>|<\/target>)/i,o=e.match(/<target>.+?<\/target>/gi)||[],s=[];o.forEach(function(e){var t=e.match(n);t&&s.push(t[1])}),this._targets=s.map(function(e){return r.swc.services.persons.getPerson(e,!0)}),i.default.get.isTeams()&&this._targets.length>1&&(this._targets=this._targets.filter(function(e){return e.mri!==t._initiator.mri}))},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.SEARCH="search",e.CONTACTS="contacts",e.RECENT="recent",e.NEWCHAT="new",e.AVATAR="avatar",e.CONVERSATION_ROSTER="conversationRoster",e.ADD_PARTICIPANTS_TEAMS="addParticipantsTeams",e.NOTIFICATION="openNotification"}(t.OpenChatOrigin||(t.OpenChatOrigin={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.SDK_LOADER="sdk-loader",e.SDK_CORE="sdk-core",e.ASSETS="assets-bundle",e.BUILDER="builder-bundle",e.BUILDER_CORE="builder-core",e.CALLING="calling-bundle",e.CALLING_STANDALONE="callingStandalone-bundle",e.SERVICES="services-bundle",e.CHAT_BUNDLE="chat-bundle",e.RECENTS_BUNDLE="recents-bundle",e.UICOMPONENT_BUNDLE="uicomponent-bundle",e.TELEMETRY_BUNDLE="telemetry-bundle",e.VENDORS="vendors",e.CONNECT="connect",e.POLYFILLS="polyfills",e.HOST_CHAT_PAGE="host-chat",e.HOST_BING_PAGE="host-button",e.HOST_BUILDER_PAGE="host-builder",e.STYLE_BUILDER="swc-builder",e.STYLE_SDK="swc-sdk",e.STYLE_CHAT_SKYPE="swc-chat",e.STYLE_RECENTS_SKYPE="swc-recents",e.STYLE_CHAT_BING="swc-bing",e.STYLE_CHAT_THEME_DARK="swc-dark",e.STYLE_CALLING="swc-calling",e}();t.PackageName=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(21),o=n(0),s=n(12),a=n(10),c=n(153),u=n(28),l={retryCount:3,timeout:5e4,policy:""},p=function(e,t){void 0===t&&(t={});var n=Object.assign({},t);return c.getHeaders().then(function(t){return n.method=e,n.headers=n.headers||{},Object.assign(n.headers,{ClientInfo:i.Configuration.getChatClientInfo(),Pragma:"no-cache",Expires:0,ContextId:"tcid="+s.guid.generate(),BehaviorOverride:"redirectAs404",Accept:"application/json"},t),n})},d=function(e,t,n,i,r){return void 0===r&&(r=3),429===t.status||500===t.status||503===t.status?0===r?Promise.reject(t):a.default("webapi-"+e,l,n,i).then(function(t){return new Promise(function(o){setTimeout(function(){o(d(e,t,n,i,r-1))},2e3*(3-r+1))})}):Promise.resolve(t)},f=function(e,t,n,i,s,h){return p(t,i).then(function(g){if(!u.getDomain())return o.swc.services.signInManager.logout("services:domain is undefined"),Promise.reject({message:"Domain is undefined"});var m=s?n:u.getDomain()+n;return a.default("webapi-"+e,l,m,g).then(c.handleRegTokenExpiry).catch(function(n){return o.swc.services.signInManager.state===r.SigninState.SignedOut?Promise.reject(n):p(t,i).then(function(t){return a.default("webapi-"+e,l,m,t)})}).then(c.handleRegTokenExpiry).catch(function(e){return Promise.reject(e)}).then(function(s){return o.swc.services.signInManager.state===r.SigninState.SignedOut?Promise.reject(s):p(t,i).then(function(t){return d(e,s,u.getDomain()+n,t)})}).then(c.processHeaders).then(function(r){return u.handle404Redirect(r,function(r){return void 0===r&&(r=n),f(e,t,r,i,s)},h)})})};t.get=function(e,t,n,i,r){return f(e,"GET",t,n,i,r)},t.getWithDomain=function(e,t,n,i){return void 0===i&&(i=!1),f(e,"GET",t,n,!0,i)},t.put=function(e,t,n,i,r){return f(e,"PUT",t,n,i,r)},t.del=function(e,t,n){return f(e,"DELETE",t,n)},t.post=function(e,t,n,i){return f(e,"POST",t,n,i)},t.parseJson=function(e){return e.json().then(function(t){return e.ok?Promise.resolve(t):Promise.reject(t)})},t.reset=function(){c.reset(),u.reset()};var h=n(44);t.addGetParamsToUrl=h.addGetParamsToUrl},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Skype=8]="Skype",e[e.Agent=28]="Agent",e[e.Pstn=4]="Pstn",e[e.MSA=1]="MSA",e[e.Undefined=0]="Undefined"}(t.ContactType||(t.ContactType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addGetParamsToUrl=function(e,t){var n=[],i=function(e){if(void 0!==t[e]){var i=encodeURIComponent(e);if(Array.isArray(t[e]))t[e].forEach(function(e){var t=encodeURIComponent(e);n.push(i+"="+t)});else{var r=encodeURIComponent(t[e].toString());n.push(i+"="+r)}}};for(var r in t)i(r);return e+"?"+n.join("&")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.swcPostMessage=function(e,t,n){e.postMessage(t,n||"*")}},function(e,t,n){(function(t){var n="Expected a function",i=NaN,r="[object Symbol]",o=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt,l="object"==typeof t&&t&&t.Object===Object&&t,p="object"==typeof self&&self&&self.Object===Object&&self,d=l||p||Function("return this")(),f=Object.prototype.toString,h=Math.max,g=Math.min,m=function(){return d.Date.now()};function v(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function y(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&f.call(e)==r}(e))return i;if(v(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=v(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(o,"");var n=a.test(e);return n||c.test(e)?u(e.slice(2),n?2:8):s.test(e)?i:+e}e.exports=function(e,t,i){var r,o,s,a,c,u,l=0,p=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError(n);function _(t){var n=r,i=o;return r=o=void 0,l=t,a=e.apply(i,n)}function b(e){var n=e-u;return void 0===u||n>=t||n<0||d&&e-l>=s}function T(){var e=m();if(b(e))return S(e);c=setTimeout(T,function(e){var n=t-(e-u);return d?g(n,s-(e-l)):n}(e))}function S(e){return c=void 0,f&&r?_(e):(r=o=void 0,a)}function w(){var e=m(),n=b(e);if(r=arguments,o=this,u=e,n){if(void 0===c)return function(e){return l=e,c=setTimeout(T,t),p?_(e):a}(u);if(d)return c=setTimeout(T,t),_(u)}return void 0===c&&(c=setTimeout(T,t)),a}return t=y(t)||0,v(i)&&(p=!!i.leading,s=(d="maxWait"in i)?h(y(i.maxWait)||0,t):s,f="trailing"in i?!!i.trailing:f),w.cancel=function(){void 0!==c&&clearTimeout(c),l=0,r=u=o=c=void 0},w.flush=function(){return void 0===c?a:S(m())},w}}).call(this,n(26))},function(e,t,n){"use strict";function i(e){return!!e&&(0===e.indexOf("fb-")||0===e.indexOf("pr-"))}Object.defineProperty(t,"__esModule",{value:!0}),t.versionRegExp=/^\d+\.\d+\.\d+$/,t.getBranchParentFolder=function(e){return i(e)?"fb":"v"},t.isAppVersion=function(e){return!!e&&t.versionRegExp.test(e)},t.isFeatureBranch=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,s=n(13),a=n(11),c=function(e){function t(){var t=e.call(this)||this;return t._isOnline=navigator.onLine,t.subscribeOnlineHandlers(),t}return r(t,e),Object.defineProperty(t.prototype,"isOnline",{get:function(){return this._isOnline},set:function(e){e!==this._isOnline&&(this._isOnline=e,this.publish("isOnline",e),e&&this._onlinePromise&&this._onlinePromise.status===a.PromiseStatus.Pending&&this._onlinePromise.resolve())},enumerable:!0,configurable:!0}),t.prototype.onceOnline=function(){return this.isOnline?Promise.resolve():(this._onlinePromise&&this._onlinePromise.status===a.PromiseStatus.Pending||(this._onlinePromise=new a.CancelablePromise),this._onlinePromise.promise)},t.prototype.subscribeOnlineHandlers=function(){window.addEventListener("online",this.onlineStatusHandler.bind(this)),window.addEventListener("offline",this.onlineStatusHandler.bind(this))},t.prototype.onlineStatusHandler=function(){this.isOnline=navigator.onLine},t}(s.default);t.get=function(){return o||(o=new c),o}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="px",r="all 0.5s ease";function o(e,t){var n=e.style;n.top=t.top+i,n.left=t.left+i,n.width=t.width+i,n.height=t.height+i}function s(e){return window.getComputedStyle(e)}t.transport=function(e,t,n,i,s,a){var c=e.getBoundingClientRect(),u=function(e){return t.appendChild(e)};a||u(e),e.style.transition=r,o(e,c),setTimeout(function(){return o(e,n)},0),setTimeout(function(){s(),e.style.transition=null,a&&u(e)},i)},t.setRectStyle=o,t.resetRectStyle=function(e){var t=e.style;t.width=t.height=t.top=t.bottom=t.right=t.left=null},t.isInDom=function(e){if(e)for(;e.parentNode;)if((e=e.parentNode)===document.documentElement)return!0;return!1},t.innerSize=function(e){var t=s(e);return{width:e.offsetWidth-parseInt(t.paddingLeft,10)-parseInt(t.paddingRight,10),height:e.offsetHeight-parseInt(t.paddingTop,10)-parseInt(t.paddingBottom,10)}},t.setStyle=function(e,t){e.setAttribute("style",t)},t.style=s,t.copyStyle=function(e,t,n){for(var i=s(t),r=e.style,o=0,a=n;o<a.length;o++){var c=a[o];r[c]=i[c]}},t.isInIframe=function(){try{return window.self!==window.top}catch(e){return!0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(40),o=n(0),s=n(22),a="/sdk/v1/",c="sdk",u="js",l=function(){function e(){}return e.startChat=function(e,t,n,r,s){var a={ConversationId:e||"",Style:t.Style,Title:t.Title,SetConversationTopic:t.SetConversationTopic,NewChatFlag:n,DisableAvatarClickAction:t.DisableAvatarClickAction,EnableCalling:t.EnableCalling};s&&(a.ExecuteCall=s),!i.default.get.frameless||o.swc.services.signInManager.isTrusted?o.swc.Eventing.triggerEvent("startChat",a):o.swc.Eventing.triggerLocalEvent("openChatLocal",a),o.swc.Telemetry.sendEvent.recentsAction(e?"openChat":"newChat",r)},e.startCall=function(t,n,i,o,s,a){var c={calleeId:t,withVideo:i,displayName:o,avatarUrl:s,isGroup:a};e.startChat(t,n,!1,r.OpenChatOrigin.RECENT,c)},e.joinGroupCall=function(t,n,i,o,s){var a={threadId:t,withVideo:i,displayName:o,avatarUrl:s,isGroup:!0,accept:!0};e.startChat(t,n,!1,r.OpenChatOrigin.RECENT,a)},e.closeAllOpenChats=function(){o.swc.Eventing.triggerEvent("closeAllChats")},e._getSDKUrl=function(){var e=a+c,t=s.UrlHelper.getCompletePath(e,u);return s.UrlHelper.getCDNPath(o.swc.EcsConfig)+t},e._callingPopup=null,e}();t.default=l},function(e,t,n){"use strict";var i,r,o;Object.defineProperty(t,"__esModule",{value:!0}),window.swc=window.swc||{},function(e){e[e.iwapp=927]="iwapp",e[e.todo=927]="todo",e[e.wac=928]="wac",e[e.wordonline=928]="wordonline",e[e.powerbi=930]="powerbi",e[e.sharepoint=931]="sharepoint",e[e.adminportal=932]="adminportal",e[e.yammer=933]="yammer",e[e.dynamics365=934]="dynamics365",e[e.dynamicsnav=934]="dynamicsnav"}(i||(i={})),function(e){e[e.outlook=915]="outlook",e[e.interviews=916]="interviews",e[e.bing=917]="bing",e[e.msn=918]="msn",e[e.azureportal=919]="azureportal",e[e.onedrive=920]="onedrive",e[e.scom=921]="scom",e[e.office=927]="office",e[e.word=928]="word",e[e.excel=929]="excel",e[e.powerpoint=930]="powerpoint",e[e.sharepoint=931]="sharepoint",e[e.adminportal=932]="adminportal",e[e.yammer=933]="yammer",e[e.dynamics=934]="dynamics",e[e["office default"]=935]="office default"}(r=t.NameMapping||(t.NameMapping={})),function(e){e[e["outlook.live.com"]=915]="outlook.live.com",e[e["outlook-sdf.live.com"]=915]="outlook-sdf.live.com",e[e["outlook.office.com"]=915]="outlook.office.com",e[e["outlook-sdf.office.com"]=915]="outlook-sdf.office.com",e[e["interviews.skype.com"]=916]="interviews.skype.com",e[e["interviews-df.skype.com"]=916]="interviews-df.skype.com",e[e["interviews-int.skype.com"]=916]="interviews-int.skype.com",e[e["www.bing.com"]=917]="www.bing.com",e[e["www.staging-bing-int.com"]=917]="www.staging-bing-int.com",e[e["www.bing-int.com"]=917]="www.bing-int.com",e[e["www.msn.com"]=918]="www.msn.com",e[e["int.msn.com"]=918]="int.msn.com",e[e["int1.msn.com"]=918]="int1.msn.com",e[e["wtskype2.azurewebsites.net"]=919]="wtskype2.azurewebsites.net",e[e["azuresupportextension-ms.hosting.portal.azure.net"]=919]="azuresupportextension-ms.hosting.portal.azure.net",e[e["portal.azure.com"]=919]="portal.azure.com",e[e["rc.portal.azure.com"]=919]="rc.portal.azure.com",e[e["ms.portal.azure.com"]=919]="ms.portal.azure.com",e[e["onedrive.live.com"]=920]="onedrive.live.com",e[e["www.skype.com"]=921]="www.skype.com",e[e["www.office.com"]=927]="www.office.com",e[e["microsoft-my.sharepoint.com"]=931]="microsoft-my.sharepoint.com",e[e["www.onedrive.com"]=920]="www.onedrive.com",e[e["word.office.com"]=928]="word.office.com",e[e["word.live.com"]=928]="word.live.com",e[e["excell.office.com"]=929]="excell.office.com",e[e["excell.live.com"]=929]="excell.live.com",e[e["powerpoint.office.com"]=930]="powerpoint.office.com",e[e["powerpoint.live.com"]=930]="powerpoint.live.com",e[e["sharepoint.office.com"]=931]="sharepoint.office.com",e[e["adminportal.office.com"]=932]="adminportal.office.com",e[e["www.yammer.com"]=933]="www.yammer.com",e[e["dynamics.office.com"]=934]="dynamics.office.com",e[e[".office.com"]=935]=".office.com"}(o||(o={}));var s=function(){function e(){}return e.getPlatformId=function(e){if(void 0===e&&(e=null),this._platformId)return this._platformId;if(swc.SDK&&swc.SDK.platformId&&swc.SDK.platformId>0)return this._platformId=swc.SDK.platformId,this._platformId;var t=-1;return e&&(t=this.getPlatformIdByAttribute(e)),t<=0&&(t=this.getPlatformIdByDomain()),t>0?t:912},e.getPlatformIdByAttribute=function(e){if(e){e=e.trim().toLowerCase();var t=parseInt(e,10);return t&&t>0?t:this.getPlatformIdForOffice(e)}return-1},e.getPlatformName=function(){var e=this.getPlatformId();return r[e]?r[e]:"other"},e.getPlatformIdForOffice=function(e){return i[e]||935},e.getPlatformIdByDomain=function(){var t=e.getHost();if(o.hasOwnProperty(t))return o[t];for(var n in o)if("."===n.charAt(0)&&t.indexOf(n)>0)return o[n];return-1},e.getHost=function(){try{var e=window.location.hostname;return!e&&e.length>0?e:("file:"===window.location.protocol.toLowerCase()&&(e="local"),e)}catch(e){return null}},e}();t.PlatformUtils=s},function(e,t,n){(function(t){(function(){!function(e){"use strict";if(!e.fetch){var t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(t.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],i=function(e){return e&&DataView.prototype.isPrototypeOf(e)},r=ArrayBuffer.isView||function(e){return e&&n.indexOf(Object.prototype.toString.call(e))>-1};l.prototype.append=function(e,t){e=a(e),t=c(t);var n=this.map[e];n||(n=[],this.map[e]=n),n.push(t)},l.prototype.delete=function(e){delete this.map[a(e)]},l.prototype.get=function(e){var t=this.map[a(e)];return t?t[0]:null},l.prototype.getAll=function(e){return this.map[a(e)]||[]},l.prototype.has=function(e){return this.map.hasOwnProperty(a(e))},l.prototype.set=function(e,t){this.map[a(e)]=[c(t)]},l.prototype.forEach=function(e,t){Object.getOwnPropertyNames(this.map).forEach(function(n){this.map[n].forEach(function(i){e.call(t,i,n,this)},this)},this)},l.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),u(e)},l.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),u(e)},l.prototype.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),u(e)},t.iterable&&(l.prototype[Symbol.iterator]=l.prototype.entries);var o=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];m.prototype.clone=function(){return new m(this,{body:this._bodyInit})},g.call(m.prototype),g.call(y.prototype),y.prototype.clone=function(){return new y(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new l(this.headers),url:this.url})},y.error=function(){var e=new y(null,{status:0,statusText:""});return e.type="error",e};var s=[301,302,303,307,308];y.redirect=function(e,t){if(-1===s.indexOf(t))throw new RangeError("Invalid status code");return new y(null,{status:t,headers:{location:e}})},e.Headers=l,e.Request=m,e.Response=y,e.fetch=function(e,n){return new Promise(function(i,r){var o=new m(e,n),s=new XMLHttpRequest;s.onload=function(){var e,t,n={status:s.status,statusText:s.statusText,headers:(e=s.getAllResponseHeaders()||"",t=new l,e.split("\r\n").forEach(function(e){var n=e.split(":"),i=n.shift().trim();if(i){var r=n.join(":").trim();t.append(i,r)}}),t)};n.url="responseURL"in s?s.responseURL:n.headers.get("X-Request-URL");var r="response"in s?s.response:s.responseText;i(new y(r,n))},s.onerror=function(){r(new TypeError("Network request failed"))},s.ontimeout=function(){r(new TypeError("Network request failed"))},s.open(o.method,o.url,!0),"include"===o.credentials&&(s.withCredentials=!0),"responseType"in s&&t.blob&&(s.responseType="blob"),o.headers.forEach(function(e,t){s.setRequestHeader(t,e)}),s.send(void 0===o._bodyInit?null:o._bodyInit)})},e.fetch.polyfill=!0}function a(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function c(e){return"string"!=typeof e&&(e=String(e)),e}function u(e){var n={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return t.iterable&&(n[Symbol.iterator]=function(){return n}),n}function l(e){this.map={},e instanceof l?e.forEach(function(e,t){this.append(t,e)},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function p(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function d(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function f(e){var t=new FileReader,n=d(t);return t.readAsArrayBuffer(e),n}function h(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function g(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(t.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(t.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(t.arrayBuffer&&t.blob&&i(e))this._bodyArrayBuffer=h(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!t.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!r(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=h(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var e=p(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?p(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(f)}),this.text=function(){var e,t,n,i=p(this);if(i)return i;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=d(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),i=0;i<t.length;i++)n[i]=String.fromCharCode(t[i]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(v)}),this.json=function(){return this.text().then(JSON.parse)},this}function m(e,t){var n,i,r=(t=t||{}).body;if("string"==typeof e)this.url=e;else{if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new l(e.headers)),this.method=e.method,this.mode=e.mode,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new l(t.headers)),this.method=(n=t.method||this.method||"GET",i=n.toUpperCase(),o.indexOf(i)>-1?i:n),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function v(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),i=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(i),decodeURIComponent(r))}}),t}function y(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new l(t.headers),this.url=t.url||"",this._initBody(e)}}("undefined"!=typeof self?self:this),e.exports=t.fetch}).call(t)}).call(this,n(26))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.read=0]="read"}(t.Permission||(t.Permission={})),function(e){e[e.Success=1]="Success",e[e.InProgress=2]="InProgress",e[e.ScanInProgress=3]="ScanInProgress",e[e.Failed=4]="Failed",e[e.Malware=5]="Malware"}(t.DocumentStatus||(t.DocumentStatus={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=n(0),o={caseFirst:"upper"},s=function(){function e(){}return e.mapSearchProfileInfo=function(e){return e&&e.results?e.results.map(function(e){var t=e.nodeProfileData.skypeId,n={skypeid:-1===t.indexOf("8:")?"8:"+t:t,name:e.nodeProfileData.name,avatar:e.nodeProfileData.avatarUrl,type:i.ContactType.Skype,contactType:e.nodeProfileData.contactType,annotation:e.nodeAnnotation,jobTitle:e.nodeProfileData.jobTitle,department:e.nodeProfileData.department,location:e.nodeProfileData.location};return e.nodeConnectionData&&(n.distance=e.nodeConnectionData.distance,n.mutualFriendCount=e.nodeConnectionData.mutualFriendCount),n}):[]},e.getWrappedIdWithMri=function(e){var t=/^\d+:/.exec(e.id);if(t&&t[0])return e.id;var n=e.isAgent?/^28:/:/^8:/;return(e.isAgent?"28:":"8:")+e.id.replace(n,"")},e.sortByName=function(e,t){var n=e.person.displayName.localeCompare(t.person.displayName,void 0,o);return 0===n?e.person.id.localeCompare(t.person.id):n},e.getSortedByRelevance=function(t){var n=t.filter(function(e){return e.rawPerson.mutualFriendCount}).sort(function(e,t){return t.rawPerson.mutualFriendCount-e.rawPerson.mutualFriendCount}),i=t.filter(function(e){return!e.rawPerson.mutualFriendCount}).sort(e.sortByName);return n.concat(i)},e.preloadImage=function(e,t,n){if(e.indexOf("data:image/jpeg;base64")>-1)t&&"function"==typeof t&&t(e);else{if(-1!==e.indexOf("https://teams.microsoft.com")){var i=r.swc.services.avatarService;if(i.fetchSingleAvatar&&t&&"function"==typeof t)return void i.fetchSingleAvatar(e).then(function(e){t(e)})}var o=new Image,s=encodeURI(decodeURI(e));o.onload=function(){t&&"function"==typeof t&&t(s)},o.onerror=function(e){n&&"function"==typeof n&&n()},o.src=s}},e.replaceAvatarPath=function(e){return e.indexOf("data:image/jpeg;base64")>-1?e:e=(e=e.replace("URL@","")).indexOf("/views/avatar_fullsize")<0?e+"/views/avatar_fullsize":e},e.resolveConversationAvatar=function(t,n){return n?t?e.replaceAvatarPath(n):n:""},e}();t.default=s},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(27),r=function(){function e(){this.loaded=[],this.progress={}}return e.prototype.addScript=function(e,t,n){var r=this;if(-1===this.loaded.indexOf(e)){var o=this.progress;if(o[e])return t&&-1===o[e].success.indexOf(t)&&o[e].success.push(t),void(n&&-1===o[e].failure.indexOf(n)&&o[e].failure.push(n));o[e]={success:[],failure:[]},t&&o[e].success.push(t),n&&o[e].failure.push(n);var s=i.default.getDocument(),a=s.createElement("script");a.crossOrigin="anonymous",a.type="text/javascript",a.src=e,t&&(a.onload=function(){r.progress[e].success.forEach(function(e){try{e()}catch(e){}}),delete r.progress[e],r.loaded.push(e)}),n&&(a.onerror=function(){r.progress[e].failure.forEach(function(e){try{e()}catch(e){}}),delete r.progress[e]}),s.getElementsByTagName("body")[0].appendChild(a)}else t&&t()},e}();t.ScriptLoader=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(58),r=n(59),o=n(4),s=n(8),a=n(29),c=n(80),u=n(32),l=function(){function e(){}return e.prototype.parseBaseDom=function(e,t){var n=t.getAttribute(i.Attributes.ID);n&&(e.ConversationId=a.default.getNormalizeId(n));var r=t.getAttribute(i.Attributes.BOT_ID);r&&(e.ConversationId=a.default.getNormalizeId(r)),(r=t.getAttribute(i.Attributes.CONTACT_EMAIL))&&(e.ConversationId=r),(r=t.getAttribute(i.Attributes.PHONE_NUMBER))&&(e.ConversationId=a.default.getNormalizeId(r)),(r=t.getAttribute(i.Attributes.CONTACT_ID))&&(e.ConversationId=a.default.getNormalizeId(r)),(r=t.getAttribute(i.Attributes.THREAD_ID))&&(e.ConversationId=a.default.getNormalizeId(r)),(r=t.getAttribute(i.Attributes.JOIN_LINK))&&(e.ConversationId=r),(r=t.getAttribute(i.Attributes.TOKEN))&&(e.ConversationId=r),this.parseDom(e,i.Attributes,t)},e.prototype.parseDom=function(e,t,n){c.objectProperties(e,function(i){if(i&&t[i]&&n.getAttribute(t[i])){var r=n.getAttribute(t[i]);if(!r)return;"true"===r.toLowerCase()||"false"===r.toLowerCase()?e[i]=u.toBoolean(r):e[i]=r}})},e.prototype.setBaseDOM=function(e,t){if(this.setDom(e,i.Attributes,t),e.ConversationId){t.removeAttribute(i.Attributes.PHONE_NUMBER),t.removeAttribute(i.Attributes.CONTACT_ID),t.removeAttribute(i.Attributes.BOT_ID),t.removeAttribute(i.Attributes.JOIN_LINK);var n=a.default.detectConversationType(e.ConversationId);n===o.ConversationType.AGENT?t.setAttribute(i.Attributes.BOT_ID,a.default.getNormalizeId(e.ConversationId)):n===o.ConversationType.PERSON?t.setAttribute(i.Attributes.CONTACT_ID,a.default.getNormalizeId(e.ConversationId)):n===o.ConversationType.GROUP?t.setAttribute(i.Attributes.THREAD_ID,e.ConversationId):n===o.ConversationType.JOIN?t.setAttribute(i.Attributes.JOIN_LINK,e.ConversationId):n===o.ConversationType.PHONE?t.setAttribute(i.Attributes.PHONE_NUMBER,e.ConversationId):s.default.throwError(10002,"Unsupported conversation id:",null,e.ConversationId)}},e.prototype.setDom=function(e,t,n,i){c.objectProperties(e,function(r){if(void 0!==e[r]&&null!==e[r]&&""!==e[r]){var o=e[r];if("boolean"==typeof o&&(o=o.toString()),!t[r])return;if(i&&e[r]===i[r])return;n.setAttribute(t[r],o)}})},e.prototype.parseBaseUrlParams=function(e,t){t[i.Attributes.BOT_ID]?e.ConversationId=a.default.getNormalizeId(t[i.Attributes.BOT_ID]):t[i.Attributes.PHONE_NUMBER]?e.ConversationId=a.default.getNormalizeId(t[i.Attributes.PHONE_NUMBER]):t[i.Attributes.CONTACT_ID]?e.ConversationId=a.default.getNormalizeId(t[i.Attributes.CONTACT_ID]):t[i.Attributes.THREAD_ID]?e.ConversationId=a.default.getNormalizeId(t[i.Attributes.THREAD_ID]):t[i.Attributes.JOIN_LINK]?e.ConversationId=t[i.Attributes.JOIN_LINK]:t[i.Attributes.TOKEN]&&(e.ConversationId=t[i.Attributes.TOKEN]),t[i.Attributes.SWC_Locale]&&(e.Locale=t[i.Attributes.SWC_Locale]),t[i.Attributes.SWC_ForceFrame]&&(e.ForceFrame=u.toBoolean(t[i.Attributes.SWC_ForceFrame])),t[i.Attributes.SWC_IsMinified]&&(e.IsMinified=u.toBoolean(t[i.Attributes.SWC_IsMinified])),this.parseUrlParams(e,i.Attributes,t)},e.prototype.parseUrlParams=function(e,t,n){c.objectProperties(e,function(i){if(n[t[i]]){var r=n[t[i]];"true"===r.toLowerCase()||"false"===r.toLowerCase()?e[i]=u.toBoolean(r):e[i]=r}})},e.prototype.getQueryStringParameters=function(){var e=!1,t=window.location.search.substring(1).split("&"),n={};return t.forEach(function(t){if(t){e=!0;var i=t.split("=");n[decodeURIComponent(i[0])]=decodeURIComponent(i[1])||""}}),e?n:null},e.prototype.getDefinitionFromUrl=function(){var e=this.getQueryStringParameters(),t=new r.Definition;return e?(this.parseBaseUrlParams(t,e),this.parseUrlParams(t,i.Attributes,e),t):t},e}();t.ConfigFactory=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.Theme="data-theme",e.Locale="data-locale",e.SWC_Locale="swc-locale",e.SWC_ForceFrame="swc-force-frame",e.SWC_IsMinified="swc-min",e.ID="data-id",e.BOT_ID="data-bot-id",e.CONTACT_ID="data-contact-id",e.PHONE_NUMBER="data-phone-number",e.CONTACT_EMAIL="data-contact-email",e.JOIN_LINK="data-join-link",e.THREAD_ID="data-thread-id",e.TOKEN="data-token",e.Payload="data-payload",e.BingDLApi="data-bing-dl-api",e.Title="data-title",e.Avatar="data-avatar",e.Prefill="data-prefill",e.PrivacyUri="data-privacy-uri",e.TermsOfUseUri="data-tou-uri",e.EnableCalling="data-enable-calling",e.CallingOnly="data-calling-only",e.DisableSendingEmoticons="data-disable-sending-emoticons",e.TrafficProvider="data-provider",e.TrafficSource="data-source",e.DisableInOutAnimation="data-disable-inout-animation",e.CorrelationId="data-correlation-id",e.SkypeOnly="data-skype-only",e.Style="data-style",e.DisableInput="data-disable-input",e.EnableParticipantsControl="data-enable-participants-control",e.InputPlaceholder="data-input-placeholder",e.ForceAuthentication="data-force-authentication",e.TitleColor="data-title-color",e.TitleBackground="data-title-background",e.PlatformFeature="data-platform-feature",e}();t.Attributes=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t){this.Locale="",this.Theme="",this.Payload="",this.BingDLApi=!1,this.Title="",this.Avatar="",this.PrivacyUri="",this.TermsOfUseUri="",this.Prefill="",this.EnableCalling=null,this.CallingOnly=null,this.DisableSendingEmoticons=!1,this.TrafficProvider="",this.TrafficSource="",this.DisableInOutAnimation=!1,this.SkypeOnly=!1,this.Style="",this.DisableInput=!1,this.EnableParticipantsControl=!0,this.InputPlaceholder="",this.ForceAuthentication=!1,this.PlatformFeature="",this.TitleColor="",this.TitleBackground="",this.Partner="",t instanceof e&&Object.assign(this,t)}return e.prototype.MergeWith=function(e){if(e){var t=e;for(var n in t)t.hasOwnProperty(n)&&0!==n.indexOf("_")&&void 0!==t[n]&&null!==t[n]&&""!==t[n]&&(this[n]=t[n])}},e.prototype.MergeWithJSON=function(e){if(e)for(var t in e)void 0!==e[t]&&null!==e[t]&&""!==e[t]&&(this[t]=e[t])},e}();t.Definition=i},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=1048576;t.checkFile=function(e,t){if(!t)return{supportedFileSize:!0,supportedFileExtension:!0,supportedFileType:!0};var n=isNaN(t.size)||e.size/r<=t.size,i=e.name.split("."),o=function(e,t){return!t||!t.length||e&&t.indexOf(e)>-1};return{supportedFileSize:n,supportedFileExtension:o(i.length>1&&"."+i.pop(),t.extensions),supportedFileType:o(e.type,t.types)}},t.isDocumentTypeImage=function(e){return-1!==e.indexOf("image")},t.createImageMessage=function(e,t){var n=i.Configuration.AMS_HOST_URL+"objects/"+t,r=i.Configuration.AMS_HOST_URL+"objects/"+t+"/views/imgt1",o="https://login.skype.com/login/sso?go=webclient.xmm&amp;pic="+t,s=e.name;return['<URIObject type="Picture.1" uri="'+n+'" url_thumbnail="'+r+'">','To view this shared photo, go to: <a href="'+o+'">'+o+"</a>",'<OriginalName v="'+s+'"/><meta type="photo" originalName="'+s+'"/>',"</URIObject>"].join("")},t.createFileMessage=function(e,t){var n=i.Configuration.AMS_HOST_URL+"objects/"+t,r=i.Configuration.AMS_HOST_URL+"objects/"+t+"/views/thumbnail",o="https://login.skype.com/login/sso?go=webclient.xmm&amp;docid="+t,s=e.name;return['<URIObject type="File.1" uri="'+n+'" url_thumbnail="'+r+'">',"<Title>Title: "+s+"</Title>","<Description> Description: "+s+"</Description>",'<a href="'+o+'">'+o+"</a>",'<OriginalName v="'+s+'"/>','<FileSize v="'+e.size+'"/>',"</URIObject>"].join("")},t.getNameAndExtension=function(e){var t=(e||"").split("."),n="",i="";return t.length>1?(i=t.pop().toLowerCase(),n=t.join(".")):(i="",n=t[0]),{name:n,extension:i}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(54),r=n(9),o="returnDefaultImage=false",s="returnDefaultImage=true",a="?returnDefaultImage",c="?auth_key=",u=["rgb(153, 180, 51)","rgb(107, 165, 231)","rgb(231, 115, 189)","rgb(0, 163, 0)","rgb(30, 113, 69)","rgb(255, 0, 151)","rgb(126, 56, 120)","rgb(96, 60, 186)","rgb(29, 29, 29)","rgb(0, 171, 169)","rgb(45, 137, 239)","rgb(43, 87, 151)","rgb(218, 83, 44)","rgb(185, 29, 71)","rgb(238, 17, 17)"];t.loadAvatarUri=function(e,t,n){e&&(e.indexOf(c)<0&&(e=e.indexOf(a)<0?function(e){var t=e.split("?")[0],n=e.split("?")[1],i=function(e){return e.indexOf("/profile/avatar")>-1||e.indexOf("/public")>-1}(e);return n?(e=t+"?"+n,e+=i?"&"+o:""):e+=i?"?"+o:"",e}(e):e.replace(s,o)),i.default.preloadImage(e,t,n))},t.getBackgroundColor=function(e){for(var t=0,n=(e&&e.length||0)-1;n>=0;n--){var i=e.charCodeAt(n),r=n%8;t^=(i<<r)+(i>>8-r)}return u[t%u.length]},t.getInitials=function(e){var t="",n=(e=function(e){return r.MessageUtils.getMessageSanitizedContent(e).replace(/\s+/gi," ").trim()}(e)).split(" ");return n.length>1?(t+=n[0][0]?n[0][0]:"",t+=n[1][0]?n[1][0]:""):n.length&&(t+=n[0][0]?n[0][0]:"",t+=n[0][1]?n[0][1]:""),t.toUpperCase()}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.unknown=0]="unknown",e[e.card=1]="card",e[e.carousel=2]="carousel",e[e.signin=3]="signin",e[e.receipt=4]="receipt",e[e.multiline=5]="multiline",e[e.adaptive=6]="adaptive"}(t.SwiftCardType||(t.SwiftCardType={})),function(e){e[e.unknown=0]="unknown",e[e.hero=1]="hero",e[e.thumb=2]="thumb",e[e.receipt=3]="receipt",e[e.signin=4]="signin",e[e.video=5]="video",e[e.audio=6]="audio",e[e.animation=7]="animation",e[e.actionImage=8]="actionImage",e[e.flex=9]="flex",e[e.adaptive=10]="adaptive"}(t.SwiftCardContentType||(t.SwiftCardContentType={})),function(e){e[e.unknown=0]="unknown",e[e.unsupported=1]="unsupported",e[e.openUrl=2]="openUrl",e[e.imBack=3]="imBack",e[e.signin=4]="signin",e[e.call=5]="call",e[e.showImage=6]="showImage",e[e.payment=7]="payment",e[e.postBack=8]="postBack"}(t.SwiftCardActionType||(t.SwiftCardActionType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.UserMessage="UserMessage",e.SwiftCard="SwiftCard",e.SystemMessage="SystemMessage",e.Unsupported="Unsupported",e.SkypeLogo="SkypeLogo",e.Welcome="Welcome",e.Translate="Translate",e.LwcImage="LwcImage",e.LwcFile="LwcFile",e.LwcCallRecording="LwcCallRecording",e.UnreadSplitter="UnreadSplitter"}(t.MessageType||(t.MessageType={})),function(e){e.CallEnd="CallEndMsg",e.MissedCall="MissedCallMsg",e.MissedGroupCall="MissedGroupCallMsg",e.Call="CallMsg",e.Custom="CustomMsg",e.MeLeftGroup="MeLeftGroupConversation"}(t.CustomMessageType||(t.CustomMessageType={})),function(e){e[e.Incoming=0]="Incoming",e[e.Outgoing=1]="Outgoing"}(t.Direction||(t.Direction={})),function(e){e[e.Pending=0]="Pending",e[e.Sent=1]="Sent",e[e.Failed=2]="Failed"}(t.DeliveryStatus||(t.DeliveryStatus={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.addMember="addMember",e.changeTopic="changeTopic",e.changePicture="changePicture",e.kickMember="kickMember",e.editMsg="editMsg",e.callP2P="callP2P",e.sendText="sendText",e.sendSms="sendSms",e.sendFileP2P="sendFileP2P",e.sendContacts="sendContacts",e.sendVideoMsg="sendVideoMsg",e.sendMediaMsg="sendMediaMsg",e.changeModerated="changeModerated"}(t.ParticipantCapabilities||(t.ParticipantCapabilities={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.UNDEFINED="",e.PERSON="person",e.PHONE="phone",e.AGENT="agent",e.JOIN="join",e.GROUP="group"}(t.ConversationType||(t.ConversationType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Admin="Admin",e.User="User"}(t.ParticipantRole||(t.ParticipantRole={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.getQueryParameters=function(){var e=window.location.search.substring(1);return this.extractQueryParameters(e)},e.extractQuery=function(e){var t="";return e.indexOf("?")>-1&&(t=e.split("?")[1]),t},e.getQueryParameter=function(e,t){var n=this.extractQuery(e);return n?this.extractQueryParameters(n)[t]:null},e.extractQueryParameters=function(e){var t=e.split("&"),n={};return t.forEach(function(e){var t=e.split("=");n[decodeURIComponent(t[0])]=decodeURIComponent(t[1])||""}),n},e.extractProtocol=function(e){var t=null;return e.indexOf("://")>-1&&(t=e.split("://")[0]),t},e.extractHostname=function(e){return(e.indexOf("//")>-1?e.split("/")[2]:e.split("/")[0]).split(":")[0].split("?")[0]},e.extractPath=function(e){var t="";e.indexOf("//")>-1&&(e=e.split("//")[1]);var n=e.indexOf("/");return n>-1&&(t=e.substring(n)),t=t.split("?")[0]},e}();t.default=i},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(3),o=n(21),s=n(24),a=n(16),c=n(31),u=n(0),l=n(48),p=n(42);t.getPolling=function(){return u.swc.services.polling};var d=function(){t.getPolling().authorization.then(function(){f()?t.activationRequest().then(function(e){t.stopActivation(),e&&e.ok&&(i=setTimeout(d,12e3))},function(){t.stopActivation()}):t.stopActivation()})};function f(){return u.swc.services.signInManager.userIdentityType===s.IdentityType.SKYPE&&u.swc.services.signInManager.state===o.SigninState.SignedIn&&l.get().isOnline&&r.default.get.backend!==a.MessagingBackend.TEAMS}t.activationRequest=function(){var e=u.swc.services.sessionStorage.getItem(c.SKYPE_ENDPOINT_ID_KEY),t="users/ME/endpoints/"+e+"/active",n={body:JSON.stringify({timeout:15})};return!e&&f()?Promise.reject({}):p.post("active",t,n)},t.startActivation=function(){i||f()&&d()},t.stopActivation=function(){i&&(clearTimeout(i),i=null)},l.get().subscribe("isOnline",function(e){e||t.stopActivation()})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r,o=n(3),s=n(19);!function(e){e.Mobile="Mobile",e.Desktop="Desktop",e.Web="Web"}(t.DeviceType||(t.DeviceType={})),function(e){e.Available="Available",e.AvailableIdle="AvailableIdle",e.Busy="Busy",e.BusyIdle="BusyIdle",e.DoNotDisturb="DoNotDisturb",e.BeRightBack="BeRightBack",e.Away="Away",e.Offline="Offline",e.PresenceUnknown="PresenceUnknown"}(i=t.Availability||(t.Availability={})),function(e){e.Available="Available",e.Inactive="Inactive",e.Busy="Busy",e.InMeeting="InAMeeting",e.InCall="InACall",e.InConferenceCall="InAConferenceCall",e.UrgentInterruptionOnly="UrgentInterruptionOnly",e.DoNotDisturb="DoNotDisturb",e.Presenting="Presenting",e.BeRightBack="BeRightBack",e.Away="Away",e.Offwork="Offwork",e.OutOfOffice="OutOfOffice",e.Offline="Offline",e.PresenceUnknown="PresenceUnknown"}(r=t.Activity||(t.Activity={}));var a={};a[i.Available]=[r.Available],a[i.Busy]=[r.Busy],a[i.DoNotDisturb]=[r.DoNotDisturb],a[i.BeRightBack]=[r.BeRightBack],a[i.Away]=[r.Away,r.Offline],t.allowedForcedAvailabilities=[i.Available,i.Busy,i.DoNotDisturb,i.BeRightBack,i.Away],t.isForcedAvailabilityAllowed=function(e){return 1===t.allowedForcedAvailabilities.filter(function(t){return t===e}).length},t.isActivityCombinationAllowed=function(e,t){return!(!a[t]||1!==a[e].filter(function(e){return e===t}).length)},t.getAvailabilityFromStatus=function(e){if(o.default.get.isTeams())switch(e){case s.PresenceStatus.Online:return i.Available;case s.PresenceStatus.Busy:return i.Busy;case s.PresenceStatus.BeRightBack:return i.BeRightBack;case s.PresenceStatus.Away:return i.Away;case s.PresenceStatus.DoNotDisturb:return i.DoNotDisturb;default:return}else switch(e){case s.PresenceStatus.Online:return i.Available;case s.PresenceStatus.Away:return i.Away;case s.PresenceStatus.Busy:return i.Busy;default:return}},t.getStatusFromAvailability=function(e){if(o.default.get.isTeams())switch(e){case i.Available:case i.AvailableIdle:return s.PresenceStatus.Online;case i.Away:return s.PresenceStatus.Away;case i.BeRightBack:return s.PresenceStatus.BeRightBack;case i.DoNotDisturb:return s.PresenceStatus.DoNotDisturb;case i.Busy:case i.BusyIdle:return s.PresenceStatus.Busy;default:return s.PresenceStatus.Offline}else switch(e){case i.Available:case i.AvailableIdle:return s.PresenceStatus.Online;case i.Away:return s.PresenceStatus.Away;case i.BeRightBack:return s.PresenceStatus.BeRightBack;case i.DoNotDisturb:return s.PresenceStatus.DoNotDisturb;case i.Busy:case i.BusyIdle:return s.PresenceStatus.Busy;default:return s.PresenceStatus.Offline}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(16),r=n(28),o=n(4),s=n(142),a=n(75),c=n(9),u=n(38);t.UNREAD_TYPES={Text:1,RichText:1,"RichText/UriObject":1,"RichText/Media_GenericFile":1,"Event/Call":1,"Signal/Flamingo":1,"RichText/Html":1};var l=function(){function e(){}return e.getType=function(e){return a.getConversationType(e)},e.getBackend=function(e,t){if(t!==i.MessagingBackend.UNDETERMINED)return t;switch(e.split(":")[0]){case"8":case"28":case"19":t=i.MessagingBackend.SKYPE;break;default:return i.MessagingBackend.UNDETERMINED}return t},e.replaceMapped=function(e,t,n){return n&&(t[n]=""),this.replaceMap(e,t)},e.replaceMap=function(e,t){return Object.keys(t).forEach(function(n){e=e.replace(n,t[n])}),e.trim().replace(/(^,|[ ],|,$)/,"").trim()},e.parseConversationTopic=function(e,t,n){if(void 0===t&&(t={}),void 0===n&&(n=""),n&&t[n]&&delete t[n],!e&&t)return Object.keys(t).map(function(e){return t[e]}).sort().join(", ");if(e){e=this.replaceMapped(e,t,n);var i=u.default.normalizePersonId(n),r={};Object.keys(t).forEach(function(e){r[u.default.normalizePersonId(e)]=t[e]}),e=this.replaceMapped(e,r,i)}return c.MessageUtils.parseTopic(e)||""},e.isConversationReadOnServer=function(e,t){if(!e)return!1;var n=new s.ConsumptionHorizon;n.set(e);var i=t.skypeeditedid||t.clientmessageid||t.messageid||t.id||"0",r=n.lastReadMessageId===i||""===n.lastReadMessageId||n.lastReadMessageId===t.id,o=new Date(t.originalarrivaltime).getTime();t.skypeeditedid&&+t.skypeeditedid>0&&(o=new Date(+t.skypeeditedid).getTime());var a=n.lastReadMessageTimestamp>=o;return r||a},e.isUnread=function(n,i,s,a){if(!a)return!1;if(e.getType(i)===o.ConversationType.PHONE)return!1;if(!t.UNREAD_TYPES[a.messagetype])return!1;if(a.from){var u=r.normalizePersonId(c.MessageUtils.getSenderIdFromUrl(a.from));if(r.normalizePersonId(n)===u)return!1}return!!a.content&&(!s.consumptionhorizon&&"AcceptPendingRecipient"===s.conversationstatus||!e.isConversationReadOnServer(s.consumptionhorizon,a))},e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4);t.getConversationType=function(e){if(0===e.indexOf("http"))return i.ConversationType.JOIN;switch(e.split(":")[0]){case"4":return i.ConversationType.PHONE;case"8":return i.ConversationType.PERSON;case"28":case"99":return i.ConversationType.AGENT;case"19":return i.ConversationType.GROUP;default:return i.ConversationType.UNDEFINED}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.transformRawToXml=function(e,t,n,i){var r=[];for(r.push(t);0!==r.length;){var o=r.pop();o.nodeType===Node.TEXT_NODE?this.encodeTextNodeToXml(e,o,n,i):this.isElementAllowed(o)&&this.pushChildNodes(r,o)}},e.prototype.wordMatcher=function(){return/[\w()#:\-=<>;'\|\$"\]\*\^&\+@\{\?Ǝ\/\\!~]+/g},e.prototype.getAllWords=function(e){for(var t,n=this.wordMatcher(),i=new Array;null!==(t=n.exec(e));)i.push(t);return i},e.prototype.encodeTextNodeToXml=function(e,t,n,i){var r=t.parentNode,o=this.encodeWords(e,t,n,i);o&&o.length&&(o.forEach(function(e){r.insertBefore(e,t)}),r.removeChild(t))},e.prototype.encodeWords=function(e,t,n,i){var r=this,o=t.nodeValue,s=this.getAllWords(o),a=0,c=[];return s.forEach(function(t){var s=r.wordRawToXml(e,t[0],n,i);0!==s.length&&(a!==t.index&&c.push(e.createTextNode(o.substring(a,t.index))),a=t.index+t[0].length,c=c.concat(s))}),0!==a&&a<o.length&&c.push(e.createTextNode(o.substring(a))),c},e.prototype.pushChildNodes=function(e,t){for(var n=0;n<t.childNodes.length;n++)e.push(t.childNodes[n])},e}();t.WordDomTransformer=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=n(13),a=n(0),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isFocused=!0,t.restart=function(){t.dispose(),t._initManagers&&t._initManagers(),t._signInManager.getSkypeToken().then(null,function(){}),a.swc.services.mePersonManager.fetch(),t.restoreLastConversation()},t}return r(t,e),Object.defineProperty(t,"instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.initServices=function(e){t._initParams=e;var n=t._initParams;return a.swc.Eventing.registerEvent("callStatusChanged",function(e){if(e)switch(e.status){case 2:case 3:case 4:case 9:t._isInCall=!0;break;default:t._isInCall=!1}}),a.swc.services.initManagers(e&&e.locale||o.default.get.getCurrentLocale(),{tokenProvider:n.skypeTokenProvider||n.tokenProvider,initialToken:n.initialSkypeTokenData,externalLogin:n.externalLogin,tokenType:n.tokenType,enterpriseAuth:n.enterpriseAuth},{fileSharing:n.fileSharing,userSettings:n.userSettings}).then(function(){t.instance.SignInManager,a.swc.services.persons})},t.prototype.dispose=function(){var e;(e=this._mePersonManager)&&(e.dispose(),e=null),this._amsManager&&this._amsManager.dispose(),this._persons&&this._persons.dispose(),this._isCleared=!1},Object.defineProperty(t.prototype,"SignInManager",{get:function(){return this._signInManager||(this._signInManager=a.swc.services.signInManager,this._signInManager&&this._signInManager.subscribe("resurrect",this.restart)),this._signInManager},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCleared",{get:function(){return this._isCleared},set:function(e){e!==this._isCleared&&(this._isCleared=e,this.publish("isCleared",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFocused",{get:function(){return this._isFocused},set:function(e){e!==this._isFocused&&(this._isFocused=e,this.publish("isFocused",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isInCall",{get:function(){return t._isInCall},enumerable:!0,configurable:!0}),t.prototype.setRestoreOfLastConversation=function(e){this._lastConversationCallback=e},t.prototype.restoreLastConversation=function(){this._lastConversationCallback&&this._lastConversationCallback()},t.prototype.setManagersInit=function(e){this._initManagers||(this._initManagers=e)},t._isInCall=!1,t}(s.default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(0),o=n(12),s=n(111),a=function(){function e(e){this.id=o.guid.generate(),this.title="",this.description="",this.sender="",this.avatarUrl="",this.actions=[],this.type=e,this.sound=this._getSoundFile(e)}return e.prototype._getSoundFile=function(e){var t=null;switch(e){case"UnreadMessage":t=s.SupportedSounds.Notification,this.loopSound=!1;break;case"Calling":t=s.SupportedSounds.Ringing,this.loopSound=!0}return t},e.prototype.getAvatar=function(e,t){var n=i.Configuration.DEFAULT_AVATAR_URI;return t&&t.avatarData?n=t.avatarData:e.avatar&&(n=(n=e.avatar).replace("returnDefaultImage=false","returnDefaultImage=true")),n},e.prototype.hide=function(){r.swc.Eventing.triggerEvent("hideNotification",this.id)},e}();t.Notification=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(8),o={version:"1.0.0.0",urls:["https://config.edge.skype.com"]};t.configLoader=function(e,t,n){return new Promise(function(n,c){var u=function(){var e=i.Configuration.ECS?i.Configuration.ECS.version:o.version;/\d\.\d\.\d/.test(e)||(e=o.version);for(var t=e.split(".",4),n=i.Configuration.getPlatformId();t.length<4;)t.unshift("0");var r=t.join(".");return n?n+"_"+r:r}(),l=a(e,u,t),p=0,d=function(){if(p<l.length){var t=l[p++];s(e,t).then(function(e){return e?n(e):d()}).catch(function(e){var n="Error: "+e+" URL: "+t;r.default.throwError(12001,n),d()})}else{var i="Unable to fetch config from ECS, name: "+e+", urls: "+l;r.default.throwError(12001,i),c(i)}};d()})};var s=function(e,t){return new Promise(function(n,i){var o=encodeURIComponent("jsonSwcEcsFetch"+e+Date.now()),s=document.querySelector("body"),a=document.createElement("script"),c=-1===t.indexOf("?")?"?":"&",u=""+t+c+"callback="+o;a.src=u;var l=function(){delete window[o],s.removeChild(a)};window[o]=function(e){clearTimeout(p),l(),n(e)};var p=setTimeout(function(){l();var e="[configLoader.fetchJson] ECS timed out after 10000 ms, url: "+u;r.default.throwError(12003,"[configLoader.fetchJson] ECS returned values:"+e),i("ECS timed out "+e)},1e4);s.appendChild(a)})},a=function(e,t,n){var i,r,s=[],a=(r=[],i=(i=n)||{},Object.keys(i).forEach(function(e){r.push(encodeURIComponent(e)+"="+encodeURIComponent(i[e]))}),r.join("&"));return o.urls.forEach(function(n){s.push(n+"/config/v1/"+e+"/"+t+(a?"?"+a:""))}),s}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.objectProperties=function(e,t){for(var n in e)e.hasOwnProperty(n)&&t&&t(n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hashCode=function(e){var t=0,n=e.length,i=0;if(n>0)for(;i<n;)t=(t<<5)-t+e.charCodeAt(i++)|0;return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(108));var i=n(72);t.startEndpointActivation=i.startActivation,t.stopEndpointActivation=i.stopActivation,t.getPolling=i.getPolling},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(34),r=n(4),o=n(8),s=function(){function e(){}return e.strip=function(e){var t=e.match(this.idRegExp);return t?t[2]:e},e.detectConversationType=function(e){if(!e)return r.ConversationType.UNDEFINED;if(this.typeMapppings[e])return this.typeMapppings[e];var t,n=e.match(this.idRegExp);if(n&&(t=this.getTypeByPrefix(n[1])),t)return this.typeMapppings[e]=t,t;if(0===e.indexOf("https://join.skype.com/"))return this.typeMapppings[e]=r.ConversationType.JOIN,r.ConversationType.JOIN;if(/^(28:)?[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i.test(e))return this.typeMapppings[e]=r.ConversationType.AGENT,r.ConversationType.AGENT;if(/^(19:)?[\S]+[@]([\S].)?[\S]*thread\.skype/i.test(e))return this.typeMapppings[e]=r.ConversationType.GROUP,r.ConversationType.GROUP;return/(?:00|\+)?(^[^a-z][^A-Z])(\d+$)/i.test(e.replace(/\s+|[()\-\+]/gi,""))?(this.typeMapppings[e]=r.ConversationType.PHONE,r.ConversationType.PHONE):(this.typeMapppings[e]=r.ConversationType.PERSON,r.ConversationType.PERSON)},e.getSdkModeFromId=function(e){switch(this.detectConversationType(e)){case r.ConversationType.PERSON:return i.SDKMode.PERSON;case r.ConversationType.AGENT:return i.SDKMode.BOT;case r.ConversationType.JOIN:return i.SDKMode.JOIN_URL;case r.ConversationType.PHONE:return i.SDKMode.PHONE;case r.ConversationType.GROUP:return i.SDKMode.THREAD}return i.SDKMode.UNDEFINED},e.toFullIdentifier=function(e){var t=this.getPrefixForId(e);return 0===e.indexOf(t+":")?e:t?t+":"+e:e},e.addPrefix=function(e,t){return 0===t.indexOf(e+this.SPLITTER)?t:0===t.indexOf(this.SPLITTER)?e+t:e+this.SPLITTER+t},e.getNormalizeId=function(e){return e.match(this.idRegExp)?e.replace(/\d{1,2}:/,""):e},e.isEqual=function(e,t){return this.toFullIdentifier(e).toLowerCase()===this.toFullIdentifier(t).toLowerCase()},e.getPrefixForId=function(e){if(this.hasAlreadyPrefix(e))return"";var t=this.getSdkModeFromId(e);switch(t){case i.SDKMode.PERSON:return"8";case i.SDKMode.BOT:return"28";case i.SDKMode.THREAD:return"19";case i.SDKMode.PHONE:return"4";default:o.default.throwError(10502,"Unable to define conversation prefix",{id:e,sdkMode:t})}return""},e.getTypeByPrefix=function(e){if(!e)return r.ConversationType.UNDEFINED;switch(e.indexOf(":")>-1&&(e=e.replace(":","")),e){case"4":return r.ConversationType.PHONE;case"8":return r.ConversationType.PERSON;case"19":return r.ConversationType.GROUP;case"28":return r.ConversationType.AGENT;default:return r.ConversationType.UNDEFINED}},e.hasAlreadyPrefix=function(e){var t=/^\d+:/.exec(e);return!!t&&!!t[0]},e.SPLITTER=":",e.idRegExp=/(\d{1,2}:)([\S]*)/,e.typeMapppings={},e}();t.default=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return e.call(this)||this}return r(t,e),t.create=function(){var e=Object.create(t.prototype);return e.callbacks=[],e},t.prototype.pushObservable=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.prototype.push.apply(this,t);var i=new s(t);return this.publish(i),this.length},t.prototype.popObservable=function(){var t=e.prototype.pop.call(this);return this.publish(),t},t.prototype.shiftObservable=function(){var t=e.prototype.shift.call(this);return this.publish(),t},t.prototype.unshiftObservable=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.prototype.unshift.apply(this,t);var i=new s(t);return this.publish(i),this.length},t.prototype.sortObservable=function(t){var n=e.prototype.sort.call(this,t);return this.publish(),n},t.prototype.spliceObservable=function(t,n){for(var i,r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];i=n?r?e.prototype.splice.apply(this,[t,n].concat(r)):e.prototype.splice.call(this,t,n):e.prototype.splice.call(this,t);var a=new s([],i);return this.publish(a),i},t.prototype.subscribe=function(e){this.callbacks.push(e)},t.prototype.unsubscribe=function(e){var t=this.callbacks.indexOf(e);t>-1&&this.callbacks.splice(t,1)},t.prototype.dispose=function(){var e=this;this.callbacks.forEach(function(t,n){e.callbacks[n]=null}),this.callbacks=[]},t.prototype.publish=function(e){var t=this;e||(e=new s),this.callbacks.forEach(function(n){n(t,e)})},t}(Array);t.ObservableCollection=o;var s=function(){return function(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]),this.newItems=e,this.oldItems=t}}()},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.request="bridge:request:theme",e.response="bridge:request:return"}(t.ApiEventsBridgeTheme||(t.ApiEventsBridgeTheme={}))},function(e,t,n){"use strict";var i,r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Outlook="OUTLOOK",e.Scom="SCOM",e.Office="OFFICE"}(i=t.NotificationSupportedHost||(t.NotificationSupportedHost={})),function(e){e.All="ALL",e.Notification="NOTIFICATION",e.Off="OFF"}(r=t.NotificationAllowedValue||(t.NotificationAllowedValue={})),function(e){e.swc="swc",e.api="api"}(t.NotificationSettingSource||(t.NotificationSettingSource={})),function(e){e.IncomingCall="swc.notification.incoming-call",e.NewMessage="swc.notification.new-message"}(t.NotificationSettingType||(t.NotificationSettingType={})),t.NOTIFICATION_DEFAULT=[{host:i.Outlook,value:r.All},{host:i.Scom,value:r.All},{host:i.Office,value:r.All}]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(110),r=n(16),o=n(0),s=n(280),a=n(3),c=n(281),u=n(282),l=n(283),p=n(146),d=n(285),f=n(286),h={LARGE:"large",EXTRA_LARGE:"extraLarge"},g=3,m=function(e){var t;return(o.swc.services.pesManager.config?o.swc.services.pesManager.config.items:[]).forEach(function(n){t||n.id!==e||(t=n)}),t},v=function(){return function(e,t){var n=this;this.outgoingDomTransformers=[],this.incomingDomTransformers=[],this.encode=function(e,t,r){var o=new DOMParser,s=i(e),a=c.default.addFormatting(s),u=o.parseFromString(a,"text/html");if(0!==u.getElementsByTagName("parsererror").length)return s;try{return n.outgoingDomTransformers.forEach(function(e){try{e.transformRawToXml(u,u.body,t,r)}catch(e){}}),n.convertHtmlDomToXmlString(u)}catch(e){return s}},this.decode=function(e){var t,i,c,u=n;a.default.get.backend===r.MessagingBackend.TEAMS&&(e=s.TeamsMessageUtil.prepare(e));try{var l=n._private.parseXML(n._private.encapsulateInRootElement(e));if(l)return i=l.documentElement,o.swc.services.pesManager.canRenderConfigItems()&&function(e){var n=a.default.get.largeEmoticonClass?h.EXTRA_LARGE:h.LARGE,r=i.getElementsByTagName("ss"),o=[],s=r.length<=g&&r.length>0;if(s){var c=i.childNodes;for(a.default.get.isTeams()&&1===c.length&&"message"===c[0].tagName&&(c=c[0].childNodes),t=0;t<c.length;++t){var l=0===c[t].textContent.replace(" ","").replace(/<br\s*\/?>/g,"").replace(/\n/g,"").length;s=s&&("ss"===c[t].tagName||l)}}var p,d,f=r.length>20;for(t=0;t<r.length;++t){var m=u.emoticonEncoder.createHtmlElement(e,r[t].getAttribute("type"),r[t].textContent,s,f,n);m&&o.push([m,r[t]])}for(t=0;t<o.length;++t)p=o[t][0],(d=o[t][1]).parentNode&&d.parentNode.replaceChild(p,d)}(l),(c=i.getElementsByTagName("e_m"))&&0!==c.length&&c[0].parentNode.removeChild(c[0]),n.incomingDomTransformers.forEach(function(e){try{e.transformRawToXml(l,i)}catch(e){}}),u.emoticonEncoder.fixInvalidHtml(n._private.decapsulateFromRootElement(n._private.xmlToString(l)))}catch(e){}return e},this.convertHtmlDomToXmlString=function(e){for(var t=e.implementation.createDocument(e.body.namespaceURI,"message",null);0!==e.body.childNodes.length;)t.childNodes[0].appendChild(e.body.childNodes[0]);var i=t.childNodes[0].outerHTML;return a.default.get.backend===r.MessagingBackend.TEAMS&&(i=n._translateToTeamsEmoticons(i,e,t)),i.replace(/(?:^<message.*?>|<\/message>$)/g,"")},this._translateToTeamsEmoticons=function(e,t,n){var i=e.match(/<ss[^>]+>[^<]+<\/ss>/g);if(i){var r=i.length===n.firstChild.childNodes.length&&i.length<=g&&i.length>0,s=o.swc.services.pesManager.map;for(var a in i){var c=i[a],u=c.match(/<ss type="([^"]+)">([^<]+)<\/ss>/),l=u[1],p=s[u[2]];p.match(/^\(.*\)$/)||(p="("+p+")");var d=m(l),f=t.implementation.createDocument(t.body.namespaceURI,"emoticon",null),h=f.createElement("span"),v=r?50:20;h.setAttribute("class","animated-emoticon-"+v+"-"+l),h.setAttribute("title",l),h.setAttribute("type",p);var y=f.createElement("img");y.setAttribute("alt",d.description),y.setAttribute("itemid",l),y.setAttribute("itemscope",""),y.setAttribute("itemtype","http://schema.skype.com/Emoji"),y.setAttribute("src","https://statics.teams.microsoft.com/evergreen-assets/funstuff/skype-emoticons-f/"+l+"/default_"+v+".png"),y.setAttribute("style","width:"+v+"px;height:"+v+"px;"),h.appendChild(y),f.childNodes[0].appendChild(h);var _=f.childNodes[0].outerHTML.replace(/(?:^<emoticon.*?>|<\/emoticon>$)/g,"");e="<div><div>"+(e=e.replace(c,_))+"</div></div>"}}return e},this._private={separators:{"   ":!0,"\n":!0,"\r":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0," ":!0,"　":!0},createFlagElement:function(e,t,n){var i=e.createElement("span");return i.textContent=n,i.setAttribute("class","flag "+t),i.textContent="(flag:"+t+")",i},encapsulateInRootElement:function(e){for(var t;t!==e;)t=e,e=e.replace(/<\s*?root[\s\S]*?>.*?(<\s*?\/\s*?root\s*?>)?/gi,"");return"<root>"+e+"</root>"},decapsulateFromRootElement:function(e){return e.match(/<root ?\/>/)?"":e.length==="</root>".length?"":e.substring("<root>".length,e.length-"</root>".length)},parseXML:function(e){var t;try{if(o.swcWindow.DOMParser){var n=new DOMParser;n.async=!1,t=n.parseFromString(e,"text/xml")}else{var i=new ActiveXObject("Microsoft.XMLDOM");if(i.async=!1,i.loadXML(e))return i}}catch(e){return null}var r=t.parseError;return r&&0!==r.errorCode?null:t.getElementsByTagName("parsererror").length>0?null:t},xmlToString:function(e){var t;try{t=(new XMLSerializer).serializeToString(e)}catch(n){t=e.xml}return t},xmlEscapeMap:{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&apos;"},escapeXml:function(e){var t=this.xmlEscapeMap;return e.replace(/[<>&"']/g,function(e){return t[e]})},unescapeXml:function(e){var t={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"};return e.replace(/&lt;|&gt;|&amp;|&quot;|&apos/g,function(e){return t[e]})}},this.emoticonEncoder=new u.default,e?e.forEach(function(e){n.incomingDomTransformers.push(e)}):this.incomingDomTransformers=[new d.NewLineDomTransformer,new l.MentionDomDecoder],t?t.forEach(function(e){n.outgoingDomTransformers.push(e)}):this.outgoingDomTransformers=[new f.URLDomTransformer,new d.NewLineDomTransformer,new p.MentionDomEncoder,this.emoticonEncoder]}}();t.Encoder=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(0),o=function(){function e(){}return Object.defineProperty(e,"Marked",{get:function(){return r.swc.vendors.marked},enumerable:!0,configurable:!0}),Object.defineProperty(e,"renderer",{get:function(){return this._renderer||(this._renderer=new e.Marked.Renderer),this._renderer},enumerable:!0,configurable:!0}),e.parse=function(t,n){return e.Marked.setOptions({renderer:this.renderer,gfm:!0,tables:!1,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!0,smartypants:!1,xhtml:!1}),i.default.get.isTeams()&&(t=t.replace(/<br\/><br\/>/g,"<br/>").replace(/<br\s*\/?>\r\n/g,"  \n")),t=t.replace(/<br\s*\/?><br\s*\/?>/g,"\n\n").replace(/<br\s*\/?>/g,"  \n").replace(/<\/p>\n<p>/g,"\n\n"),t=(t=e.Marked(t).trim()).replace(/(^<p>)|(<\/p>$)/g,"").replace(/<\/p>\n<p>/g,"<br><br />")},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.BUTTON_SEND_CLICK=1]="BUTTON_SEND_CLICK",e[e.KEYPRESS_ENTER=2]="KEYPRESS_ENTER",e[e.WELCOME_MESSAGE=3]="WELCOME_MESSAGE",e[e.TYPING=4]="TYPING",e[e.SUGGESTED_ACTION=5]="SUGGESTED_ACTION",e[e.BUTTON_SWIFT_CLICKED=6]="BUTTON_SWIFT_CLICKED",e[e.INVITE=7]="INVITE",e[e.ADDON=8]="ADDON"}(t.ActionTrigger||(t.ActionTrigger={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(90),r=n(91),o=n(9),s=function(){function e(){}return Object.defineProperty(e,"encoder",{get:function(){return e._encoder||(e._encoder=new i.Encoder),this._encoder},enumerable:!0,configurable:!0}),e.INVALID_VALUE="invalidValue",e.filterOutNotValidItems=function(t,n){for(var i=e.mapArray(t,n),r=[],o=0;o<i.length;o++){var s=i[o];s.isValid&&!s.isValid()||r.push(s)}return r},e.filterOutDisabledItems=function(t,n){for(var i=e.mapArray(t,n),r=[],o=0;o<i.length;o++){var s=i[o];s.isDisabled&&s.isDisabled()||r.push(s)}return r},e.getItemIfNotDisabled=function(e){return e.isDisabled&&e.isDisabled()?null:e},e.mapArray=function(e,t){var n=[];if(!e)return n;for(var i=0;i<e.length;i++){var r=e[i];r&&n.push(t(r))}return n},e.normalizeText=function(e){return e?o.MessageUtils.getMessageSanitizedContent(e):null},e.normalizeUrl=function(e){return o.MessageUtils.normalizeUrl(e)},e.normalizeDestination=function(t){return/^(skype|tel):/i.test(t)?o.MessageUtils.getMessageSanitizedContent(t):e.INVALID_VALUE},e.normalizeRichText=function(t){if(!t)return"";t=e.encoder.decode(e.encoder.encode(t)),t=o.MessageUtils.unescapeBrackets(t);var n=r.default.parse(t);return o.MessageUtils.getMessageSanitizedContent(n)},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(e){try{var t=i.swc.services.mePerson.mri;return i.swc.services.webApi.createThread([{id:t,role:"Admin"},{id:e,role:"Admin"}]).then(function(e){return e.headers.get("location").match(/threads\/(19:.*)$/)[1]})}catch(e){}return Promise.resolve(void 0)};t.generateOneToOneConversationId=function(e){try{if(t.isEnterpriseObjectId(e))return function(e){try{var t=i.swc.services.contactsService;if(t.getContactByObjectId)return t.getContactByObjectId(e).then(function(e){return r(e.mri)})}catch(e){}return Promise.resolve(void 0)}(t.getGuidFromEnterpriseObjectId(e));if(t.isEnterpriseUserMri(e))return r(e)}catch(e){}return Promise.resolve(void 0)},t.isEnterpriseUserMri=function(e){return/^8:orgid:[^@]+$/.test(e)},t.isEnterpriseObjectId=function(e){return/^objectId:[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$/.test(e)},t.getGuidFromEnterpriseObjectId=function(e){return e.replace("objectId:","")}},,,function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(13),s=n(0),a=function(e){function t(){var t=e.call(this)||this;return s.swc.Eventing.registerEvent("proxy:configuration:setLanguage:response",function(e){t.locale=e}),t}return r(t,e),Object.defineProperty(t,"instance",{get:function(){return t._instance||(t._instance=new t)},enumerable:!0,configurable:!0}),t.prototype.getLocale=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=null),t?(this.locale=t,this._locale):e?(this.locale=e,this._locale):this._locale?this._locale:s.swc.SDK&&s.swc.SDK.locale?(this.locale=s.swc.SDK.locale,this._locale):document.documentElement.lang?document.documentElement.lang.toLowerCase():window.navigator.languages&&0!==window.navigator.languages.length?window.navigator.languages[0].toLowerCase():navigator.language.toLowerCase()},Object.defineProperty(t.prototype,"locale",{set:function(e){e&&this._locale!==e.toLowerCase()&&(this._locale=e.toLowerCase(),this.publish("locale",this._locale))},enumerable:!0,configurable:!0}),t}(o.default);t.LocaleInfo=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o=n(181),s={retryCount:3,timeout:12e4,policy:""};t.request=function(e,t,n){var o=0===t.indexOf("http")?t:i.Configuration.AMS_HOST_URL+t;return r.default("ams-"+e,s,o,n)},t.putData=function(e,n,i){return o.getHeaders().then(function(r){var o={method:"PUT"};return o.body=i,o.headers=r,t.request(e,n,o)})},t.getData=function(e,n){return o.getHeaders().then(function(i){i.append("Accept","image/webp,image/*,*/*;q=0.8"),i.append("Accept-Encoding","gzip, deflate, sdch, br");var r={method:"GET"};return r.headers=i,t.request(e,n,r).then(function(e){return e.blob()})})},t.getJson=function(e,n){return o.getHeaders().then(function(i){i.append("Accept","image/webp,image/*,*/*;q=0.8"),i.append("Accept-Encoding","gzip, deflate, sdch, br");var r={method:"GET"};return r.headers=i,t.request(e,n,r).then(function(e){return e.json()})})},t.post=function(e,n,i){return o.getHeaders().then(function(r){r.append("Content-Type","application/json");var o={method:"POST"};return o.body=i,o.headers=r,t.request(e,n,o)})},t.postForm=function(e,n,i){return o.getHeaders().then(function(r){r.append("Content-Type","application/x-www-form-urlencoded");var o={method:"POST"};return o.headers=r,o.credentials="include",i&&(o.body=i),t.request(e,n,o)})},t.get=function(e,n){return o.getHeaders().then(function(i){i.append("Content-Type","application/json");var r={method:"GET"};return r.headers=i,t.request(e,n,r)})},t.parseJson=function(e){return e.json().then(function(t){return e.ok?Promise.resolve(t):Promise.reject(t)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.multilineRegExp=function(e,t){return new RegExp(e.join(""),t)},e.escapeSpecialChars=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},e}();t.default=i},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o={isEnabled:!0,pollingInterval:240};t.getConfig=function(){return i({},o,r.Configuration.ECS.presence)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.callback=e,this.timeout=t}return e.prototype.start=function(){this.reset(),this.retryTimeout=setTimeout(this.callback,this.timeout)},e.prototype.reset=function(){this.retryTimeout&&clearTimeout(this.retryTimeout)},e}();t.FixedTimeout=i,t.build=function(e,t){return new i(e,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.maxLength=16,t.minLength=2,t.firstLetters="8:(B;|I]>+xX<*\\",t.firstLettersMap={8:"8",":":":","(":"(",B:"B",";":";","|":"|",I:"I","]":"]",">":">","+":"+",x:"x",X:"X","<":"<","*":"*","\\":"\\"},t.clearShortcutMap=function(){t.shortcutIdMap={}},t.idEmoticonMap={},t.shortcutIdMap={":)":"smile",":-)":"smile",":=)":"smile","(smile)":"smile",":(":"sad",":-(":"sad",":=(":"sad","(sad)":"sad",":<":"sad",":-<":"sad",":D":"laugh",":-D":"laugh",":=D":"laugh",":d":"laugh",":-d":"laugh",":=d":"laugh","(laugh)":"laugh",":>":"laugh",":->":"laugh","(lol)":"laugh","(LOL)":"laugh","(cool)":"cool","8-)":"cool","8=)":"cool","B-)":"cool","B=)":"cool",":O":"surprised",":-O":"surprised",":=O":"surprised",":o":"surprised",":-o":"surprised",":=o":"surprised","(surprised)":"surprised",";)":"wink",";-)":"wink",";=)":"wink","(wink)":"wink",";(":"cry",";-(":"cry",";=(":"cry","(cry)":"cry",":'(":"cry","(:|":"sweat","(sweat)":"sweat",":|":"speechless",":-|":"speechless",":=|":"speechless","(speechless)":"speechless","(kiss)":"kiss",":*":"kiss",":-*":"kiss",":=*":"kiss","(xo)":"kiss","(K)":"kiss","(k)":"kiss",":P":"tongueout",":-P":"tongueout",":=P":"tongueout",":p":"tongueout",":-p":"tongueout",":=p":"tongueout","(tongueout)":"tongueout",":$":"blush",":-$":"blush",":=$":"blush",':">':"blush","(blush)":"blush",":^)":"wonder","(wonder)":"wonder","|-)":"sleepy","I-)":"sleepy","I=)":"sleepy","(snooze)":"sleepy","|-(":"dull","|(":"dull","|=(":"dull","(dull)":"dull","(inlove)":"inlove","(love)":"inlove",":]":"inlove",":-]":"inlove","]:)":"eg",">:)":"eg","(grin)":"eg","(yn)":"fingerscrossed","(fingers)":"fingerscrossed","(fingerscrossed)":"fingerscrossed","(crossedfingers)":"fingerscrossed","(yawn)":"yawn","(puke)":"puke",":&":"puke",":-&":"puke",":=&":"puke","+o(":"puke","(doh)":"doh","(angry)":"angry",":@":"angry",":-@":"angry",":=@":"angry","x(":"angry","x-(":"angry","X(":"angry","X-(":"angry","x=(":"angry","X=(":"angry",";@":"angry",";-@":"angry","(wasntme)":"wasntme","(wm)":"wasntme","(party)":"party","<O)":"party","<o)":"party","<:o)":"party","(worry)":"worry",":S":"worry",":s":"worry",":-s":"worry",":-S":"worry",":=s":"worry",":=S":"worry","(mm)":"mmm","(mmm)":"mmm","(mmmm)":"mmm","(nerd)":"nerdy","8-|":"nerdy","B-|":"nerdy","8|":"nerdy","B|":"nerdy","8=|":"nerdy","B=|":"nerdy",":x":"lipssealed",":-x":"lipssealed",":X":"lipssealed",":-X":"lipssealed",":#":"lipssealed",":-#":"lipssealed",":=x":"lipssealed",":=X":"lipssealed",":=#":"lipssealed","(wave)":"hi","(hi)":"hi","(bye)":"hi","(BYE)":"hi","(Bye)":"hi","(Hi)":"hi","(HI)":"hi","(facepalm)":"facepalm","(fail)":"facepalm","(devil)":"devil","(6)":"devil","(angel)":"angel","(A)":"angel","(a)":"angel","(envy)":"envy","(V)":"envy","(v)":"envy","(wait)":"wait","(hug)":"hug","(bear)":"hug","(makeup)":"makeup","(kate)":"makeup","(chuckle)":"giggle","(giggle)":"giggle","(clap)":"clap","(think)":"think",":-?":"think",":?":"think",":=?":"think","*-)":"think","(bow)":"bow","(rofl)":"rofl","(rotfl)":"rofl","(whew)":"whew","(phew)":"whew","(happy)":"happy","(smirk)":"smirk","(nod)":"nod","(shake)":"shake","(waiting)":"waiting","(forever)":"waiting","(impatience)":"waiting","(emo)":"emo","(y)":"yes","(Y)":"yes","(ok)":"yes","(yes)":"yes","(OK)":"yes","(oK)":"yes","(Ok)":"yes","(n)":"no","(N)":"no","(no)":"no","(handshake)":"handshake","(highfive)":"highfive","(hifive)":"highfive","(h5)":"highfive","(heart)":"heart","(h)":"heart","(H)":"heart","(l)":"heart","(L)":"heart","<3":"heart","(lalala)":"lalala","(lalalala)":"lalala","(lala)":"lalala","(notlistening)":"lalala","(heidy)":"heidy","(squirrel)":"heidy","(F)":"flower","(f)":"flower","(flower)":"flower","(rain)":"rain","(london)":"rain","(st)":"rain","(ST)":"rain","(St)":"rain","(sun)":"sun","(#)":"sun","(tumbleweed)":"tumbleweed","(music)":"music","(8)":"music","(bandit)":"bandit","(tmi)":"tmi","(coffee)":"coffee","(c)":"coffee","(C)":"coffee","(pi)":"pizza","(pizza)":"pizza","(cash)":"cash","(mo)":"cash","($)":"cash","(flex)":"muscle","(muscle)":"muscle","(^)":"cake","(cake)":"cake","(beer)":"beer","(bricklayers)":"beer","(B)":"beer","(b)":"beer","(d)":"drink","(D)":"drink","(drink)":"drink","\\o/":"dance","\\:D/":"dance","\\:d/":"dance","(dance)":"dance","(ninja)":"ninja","(J)":"ninja","(j)":"ninja","(*)":"star","(star)":"star","(headbang)":"headbang","(banghead)":"headbang","(swear)":"swear","(drunk)":"drunk","(finger)":"finger","(poolparty)":"poolparty","(hrv)":"poolparty","(rock)":"rock","(smoking)":"smoke","(smoke)":"smoke","(ci)":"smoke","(bug)":"bug","(toivo)":"toivo","(wfh)":"wfh","(@h)":"wfh","(@H)":"wfh","(hollest)":"hollest","(zilmer)":"priidu","(e)":"mail","(m)":"mail","(mail)":"mail","(E)":"mail","(o)":"time","(O)":"time","(time)":"time","(clock)":"time","(0)":"time","(~)":"movie","(film)":"movie","(movie)":"movie","(mp)":"phone","(ph)":"phone","(phone)":"phone","(talk)":"talk","(call)":"call","(T)":"call","(t)":"call","(punch)":"punch","*|":"punch","*-|":"punch","(skype)":"skype","(ss)":"skype","(u)":"brokenheart","(U)":"brokenheart","(brokenheart)":"brokenheart","(mooning)":"mooning","(oliver)":"oliver","(bartlett)":"bertlett","(football)":"bertlett","(soccer)":"bertlett","(so)":"bertlett","(talktothehand)":"talktothehand","(idea)":"idea",":i":"idea",":I":"idea","*-:)":"idea","(sheep)":"sheep","(bah)":"sheep","(cat)":"cat",":3":"cat","(@)":"cat","(meow)":"cat","(bike)":"bike","(bicycle)":"bike","(sander)":"bike","(dog)":"dog",":o3":"dog","(&)":"dog"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(22),r=n(36),o={small:"getSmall",large:"getLarge",extraLarge:"getExtraLarge",superLarge:"getSuperLarge"};t.buildEmoticonUrl=function(e,n,s,a){var c=e+"/"+n.id+"/views/";c=t.rewriteUrls(c,r.default.pesCDNAuthentication.rewriteRules);var u=o[s]+(a?"Animated":"");return i.UrlHelper.setQueryParameters(c+r.default.profiles.emoticons[u](),{etag:n.etag})},t.rewriteUrls=function(e,t){if("string"!=typeof e)return e;var n,i=e;for(n in t)if(-1!==n.search(n.from)){i=i.replace(n.from,n.to);break}return i}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(13),s=n(4),a=function(e){function t(t,n){var i=e.call(this)||this;return i._isTyping=!1,i._person=t,i._role=n&&n.role?n.role:s.ParticipantRole.User,i._capabilities=n&&n.capabilities?n.capabilities:[],i}return r(t,e),Object.defineProperty(t.prototype,"person",{get:function(){return this._person},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"role",{get:function(){return this._role},set:function(e){e!==this._role&&(this._role=e,this.publish("role",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"capabilities",{get:function(){return this._capabilities},set:function(e){e!==this._capabilities&&(this._capabilities=e,this.publish("capabilities",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTyping",{get:function(){return this._isTyping},set:function(e){if(this._isTyping=e,this.publish("isTyping",e),this._typingIndicatorTimoutId&&clearTimeout(this._typingIndicatorTimoutId),e){var t=this;this._typingIndicatorTimoutId=setTimeout(function(){t.isTyping=!1,t._typingIndicatorTimoutId=void 0},5e3)}},enumerable:!0,configurable:!0}),t}(o.default);t.default=a},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(72);!function(e){e[e.default=100]="default",e[e.extended=200]="extended"}(t.PAGE_SIZE||(t.PAGE_SIZE={})),t.SYNC_STATE_LINK_REGEX=/syncState=([^&]+)/;var o=function(){function e(){this.resetCallbacks=[],this.allConversations=[],this.syncState="",this.updateConsumptionHorizonToLastMessage=function(e){}}return e.prototype.subscribeConversation=function(e,t,n){return r.getPolling().subscribeConversation(e,t,n)},e.prototype.unsubscribeConversation=function(e){r.getPolling().unsubscribeConversation(e)},e.prototype.subscribeResource=function(e,t){return r.getPolling().subscribeResource(e,t)},e.prototype.unsubscribeResource=function(e){r.getPolling().unsubscribeResource(e)},e.prototype.startEndpointActivation=function(){r.startActivation()},e.prototype.stopEndpointActivation=function(){r.stopActivation()},e.prototype.addResetSubscriber=function(e){e&&this.resetCallbacks.push(e)},e.prototype.reset=function(){return this.allConversations=[],this.syncState="",this.resetCallbacks.forEach(function(e){e()}),i.swc.Telemetry.flushAll(),r.getPolling().reset().then(null,function(){})},e.prototype.getSyncState=function(e){if(!e||!t.SYNC_STATE_LINK_REGEX.test(e))return"";var n=e.match(t.SYNC_STATE_LINK_REGEX);return n?n[1]:""},e}();t.ConversationWebApi=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.UNDETERMINED=10]="UNDETERMINED",e[e.TEXT=100]="TEXT",e[e.IMAGE=200]="IMAGE",e[e.FILE=300]="FILE",e[e.SWIFT=400]="SWIFT",e[e.TYPING=500]="TYPING",e[e.EMOTICON=600]="EMOTICON",e[e.QUICK_REPLY=700]="QUICK_REPLY",e[e.LIVE_STATE=9999999999]="LIVE_STATE"}(t.MessageType||(t.MessageType={}))},function(e,t,n){(function(t){var n=1/0,i="[object Symbol]",r=/[&<>"'`]/g,o=RegExp(r.source),s="object"==typeof t&&t&&t.Object===Object&&t,a="object"==typeof self&&self&&self.Object===Object&&self,c=s||a||Function("return this")();var u,l=(u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},function(e){return null==u?void 0:u[e]}),p=Object.prototype.toString,d=c.Symbol,f=d?d.prototype:void 0,h=f?f.toString:void 0;function g(e){if("string"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&p.call(e)==i}(e))return h?h.call(e):"";var t=e+"";return"0"==t&&1/e==-n?"-0":t}e.exports=function(e){var t;return(e=null==(t=e)?"":g(t))&&o.test(e)?e.replace(r,l):e}}).call(this,n(26))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Connecting="Skype_Call_Connecting.m4a",e.Dialing="Skype_Call_Dialing.m4a",e.Ended="Skype_Call_Ended.m4a",e.Reconnected="Skype_Call_Reconnected.m4a",e.Ringback="Skype_Call_Ringback.m4a",e.Ringing="Skype_Call_Ringing.m4a",e.Notification="Skype_Notification.m4a",e.Message_Received="Skype_Msg_Received.m4a"}(t.SupportedSounds||(t.SupportedSounds={}))},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={allowedProtocols:["https:"]},r=function(){function e(){this.probe=document.createElement("a")}return Object.defineProperty(e,"instance",{get:function(){return e.init()},enumerable:!0,configurable:!0}),e.init=function(){return e._instance||(e._instance=new e)},e.prototype.validate=function(e,t){if(!e)return!1;var n=Object.assign(i,t||{}),r=function(e,t){if(!t)return!0;for(var n,i=0,r=t;i<r.length;i++){if(n=r[i]===e)break}return n};this.probe.href=e;var o=r(this.probe.protocol,n.allowedProtocols)&&r(this.probe.hostname,n.allowedDomains)&&r(this.probe.port,n.allowedPorts);return this.probe.href="",o},e}();t.UrlValidator=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(177))},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(73)),i(n(100))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(118),o=function(){function e(e){void 0===e&&(e=[]),this._namespace=e}return e.prototype.createChild=function(t,n){return new e(this._namespace.concat(["string"==typeof t?function(){return t}:t]))},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e&&e.length&&e[0].name&&this.reportEvent(e[0].name,e[0].properties)},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e&&e.length&&e[0].name&&this.reportEvent(e[0].name,e[0].properties)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e&&e.length&&e[0].name&&this.reportEvent(e[0].name,e[0].properties)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.reportError("warn",e),e&&e.length&&e[0].name&&this.reportEvent(e[0].name,e[0].properties)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.reportError("error",e),e&&e.length&&e[0].name&&this.reportEvent(e[0].name,e[0].properties)},Object.defineProperty(e.prototype,"_prefix",{get:function(){return this._namespace.map(function(e){return e()}).join("/")},enumerable:!0,configurable:!0}),e.prototype.reportError=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(t&&0!==t.length)try{i.swc.Telemetry.sendEvent.callingError(this._prefix,t.join("; "),e)}catch(e){}},e.prototype.reportEvent=function(e,t){var n=i.swc.Telemetry.getLogger("trouter"),o=r.createTrouterEvent(e,t);n.logEvent(o)},e}();t.LocalCallingLogger=o},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(18);t.createTrouterEvent=function(e,t){return{name:e,properties:i({},t,{AppInfo_Version:r.Configuration.getUiVersion(),"DeviceInfo.BrowserName":o.default.getBrowserName(),"DeviceInfo.BrowserVersion":o.default.getBrowserVersion(),"DeviceInfo.OsName":o.default.getOsName(),"DeviceInfo.OsVersion":o.default.getOsVersion(),"DeviceInfo.Id":o.default.getDeviceId().replace(/-/g,""),ua:"SWC"})}}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),a=n(0),c=n(12),u=function(e){function t(t){var n=e.call(this,t)||this;return n.blockClassName="emoticon",n._id=c.guid.generate(),n.state=o({isAnimated:!1,textOnly:!1},n._getNewState(t)),t.setUpdateCallback&&t.setUpdateCallback(function(e){n.setState(function(){return n._getNewState(e)})}),n}return r(t,e),t.prototype._getNewState=function(e){var t=a.swc.services.pesManager.emoticonMap,n=e.emoticonId||this.props.emoticonId,i=e.textContent||this.props.textContent,r=e.title||this.props.title;if(!n||!t.hasOwnProperty(n))return{textOnly:!0,textContent:i};var o={textOnly:!1,textContent:i,title:r,emoticonId:n};return!0===e.isAnimated?o.isAnimated=!0:!1===e.isAnimated&&(o.isAnimated=!1),o},t.prototype.componentDidMount=function(){var e=this;this.setState(function(t,n){return e._getNewState(n)})},t.prototype.componentWillReceiveProps=function(e){var t=this;this.setState(function(n,i){return t._getNewState(e)})},t.prototype.getComposedBlockClassName=function(){var t=e.prototype.getComposedBlockClassName.call(this);return this.props.large&&(t+=" "+this.props.largeEmoticonClass),t},t.prototype.render=function(){if(this.state.textOnly)return s.createElement("span",null,this.state.textContent);var e={"data-item-id":this.state.emoticonId,"data-is-animated":this.state.isAnimated,textContent:this.state.textContent,title:this.state.title};return this.props.large&&["emoticon"].push(this.props.largeEmoticonClass),s.createElement("span",{className:this.getComposedBlockClassName()},s.createElement("canvas",o({},e,{id:this._id}),this.state.textContent))},t}(n(7).SwcBaseComponent);t.SwcEmoticon=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(146),r=n(92),o=n(4),s=n(0),a=n(93),c="https://www.skype.com/",u="width=600, height=620, menubar=no, status=no, titlebar=no, toolbar=no, rel=noopener noreferrer",l=function(){function e(e,t,n){var l=this;switch(this.type=o.SwiftCardActionType.unknown,this.actions={},this.isValid=function(){return!!l.title||!!l.value||!!l.fallbackUri},this.isDisabled=function(){return!1},this.isSupported=function(){return null!==l.type&&l.type!==o.SwiftCardActionType.unknown},this.action=function(){return l.isValid()?l.actions[o.SwiftCardActionType[l.type]]().then(function(){}).catch(function(){}):Promise.resolve()},this.openUrl=function(){return l.value.match(/^skype:\?payments/)||l.value.match(/^skype:/),window.open(l.value,"_blank").opener=null,Promise.resolve()},this.imBack=function(){return l.conversation.sendSwift({title:l.title,value:l.value}).then(function(){return Promise.resolve()}).catch(function(e){s.swc.Telemetry.sendEvent.runtimeError(104001,"unable to send swift message",e.messsage,e.stack)})},this.showImage=function(){var e=l.value||"";return l.conversation.sendMessage(e,r.ActionTrigger.SUGGESTED_ACTION),Promise.resolve()},this.postBack=function(){return l.conversation.sendSwift({title:l.title,value:l.value,image:l.image}),Promise.resolve()},this.payment=function(){var e=l.fallbackUri?l.fallbackUri:l.value;if(e){var t=window.open(e,"_blank",u);return t&&window.focus&&t.focus(),t.opener=null,Promise.resolve()}},this.convertToActionType=function(e){if(!e)return null;try{switch(e.toLowerCase()){case"unsupported":return o.SwiftCardActionType.unsupported;case"openurl":return o.SwiftCardActionType.openUrl;case"imback":return o.SwiftCardActionType.imBack;case"signin":return o.SwiftCardActionType.signin;case"call":return o.SwiftCardActionType.call;case"showimage":return o.SwiftCardActionType.showImage;case"payment":case"anypayment":return o.SwiftCardActionType.payment;case"postback":return o.SwiftCardActionType.postBack;default:return o.SwiftCardActionType.unknown}}catch(e){return s.swc.Telemetry.sendEvent.runtimeError(104002,"unknown shift card type","unknown shift card type",""),o.SwiftCardActionType.unknown}},this.type=this.convertToActionType(e.type),this.isCallActionType=this.type===o.SwiftCardActionType.call,this.title=a.default.normalizeText(e.title),this.value=e.value?a.default.normalizeUrl(e.value):null,this.senderId=n,this.tooltip=this.title,this.image=e.image?e.image:null,this.fallbackUri=e.fallback&&e.fallback.uri?a.default.normalizeUrl(e.fallback.uri):null,this.actions[o.SwiftCardActionType[o.SwiftCardActionType.call]]=this.call,this.actions[o.SwiftCardActionType[o.SwiftCardActionType.imBack]]=this.imBack,this.actions[o.SwiftCardActionType[o.SwiftCardActionType.postBack]]=this.postBack,this.actions[o.SwiftCardActionType[o.SwiftCardActionType.openUrl]]=this.openUrl,this.actions[o.SwiftCardActionType[o.SwiftCardActionType.showImage]]=this.showImage,this.actions[o.SwiftCardActionType[o.SwiftCardActionType.signin]]=this.openUrl,this.actions[o.SwiftCardActionType[o.SwiftCardActionType.payment]]=this.payment,this.type){case o.SwiftCardActionType.call:this.value=a.default.normalizeDestination(this.value);break;case o.SwiftCardActionType.imBack:if(t.isGroup){var p=this.value,d=n.substring(3),f=function(){var e=new i.MentionDomEncoder,n=e.getMentionUserData(d,t);if(n){var r=e.createXmlElement(document,n).outerHTML;l.value=r+" "+p}};t.participants.filter(function(e){return e.person.id.toLowerCase()===d}).forEach(function(e){e.person.subscribe("displayName",f)}),f()}break;case o.SwiftCardActionType.showImage:this.value&&(this.value=a.default.normalizeUrl(e.value)),this.title||(this.title=s.swc.services.i18n.fetch("s_showImageTitle"));break;case o.SwiftCardActionType.payment:this.value&&(this.value.match(/^skype:\?payments/)?this.value=a.default.normalizeDestination(this.value):this.value=a.default.normalizeUrl(e.value));break;case o.SwiftCardActionType.openUrl:this.value&&(this.value.match(/^skype:/)?this.value=a.default.normalizeDestination(this.value):this.value=a.default.normalizeUrl(e.value),this.tooltip?this.tooltip+="\n\n"+this.value:this.tooltip=this.value);break;case o.SwiftCardActionType.signin:this.value=a.default.normalizeUrl(e.value),this.title||(this.title=s.swc.services.i18n.fetch("s_signInTitle"));break;case o.SwiftCardActionType.unsupported:this.type=o.SwiftCardActionType.openUrl,this.title||(this.title=s.swc.services.i18n.fetch("s_unsupported_button")),this.value||(this.value=c);break;case o.SwiftCardActionType.postBack:this.title=a.default.normalizeText(this.title),this.value=a.default.normalizeText(this.value),this.tooltip||(this.tooltip=this.title)}this.conversation=t}return e.prototype.call=function(){return Promise.reject("Calling is not supported")},e}();t.default=l},,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ME="ME",function(e){e.Bridged="bridged",e.Unbridged="unbridged"}(t.DeliveryMode||(t.DeliveryMode={})),function(e){e[e.CONFIRMED=0]="CONFIRMED",e[e.CANCELED=1]="CANCELED"}(t.DialogResult||(t.DialogResult={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=[{language:"ar",defaultLocale:"ar-sa"},{language:"bg",defaultLocale:"bg-bg"},{language:"ca",defaultLocale:"ca-es"},{language:"cs",defaultLocale:"cs-cz"},{language:"cy",defaultLocale:"cy-gb"},{language:"da",defaultLocale:"da-dk"},{language:"de",defaultLocale:"de-de"},{language:"el",defaultLocale:"el-gr"},{language:"en-ca",defaultLocale:"en-gb"},{language:"en-au",defaultLocale:"en-gb"},{language:"en-in",defaultLocale:"en-gb"},{language:"en-hk",defaultLocale:"en-gb"},{language:"en-ie",defaultLocale:"en-gb"},{language:"en-pk",defaultLocale:"en-gb"},{language:"en-sg",defaultLocale:"en-gb"},{language:"en-gb",defaultLocale:"en-gb"},{language:"en",defaultLocale:"en-us"},{language:"es-ar",defaultLocale:"es-mx"},{language:"es-uy",defaultLocale:"es-mx"},{language:"es-py",defaultLocale:"es-mx"},{language:"es-co",defaultLocale:"es-mx"},{language:"es-cl",defaultLocale:"es-mx"},{language:"es-pe",defaultLocale:"es-mx"},{language:"es-ec",defaultLocale:"es-mx"},{language:"es-ve",defaultLocale:"es-mx"},{language:"es-cr",defaultLocale:"es-mx"},{language:"es-do",defaultLocale:"es-mx"},{language:"es-pa",defaultLocale:"es-mx"},{language:"es-gt",defaultLocale:"es-mx"},{language:"es-bo",defaultLocale:"es-mx"},{language:"es-ev",defaultLocale:"es-mx"},{language:"es-hn",defaultLocale:"es-mx"},{language:"es-ni",defaultLocale:"es-mx"},{language:"es-pu",defaultLocale:"es-mx"},{language:"es-br",defaultLocale:"es-mx"},{language:"es-419",defaultLocale:"es-mx"},{language:"es-us",defaultLocale:"es-us"},{language:"es",defaultLocale:"es-es"},{language:"et",defaultLocale:"et-ee"},{language:"eu",defaultLocale:"eu-es"},{language:"gl",defaultLocale:"gl-es"},{language:"fi",defaultLocale:"fi-fi"},{language:"fr-ca",defaultLocale:"fr-ca"},{language:"fr",defaultLocale:"fr-fr"},{language:"iw",defaultLocale:"he-il"},{language:"he",defaultLocale:"he-il"},{language:"hi",defaultLocale:"hi-in"},{language:"hr",defaultLocale:"hr-hr"},{language:"hu",defaultLocale:"hu-hu"},{language:"in",defaultLocale:"id-id"},{language:"id",defaultLocale:"id-id"},{language:"it",defaultLocale:"it-it"},{language:"ja",defaultLocale:"ja-jp"},{language:"kk",defaultLocale:"kk-kz"},{language:"ko",defaultLocale:"ko-kr"},{language:"lt",defaultLocale:"lt-lt"},{language:"lv",defaultLocale:"lv-lv"},{language:"ms",defaultLocale:"ms-my"},{language:"no",defaultLocale:"nb-no"},{language:"nb",defaultLocale:"nb-no"},{language:"nn",defaultLocale:"nn-no"},{language:"nl",defaultLocale:"nl-nl"},{language:"pl",defaultLocale:"pl-pl"},{language:"pt-pt",defaultLocale:"pt-pt"},{language:"pt-br",defaultLocale:"pt-br"},{language:"pt",defaultLocale:"pt-br"},{language:"ro",defaultLocale:"ro-ro"},{language:"ru",defaultLocale:"ru-ru"},{language:"sk",defaultLocale:"sk-sk"},{language:"sl",defaultLocale:"sl-si"},{language:"sr",defaultLocale:"sr-latn-rs"},{language:"sr-cyrl",defaultLocale:"sr-cyrl-rs"},{language:"sr-latn",defaultLocale:"sr-latn-rs"},{language:"sv",defaultLocale:"sv-se"},{language:"th",defaultLocale:"th-th"},{language:"tr",defaultLocale:"tr-tr"},{language:"uk",defaultLocale:"uk-ua"},{language:"vi",defaultLocale:"vi-vn"},{language:"zh",defaultLocale:"zh-cn"},{language:"zh-tw",defaultLocale:"zh-tw"},{language:"zh-hant",defaultLocale:"zh-tw"},{language:"zh-cht",defaultLocale:"zh-tw"},{language:"zh-hk",defaultLocale:"zh-hk"},{language:"zh-mo",defaultLocale:"zh-tw"}],r=[{locale:"am-et",pesLocale:"am"},{locale:"ar-sa",pesLocale:"ar"},{locale:"az-latn-az",pesLocale:"az"},{locale:"be-by",pesLocale:"be-BY"},{locale:"bg-bg",pesLocale:"bg"},{locale:"bn-bd",pesLocale:"bn"},{locale:"bn-in",pesLocale:"bn"},{locale:"bs-latn-ba",pesLocale:"bs-Latn-BA"},{locale:"ca-es",pesLocale:"ca"},{locale:"ca-es-valencia",pesLocale:"ca"},{locale:"cs-cz",pesLocale:"cs"},{locale:"cy-gb",pesLocale:"cy-GB"},{locale:"da-dk",pesLocale:"da"},{locale:"de-de",pesLocale:"de"},{locale:"el-gr",pesLocale:"el"},{locale:"en-gb",pesLocale:"en"},{locale:"en-us",pesLocale:"en"},{locale:"es-es",pesLocale:"es"},{locale:"et-ee",pesLocale:"et"},{locale:"eu-es",pesLocale:"eu"},{locale:"fa-ir",pesLocale:"fa"},{locale:"fi-fl",pesLocale:"fi"},{locale:"fil-ph",pesLocale:"fil_PH"},{locale:"fr-fr",pesLocale:"fr"},{locale:"gd-gb",pesLocale:"gd-GB"},{locale:"gl-es",pesLocale:"gl"},{locale:"gu-in",pesLocale:"gu-IN"},{locale:"he-il",pesLocale:"he"},{locale:"hi-in",pesLocale:"hi"},{locale:"hr-hr",pesLocale:"hr"},{locale:"hu-hu",pesLocale:"hu"},{locale:"id-id",pesLocale:"id"},{locale:"is-is",pesLocale:"is"},{locale:"it-it",pesLocale:"it"},{locale:"ja-jp",pesLocale:"ja"},{locale:"ka-ge",pesLocale:"ka-GE"},{locale:"kk-kz",pesLocale:"kk"},{locale:"kn-in",pesLocale:"kn"},{locale:"ko-kr",pesLocale:"ko"},{locale:"ku-arab-iq",pesLocale:"ku-Arab-IQ"},{locale:"lb-lu",pesLocale:"lb-LU"},{locale:"lt-lt",pesLocale:"lt"},{locale:"lv-lv",pesLocale:"lv"},{locale:"mk-mk",pesLocale:"mk"},{locale:"ml-in",pesLocale:"ml"},{locale:"mr-in",pesLocale:"mr-IN"},{locale:"ms-my",pesLocale:"ms"},{locale:"nb-no",pesLocale:"no"},{locale:"nl-nl",pesLocale:"nl"},{locale:"nn-no",pesLocale:"no"},{locale:"or-in",pesLocale:"or-IN"},{locale:"pl-pl",pesLocale:"pl"},{locale:"pt-pt",pesLocale:"pt-PT"},{locale:"pt-br",pesLocale:"pt-BR"},{locale:"ro-ro",pesLocale:"ro"},{locale:"ru-ru",pesLocale:"ru"},{locale:"sk-sk",pesLocale:"sk"},{locale:"sl-sl",pesLocale:"sl"},{locale:"sq-al",pesLocale:"sq"},{locale:"sr-cyrl-ba",pesLocale:"sr"},{locale:"sr-cyrl-rs",pesLocale:"sr"},{locale:"sr-latn-rs",pesLocale:"sr"},{locale:"sv-se",pesLocale:"sv"},{locale:"sw-ke",pesLocale:"sw"},{locale:"ta-in",pesLocale:"ta"},{locale:"te-in",pesLocale:"te"},{locale:"th-th",pesLocale:"th"},{locale:"tr-tr",pesLocale:"tr"},{locale:"uk-ua",pesLocale:"uk"},{locale:"ur-pk",pesLocale:"ur-PK"},{locale:"uz-latn-uz",pesLocale:"uz"},{locale:"vi-vn",pesLocale:"vi"},{locale:"zh-cn",pesLocale:"zh_Hans"},{locale:"zh-tw",pesLocale:"zh_Hant"}],o=function(){function e(){}return e.prototype.getLocale=function(e){var t=this.getMappingByLanguage(e);if(t)return t.defaultLocale;var n=e.lastIndexOf("-");return n>-1?this.getLocale(e.substring(0,n)):e},e.prototype.getPesLocale=function(e){var t,n;return e?(t=this.getPESMapping(e))&&t.pesLocale?t.pesLocale:(n=this.getLocale(e))!==e&&(t=this.getPESMapping(n))?t.pesLocale:"default":"default"},e.prototype.getPESMapping=function(e){for(var t=0;t<r.length;t++)if(r[t].locale.toLowerCase()===e.toLowerCase())return r[t];return null},e.prototype.getMappingByLanguage=function(e){for(var t=0;t<i.length;t++)if(i[t].language.toLowerCase()===e.toLowerCase())return i[t];return null},e}();t.default=new o},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(13),s=n(53),a=n(0),c=function(e){function t(t){var n=e.call(this)||this;return n._amsService=t,n._authenticated=!1,n._cache={},n._uploads={},n}return r(t,e),t.prototype.isEnterpriseAmsUsed=function(){return!1},t.prototype.downloadFileByDocumentId=function(e){var t=this;return this.authenticate().then(function(){return t._amsService.downloadFile(e)})},t.prototype.downloadRawFile=function(e){return Promise.reject("Not supported")},t.prototype.authenticate=function(){return this._authenticated?Promise.resolve():(this._authenticated=!0,this._amsService.authenticate())},t.prototype.sendFile=function(e,t){var n=this,i=Date.now().toString();this._uploads[i]=s.DocumentStatus.InProgress;var r=this.createAmsDocument(e,t),o=r.then(function(e){return{documentId:e.id}}),c=r.then(function(i){return n.uploadFileContent(e,i.id,t)}).catch(function(e){n._uploads[i]=s.DocumentStatus.Failed,a.swc.Telemetry.sendEvent.runtimeError(104012,e.message,"File upload failed","")});return e.sendFile({file:t,clientMessageId:i,uploadPromise:c,registerPromise:o})},t.prototype.createAmsDocument=function(e,t){var n=this;return this.authenticate().then(function(){return n._amsService.createNewDocument(e.id,t)})},t.prototype.retryFileUpload=function(e,t){var n=this._cache[t];return n?this.uploadFileContent(e,t,n):Promise.reject(null)},t.prototype.uploadFileContent=function(e,t,n){var i=this,r=Date.now();return this._cache[t]=n,this._amsService.sendFile(t,n).then(function(o){return delete i._cache[t],a.swc.Telemetry.sendEvent.fileUpload(n,Date.now()-r,o.status,e),o})},t.prototype.getFileStatus=function(e,t){var n=this._uploads[e];return n?Promise.resolve({uploadStatus:n}):this._amsService.getFileStatus(e,t)},t.prototype.downloadPictureThumbnail=function(e){var t=this;return this.authenticate().then(function(){return t._amsService.downloadPictureThumbnail(e)})},t.prototype.getPictureThumbnail=function(e){var t=this;return this.authenticate().then(function(){return t._amsService.getPictureThumbnail(e)})},t.prototype.downloadPicture=function(e){var t=this;return this.authenticate().then(function(){return t._amsService.downloadPicture(e)})},t.prototype.getCallRecordingThumbnail=function(e){var t=this;return this.authenticate().then(function(){return t._amsService.getCallRecordingThumbnail(e)})},t.prototype.downloadCallRecording=function(e){var t=this;return this.authenticate().then(function(){return t._amsService.downloadCallRecording(e)})},t.prototype.dispose=function(){this._authenticated=!1,this._cache=null},t}(o.default);t.SkypeAmsManager=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(18),o=function(){function e(){}return e.prototype.getCommonCapabilities=function(e){var t=e.CanUploadFile,n=e.DisableSendingEmoticons,o=r.default.testSupporedList(i.Configuration.ECS.callingSupportedBrowsers)&&e.EnableCalling;return Promise.resolve({allowEditMessage:!0,allowDeleteMessage:!0,allowChat:!0,allowUploadFiles:t,allowSendEmoticons:!n&&i.Configuration.ECS.expressionPickerEnabled,allowCalling:o})},e.prototype.getCapabilitiesForConversation=function(e){return this.getCommonCapabilities(e.definition).then(function(t){var n=e.isWithMe(),i=e.isChatEnabled,r=e.isUnderQuarantine,o=!n&&i&&!r,s=t.allowCalling&&!n;return{allowEditMessage:o&&t.allowEditMessage,allowDeleteMessage:o&&t.allowDeleteMessage,allowChat:o&&t.allowChat,allowUploadFiles:o&&t.allowUploadFiles,allowSendEmoticons:t.allowSendEmoticons,allowCalling:s}})},e}();t.SkypeCapabilitiesService=o},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=n(1),a=n(11),c=n(16),u=n(8),l=n(9),p=n(4),d=n(5),f=n(82),h=n(108),g=n(42),m=n(28),v={"8:echo123":!0},y=["Online","Busy","Away","Hidden"],_=function(){return f.getPolling()},b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._createConsumptionHorizon=function(e){var t=e.skypeeditedid||e.clientmessageid||e.id||"0";return new Date(e.originalarrivaltime).getTime()+";"+(new Date).getTime()+";"+t},t._createConsumptionHorizonFromProcessedMessage=function(e){var t=e.skypeEditedId||e.clientMessageId||e.id||"0";return e.originalTimestamp.getTime()+";"+(new Date).getTime()+";"+t},t.updateConsumptionHorizonToLastMessage=function(e){if(null!==e.lastMessage){var n=t._createConsumptionHorizonFromProcessedMessage(e.lastMessage);o.default.get.isTeams()&&e.isUnreadBookmark?t.updateConsumptionHorizonBookmark(e.id,n).then(function(){e.updateConsumptionHorizon(n)}):t.updateConsumptionHorizon(e.id,n).then(function(){e.updateConsumptionHorizon(n)})}},t.markAllConversationsAsRead=function(){var e=t.recents();Object.keys(e).forEach(function(n){e[n].isUnread&&t.updateConsumptionHorizonToLastMessage(e[n])})},t.markConversationAsUnread=function(e,n){var i=function(n){var i=t._createConsumptionHorizon(n);t.updateConsumptionHorizon(e,i)};n?i(n):t.fetchMessages(e).then(function(e){var t=e.messages;if(!(t.length<=1)){var n=t.filter(function(e){return m.normalizePersonId(l.MessageUtils.getSenderIdFromUrl(e.from))!==d.ServicesManager.signInManager.currentUserName}).sort(function(e,t){return t.originalarrivaltime>e.originalarrivaltime?-1:1});i(n[n.length-2])}})},t.markConversationAsRead=function(e){t.updateConsumptionHorizonToLastMessage(t.recents()[e])},t.fetchMessagesByLink=function(e){return e=e.substring(e.indexOf("users/ME/conversations/")),_().authorization.then(function(){return g.get("fetchMessagesByLink",e).then(function(e){return g.parseJson(e)})},console.warn)},t.sendDataToBot=function(e,t){var n="agents/"+e+"/invoke";return g.post("invoke",n,{body:JSON.stringify(t)}).then(function(e){return g.parseJson(e).then(void 0,console.warn).catch(function(e){})})},t.getMyPresence=function(){return _().authorization.then(function(){return g.get("getPresence","users/ME/presenceDocs/messagingService?view=expanded").then(function(e){return e.ok||e.json?e.json():null})})},t}return r(t,e),t.prototype.recents=function(){return d.ServicesManager.conversations.getAll()},t.prototype.prefetchRecents=function(e,t){return this._prefetchPromise||(this._prefetchPromise=this.fetchRecentConversations(e,t)),this._prefetchPromise},t.prototype.fetchRecentConversations=function(e,t){var n=this;if(this._prefetchPromise){var i=this._prefetchPromise;if(this._prefetchPromise=void 0,t<=h.PAGE_SIZE.default)return i}if((this._fetchRecentsPromise?this._fetchRecentsPromise.status:void 0)===a.PromiseStatus.Pending)return this._fetchRecentsPromise.promise;var r;return this._fetchRecentsPromise&&this._fetchRecentsPromise.status===a.PromiseStatus.Pending||(this._fetchRecentsPromise=new a.CancelablePromise),r=e,_().authorization.then(function(){var e={pageSize:t,view:"supportsExtendedHistory|msnp24Equivalent"};r&&!n.syncState&&Object.assign(e,{startTime:r}),n.syncState?Object.assign(e,{syncState:n.syncState}):Object.assign(e,{targetType:"All|InviteFree|Agent"});var i=g.addGetParamsToUrl("users/ME/conversations",e);g.get("fetchRecents",i).then(function(e){e.ok?n._fetchRecentsPromise.isCanceled||g.parseJson(e).then(function(e){n.syncState=n.getSyncState(e._metadata.syncState);var t=e.conversations.filter(function(e){return e.id.lastIndexOf("48:",0)});n.allConversations=n.allConversations.concat(t),n._fetchRecentsPromise.resolve({conversations:n.allConversations,hasMoreConversations:!!e._metadata.backwardLink})}).catch(function(t){u.default.throwError(111,"fetchRecentConversations::getConversationsPage unable to parse response",t),n._fetchRecentsPromise.cancel(e,n.allConversations)}):n._fetchRecentsPromise.cancel(e,n.allConversations)},function(e){n._fetchRecentsPromise.cancel(e,n.allConversations)})}),this._fetchRecentsPromise.promise},t.prototype.fetchMeProperties=function(){return _().authorization.then(function(){return g.get("fetchMeProperties","users/ME/properties",null,!1,!0).then(function(e){return g.parseJson(e)})})},t.prototype.setMeProperty=function(e,t){var n="users/ME/properties?name="+e,i={};return i[e]=t,_().authorization.then(function(){return g.put("setMeProperty",n,{body:JSON.stringify(i)},!1,!0).then(function(e){})})},t.prototype.fetchMeProperty=function(e){var t="users/ME/properties?name="+e;return _().authorization.then(function(){return g.get("setMeProperty",t,null,!1,!0).then(function(t){return g.parseJson(t).then(function(t){return t[e]||void 0})})})},t.prototype.fetchMessages=function(e,t,n){void 0===t&&(t=20),void 0===n&&(n=0);var i={pageSize:t,view:"supportsExtendedHistory|msnp24Equivalent|supportsMessageProperties",startTime:n},r=g.addGetParamsToUrl("users/ME/conversations/"+e+"/messages",i);return _().authorization.then(function(){return g.get("fetchMessages",r).then(function(e){return g.parseJson(e).then(function(e){return e})})})},t.prototype.fetchConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e,{view:"msnp24Equivalent",targetType:"All"});return g.get("fetchConversation",t).then(function(e){return g.parseJson(e).catch(function(e){return e})})},t.prototype.deleteConversation=function(e){var t="users/ME/conversations/"+e+"/messages";return g.del("deleteConversation",t)},t.prototype.sendMessage=function(e,t){var n="users/ME/conversations/"+e+"/messages";return _().authorization.then(function(){return g.post("sendMessage",n,{body:JSON.stringify(t)})}).then(function(e){return g.parseJson(e)})},t.prototype.editMessage=function(e,t,n,i){var r="users/ME/conversations/"+e+"/messages/"+t,o={messagetype:n,content:i};return g.put("edit",r,{body:JSON.stringify(o)})},t.prototype.deleteMessage=function(e,t){var n="users/ME/conversations/"+e+"/messages/"+t;return g.del("deleteMessage",n)},t.prototype.enableJoining=function(e,t){void 0===t&&(t=!0);var n=g.addGetParamsToUrl("threads/"+e+"/properties",{name:"joiningenabled"}),i={body:JSON.stringify({joiningenabled:t})};return g.put("enableJoining",n,i)},t.prototype.discloseHistory=function(e,t){void 0===t&&(t=!0);var n=g.addGetParamsToUrl("threads/"+e+"/properties",{name:"historydisclosed"}),i={body:JSON.stringify({historydisclosed:t})};return g.put("historyDisclosed",n,i)},t.prototype.fetchThread=function(e){var t=g.addGetParamsToUrl("threads/"+e,{view:"msnp24Equivalent"});return g.get("fetchThread",t,null,!1,!0).then(function(e){return g.parseJson(e)})},t.prototype.createThread=function(e){var t={headers:{"Content-Type":"application/json",Accept:"application/json, text/javascript"},body:JSON.stringify({members:e})};return g.post("thread","threads",t)},t.prototype.setConversationTopic=function(e,t){var n=g.addGetParamsToUrl("threads/"+e+"/properties",{name:"topic"});return _().authorization.then(function(){return g.put("setTopic",n,{body:JSON.stringify({topic:t})})})},t.prototype.muteConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"alerts"});return _().authorization.then(function(){return g.put("muteConversation",t,{body:JSON.stringify({alerts:"false"})})})},t.prototype.unmuteConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"alerts"});return _().authorization.then(function(){return g.put("unmuteConversation",t,{body:JSON.stringify({alerts:"true"})})})},t.prototype.setFavoriteConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"favorite"});return this.setPinnedConversation(e),_().authorization.then(function(){return g.put("setFavoriteConversation",t,{body:JSON.stringify({favorite:"true"})})})},t.prototype.removeFavoriteConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"favorite"});return this.removePinnedConversation(e),_().authorization.then(function(){return g.put("removeFavoriteConversation",t,{body:JSON.stringify({favorite:"false"})})})},t.prototype.setPinnedConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"pinned"});return _().authorization.then(function(){return g.put("setPinnedConversation",t,{body:JSON.stringify({pinned:"true"})})})},t.prototype.removePinnedConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"pinned"});return _().authorization.then(function(){return g.put("removePinnedConversation",t,{body:JSON.stringify({pinned:"false"})})})},t.prototype.addParticipant=function(e,t,n){var i="threads/"+e+"/members/"+t,r=n?"Admin":"User";return _().authorization.then(function(){return g.put("addParticipant",i,{body:JSON.stringify({role:r})})})},t.prototype.removeParticipant=function(e,t){var n="threads/"+e+"/members/"+t;return _().authorization.then(function(){return g.del("removeParticipant",n,{body:""})})},t.prototype.acceptConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"conversationstatus"});return g.put("acceptConversation",t,{body:JSON.stringify({conversationstatus:"Accepted"})})},t.prototype.setBlockedConversation=function(e,t){var n=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"conversationblocked"});return g.put("setBlockedConversation",n,{body:JSON.stringify({conversationblocked:t?"true":"false"})})},t.prototype.updateConsumptionHorizon=function(e,t){var n=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"consumptionhorizon"});return g.put("consumptionHorizon",n,{body:JSON.stringify({consumptionhorizon:t})})},t.prototype.updateConsumptionHorizonBookmark=function(e,t){var n=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"consumptionHorizonBookmark"});return g.put("consumptionHorizonBookmark",n,{body:JSON.stringify({consumptionHorizonBookmark:t})})},t.prototype.getUsersPresence=function(e){e.length>10&&e.splice(10);var t=g.addGetParamsToUrl("users/ME/contacts/ALL/presenceDocs/messagingService",{cMri:e});return _().authorization.then(function(){return g.get("getUsersPresence",t).then(function(e){return e.json().then(function(e){return e.Responses})})})},t.prototype.sendLocalSystemMessage=function(e,t,n){var i=new Date,r=m.getDomain()+"users/ME/conversations/"+e+"/messages/"+i.getTime(),o={id:i.getTime()+"",from:"",messagetype:p.MessageType.SystemMessage,originalarrivaltime:i.toISOString(),content:t};n&&(o.customType=n);var s={resource:o,resourceLink:r,resourceType:"NewMessage"};_().sendLocalMessage(s)},t.prototype.setMessageProperty=function(e,t,n,i){var r=this.messageProperties(e,t,n),a={};return o.default.get.backend===c.MessagingBackend.TEAMS&&n===s.Configuration.MESSAGE_PROPERTIES.PER_USER.EMOTIONS&&"yes"===i.key&&(i.key="like"),a[n]=JSON.stringify(i),g.put(s.Configuration.CHAT_SERVICE_COMMANDS.SET_MESSAGE_PROPERTY,r,{body:JSON.stringify(a),headers:{"Content-Type":"application/json"}})},t.prototype.messageProperties=function(e,t,n){return"users/ME"+("/conversations"+("/"+e+"/messages")+("/"+t+"/properties"))+"?name="+n},t.prototype.removeMessageProperty=function(e,t,n,i){var r=this.messageProperties(e,t,n),a={};return o.default.get.backend===c.MessagingBackend.TEAMS&&n===s.Configuration.MESSAGE_PROPERTIES.PER_USER.EMOTIONS&&"yes"===i.key&&(i.key="like"),a[n]=JSON.stringify(i),g.del(s.Configuration.CHAT_SERVICE_COMMANDS.REMOVE_MESSAGE_PROPERTY,r,{body:JSON.stringify(a),headers:{"Content-Type":"application/json"}})},t.prototype.subscribeContactPresence=function(e){var t=this;return s.Configuration.ECS.contactPresenceEnabled?(-1===e.indexOf("8:")&&(e="8:"+e),v[e]?Promise.resolve():_().authorization.then(function(){return _().subscribeContactPresence(e).then(function(){return t.getUsersPresence([e]).then(function(t){d.ServicesManager.persons.handlePresenceData(e,t[0].Payload)})})})):Promise.resolve()},t.prototype.unsubscribeContactPresence=function(e){return _().unsubscribeContactPresence(e)},t.prototype.setMyPresence=function(e){return y.some(function(t){return t===e})?_().authorization.then(function(){return g.put("setPresence","users/ME/presenceDocs/messagingService",{body:JSON.stringify({status:e})})}):Promise.reject("Unsupported presence")},t.prototype.setEndpointPresence=function(){return _().authorization.then(function(){return _().setEndpointPresence()})},t}(f.ConversationWebApi);t.ConversationConsumerWebApi=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(46),r=n(1),o=n(11),s=n(31),a=n(0),c=n(8),u=n(83),l=n(194),p=n(195),d=n(101),f=n(4),h=n(72),g=n(42),m=n(28);t.SET_ENDPOINT_PROPERTY="supportsMessageProperties";var v=5e3,y=3,_=1,b=2,T=2e3,S={get:function(e){if(e)try{var t=JSON.parse(a.swc.services.sessionStorage.getItem(s.SKYPE_ENDPOINT_KEY)||"");if(t&&t.validUntil>Date.now()&&e===t.username)return t.value}catch(e){}return""},set:function(e,t){var n={username:e,value:t,validUntil:Date.now()+6e5};a.swc.services.sessionStorage.setItem(s.SKYPE_ENDPOINT_KEY,JSON.stringify(n))},invalidate:function(){a.swc.services.sessionStorage.removeItem(s.SKYPE_ENDPOINT_KEY)}},w=function(){function e(){var n=this;this._handledConversations={},this._handledResourceTypes={},this._isPolling=!1,this._followedContacts={},this.reset=function(){return h.stopActivation(),n._waitingForRetry=!1,n._handledConversations={},n._handledResourceTypes={},n._followedContacts={},n._stopPolling(),n._authPromise.promise.then(null,function(){}).catch(),n._authPromise.cancel(),n._removeEndpoint()},this.subscribeConversation=function(e,t,i){return n._handledConversations[e]||(n._handledConversations[e]={eventHandler:t,backfillCallback:i}),n._endpointCreationPromise&&!n._endpointCreationPromise.isCanceled||n._startPollingSequence(),n._endpointCreationPromise.promise},this.unsubscribeConversation=function(e){n._handledConversations[e]&&delete n._handledConversations[e]},this.subscribeContactPresence=function(e){return n._followedContacts[e]?Promise.resolve():(n._followedContacts[e]=!0,!n._endpointCreationPromise||n._endpointCreationPromise.isCanceled?n._startPollingSequence():n._subscriptionId&&n._updateSubscription(),n._endpointCreationPromise.promise)},this.unsubscribeContactPresence=function(e){n._followedContacts[e]&&(delete n._followedContacts[e],n._endpointCreationPromise.status===o.PromiseStatus.Resolved&&n._updateSubscription())},this.subscribeResource=function(e,t){return n._handledResourceTypes[e]&&c.default.throwError(10004,"Resource with that name was already handled",e),n._handledResourceTypes[e]=t,Promise.resolve()},this.unsubscribeResource=function(e){n._handledResourceTypes[e]&&delete n._handledResourceTypes[e]},this.sendLocalMessage=function(e){var t={eventMessages:[e]};n._handlePollData(t)},this._poll=function(e){n._isPolling||(n._pollingRetryInterval&&n._pollingRetryInterval.reset(),n._pollingRetryInterval=new d.FixedTimeout(n._poll.bind(n,e),v),n._isPolling=!0,n._waitingForRetry=!1,n._pollingPromise=new o.CancelablePromise(g.post("polling","users/ME/endpoints/SELF/subscriptions/"+e+"/poll",{body:JSON.stringify({})})),n._pollingPromise.promise.then(function(t){n._isPolling=!1;var i=t.headers.get("location");if(t.ok||404===t.status){if(404===t.status&&null!==i&&m.parseChatServiceHostUrlForRedirects(i)){var s=m.parseChatServiceHostUrlForRedirects(i);r.Configuration.CHAT_HOST_URL=s,r.Configuration.CHAT_GUEST_HOST_URL=s,n.reset().then(function(){S.invalidate(),n._startPollingSequence()})}n._pollingFailedCount=0,t.json().then(function(t){n._pollingPromise.isCanceled||(n._handlePollData(t),729===t.errorCode?(S.invalidate(),n._startPollingSequence()):450===t.errorCode?(n._subscribeToEndpoint(),n.triggerBackfilling()):n._endpointCreationPromise&&n._endpointCreationPromise.status===o.PromiseStatus.Resolved&&n._poll(e))}).catch(function(t){n._poll(e)})}else n.retryPollingIfNeeded(t,e)},function(e){n._isPolling=!1,n.retryPollingIfNeeded()}))},this._handlePollData=function(e){if(e&&e.eventMessages){e.eventMessages.forEach(function(e){!function(e){var t=e.resourceType,i=n._handledResourceTypes[t];i&&i(m.getConversationIdFromUrl(e.resourceLink),e.resource)}(e),"NewMessage"===e.resourceType||"MessageUpdate"===e.resourceType||"ConversationUpdate"===e.resourceType?function(e){var t;t=e.resource&&e.resource.conversationid?e.resource.conversationid:e.resource.conversationLink?m.getConversationIdFromUrl(e.resource.conversationLink):m.getConversationIdFromUrl(e.resourceLink);var i=n._handledConversations[t];i||a.swc.services.conversations.get(t);var r=i&&i.eventHandler,o=e.resource,s=m.getConversationIdFromUrl(o.from),c=l.ThreadNotifications.instance;s&&!c.empty&&u.default.detectConversationType(s)===f.ConversationType.AGENT&&c.notify(u.default.getNormalizeId(s),t,o.content);if(r){if("ConversationUpdate"===e.resourceType){var p=e.resource;a.swc.services.conversations.get(p.id).update(p),a.swc.services.unreadCounterStore.update(p)}r(e.resourceType,o)}}(e):"UserPresence"===e.resourceType?function(e){var t=m.getConversationIdFromUrl(e.resourceLink);if(!t&&e.resource&&e.resource.selfLink&&(t=m.getConversationIdFromUrl(e.resource.selfLink)),t){var i=a.swc.services.mePerson.mri===t;(n._followedContacts[t]||i)&&a.swc.services.persons.handlePresenceData(t,e.resource)}}(e):"ThreadUpdate"===e.resourceType&&function(e){if("ThreadUpdate"===e.resourceType){var t=e.resource;a.swc.services.conversations.get(t.id).updateThread(t)}}(e)})}},this.retryPollingIfNeeded=function(e,t){if(!n._pollingPromise.isCanceled){if(n._pollingFailedCount>=y)return n._startPollingSequence(),void n.triggerBackfilling();n._pollingFailedCount++,e&&"Timeout"===e.statusText?n._poll(t):(n._pollingRetryInterval.start(),n.triggerBackfilling())}},this.triggerBackfilling=function(){for(var e in n._handledConversations){if(n._handledConversations.hasOwnProperty(e))n._handledConversations[e].backfillCallback()}},this._startPollingSequence=function(e){if(n._endpointCreationPromise&&n._endpointCreationPromise.status===o.PromiseStatus.Pending)return n._endpointCreationPromise.promise;if(n._isPolling)return Promise.resolve();if(n._waitingForRetry&&!e)return Promise.resolve();n._endpointRetryInterval.reset(),p.stop(),n._pollingFailedCount=0,n._pollingRetryInterval&&n._pollingRetryInterval.reset(),n._pollingRemoved=!1,n._authPromise.status!==o.PromiseStatus.Pending&&(n._authPromise=new o.CancelablePromise);return n._endpointCreationPromise=new o.CancelablePromise(n._createEndpoint().then(function(e){p.reset(),e.json().then(function(e){if(!n._endpointCreationPromise.isCanceled){if(!(e.subscriptions&&e.subscriptions.length>0))return n._subscribeToEndpoint();n._poll(e.subscriptions[0].id)}})},function(){n._endpointCreationPromise.isCanceled||(n._endpointFailedCount++,n._waitingForRetry=!0,n._endpointFailedCount>=_?(p.execute(n._startPollingSequence.bind(n,!0)),n._endpointFailedCount>=b&&a.swc.Eventing.triggerEvent("chatServiceUnavailable",null,!0)):n._endpointRetryInterval.start())})),n._endpointCreationPromise.promise},this._storeEpid=function(t){var n=(t=t||"").match(/endpoints\/(%7B[\da-z\-]+%7D)/),i=n&&n[1]||e._epid;i&&(e._epid=i,a.swc.services.sessionStorage.setItem(s.SKYPE_ENDPOINT_ID_KEY,e._epid))},this.onEndpointCreation=function(e){n._setEndpointProperty(t.SET_ENDPOINT_PROPERTY,!0),n.setEndpointPresence()},this._createEndpoint=function(){var e={endpointFeatures:"Agent,InviteFree,MessageProperties"},t=function(e){if(!e.ok)return Promise.reject("Failed to create endpoint");var t=e.headers.get("location")||e.url;n._storeEpid(t);var i=m.parseChatServiceHostUrl(t);r.Configuration.CHAT_HOST_URL=i,r.Configuration.CHAT_GUEST_HOST_URL=i;var o=n._authPromise.resolve.bind(n._authPromise);return setTimeout(o,1),a.swc.services.isActive()&&h.startActivation(),n.onEndpointCreation(e),a.swc.Eventing.triggerEvent("endpointRegistered",null,!0),e},i=a.swc.services.mePerson?a.swc.services.mePerson.id:"",o=S.get(i);if(o){return g.put("endpointCreation",o,{body:JSON.stringify(e),headers:{"Content-Type":"application/json"}},!0,!0).then(function(e){return r.Configuration.CHAT_HOST_URL=m.parseChatServiceHostUrl(e.url),e}).then(t).catch(function(e){return S.invalidate(),n._createEndpoint()})}return g.post("endpointCreation","users/ME/endpoints",{body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then(function(e){if(e.ok){var t=e.headers.get("location");S.set(i,t)}return e}).then(t)},this._requestSubscription=function(){var e={channeltype:"httpLongPoll",interestedResources:n._getInterestedResources()};return g.post("endpointSubscription","users/ME/endpoints/SELF/subscriptions",{body:JSON.stringify(e)})},this.setEndpointPresence=function(){var t={id:"messagingService",privateInfo:{epname:"skype"},epname:"skype",publicInfo:{capabilities:"video|audio",nodeInfo:"",skypeNameVersion:"skype.com",type:1},version:r.Configuration.getClientVersion(),selfLink:"uri",type:"EndpointPresenceDoc"};if(!e._epid){return Promise.reject("[setEndpointPresence] - missing polling epid, no location coming from createEndpoint")}return g.put("setEndpointPresence","users/ME/endpoints/"+e._epid+"/presenceDocs/messagingService",{body:JSON.stringify(t)})},this.modifySubscription=function(){var e={interestedResources:n._getInterestedResources()};if(void 0===n._subscriptionId)return Promise.resolve();var t="users/ME/endpoints/SELF/subscriptions/"+n._subscriptionId+"?name=interestedResources",i=e.interestedResources.length;return g.put("endpointSubscription",t,{body:JSON.stringify(e)}).then(function(e){e&&!e.ok&&c.default.throwError(10005,"Unable to update subscription. Number of followed contacts: "+i,e)},function(e){c.default.throwError(10005,"Unable to update subscription. Number of followed contacts: "+i,e)})},e._epid=a.swc.services.sessionStorage.getItem(s.SKYPE_ENDPOINT_ID_KEY),this._authPromise=new o.CancelablePromise,this._endpointRetryInterval=new d.FixedTimeout(this._startPollingSequence.bind(this,!0),v),this._pollingFailedCount=0,this._endpointFailedCount=0,this._updateSubscription=i(this.modifySubscription.bind(this),T,{leading:!0}),l.ThreadNotifications.init()}return Object.defineProperty(e.prototype,"authorization",{get:function(){return this._startPollingSequence(),this._authPromise.promise},enumerable:!0,configurable:!0}),e.prototype._setEndpointProperty=function(e,n){var i={};return i[e]=n,g.put("endpointProperties","users/ME/endpoints/SELF/properties?name="+t.SET_ENDPOINT_PROPERTY,{body:JSON.stringify(i),headers:{"Content-Type":"application/json"}})},e.prototype._getInterestedResources=function(){var e=["/v1/users/ME/conversations/ALL/messages","/v1/users/ME/conversations/ALL/properties","/v1/threads/ALL"];return Object.getOwnPropertyNames(this._followedContacts).forEach(function(t){e.push("/v1/users/ME/contacts/"+t)}),e},e.prototype._subscribeToEndpoint=function(){var e=this;return this._requestSubscription().then(function(t){if(!e._endpointCreationPromise.isCanceled){var n=(t.headers.get("location")||"").match(/\/(\d+)$/);n?(e._subscriptionId=n[1],e._poll(n[1])):e._startPollingSequence()}},function(t){if(!t||!t.json)return e._waitingForRetry=!0,void e._endpointRetryInterval.start();t.json().then(function(t){!t||729!==t.errorCode&&201!==t.errorCode||(729===t.errorCode&&S.invalidate(),e._startPollingSequence())},function(){})})},e.prototype._removeEndpoint=function(){if(this._pollingRemoved)return Promise.resolve();function t(){g.reset(),e._epid=null}return this._pollingRemoved=!0,e._epid||(e._epid=a.swc.services.sessionStorage.getItem(s.SKYPE_ENDPOINT_ID_KEY)),e._epid?g.del("deleteEndpoint","users/ME/endpoints/"+e._epid).then(t,t):(g.reset(),Promise.resolve())},e.prototype._stopPolling=function(){this._endpointRetryInterval.reset(),this._pollingRetryInterval&&this._pollingRetryInterval.reset(),this._pollingFailedCount=0,this._endpointFailedCount=0,this._endpointCreationPromise&&this._endpointCreationPromise.cancel(),this._pollingPromise&&(this._pollingPromise.cancel(),this._isPolling=!1)},e}();t.Polling=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(200),r=n(10),o={retryCount:3,timeout:5e4,policy:""},s=function(){function e(e,t){this.serviceName=e,this.baseUrl=t,this.authentication=function(e){return Promise.resolve(e)}}return e.prototype.issueRequest=function(e,t,n){var s=this;void 0===t&&(t={}),void 0===n&&(n={});var a=i.buildUriFromTemplate(this.baseUrl,e,t);return n.headers=n.headers||{},n.headers["Content-Type"]="application/json",this.onBeforeRequest(n).then(function(t){return r.default(s.serviceName+"-"+e,o,a,t).then(function(e){return e.ok?e.json():Promise.reject(e)})})},e.prototype.onBeforeRequest=function(e){return this.authentication(e)},e.prototype.setAuthentication=function(e){this.authentication=e},e.prototype.post=function(e,t,n,i){return void 0===t&&(t={}),void 0===i&&(i={}),i.method="POST",i.body=JSON.stringify(n),this.issueRequest(e,t,i)},e.prototype.get=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n={}),n.method="GET",this.issueRequest(e,t,n)},e}();t.JsonClient=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o=n(203),s={retryCount:3,timeout:12e4,policy:""},a=function(e,t,n,o){var a;return a=o?o+t:i.Configuration.CONTACTS_HOST_URL+t,r.default("contacts-"+e,s,a,n)};t.get=function(e,t){return o.getHeaders().then(function(n){var i={method:"GET"};return i.headers=n,i.cache="no-cache",a(e,t,i).then(function(e){return e.json()})})},t.getRaw=function(e,t,n){return o.getHeaders().then(function(i){n&&Object.getOwnPropertyNames(n).forEach(function(e){i.append(e,n[e])});var r={method:"GET"};return r.headers=i,r.cache="no-cache",a(e,t,r)})},t.post=function(e,t,n,i){return o.getHeaders().then(function(r){r.append("Content-Type","application/json");var o={method:"POST"};return o.body=n,o.headers=r,a(e,t,o,i)})},t.put=function(e,t,n){return o.getHeaders().then(function(i){i.append("Content-Type","application/json");var r={method:"PUT"};return r.body=n,r.headers=i,a(e,t,r)})},t.deleteMethod=function(e,t){return o.getHeaders().then(function(n){var i={method:"DELETE"};return i.headers=n,a(e,t,i)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(1),o=n(21),s=n(11),a=n(0),c=n(8),u=n(205),l=n(5),p=n(206),d=n(134),f=n(136),h="X-Skype-Continuation-Token",g="If-None-Match",m="Etag",v=4e3,y=3;t.reasons={DEFAULT:"default",NOTIFICATION:"notification"};var _=function(){function e(){var e=this;this._contacts=[],this._groups=[],this._blocklist=[],this._pendingContactFetching={},this._haveAllContacts=!1,this._retryCount=0,this._retryTimeout=v,this._etagHeader="",this.fetchMyContacts=function(t,n){void 0===t&&(t=100);var i=Date.now(),r=0;if(e._fetchContactsPromise)return n&&n(e._contacts),e._fetchContactsPromise.promise;var o=new p.ContactsInfo,d=function(s,p){var f=function(g){if(r++,!e._fetchContactsPromise||!e._fetchContactsPromise.isCanceled){var v=Date.now(),_=l.ServicesManager.signInManager.currentUserName;e.fetchContacts(_,t,g).then(function(l){if(!e._fetchContactsPromise||!e._fetchContactsPromise.isCanceled){if(!l.ok){if(429===l.status||500===l.status||502===l.status)return void(e._retryCount<y&&new Promise(function(t,n){setTimeout(function(){d(s,p)},e._retryTimeout),e._retryTimeout=2*e._retryTimeout,e._retryCount++}));var g={code:l.status,message:l.statusText};return c.default.throwError(11001,"Unable to fetch contacts 1",g),p(g),void(e._fetchContactsPromise=null)}l.json().then(function(c){return function(c){if(e._haveAllContacts=!0,!c)return e._contacts?s(o):(p({status:l.status,statusText:l.statusText}),e._fetchContactsPromise=null),void a.swc.Telemetry.sendEvent.contactsLoadedQos(l.status,r);c.duration=Date.now()-v,o.update(c);var u={"If-None-Match":"/"};n&&n(c.contacts);var d=l.headers.get(h),g=l.headers.get(m);return g&&(e._etagHeader=g),d?(u[h]=d,f(u)):(e._contacts=o.contacts.getItems(),c.contacts=e._contacts,e._groups=o.groups.getItems(),c.groups=e._groups,e._blocklist=o.blocklist.getItems(),c.blocklist=e._blocklist,c.scope=o.firstScope,c.duration=o.duration,s(c),void a.swc.Telemetry.sendEvent.contactsLoadedQos(l.status,r,c.contacts.length,c.blocklist.length,c.groups.length,o.filter(4).length,o.filter(8).length,o.filter(28).length,t,Date.now()-i))}(c)},function(t){c.default.throwError(11001,"Unable to fetch contacts 2",t),p(t),e._fetchContactsPromise=null,u.reportContactsLoadedQosError(l.status,t)})}})}};l.ServicesManager.signInManager.onceSignedIn().then(f.bind(e))},f=new Promise(d);return e._fetchContactsPromise=new s.CancelablePromise(f),e._fetchContactsPromise.promise},this.getContactsUpdate=function(n){return e._fetchContactsDelta(t.reasons.NOTIFICATION).then(function(e){return e.json()})},this.fetchContacts=function(e,t,n){if(void 0===t&&(t=100),i.default.get.isTeams())return Promise.resolve({status:200,statusText:"Aad is here"});var r="users/"+encodeURIComponent(e)+"?page_size="+t+"&reason=default";return d.getRaw("fetchContacts",r,n)},this._fetchContactsDelta=function(n){void 0===n&&(n=t.reasons.DEFAULT),n=n||t.reasons.DEFAULT;var r=l.ServicesManager.signInManager.currentUserName,o=e._etagHeader||"/",s={};if(s[g]=o,i.default.get.isTeams())return Promise.resolve({status:200,statusText:"Aad is here"});var a="users/"+encodeURIComponent(r)+"?delta&reason="+encodeURIComponent(n);return d.getRaw("fetchContactsDelta",a,s)},this.getContact=function(t,n){if(e._fetchContactsPromise&&e._fetchContactsPromise.status===s.PromiseStatus.Pending)return e._fetchContactsPromise.promise.then(function(){for(var t,i=0;i<e._contacts.length;i++)if(e._contacts[i].mri===n){t=e._contacts[i];break}return t});if(e._pendingContactFetching[n])return e._pendingContactFetching[n];for(var i,r=0;r<e._contacts.length;r++)if(e._contacts[r].mri===n){i=e._contacts[r];break}return i?(delete e._pendingContactFetching[n],Promise.resolve(i)):e._haveAllContacts?Promise.resolve():(e._pendingContactFetching[n]=new Promise(function(i,r){e.fetchContact(t,n).then(function(t){return t.json().then(function(t){var r,o=t.contacts||[];t.contacts&&t.contacts.length&&e._contacts.push(o),delete e._pendingContactFetching[n];for(var s=0;s<o.length;s++)if(o[s].mri&&o[s].mri===n){r=o[s];break}i(r)},function(t){delete e._pendingContactFetching[n],c.default.throwError(11002,"Unable to fetch contact",t),r(t)})},function(t){delete e._pendingContactFetching[n],c.default.throwError(11002,"Unable to fetch contact",t)})}),e._pendingContactFetching[n])},this.fetchContact=function(e,t){if(i.default.get.isTeams())return Promise.resolve({status:200,statusText:"Aad is here"});var n=f.default.normalizePersonId(t),r="users/"+e+"/contacts?$filter=mri%2Fnamespace+eq+%27"+f.default.parsePersonId(t).type+"%27+and+mri%2Fidentifier+eq+%27"+n+"%27";return d.getRaw("fetchContact",r)},l.ServicesManager.signInManager.subscribe("state",function(t){t===o.SigninState.SignedOut&&e.dispose()})}return Object.defineProperty(e.prototype,"fetchMyContactsPromise",{get:function(){return this._fetchContactsPromise&&this._fetchContactsPromise.promise},enumerable:!0,configurable:!0}),e.prototype.addContact=function(e,t){var n="users/"+l.ServicesManager.signInManager.currentUserName+"/contacts",i={mri:e,greeting:t};return d.post("addContact",n,JSON.stringify(i))},e.prototype.addFavoriteContact=function(e){var t="users/"+l.ServicesManager.signInManager.currentUserName+"/contacts/favorites/"+e;return d.put("addFavoriteContact",t,"")},e.prototype.removeFavoriteContact=function(e){var t="users/"+l.ServicesManager.signInManager.currentUserName+"/contacts/favorites/"+e;return d.deleteMethod("removeFavoriteContact",t)},e.prototype.blockContact=function(e,t,n){var i=this;void 0===t&&(t=!0),void 0===n&&(n="spam");var o=l.ServicesManager.signInManager.currentUserName,s="users/"+o+"/contacts/blocklist/"+e,a={delete_contact:!1,report_abuse:t,ui_version:r.Configuration.getUiVersion(),reason:n};return this.invalidateCache(),t?d.put("blockContact",s,JSON.stringify(a)).then(function(){return i.reportAbuse(o,e,n)}):d.put("blockContact",s,JSON.stringify(a))},e.prototype.reportAbuse=function(e,t,n){void 0===n&&(n="spam");var i="users/"+e+"/contacts/"+t+"/report",o={ui_version:r.Configuration.getUiVersion(),reason:n,report_context:"contact_request",content:{hash:"af94h"}};return d.post("reportAbuse",i,JSON.stringify(o))},e.prototype.unblockContact=function(e){var t="users/"+l.ServicesManager.signInManager.currentUserName+"/contacts/blocklist/"+e;return this.invalidateCache(),d.deleteMethod("unblockContact",t)},e.prototype.invalidateCache=function(){this._fetchContactsPromise&&(this._fetchContactsPromise.cancel(),this._fetchContactsPromise=null),this.fetchMyContacts()},e.prototype.getContactByMriIfPresent=function(e){var t=this._contacts.filter(function(t){return t.mri===e});return t.length?t[0].display_name:null},e.prototype.getContactByMri=function(e){var t=this._contacts.filter(function(t){return t.mri===e});return t.length?t[0]:void 0},e.prototype.getBlockedList=function(){return this._fetchContactsPromise?this._fetchContactsPromise.promise.then(function(e){return e.blocklist}):Promise.resolve()},Object.defineProperty(e.prototype,"contactsList",{get:function(){return this._contacts},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._contacts=[],this._groups=[],this._blocklist=[],this._fetchContactsPromise&&this._fetchContactsPromise.status===s.PromiseStatus.Pending&&this._fetchContactsPromise.cancel(),this._fetchContactsPromise=null},e}();t.default=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(43),r=function(){function e(){}return e._personIdRegExp=/(\d+:)([\S]*)/,e.normalizePersonId=function(t){var n=t.match(e._personIdRegExp);return n?n[2]:t},e.parsePersonId=function(t){var n=t.match(e._personIdRegExp);return n?{id:n[2],type:parseInt(n[1],0)}:{id:t,type:null}},e.getContactType=function(e){var t=/\d{0,}[^:]/g.exec(e.mri);return t&&t[0]?parseInt(t[0],0):i.ContactType.Undefined},e.replaceAvatarPath=function(e){return e.indexOf("data:image/jpeg;base64")>-1?e:e=(e=e.replace("URL@","")).indexOf("/views/avatar_fullsize")<0?e+"/views/avatar_fullsize":e},e.resolveConversationAvatar=function(t,n){return n?t?e.replaceAvatarPath(n):n:""},e}();t.default=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(11),s=n(13),a=n(0),c=n(4),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.searchSkypeDirectory=function(e){return this._searchPromise&&this._searchPromise.status===o.PromiseStatus.Pending&&(this._searchPromise.cancel(),this._searchPromise=null),this._searchKey=e,this._searchPromise=new o.CancelablePromise(a.swc.services.skypeGraphService.fetchProfiles(e)),this._searchPromise.promise},t.prototype.searchAgents=function(e){return new Promise(function(t,n){return a.swc.services.agentsService.searchAgents(e).then(function(e){if(e&&e.agentDescriptions){var n=e.agentDescriptions.map(function(e){return{skypeid:"28:"+e.agentId,name:e.displayName,avatar:e.userTileSmallUrl||e.userTileStaticUrl||"",type:c.ContactType.Agent}});t(n)}else t([])})})},t}(s.default);t.default=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=n(1),a=n(13),c=n(44),u=n(62),l=n(9),p=n(8),d=n(38),f=n(5),h="guest:";var g=function(e){function t(t,n,i){void 0===n&&(n=!1),void 0===i&&(i=!0);var r=e.call(this)||this;r._id=t,r._displayName="",r._isAgent=!1,r._isGuest=!1,r._isPstn=!1,r._isBlocked=!1,r._isFavorite=!1,r._avatarData="",r._email="",r._setAvatarDataIfValidUrl=function(e,t){u.loadAvatarUri(e,function(e){r.avatarData=e},t)},r.getPersonData=function(){if(r.displayName&&r.avatarData&&r._isFilled)return Promise.resolve();if(r._isFilled=!0,r.isAgent||r.isPstn)return Promise.resolve();if(r._ongoingStratusRequest)return r._ongoingStratusRequest;var e=function(e){p.default.throwError(10801,"Unable to resolve user details",e)};if(r._isMePerson){r._ongoingStratusRequest=f.ServicesManager.stratusService.fetchMeProperties().then(function(e){if(e){var t=e.firstname||"";t+=e.lastname?" "+e.lastname:"",r.displayName=t||r.displayName;var n=e.avatarUrl||e.avatarData;r._setAvatarDataIfValidUrl(n)}},e)}else{if(!r.shouldFetchProfile())return Promise.resolve();r._ongoingStratusRequest=f.ServicesManager.stratusService.fetchPerson(r._id).then(function(e){var t=(e=e||[]).filter(function(e){return e.username===r._id||e.username===r._mri})[0];if(t){var n=t.displayname?t.displayname:"",i=t.username?t.username:"",o=n||i;o&&(r.displayName=o),r._id===r._mri&&(r._mri=(r.isAgent?"28:":"8:")+r._id),t.avatarUrl&&r._setAvatarDataIfValidUrl(t.avatarUrl,function(){}),t.avatarData&&(r.avatarData=t.avatarData)}else p.default.throwError(10801,"Unable to resolve user details")},e)}return r._ongoingStratusRequest},r.getDataFromContactsService=function(){return r._ongoingContactsRequest?r._ongoingContactsRequest:r.isPstn?Promise.resolve():(r._ongoingContactsRequest=f.ServicesManager.signInManager.getSkypeToken().then(function(){var e=f.ServicesManager.signInManager.currentUserName;return e.indexOf("guest")>-1||r.isGuest||r._isMePerson?r._fetchDisplayNameAndAvatar():f.ServicesManager.contactsService.getContact(e,r._mri).then(function(e){if(e){var t=e.avatar,n=e.display_name;return t||(t=e.profile?e.profile.avatar_url:""),n&&(r.displayName=n),t?r._setAvatarDataIfValidUrl(t):r._fetchDisplayNameAndAvatar(),r._ongoingContactsRequest=null,""}return r._ongoingContactsRequest=null,r._fetchDisplayNameAndAvatar()},function(){return r._ongoingContactsRequest=null,r._fetchDisplayNameAndAvatar()})},function(){return r._ongoingContactsRequest=null}),r._ongoingContactsRequest)};var o=/^\d+:/;o.test(r._id)?(r._mri=r._id,r._id=r.id.replace(o,"")):r._mri="8:"+r._id,r._mri.indexOf("https://");var s=d.default.normalizePersonId(r._id);return s!==r._id&&(r._id=s),r._isAgent=n||r._mri.indexOf("28:")>-1,r._isGuest=r._id.indexOf(h)>-1,r._isPstn=r._mri.indexOf("4:")>-1,r._description="",r._isMePerson=r._id===f.ServicesManager.signInManager.currentUserName||d.default.normalizePersonId(r._id)===f.ServicesManager.signInManager.currentUserName,i&&r.fetchDisplayNameAndAvatar(),r}return r(t,e),Object.defineProperty(t.prototype,"isAgent",{get:function(){return this._isAgent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPstn",{get:function(){return this._isPstn},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBlocked",{get:function(){return this._isBlocked},set:function(e){e!==this._isBlocked&&(this._isBlocked=e,this.publish("isBlocked",this._isBlocked))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFavorite",{get:function(){return this._isFavorite},set:function(e){e!==this._isFavorite&&(this._isFavorite=e,this.publish("isFavorite",this._isFavorite))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isGuest",{get:function(){return this._isGuest},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mri",{get:function(){return this._mri},set:function(e){this._mri=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayName",{get:function(){return this._displayName||this.fetchDisplayNameAndAvatar(),this._displayName},set:function(e){this.setDisplayName(e)},enumerable:!0,configurable:!0}),t.prototype.setDisplayName=function(e){e&&e!==this._displayName&&(this._displayName=l.MessageUtils.parseTopic(e),this.publish("displayName",this._displayName))},t.prototype.getDisplayName=function(){return this._displayName},Object.defineProperty(t.prototype,"description",{get:function(){return this._description},set:function(e){e!==this._description&&(this._description=e,this.publish("description",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"avatarData",{get:function(){return o.default.get.isTeams()?(e=this._mri,t=this._displayName,n=s.Configuration.TEAMS_MIDDLE_TIER_URL+"/beta/users/"+e+"/profilepicturev2",i={displayname:t},c.addGetParamsToUrl(n,i)):this._avatarData;var e,t,n,i},set:function(e){e!==this._avatarData&&(this._avatarData=e,this.publish("avatarData",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extraLargeAvatarUrl",{get:function(){return this.extraLargeAvatarUrl},set:function(e){e!==this._extraLargeAvatarUrl&&(this._extraLargeAvatarUrl=e,this.publish("extraLargeAvatarUrl",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"email",{get:function(){return this._email},set:function(e){e!==this._email&&(this._email=e,this.publish("email",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"presenceStatus",{get:function(){return this._presenceStatus},set:function(e){this._presenceStatus!==e&&(this._presenceStatus=e,this.publish("presenceStatus",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFilled",{get:function(){return this._isFilled},enumerable:!0,configurable:!0}),t.prototype.fetchDisplayNameAndAvatar=function(){return this.isFilled?Promise.resolve():this.getDataFromContactsService()},t.prototype._fetchDisplayNameAndAvatar=function(){var e=this;return this._isFilled=!0,this.isAgent?f.ServicesManager.agentsService.getAgentDetails(this._id).then(function(t){if(t&&t.agentDescriptions&&1===t.agentDescriptions.length){var n=t.agentDescriptions[0].displayName;e._description=t.agentDescriptions[0].description,e._setAvatarDataIfValidUrl(t.agentDescriptions[0].userTileExtraLargeUrl),n&&(e.displayName=n)}return e._displayName}):this.getPersonData().then(function(){return e.displayName})},t.prototype.shouldFetchProfile=function(){return this._mri.indexOf("8:")>-1&&(!o.default.get.isTeams()||o.default.get.isTeams()&&!this._displayName)},t}(a.default);t.default=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(8),o=n(226),s=function(){function e(){var e=this;this.pesManager=null,this.isLoading=!1,this.setLoadingFinished=function(){e.isLoading=!1},this.init=function(){return e.initSkype()},this.canRenderConfigItems=function(){return e.pesManager.canRenderConfigItems()},this.getConfiguration=function(){return new Promise(function(t,n){e.config?t(e.config):e.init().then(function(n){t(e.config)})})},this.pesManager=new o.PesManager}return e.prototype.refresh=function(){this.pesManager.refresh()},e.prototype.initSkype=function(){var e=this;return this.getConfigurationPromise?this.getConfigurationPromise:(this.isLoading=!0,this.getConfigurationPromise=new Promise(function(t,n){i.swc.services.mePersonManager.fetch().then(function(n){e.pesManager.isInitialized||e.pesManager.init(n.id).then(function(n){e.config=n,e.setLoadingFinished(),t(e.config)},e.setLoadingFinished)},function(t){e.setLoadingFinished(),n(t),r.default.throwError(10503,"Unable to fetch me person and load PES",t)})}),this.getConfigurationPromise)},Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this.isLoading||this.pesManager.isInitialized},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"map",{get:function(){return this.pesManager.map},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emoticonMap",{get:function(){return this.pesManager.emoticonMap},enumerable:!0,configurable:!0}),e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.SMALL="small",e.LARGE="large",e.EXTRA_LARGE="extraLarge",e.SUPER_LARGE="superLarge"}(t.ITEM_SIZES||(t.ITEM_SIZES={})),t.STATIC_MEDIA_INFO={firstFrame:0,framesCount:1,fps:1},function(e){e.camel="drawState",e.dash="draw-state"}(t.DRAW||(t.DRAW={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._items={}}return Object.defineProperty(e.prototype,"length",{get:function(){return Object.keys(this._items).length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._items={}},e.prototype.getItem=function(e){return this._items[e]},e.prototype.key=function(e){return null},e.prototype.removeItem=function(e){delete this._items[e]},e.prototype.setItem=function(e,t){this._items[e]=t},e}();t.MemoryStorage=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this)||this;return n.lastReadMessageTimestamp=-1,n.modificationTime=-1,n.lastReadMessageId="",n.value="",t&&n.set(t),n}return r(t,e),t.prototype.set=function(e,t){if(e){var n=e.split(";");this.lastReadMessageTimestamp=Number(n[0]),this.modificationTime=Number(n[1]),this.lastReadMessageId=n[2],this.value=e,!0===t&&this.publish("value",this.value)}},t}(n(13).default);t.ConsumptionHorizon=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.callbacks=[]}return e.prototype.subscribe=function(e){return 0===this.callbacks.filter(function(t){return t===e}).length&&(this.callbacks.push(e),!0)},e.prototype.unsubscribe=function(e){this.callbacks=this.callbacks.filter(function(t){return t!==e})},e.prototype.notify=function(e){this.callbacks.forEach(function(t){t(e)})},e.prototype.dispose=function(){delete this.callbacks},e}();t.SubscribeableStore=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(267),r=n(268),o=n(269),s=function(){function e(){}return Object.defineProperty(e.prototype,"messages",{get:function(){return new r.MessagesCblBase},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skypeSignInManager",{get:function(){return new o.SkypeSignInManagerCblBase},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"deleteMemberProcessor",{get:function(){return new i.DeleteMemberProcessorCblBase},enumerable:!0,configurable:!0}),e}();t.CblBase=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(109),r=function(){function e(){}return e.getSentMessageType=function(t){switch(t){case i.MessageType.FILE:case i.MessageType.IMAGE:return e.File;case i.MessageType.SWIFT:return e.Card;default:return e.Text}},e.getReceivedMessageType=function(t){switch(t){case"":return e.File;default:return e.Text}},e.Text="text",e.File="file",e.Card="card",e}();t.default=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(76),a=/(\(|\))/g,c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.isElementAllowed=function(e){return"i"!==e.nodeName.toLowerCase()||-1===e.className.toLowerCase().indexOf("mention")},t.prototype.wordRawToXml=function(e,t,n,i){for(var r,o=[],s=/[\.,_:\-;?]$/,a=t.substring(1),c=this.getMentionUserData(a,n,i);!c&&a.match(s);)r=a.charAt(a.length-1),a=a.substring(0,a.length-1),c=this.getMentionUserData(a,n,i);return c&&(o.push(this.createXmlElement(e,c)),r&&o.push(e.createTextNode(r))),o},t.prototype.getMentionUserData=function(e,t,n){var i,r={defaultDisplayName:"",displayName:"",skypeId:"",mri:"",isMePerson:!1};if(!e)return null;var s=0===(e=e.toLowerCase()).indexOf("("),c=s?e.substring(1,e.length-1):"",u=o.swc.services.i18n.fetch("text_all").toLowerCase();if(c===u)return{defaultDisplayName:u,displayName:u,skypeId:"*",mri:"*",isMePerson:!1};var l=t?t.participants:[];if(r.isMePerson=!!n&&(e===n.id.toLowerCase()||s&&n.displayName.replace(a,"").toLowerCase()===c),r.isMePerson)i=n;else{var p=l.filter(function(t){return t.person.id.toLowerCase()===e||s&&t.person.displayName.replace(a,"").toLowerCase()===c});p.length&&(i=p[0].person)}return i?(r.skypeId=i.id,r.mri=i.mri,r.displayName=i.displayName,r.defaultDisplayName||(r.defaultDisplayName=r.displayName),r):null},t.prototype.wordMatcher=function(){return/@([a-z0-9\.,\-_:]+|\(.+?\))/gi},t.prototype.createXmlElement=function(e,t){var n=e.createElement("at");return n.setAttribute("id",t.mri),n.innerText=t.defaultDisplayName,n},t}(s.WordDomTransformer);t.MentionDomEncoder=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(9),o=n(136),s=function(){function e(){}return e._processUsers=function(e,t){for(var n=i.swc.services.mePersonManager.mePerson,s=0;s<e.users.length;s++){var a=null,c=e.users[s],u=o.default.normalizePersonId(c.mri);c.person=n.id===u?n:i.swc.services.persons.getPerson(c.mri,!0),c.value=c.value?r.MessageUtils.getMessageSanitizedContent(c.value):"";for(var l=0;l<t.users.length;l++){var p=t.users[l];if(c.mri===p.mri){a=p;break}}a||t.users.push(c)}},e.parseMessageProperties=function(t,n){n.properties&&t.supportedAnnotations.forEach(function(i){var r=n.properties?n.properties[i]:[],o=t[i];if(r)for(var s=function(t){var n=null,i=r[t];i&&"reactionsConsumptionHorizon"!==i.key&&function(){for(var t=0;t<o.length;t++){var r=o[t];i.key===r.key&&(n=r)}n||(n={key:i.key,users:[]},o.pushObservable(n)),e._processUsers(i,n)}()},a=0;a<r.length;a++)s(a)})},e.updateMessageProperties=function(e,t){t&&e.supportedAnnotations.forEach(function(n){var i=e[n],r=t[n];i&&r&&(i.spliceObservable(0,i.length),r&&r.forEach(function(e){i.pushObservable(e)}))})},e}();t.default=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(40),s=n(0),a=n(50),c=n(28),u=n(5),l=function(e){function t(n,i){var r=e.call(this,"Reminder")||this;return r.title=r.getTitle(n),r.description=t.getDescription(n),r.conversationId=i.id,r.sender="",r.avatarUrl=r.getAvatar(i),r.actionsInformation=t.getActionsInformation(),r}return r(t,e),t.getActionsInformation=function(){return{accept:{title:s.swc.services.i18n.fetch("open"),description:s.swc.services.i18n.fetch("open_client_descr")},ignore:{title:s.swc.services.i18n.fetch("ignore"),description:s.swc.services.i18n.fetch("ignore_reminder_notificaton_descr")}}},t.prototype.getTitle=function(e){var t="",n=s.swc.services.i18n.fetch("separator");return e.forEach(function(e){if(e.isGroup)t+=""===t?e.topic:n+" "+e.topic;else{var i=u.ServicesManager.contactsService.getContactByMriIfPresent(e.id)||c.normalizePersonId(e.id);t+=""===t?i:n+" "+i}}),t},t.getDescription=function(e){return s.swc.services.i18n.fetch("notification_reminder_desc",{count:e.length})},t.getActions=function(e,t){return[{type:"Accept",title:e.actionsInformation.accept.title,description:e.actionsInformation.accept.description,action:function(){a.default.startChat(e.conversationId,t,!1,o.OpenChatOrigin.NOTIFICATION),s.swc.Telemetry.sendEvent.notificationAction("Reminder","Accept")}},{type:"Ignore",title:e.actionsInformation.ignore.title,description:e.actionsInformation.ignore.description,action:function(){s.swc.Telemetry.sendEvent.notificationAction("Reminder","Ignore")}}]},t}(n(78).Notification);t.default=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(40),s=n(0),a=n(50),c=n(9),u=n(28),l=n(5),p=n(35),d=function(e){function t(n,i){var r=e.call(this,"UnreadMessage")||this;return r.title=t.getTitle(n,i.sender),r.conversationId=n.id,r.description=t.getDescription(i),r.sender=t.getSender(n,i),r.avatarUrl=r.getAvatar(n,i.sender),r.actionsInformation=t.getActionsInformation(),r}return r(t,e),t.getActionsInformation=function(){return{accept:{title:s.swc.services.i18n.fetch("open"),description:s.swc.services.i18n.fetch("open_client_descr")},ignore:{title:s.swc.services.i18n.fetch("ignore"),description:s.swc.services.i18n.fetch("ignore_unread_notificaton_descr")}}},t.getTitle=function(e,t){if(e.isGroup)return e.topic;var n=l.ServicesManager.contactsService,i=t?t.displayName:null;return n.getContactByMriIfPresent(e.id)||i||u.normalizePersonId(e.id)},t.getDescription=function(e){switch(e.rawMessageType){case"RichText/UriObject":case"RichText/Html":return s.swc.services.i18n.fetch("pic_sent");case"RichText/Media_GenericFile":return s.swc.services.i18n.fetch("file_sent");case"Event/Call":return s.swc.services.i18n.fetch(t.getCallMessage(e.content));default:var n=p.default.dompurify.sanitize(e.content,{ALLOWED_TAGS:[]});return c.MessageUtils.unescape(n)}},t.getCallMessage=function(e){return/<partlist type="missed"="/.test(e)?"message_text_missedCall":(/<partlist type="ended"="/.test(e),"message_text_endedCall")},t.getActions=function(e,t){return[{type:"Accept",title:e.actionsInformation.accept.title,description:e.actionsInformation.accept.description,action:function(){a.default.startChat(e.conversationId,t,!1,o.OpenChatOrigin.NOTIFICATION),s.swc.Telemetry.sendEvent.notificationAction("UnreadMessage","Accept")}},{type:"Ignore",title:e.actionsInformation.ignore.title,description:e.actionsInformation.ignore.description,action:function(){s.swc.Telemetry.sendEvent.notificationAction("UnreadMessage","Ignore")}}]},t.getSender=function(e,t){return e.isGroup&&t.sender?t.sender.displayName:""},t}(n(78).Notification);t.UnreadMessageNotification=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(0),o=n(8),s=n(5),a=n(317),c=n(89),u=n(318),l=n(319),p=n(148),d=n(149),f={"Event/Call":1,"Signal/Flamingo":1},h=function(){function e(){this.activeCallNotifications={},this.idOfShowedMessageNotifications={},this.everOpenedChats={},this.notifications=[],this.unreadMessageObserver=new l.default,this.isEnabled=!0,this.isConversationWithConciergeBot=function(e){return e===i.Configuration.CONCIERGE_BOT_MRI||e===i.Configuration.CONCIERGE_BOT_DF_MRI}}return e.prototype.enableNotifications=function(){this.isEnabled=!0},e.prototype.disableNotifications=function(){this.isEnabled=!1},e.prototype.registerUnreadMessage=function(e,t){var n=this;if(!(this.idOfShowedMessageNotifications[t.id]||this.isOpenedIConversation(e.id)||this.isConversationWithConciergeBot(t.senderId)||f[t.rawMessageType])){var i=this.unreadMessageObserver.getNotification(e,t);i&&(this.idOfShowedMessageNotifications[t.id]=!0,this.notifications.push(i),r.swc.services.notificationSettingsStore.get(c.NotificationSettingType.NewMessage).then(function(e){n._canNotify(e)&&n.showNotifications()}))}},e.prototype.registerUnreadIConversationsSummary=function(e){var t=this;if(u.default.isEnabled&&0!==(e=e.filter(function(e){return!e.alertsOff&&!t.isConversationWithConciergeBot(e.id)})).length&&!u.default.isIgnored()){var n=this.getUnreadIConversationsNotification(e);n&&this.notifications.push(n),this.showNotifications()}},e.prototype._canNotify=function(e){return!!e&&(e.value===c.NotificationAllowedValue.All||e.value===c.NotificationAllowedValue.Notification)},e.prototype.registerCall=function(e){var t=this,n=new a.default(e),i=n.getNotification();i?r.swc.services.notificationSettingsStore.get(c.NotificationSettingType.IncomingCall).then(function(e){t._canNotify(e)&&(t.activeCallNotifications[n.callId]=i,r.swc.Eventing.triggerEvent("sendNotification",i),r.swc.Telemetry.sendEvent.notificationCreated(i.type))}):o.default.throwError(200003,"Unable to create call notification")},e.prototype.callStateHandler=function(e){this.activeCallNotifications[e.id]&&1!==e.status&&(this.activeCallNotifications[e.id].hide(),delete this.activeCallNotifications[e.id])},e.prototype.setOpenedConversations=function(e){this.everOpenedChats=e,s.ServicesManager.setEverOpenedChats(e)},e.prototype.isOpenedIConversation=function(e){var t=this.everOpenedChats[e];return t&&t.onStage},e.prototype.showNotifications=function(){if(this.isEnabled)for(var e=this.notifications.length,t=0;t<e;t++){var n=this.notifications.pop();n=JSON.parse(JSON.stringify(n)),r.swc.Eventing.triggerEvent("sendNotification",n),r.swc.Telemetry.sendEvent.notificationCreated(n.type)}else this.notifications=[]},e.getActionsForNotification=function(e,t){switch(e.type){case"UnreadMessage":return d.UnreadMessageNotification.getActions(e,t);case"Summary":return u.default.getActions(e);case"Reminder":return p.default.getActions(e,t);case"Calling":return a.default.getActions(e,t);default:return[]}},e.prototype.getUnreadIConversationsNotification=function(e){var t=r.swc.services.localStorage.getItem("swc-recentslastseen");if(!t)return new u.default(e);var n=e.filter(function(e){return e.lastMessage.originalTimestamp.getTime()>+t});return n.length?new u.default(n):null},e}();t.default=h},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),s=n(53),a=n(0),c=n(61),u=function(e){function t(t,n,i){void 0===i&&(i=!1);var r=e.call(this,n)||this;return r._sharepointService=t,r._useAms=!1,r._useAms=!!i,r}return r(t,e),t.prototype.isEnterpriseAmsUsed=function(){return this._useAms},t.prototype.downloadRawFile=function(e){return this._useAms?this.downloadEnterpriseFile(e):this._sharepointService.downloadFile(e)},t.prototype.downloadEnterpriseFile=function(t){return d(t)?e.prototype.downloadPicture.call(this,t.id):e.prototype.downloadFileByDocumentId.call(this,t.id)},t.prototype.getFileStatus=function(t,n){return this._useAms?e.prototype.getFileStatus.call(this,t,n):Promise.resolve({uploadStatus:this._sharepointService.getFileStatus(t)})},t.prototype.sendFile=function(e,t){return this._useAms?this.sendAmsEnterpriseFile(e,t):this.sendFileViaSharepoint(e,t)},t.prototype.sendAmsEnterpriseFile=function(e,t){var n=this,i=Date.now().toString();this._uploads[i]=s.DocumentStatus.InProgress;var r=p(t,null),o=this.createAmsDocument(e,t),a=o.then(function(e){var n=p(t,e.id);return{documentId:e.id,clientMessageId:i,files:[n]}}),c=o.then(function(i){return n.uploadFileContent(e,i.id,t)}).catch(function(){n._uploads[i]=s.DocumentStatus.Failed});return e.sendFilesAsAmsProperties({clientMessageId:i,files:[r],registerPromise:a,uploadPromise:c})},t.prototype.sendFileViaSharepoint=function(e,t){var n=this;return(c.isDocumentTypeImage(t.type)?this.createAndUploadAmsDocument(e,t):Promise.resolve({documentId:void 0,uploadPromise:Promise.resolve()})).then(function(i){return n.sendAndShare(e,t,i)})},t.prototype.createAndUploadAmsDocument=function(e,t){var n=this;return this.createAmsDocument(e,t).then(function(i){return{uploadPromise:n.uploadFileContent(e,i.id,t),documentId:i.id}})},t.prototype.sendAndShare=function(e,t,n){var i=this,r=n.documentId,s=n.uploadPromise,u=function(e,t){return{"@type":"http://schema.skype.com/File",version:2,id:Date.now().toString(),baseUrl:"",type:e.type,title:e.name,state:"active",objectUrl:"",providerData:'{"code":null,"type":0}',itemid:"",fileName:e.name,fileType:c.getNameAndExtension(e.name).extension,fileInfo:{fileUrl:"",siteUrl:"",serverRelativeUrl:""},botFileProperties:{},filePreview:{previewUrl:t?URL.createObjectURL(e):void 0},fileChicletState:{serviceName:"p2p",state:"active"}}}(t,r),l=this._sharepointService.checkAndUploadFile(t,u.id),p=l.then(function(e){var t=function(e,t){return{"@type":"http://schema.skype.com/File",version:2,id:e.objectId,baseUrl:e.siteInfo.siteUrl,type:e.type,title:e.title,state:"active",objectUrl:e.objectUrl,providerData:'{"code":null,"type":0}',itemid:e.objectId,fileName:e.title,fileType:e.type,fileInfo:{fileUrl:e.objectUrl,siteUrl:e.siteInfo.siteUrl,serverRelativeUrl:e.serverRelativeUrl},botFileProperties:{},filePreview:{previewUrl:t?o.Configuration.AMS_HOST_URL+"objects/"+t+"/views/imgo":void 0},fileChicletState:{serviceName:"p2p",state:"active"}}}(e.fileCheckValue,r);return{clientMessageId:u.id,files:[t]}}),d=l.then(function(t){var n=t.fileCheckValue,r=t.uploadPromise,o=e.members.map(function(e){return a.swc.services.contactsService.getContact("",e.id)}),c=Promise.all(o).then(function(e){return r.then(function(){var t=e.filter(function(e){return e&&e.email}).map(function(e){return e.email});return i._sharepointService.shareFile(n.objectUrl,t)})});return Promise.all([c,s])});return e.sendFilesAsProperties({clientMessageId:u.id,files:[u],registerPromise:p,uploadPromise:d}),d},t}(n(129).SkypeAmsManager);function l(e,t){var n=c.isDocumentTypeImage(t)?"imgpsh_fullsize":"original";return o.Configuration.AMS_HOST_URL+"objects/"+e+"/views/"+n}function p(e,t){return{"@type":"http://schema.skype.com/File",type:e.type,itemid:"",baseUrl:"",providerData:"",version:2,id:t,title:e.name,state:"active",objectUrl:l(t,e.type),fileName:e.name,fileType:c.getNameAndExtension(e.name).extension,botFileProperties:{url:t?l(t,e.type):void 0},fileInfo:{fileUrl:"",siteUrl:"",serverRelativeUrl:""},filePreview:{previewUrl:""}}}function d(e){switch(e.fileType){case"jpeg":case"jpg":case"gif":case"png":case"bmp":case"tiff":case"jfif":return!0;default:return!1}}t.TeamsAmsManager=u,t.isImage=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(23);t.reportServiceFault=function(e,t,n){t=t||{};var o=r.NA;t.headers&&"function"==typeof t.headers.get&&(o=t.headers.get("contextid")||t.headers.get("X-Skype-Caller")||t.headers.get("X-Skype-Request-Id")),i.swc.Telemetry.sendEvent.serviceFault(e,t.status,t.statusText||t.message,i.swc.services.isZombie,t.url,o,n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(3),o=n(16),s=n(31),a=n(0),c=!1,u=function(e){return{value:null,expiry:null,failureCount:e.value?e.failureCount+1||1:e.failureCount||0}};t.handleRegTokenExpiry=function(e){var t=403===e.status&&(!e.headers||"Quarantine limit Exceeded"!==e.headers.get("StatusText")),n=401===e.status;return t||n?(i=u(i),a.swc.services.sessionStorage.setItem(s.SKYPE_REGTOKEN_KEY,JSON.stringify(i)),a.swc.services.signInManager.checkAuthFailuresCount(i.failureCount),Promise.reject(e)):Promise.resolve(e)},t.handleSkypeTokenExpiry=function(e){return 401===e.status?(a.swc.services.signInManager.logout("services:401"),Promise.reject(e)):Promise.resolve(e)},t.processHeaders=function(e){var t=e.headers.get("set-registrationtoken");if(t){var n=t.match(/registrationToken=(.+); expires=(\d+)/);n&&(i.value=n[1],i.expiry=parseInt(n[2],10),i.expiry<1e10&&(i.expiry*=1e3),delete i.failureCount,a.swc.services.sessionStorage.setItem(s.SKYPE_REGTOKEN_KEY,JSON.stringify(i)))}return e},t.getHeaders=function(){c&&i.expiry<Date.now()&&(i=u(i));var e={};r.default.get.backend===o.MessagingBackend.TEAMS&&(e["x-ms-user-type"]="user",e["x-ms-client-type"]="web");var t=function(){return i.value?(e.RegistrationToken="registrationToken="+i.value,Promise.resolve(e)):new Promise(function(t,n){a.swc.services.signInManager.getSkypeToken().then(function(n){e.Authentication="skypetoken="+n,t(e)},function(){return n()})})};return c?t():a.swc.services.signInManager.onceSignedIn().then(function(){return function(){var e,t=null;if(!i){try{t=a.swc.services.sessionStorage.getItem(s.SKYPE_REGTOKEN_KEY)}catch(e){}if(t)try{e=JSON.parse(t)}catch(e){}i=e&&e.value&&e.expiry?e:{value:null,expiry:null}}c=!0}(),t()})},t.reset=function(){i={value:null,expiry:null}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLastItemFromArray=function(e,t){return e&&e.length>0?e[e.length-1]:t}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),s=n(13),a=n(84),c=n(4),u=function(e){function t(t,n){var i=e.call(this)||this;return i.customType=c.CustomMessageType.Custom,i.supportedAnnotations=[],i.type=c.MessageType.UserMessage,i._isDeleted=!1,i._isEdited=!1,i.timestamp=new Date,i.originalTimestamp=i.timestamp,i._payload=n,i._status=c.DeliveryStatus.Pending,i.suggestedActions=a.ObservableCollection.create(),t&&(i.type=c.MessageType.SystemMessage),i.supportedAnnotations.push(o.Configuration.MESSAGE_PROPERTIES.PER_USER.EMOTIONS),i.emotions=a.ObservableCollection.create(),i._files=a.ObservableCollection.create(),i}return r(t,e),Object.defineProperty(t.prototype,"files",{get:function(){return this._files},set:function(e){this._files=e,this.publish("files",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clientMessageId",{get:function(){return this._clientMessageId},set:function(e){this._clientMessageId=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"composeTime",{get:function(){return this._composeTime},set:function(e){e!==this._composeTime&&(this._composeTime=e,this.publish("composeTime",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){return this._content},set:function(e){e.indexOf("customDebug"),e!==this._content&&(this._content=e,this.publish("content",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){e!==this._direction&&(this._direction=e,this.publish("direction",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(e){e!==this._id&&(this._id=e,this.publish("id",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageContent",{get:function(){return this._imageContent},set:function(e){e!==this._imageContent&&(this._imageContent=e,this.publish("imageContent",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDeleted",{get:function(){return this._isDeleted},set:function(e){e!==this._isDeleted&&(this._isDeleted=e,this.publish("isDeleted",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isEdited",{get:function(){return this._isEdited},set:function(e){e!==this._isEdited&&(this._isEdited=e,this.publish("isEdited",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFirst",{get:function(){return this._isFirst},set:function(e){e!==this._isFirst&&(this._isFirst=e,this.publish("isFirst",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTranslated",{get:function(){return this._isTranslated},set:function(e){e!==this._isTranslated&&(this._isTranslated=e,this.publish("isTranslated",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this._key},set:function(e){e!==this._key&&(this._key=e,this.publish("key",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"originalTimestamp",{get:function(){return this._originalTimestamp},set:function(e){e!==this._originalTimestamp&&(this._originalTimestamp=e,this.publish("originalTimestamp",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"payload",{get:function(){return this._payload},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"processedContent",{get:function(){return this._processedContent},set:function(e){e!==this._processedContent&&(this._processedContent=e,this.publish("processedContent",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rawMessageType",{get:function(){return this._rawMessageType},set:function(e){this._rawMessageType=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sender",{get:function(){return this._sender},set:function(e){e!==this._sender&&(this._sender=e,this.publish("sender",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"senderId",{get:function(){return this._senderId},set:function(e){e!==this._senderId&&(this._senderId=e,this.publish("senderId",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skypeEditedId",{get:function(){return this._skypeEditedId},set:function(e){e!==this._skypeEditedId&&(this._skypeEditedId=e,this.publish("skypeEditedId",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){return this._status},set:function(e){e!==this._status&&(this._status=e,this.publish("status",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"timestamp",{get:function(){return this._timestamp},set:function(e){e!==this._timestamp&&(this._timestamp=e,this.publish("timestamp",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"translation",{get:function(){return this._content},set:function(e){e!==this._translation&&(this._translation=e,this.publish("translation",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return this._version},set:function(e){e!==this._version&&(this._version=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imdisplayname",{get:function(){return this._imdisplayname},set:function(e){e!==this._imdisplayname&&(this._imdisplayname=e)},enumerable:!0,configurable:!0}),t.prototype.getKey=function(){return this._key||this._skypeEditedId||this._clientMessageId||this._id||"0"},Object.defineProperty(t.prototype,"amsreferences",{get:function(){return this._amsreferences},set:function(e){e!==this._amsreferences&&(this._amsreferences=e,this.publish("amsreferences",e))},enumerable:!0,configurable:!0}),t}(s.default);t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.implode=function(e){return e.join(",")},e.explode=function(e){return e?e.replace(/\s/g,"").split(","):[]},e.find=function(t,n){return e.explode(t).indexOf(n)>-1},e.add=function(t,n,i){if(!i||!e.find(t,n)){var r=e.explode(t);r.push(n),t=e.implode(r)}return t},e}();t.default=i},,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addScript=function(e,t,n,i){void 0===t&&(t=!1);var r=function(){return i&&i("failed to load "+e)},o=setTimeout(r,5e3),s=document.createElement("script");s.src=e,t&&(s.crossOrigin="anonymous"),s.type="text/javascript",s.addEventListener("load",function(){clearTimeout(o),n&&n()}),s.onabort=r;var a=document.body||document.head;a&&a.appendChild(s)}},,,function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(11),o=n(20),s=n(0),a=n(22),c=n(128),u=n(175),l=n(176),p=function(){function t(){var e=this;this.initPromise=new r.CancelablePromise,this._retryCount=0,this.setLanguage=function(t){return e.lang=c.default.getLocale(t.toLowerCase()),e.defaults.then(function(){return e.load(e.lang).then(function(t){l.default.merge(t),u.default.init(e.lang)})})},this.whenReady=function(){return e.initPromise.promise},this.defaults=this.load(i.Configuration.LOCALE),this.defaults.then(function(e){l.default.set(e)}),this.lang=i.Configuration.LOCALE,u.default.init(i.Configuration.LOCALE),this.registerProxy()}return t.prototype.registerProxy=function(){var e=this;s.swc.Eventing.registerEvent("proxy:configuration:setLanguage",function(t){e.setLanguage(t).then(function(){s.swc.Eventing.triggerEvent("proxy:configuration:setLanguage:response",e.lang,!0)})}),o.ProxyConnector.instance.connect("configurationProxy",{})},t.prototype.init=function(e){var t=this;return e||(e=i.Configuration.LOCALE),this.setLanguage(e).then(function(){t.initPromise.resolve()}).catch(function(){t._retryCount<2&&(t._retryCount++,t.init(t.lang))})},t.prototype.load=function(t){var n=a.UrlHelper.getAppPath(s.swc.EcsConfig)+"resources/i18n/"+t+"/Strings.json";return e(n).then(function(e){return e.json()})},t.prototype.fetch=function(e,t){void 0!==t&&void 0!==t.count&&(e+=u.default.getPluralSuffix(t.count));var n=this._getKeyValueText(e);return this._replaceParams(n,t)},t.prototype.getResources=function(){return l.default.get()},t.prototype._replaceParams=function(e,t){for(var n in void 0===t&&(t={}),t)if(t.hasOwnProperty(n)){var i=t[n].toString(),r="{"+n+"}";e=e.replace(r,i)}return e},t.prototype._getKeyValueText=function(e){var t=l.default.get();return t&&t[e]?t[e]:e},t}();t.I18N=p}).call(this,n(52))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.username=e;try{this.storage=window.localStorage}catch(e){}}return e.prototype.isValid=function(e){return e.username===this.username&&e.expiresAt>Date.now()},e.prototype.get=function(e){try{var t=JSON.parse(this.storage.getItem(e));if(t&&this.isValid(t))return t.value;this.storage.removeItem(e)}catch(e){}},e.prototype.set=function(e,t,n){void 0===n&&(n=864e5);var i={username:this.username,expiresAt:Date.now()+n,value:t};try{this.storage.setItem(e,JSON.stringify(i))}catch(e){}},e}();t.LocalCacheStorage=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(259);t.TeamsUserPolicyService=i.TeamsUserPolicyService},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.actionType=o.SwiftCardActionType.unknown,r.originalPayload=t,r.actionType=t.type,r.image=t.image||t.image_url||null,r}return r(t,e),t}(n(120).default);t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(){var e=this;this.getDataPart=function(e){var t=e.substring(e.indexOf(".")+1);return t.substring(0,t.indexOf("."))},this.retrieveMeName=function(t){return t&&e.getTokenData(t).skypeid||""},this.getTokenData=function(t){return JSON.parse(atob(e.getDataPart(t)))}}}();t.TokenParser=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Calling="calling",e.Messaging="chat",e.Recents="recents"}(t.ModuleType||(t.ModuleType={}))},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(57),o=n(0),s=n(47);t.getBundleUri=function(e,t){void 0===t&&(t=o.swc.initSettings.version),i||(i=new r.ConfigFactory);var n=t||o.swc.initSettings?o.swc.initSettings.version:o.swc.EcsConfig.version,a=o.swc.EcsConfig.domain||location.host,c=o.swc.EcsConfig.isMinified;return a+(s.isAppVersion(n)?"/v/":"/fb/")+n+"/"+e+((void 0!==i.getDefinitionFromUrl().IsMinified?i.getDefinitionFromUrl().IsMinified:c)?".min":"")+".js"}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createTelemetryConfigFromEcs=function(e){var t={};return e&&(e.trouterTenantId&&(t.trouter={ingestionKey:e.trouterTenantId}),e.ariaTenantId&&(t.default={ingestionKey:e.ariaTenantId}),e.ariaServicesTenantId&&(t.services={ingestionKey:e.ariaServicesTenantId})),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),r={af:"af",am:"am",ar:"ar",as:"as",az:"az",be:"be",bg:"bg",bn:"bn",bs:"bs",chr:"chr",ca:"ca",cs:"cs",cy:"cy",da:"da",de:"de",el:"el",en:"en",es:"es",et:"et",eu:"eu",fa:"fa",fi:"fi",fil:"fil",fr:"fr",ga:"ga",gd:"gd",gl:"gl",gu:"gu",ha:"ha",he:"he",hi:"hi",hr:"hr",hu:"hu",hy:"hy",id:"id",ig:"ig",is:"is",it:"it",iw:"iw",ja:"ja",ka:"ka",kk:"kk",km:"km",kn:"kn",ko:"ko",kok:"kok",ku:"ku",ky:"ky",lb:"lb",lt:"lt",lv:"lv",mi:"mi",ml:"ml",mn:"mn",mr:"mr",ms:"ms",ne:"ne",nl:"nl",nn:"nn",nb:"nb",no:"no",nso:"nso",or:"or",pa:"pa",pl:"pl",prs:"prs",pt_br:"pt-br",pt_pt:"pt-pt",qps:"qps",qut:"qut",quz:"quz",ro:"ro",ru:"ru",rw:"rw",sd:"sd",si:"si",sl:"sl",sk:"sk",sq:"sq",sr:"sr",sv:"sv",sw:"sw",ta:"ta",te:"te",tg:"tg",th:"th",ti:"ti",tk:"tk",tn:"tn",tr_tr:"tr-tr",tt:"tt",ug:"ug",uk:"uk",ur:"ur",uz:"uz",vi:"vi",wo:"wo",xh:"xh",yo:"yo",zh:"zh",zu:"zu"},o={group0:{languages:[r.ja,r.id,r.ko,r.tr_tr,r.vi,r.zh,r.az,r.ig,r.fa,r.ka,r.km,r.kn,r.ms,r.prs,r.th,r.tt,r.ug,r.wo,r.yo]},group1:{languages:[r.bg,r.ca,r.cy,r.da,r.de,r.el,r.en,r.es,r.et,r.fi,r.he,r.hu,r.it,r.iw,r.nb,r.nl,r.no,r.pt_pt,r.qps,r.sv,r.af,r.as,r.bn,r.chr,r.eu,r.gl,r.gu,r.ha,r.hy,r.is,r.kk,r.kok,r.ku,r.ky,r.lb,r.mi,r.ml,r.mn,r.mr,r.ne,r.nn,r.or,r.pa,r.qut,r.quz,r.rw,r.sd,r.si,r.sq,r.sw,r.ta,r.te,r.tk,r.tn,r.ur,r.xh,r.zu]},group2:{languages:[r.fr,r.pt_br,r.am,r.fil,r.hi,r.nso,r.tg,r.ti,r.uz]},group3:{languages:[r.lv]},group4:{languages:[r.gd]},group5:{languages:[r.ro]},group6:{languages:[r.lt]},group7:{languages:[r.ru,r.uk,r.hr,r.sr,r.be,r.bs,r.sl]},group8:{languages:[r.cs,r.sk]},group9:{languages:[r.pl]},group11:{languages:[r.ga]},group12:{languages:[r.ar]}},s=function(){function e(){}return e.prototype.init=function(e){void 0===e&&(e=r.en);var t=e.replace("-","_").toLowerCase();if(!r[t]){var n=t.split("_");1===n.length&&i.default.throwError(10050,"Unsupported language:"+e),t=n[0]}this._currentLocale=t},e.prototype.getPluralSuffix=function(e){var t,n=null,i="";for(t in o)-1!==o[t].languages.indexOf(this._currentLocale)&&(n=t);switch(n){case"group0":i=1===e?"":"_few";break;case"group1":i=1===e?"":"_many";break;case"group2":i=e>1?"_many":"";break;case"group3":i=e%10==1&&e%100!=11?"":0===e?"_few":"_many";break;case"group4":i=1===e||11===e?"":2===e||12===e?"_few":"_many";break;case"group5":i=1===e?"":0===e||e%100>0&&e%100<20?"_few":"_many";break;case"group6":i=e%10==1&&e%100!=11?"":e%10>=2&&(e%100<10||e%100>=20)?"_many":"_few";break;case"group7":i=e%10==1&&e%100!=11?"":e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?"_few":"_many";break;case"group8":i=1===e?"":e>=2&&e<=4?"_few":"_many";break;case"group9":i=1===e?"":e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?"_few":"_many";break;case"group11":i=1===e?"":e>=2&&e<=10?"_few":"_many";break;case"group12":i=1===e?"":2===e?"_few":"_many";break;default:i=""}return i},e}();t.default=new s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),r=function(){function e(){this._resourcesLocation={}}return e.prototype.set=function(e){this._throwIfFalsy(e),this._resourcesLocation=e},e.prototype.merge=function(e){this._throwIfFalsy(e),Object.assign(this._resourcesLocation,e)},e.prototype.get=function(){return this._resourcesLocation},e.prototype._throwIfFalsy=function(e){e||i.default.throwError(10009,"[i18n / resources] Specified destination for localizations resources is not reachable")},e}();t.default=new r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Skype="skype",e.Aad="aad"}(t.TokenType||(t.TokenType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(11),o=n(24),s=n(16),a=n(19),c=n(0),u=n(8),l=function(){function e(){var e=this;this.fetch=function(){return e.mePerson?Promise.resolve(e.mePerson):e._mePersonPromise&&e._mePersonPromise.status===r.PromiseStatus.Pending?e._mePersonPromise.promise:(e._mePersonPromise=new r.CancelablePromise(e._fetchMePerson()),e._mePersonPromise.promise.catch(function(e){u.default.throwError(10007,"Unable to fetch me person",e)}),e._mePersonPromise.promise)},this.getFavouriteConversations=function(t){return void 0===t&&(t=!1),e.getMeProperties(t).then(function(e){return e.favorites?JSON.parse(e.favorites):{}})},this.getMeProperties=function(t){return void 0===t&&(t=!1),!t&&e._mePropertiesPromise||(e._mePropertiesPromise=new Promise(function(e,t){c.swc.services.signInManager.userIdentityType!==o.IdentityType.GUEST?c.swc.services.webApi.fetchMeProperties().then(function(t){e(t)}):t()})),e._mePropertiesPromise}}return Object.defineProperty(e.prototype,"mePerson",{get:function(){return c.swc.services.mePerson},enumerable:!0,configurable:!0}),e.prototype.getDetails=function(){var e=this;c.swc.services.signInManager.userIdentityType!==o.IdentityType.GUEST&&(this.getMeProperties().then(function(t){e.fillDetails(t)}),c.swc.services.webApi.getMyPresence().then(function(t){t&&t.status?e.mePerson.presenceStatus=t.status:e.mePerson.presenceStatus=a.PresenceStatus.Offline}),this.mePerson.fetchDisplayNameAndAvatar())},e.prototype.fillDetails=function(e){if(e)if(i.default.get.backend===s.MessagingBackend.TEAMS){var t=e.userDetails?JSON.parse(e.userDetails):{},n=e.personalFileSite?JSON.parse(e.personalFileSite):{},r=e.favorites?JSON.parse(e.favorites):{};n&&(this.mePerson.personalFileSite=n),r&&(this.mePerson.pinnedConversations=r),t.name&&(this.mePerson.displayName=t.name),t.avatarUrl&&(this.mePerson.avatarData=t.avatarUrl),this.mePerson.msaId=t.upn}else this.mePerson.msaId=e.cid},e.prototype.isMe=function(e){return!!this.mePerson&&(this.mePerson.id===e||this.mePerson.msaId===e||this.mePerson.mri===e)},e.prototype._fetchMePerson=function(){var e=this;return this.mePerson?Promise.reject("[skypeConversationsManager] mePerson has been already fetched."):c.swc.services.signInManager.onceSignedIn().then(function(){return e.getDetails(),e.mePerson})},e.prototype.dispose=function(){this._mePersonPromise&&this._mePersonPromise.status!==r.PromiseStatus.Pending&&(this._mePersonPromise=null),this.mePerson&&this.mePerson.dispose()},e}();t.default=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(13),s=n(0),a=function(e){function t(){var t=e.call(this)||this;return t.addAgent=function(e){return t._botsService.addAgentToContacts(e)},t.getAgent=function(e){return t._agentsService.getAgentDetails(e)},t._agentsService=s.swc.services.agentsService,t._botsService=s.swc.services.botsService,t}return r(t,e),t}(o.default);t.SkypeAgentsManager=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(61),o=n(5),s=n(53),a=n(98),c=function(){function e(){}return e.prototype.createNewDocument=function(e,t){var n,i,o={filename:t.name,type:(i=t.type,r.isDocumentTypeImage(i)?"pish/image":"sharing/file"),permissions:(n={},n[e]=[s.Permission[s.Permission.read]],n)};return a.post("createNewDocument","objects",JSON.stringify(o)).then(function(e){return e.json()})},e.prototype.sendFile=function(e,t){var n="objects/"+e+"/content/"+(r.isDocumentTypeImage(t.type)?"imgpsh":"original");return a.putData("sendFile",n,t)},e.prototype.getFileStatus=function(t,n){void 0===n&&(n=!1);var i=n?e.composeStatusUri(t,"imgpsh_fullsize"):e.composeStatusUri(t,"original");return this.getViewStatus(i).then(function(e){return e.scan&&"malware"===e.scan.status?{uploadStatus:s.DocumentStatus.Malware}:"ready"===e.view_state?{uploadStatus:s.DocumentStatus.Success}:e.scan&&"in progress"===e.scan.status?{uploadStatus:s.DocumentStatus.ScanInProgress}:"failed"!==e.view_state?{uploadStatus:s.DocumentStatus.InProgress}:{uploadStatus:s.DocumentStatus.Failed}})},e.prototype.downloadPictureThumbnail=function(t){var n=this,i=e.composeStatusUri(t,"imgt1");return new Promise(function(e,t){n.getViewUri(i).then(function(t){a.getData("downloadPictureThumbnail",t).then(e)},t)})},e.prototype.downloadFile=function(t){var n=this,i=e.composeStatusUri(t,"original");return new Promise(function(e,t){n.getViewUri(i).then(function(t){return a.getData("downloadFile",t).then(e)},t)})},e.prototype.downloadPicture=function(t){var n=this,i=e.composeStatusUri(t,"imgpsh_fullsize");return new Promise(function(e,t){n.getViewUri(i).then(function(t){return a.getData("downloadPicture",t).then(e)},t)})},e.prototype.getCallRecordingThumbnail=function(e){return a.getData("getRecordingThumbnail",e)},e.prototype.downloadCallRecording=function(e){return a.getData("downloadRecording",e)},e.prototype.getPictureThumbnail=function(e){return new Promise(function(t){return a.get("getPictureThumbnail",e).then(function(e){return a.parseJson(e)}).then(t)})},e.prototype.authenticate=function(){return new Promise(function(e){o.ServicesManager.signInManager.getSkypeToken().then(function(t){var n="skypetoken="+t;return a.postForm("authenticate","skypetokenauth",n).then(e)},function(){})})},e.prototype.logout=function(){return a.get("logout","skypetokenauth/expire")},e.composeStatusUri=function(e,t){return i.Configuration.AMS_HOST_URL+"objects/"+e+"/views/"+t+"/status"},e.prototype.getViewUri=function(e,t){var n=this;return void 0===t&&(t=0),this.getViewStatus(e,t).then(function(t){var i=t.scan&&"malware"===t.scan.status;return!t.view_location||"failed"===t.view_state||i?Promise.reject(new Error("Scan failed")):"ready"!==t.view_state?n.getViewUri(e,500):"expired"===t.content_state?Promise.reject(new Error("Expired")):Promise.resolve(t.view_location)},function(e){return Promise.reject(e)})},e.prototype.getViewStatus=function(e,t,n){var i=this;return void 0===t&&(t=0),void 0===n&&(n=3),0===n?Promise.reject(new Error("View Status failed after retries")):new Promise(function(e){setTimeout(e,t)}).then(function(){return a.getJson("getViewStatus",e).then(function(e){return e.status_location&&!e.view_state?i.getViewStatus(e.status_location,t,n):Promise.resolve(e)}).catch(function(r){return 401===r.status||403===r.status?(n--,i.authenticate().then(function(){return i.getViewStatus(e,t,n)})):Promise.reject(new Error("Unrecoverable view status error"))})})},e}();t.AmsService=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(5);t.getHeaders=function(){var e=new Headers,t=i.Configuration.getClientVersion();return new Promise(function(n){r.ServicesManager.signInManager.getSkypeToken().then(function(r){e.append("Authorization","skype_token "+r),i.Configuration.ECS.version&&e.append("X-MS-Client-Version",t),n(e)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),r=n(183),o=function(){function e(){var e=this;this._agents={},this.addAgentToContacts=function(e,t){var n="relationship/"+t+"/"+e;return r.put("addAgentToContacts",n)},this.getAgentDetails=function(t){if(e._agents[t])return Promise.resolve({agentDescriptions:[e._agents[t]]});var n="agents?agentId="+t;return r.get("getAgentDetails",n).then(function(t){return t&&t.agentDescriptions&&t.agentDescriptions.forEach(function(t){e._agents[t.agentId]=t;var n=i.ServicesManager.persons.getPerson("28:"+t.agentId);n.displayName=t.displayName,n.avatarData=t.userTileSmallUrl||t.userTileStaticUrl||""}),t})},this.searchAgents=function(t){var n="agents?q="+t;return r.get("searchAgents",n).then(function(t){return t&&t.agentDescriptions&&t.agentDescriptions.forEach(function(t){e._agents[t.agentId]=t;var n=i.ServicesManager.persons.getPerson("28:"+t.agentId);n.displayName=t.displayName,n.avatarData=t.userTileSmallUrl||t.userTileStaticUrl||""}),t})}}return Object.defineProperty(e.prototype,"agents",{get:function(){return this._agents},enumerable:!0,configurable:!0}),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o=n(184),s={retryCount:3,timeout:12e4,policy:""};t.get=function(e,t){return o.getHeaders().then(function(n){var o={method:"GET"};return o.headers=n,function(e,t,n){return r.default("aps-"+e,s,i.Configuration.APS_HOST_URL+t,n).then(function(e){return e.json()})}(e,t,o)})},t.put=function(e,t,n){return void 0===n&&(n=""),o.putHeaders().then(function(o){var a={method:"PUT"};return a.body=n,a.headers=o,function(e,t,n){return r.default("aps-"+e,s,i.Configuration.APS_HOST_URL+t,n)}(e,t,a)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5);t.getHeaders=function(){var e=new Headers;return new Promise(function(t){i.ServicesManager.signInManager.getSkypeToken().then(function(n){e.append("X-Skypetoken",n),e.append("Pragma","no-cache"),e.append("Cache-Control","no-cache, no-store, must-revalidate"),t(e)},function(){})})},t.putHeaders=function(){var e=new Headers;return new Promise(function(t){i.ServicesManager.signInManager.getSkypeToken().then(function(n){e.append("X-Skypetoken",n),t(e)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),r=n(186),o=function(){function e(){var e=this;this.resetAuth=function(){e.authenticationPromise=null},this.authenticate()}return e.prototype.authenticate=function(){var e=this;if(this.authenticationPromise)return this.authenticationPromise;return this.authenticationPromise=r.postRaw("cookie","/beta/imageauth/cookie"),this.authenticationPromise.then(function(){setTimeout(function(){e.authenticationPromise=null},54e4)}),this.authenticationPromise},e.prototype.fetchAvatars=function(e,t){var n=this,i="/beta/users/"+e+"/profilepicturev2",o={displayname:t,voidCache:"true"},s=r.addGetParamsToUrl(i,o);return this.authenticate().then(function(){return n.fetchSingleAvatar(s)},this.resetAuth)},e.prototype.fetchSingleAvatar=function(e){return r.getRaw("avatars",e,{cache:"default"}).then(function(e){return e.url},this.resetAuth)},e.prototype.fetchMergedAvatars=function(e){var t=e.filter(function(e){return e.userId!==i.ServicesManager.mePerson.mri});t.length>4&&(t=t.slice(0,3));var n="/beta/users/mergedProfilePicturev2?usersInfo="+encodeURIComponent(JSON.stringify(t))+"&size=HR64x64&voidCache=true";return this.authenticate().then(function(){return r.getRaw("mergedAvatars",n).then(function(e){return e.url})},this.resetAuth)},e}();t.default=o},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(10),s=n(187),a={retryCount:3,timeout:12e4,policy:""},c=function(e,t,n){return 0!==t.toString().indexOf("http")&&(t=r.Configuration.AVATAR_SERVICE_URL+t),o.default("avatar-"+e,a,t,n)};t.get=function(e,n){return t.getRaw(e,n).then(function(e){return e.json()})},t.getRaw=function(e,t,n){return void 0===n&&(n={}),s.getHeaders().then(function(r){var o={method:"GET"};return o.headers=r,o.cache="no-cache",o.credentials="include",c(e,t,i({},o,n||{}))})},t.post=function(e,n){return t.postRaw(e,n).then(function(e){return e.json()})},t.postRaw=function(e,t){var n="cookie"===e;return s.getHeaders(n).then(function(n){var i={method:"POST"};return i.headers=n,i.cache="no-cache",i.credentials="include",c(e,t,i)})};var u=n(44);t.addGetParamsToUrl=u.addGetParamsToUrl},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(1),o=n(16),s=n(5);t.getHeaders=function(e){return void 0===e&&(e=!1),i.default.get.backend===o.MessagingBackend.TEAMS?s.ServicesManager.signInManager.aad().then(function(t){var n=new Headers;return e&&n.append("authorization",t),n.append("x-ms-client-type","web"),n.append("x-ms-user-type","user"),n}):new Promise(function(e){s.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=new Headers;n.append("x-skypetoken",t),n.append("x-skype-client",r.Configuration.getClientVersion()),e(n)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(189);t.TeamsCapabilitiesService=i.TeamsCapabilitiesService},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){var n=e.call(this)||this;return n.userPolicyService=t,n}return r(t,e),t.prototype.getCommonCapabilities=function(t){return Promise.all([e.prototype.getCommonCapabilities.call(this,t),this.userPolicyService.getMessagingPolicy(),this.userPolicyService.getCallingPolicy()]).then(function(e){var t=e[0],n=e[1],i=e[2];return{allowEditMessage:t.allowEditMessage&&n.allowUserEditMessage,allowDeleteMessage:t.allowDeleteMessage&&n.allowUserDeleteMessage,allowChat:t.allowChat&&n.allowUserChat,allowUploadFiles:t.allowUploadFiles,allowSendEmoticons:t.allowSendEmoticons,allowCalling:t.allowCalling&&(i.allowPrivateCalling||i.allowGroupCalling)}})},t.prototype.getCapabilitiesForConversation=function(t){return Promise.all([e.prototype.getCapabilitiesForConversation.call(this,t),this.userPolicyService.getCallingPolicy()]).then(function(e){var t=e[0],n=e[1];return o({},t,{allowCalling:t.allowCalling&&n.allowPrivateCalling})})},t}(n(130).SkypeCapabilitiesService);t.TeamsCapabilitiesService=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),a=n(11),c=n(8),u=n(22),l=n(116),p=n(30),d=n(5),f=n(10),h=n(191),g=n(82),m=n(131),v=n(19),y=n(42),_=[v.ThreadType.Chat,v.ThreadType.SfbInterop,v.ThreadType.SfbInteropChat];function b(e){var t={conversations:[],users:[],_metadata:{},hasMoreConversations:!!e.continuationToken},n={};return e.items.forEach(function(e){t.conversations.push(T(e)),e.members.forEach(function(e){return n[e.mri]=e})}),Object.keys(n).map(function(e){return t.users.push(n[e])}),t}function T(e){var t=e.consumptionHorizon,n=t?t.timeStamp+";"+t.originalArrivalTime+";"+t.clientMessageId:void 0,i=e.lastMessage;return{id:e.id,lastMessage:{id:i.id,clientmessageid:i.clientMessageId,from:i.from,messagetype:i.messageType,originalarrivaltime:i.originalArrivalTime,content:i.content,composetime:i.composeTime,version:i.version+"",messageid:i.id},isOneOnOne:e.isOneOnOne,properties:{consumptionhorizon:n,picture:"",lastimreceivedtime:""},threadProperties:{topic:e.title,picture:"",historydisclosed:!0,threadType:S(e)},version:e.version,members:e.members.map(function(e){return{id:e.mri,role:e.role,name:e.displayName}})}}function S(e){return 1===e.interopType||-1!==e.id.indexOf("@sfb.unq.gbl.spaces")?v.ThreadType.SfbInterop:v.ThreadType.Chat}var w=function(e){function t(t){var n=e.call(this)||this;return n.chatServiceAggregatorClient=t,n.setContinuationToken=function(e){return e.continuationToken&&(n.csaContinuationToken=e.continuationToken),e},n.fetchMessagesByLink=function(e){if(-1===e.indexOf("startTime")&&(e=u.UrlHelper.appendQueryParam(e,"startTime",0)),0!==e.indexOf(s.Configuration.CHAT_HOST_URL))try{var t=new URL(e),n=new URL(s.Configuration.CHAT_HOST_URL);t.hostname=n.hostname,e=t.toString()}catch(e){}return g.getPolling().authorization.then(function(){return y.getWithDomain("fetchMessagesByLink",e,{},!0).then(function(e){return y.parseJson(e)})},console.warn)},n}return r(t,e),t.prototype.fetchRecentConversationsV2=function(e){if(this.chatServiceAggregatorClient)return this.chatServiceAggregatorClient.getUserChats(e,this.csaContinuationToken).then(this.setContinuationToken).then(b);return Promise.resolve({conversations:[],users:[],_metadata:{},hasMoreConversations:!1})},t.prototype.fetchRecentConversations=function(e,t){var n=this;if(this._prefetchPromise){var i=this._prefetchPromise;return this._prefetchPromise=void 0,i}if(s.Configuration.ECS.isCsaV2Enabled)return this.fetchRecentConversationsV2(t);if(this._fetchRecentsPromise&&this._fetchRecentsPromise.status===a.PromiseStatus.Pending)return this._fetchRecentsPromise.promise;var r=d.ServicesManager.signInManager.aad(p.AadAudience.AggregationApi).then(function(i){return d.ServicesManager.signInManager.onceSignedIn().then(function(){return f.default("teams-recents",{retryCount:1,timeout:12e4,policy:""},"https://chatsvcagg.teams.microsoft.com/api/v1/teams/users/me/chats?isPrefetch=false&enableMembershipSummary=false",{method:"get",headers:{Authorization:i,"x-ms-client-type":"swc","x-ms-user-type":s.Configuration.getUiVersion()}}).then(function(i){return i?i.json&&i.json().then(function(e){var t=[],n=[],i={};return e.forEach(function(e){var r=T(e);t.push(r),e.members.forEach(function(e){!i[e.mri]&&e.displayName&&(i[e.mri]=!0,n.push(e))})}),{conversations:t,users:n,_metadata:{},hasMoreConversations:!1}},function(i){return n.fetchRecentConversationsFallback(e,t)}):n.fetchRecentConversationsFallback(e,t)},function(i){return n.fetchRecentConversationsFallback(e,t)})},function(){n._fetchRecentsPromise.cancel(),n._fetchRecentsPromise=null})});return this._fetchRecentsPromise=new a.CancelablePromise(r),this._fetchRecentsPromise.promise},t.prototype.fetchRecentConversationsFallback=function(e,t){var n=this;if(void 0===e&&(e=1),void 0===t&&(t=100),!this._fetchRecentsPromise||this._fetchRecentsPromise.status!==a.PromiseStatus.Pending){return Promise.resolve({conversations:[],_metadata:{},hasMoreConversations:!1})}var i={view:"supportsExtendedHistory|msnp24Equivalent|supportsMessageProperties",pageSize:t,startTime:e};this.syncState?i.syncState=this.syncState:i.targetType="Passport|Skype|Lync|Thread|Agent|ShortCircuit|PSTN|SmsMms|Flxt|NotificationStream|Highlights|Cast|CortanaBot|ModernBots|InviteFree";var r=y.addGetParamsToUrl("users/ME/conversations",i);return y.get("fetchRecents-teams",r).then(function(e){e.ok?n._fetchRecentsPromise.isCanceled||y.parseJson(e).then(function(e){n.syncState=n.getSyncState(e._metadata.syncState);var t=e.conversations.filter(function(e){return e.threadProperties&&(t=e.threadProperties.threadType,_.some(function(e){return e===t}));var t});n.allConversations=n.allConversations.concat(t),n._fetchRecentsPromise.resolve({conversations:n.allConversations,hasMoreConversations:!!e._metadata.backwardLink})}).catch(function(t){c.default.throwError(112,"fetchRecentConversationsFallback unable to parse response",t),n._fetchRecentsPromise.cancel(e,n.allConversations)}):n._fetchRecentsPromise.cancel(e,n.allConversations)}),this._fetchRecentsPromise=new a.CancelablePromise,this._fetchRecentsPromise.promise},t.prototype.fetchMessages=function(e,t,n){void 0===t&&(t=20),void 0===n&&(n=0);var i={pageSize:t,view:"msnp24Equivalent|supportsMessageProperties",startTime:n},r=y.addGetParamsToUrl("users/ME/conversations/"+e+"/messages",i);return g.getPolling().authorization.then(function(){return y.get("fetchMessages",r).then(function(e){return y.parseJson(e).then(function(e){return e})})})},t.prototype.sendMessage=function(t,n){var i=o({},n,{messagetype:n.messagetype===v.MessagePayloadType.RichText?v.MessagePayloadType.RichTextHtml:n.messagetype});if(h.isInteropEnabled(t)){if(n.messagetype===v.MessagePayloadType.ControlTyping||n.messagetype===v.MessagePayloadType.ControlClearTyping)return Promise.reject("Typing not supported in SFB");i=h.addInteropDataToMessage(t,n)}return e.prototype.sendMessage.call(this,t,i)},t.prototype.editMessage=function(t,n,i,r){return i=i===v.MessagePayloadType.RichText?v.MessagePayloadType.RichTextHtml:i,e.prototype.editMessage.call(this,t,n,i,r)},t.prototype.deleteMessage=function(e,t){var n="users/ME/conversations/"+e+"/messages/"+t,i=y.addGetParamsToUrl(n,{behavior:"softDelete"});return y.del("deleteMessage",i)},t.prototype.addParticipant=function(e,t,n){var i="threads/"+e+"/members",r={members:[{id:t,role:"Admin",shareHistoryTime:-1}]};return y.post("addParticipant",i,{body:JSON.stringify(r)})},t.prototype.setFavoriteConversation=function(e,t){var n=y.addGetParamsToUrl("users/ME/properties",{name:"favorites"});return g.getPolling().authorization.then(function(){return y.put("setFavoriteConversation",n,{body:JSON.stringify({favorites:JSON.stringify(t)})})})},t.prototype.removeFavoriteConversation=function(e,t){return this.setFavoriteConversation(e,t)},t.prototype.createThread=function(e){e.forEach(function(e){return e.role="Admin"});var t={members:e,properties:{chatFilesIndexId:2,threadType:v.ThreadType.Chat}};2===e.length&&(t.properties=o({},t.properties,{fixedRoster:!0,uniquerosterthread:!0}));var n={headers:{"Content-Type":"application/json",Accept:"application/json, text/javascript"},body:JSON.stringify(t)};return y.post("thread","threads",n)},t.prototype.setBlockedConversation=function(e,t){return Promise.resolve(null)},t.prototype.subscribeContactPresence=function(e){return s.Configuration.ECS.contactPresenceEnabled?(-1===e.indexOf("8:")&&(e="8:"+e),d.ServicesManager.presenceService.subscribe(e,function(t){var n=d.ServicesManager.persons.getPerson(e);t.presence&&(n.presenceStatus=l.getStatusFromAvailability(t.presence.availability))}),Promise.resolve()):Promise.resolve()},t}(m.ConversationConsumerWebApi);t.ConversationTeamsWebApi=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(192))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(19);t.isInteropEnabled=function(e){return-1!==e.indexOf("@sfb.unq.gbl.spaces")},t.addInteropDataToMessage=function(e,t){try{var n=i.swc.services.conversations.get(e),c=s(n).email,u=a(n).mri;return t={clientmessageid:t.clientmessageid,content:t.content,contenttype:t.contenttype,messagetype:r.MessagePayloadType.Text,amsreferences:t.amsreferences||[],imdisplayname:t.imdisplayname,properties:{importance:"",interopType:"receiverSfB",subject:null},fromSipUri:"sip:"+c,toSipUri:"sip:"+o(u)}}catch(e){}return t};var o=function(e){var t=i.swc.services.contactsService.getContactByMri(e);return t?t.email:void 0},s=function(e){return e.selfParticipant.person},a=function(e){var t,n=e.selfParticipant.person.mri;return e.participants.some(function(e){return e.person.mri!==n&&(t=e.person,!0)}),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.enableLongPollTabActivation=function(e){i.swcWindow.addEventListener("focus",function(){e.resume()}),i.swcWindow.addEventListener("blur",function(){e.pause()})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(20),r=n(0),o=function(){function e(){var e=this;this.registrations={},this.setupProxy=function(){r.swc.Eventing.registerEvent("proxy:threadNotifications:register",function(t){return e.register(t.botId,t.conversationId)}),r.swc.Eventing.registerEvent("proxy:threadNotifications:unregister",function(t){return e.unregister(t.botId,t.conversationId)})},i.ProxyConnector.instance.connect("threadNotifications",null,this.setupProxy)}return Object.defineProperty(e,"instance",{get:function(){return e.init()},enumerable:!0,configurable:!0}),e.init=function(){return e._instance||(e._instance=new e)},Object.defineProperty(e.prototype,"empty",{get:function(){return!Object.keys(this.registrations).length},enumerable:!0,configurable:!0}),e.prototype.register=function(e,t){var n=this.registrations[e]=this.registrations[e]||[];t&&-1===n.indexOf(t)&&n.push(t)},e.prototype.unregister=function(e,t){var n=this.registrations[e];if(n)if(t){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}else delete this.registrations[e]},e.prototype.notify=function(e,t,n){var i=this.registrations[e];!i||i.length&&-1===i.indexOf(t)||r.swc.Eventing.triggerEvent("proxy:threadNotifications:notify",{botId:e,conversationId:t,message:n})},e}();t.ThreadNotifications=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=null,o=1;function s(){i&&clearTimeout(i)}t.execute=function(e){s(),null===r&&(r=1e3),i=setTimeout(e,r+.5*Math.random()*r),r<12e4&&(r*=++o)},t.stop=function(){s()},t.reset=function(){s(),r=null,o=1}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s,a,c,u=n(1),l=n(11),p=n(12),d=n(48),f=n(5),h=n(197),g=n(42);!function(e){e.ConversationProperties="/v1/users/ME/conversations/ALL/properties",e.ConversationMessages="/v1/users/ME/conversations/ALL/messages",e.Threads="/v1/threads/ALL"}(s||(s={})),function(e){e.Agent="Agent",e.Presence="Presence2015",e.MessageProperties="MessageProperties",e.CustomUserProperties="CustomUserProperties",e.NotificationStream="NotificationStream"}(a||(a={})),function(e){e.Poll="HttpLongPoll"}(c||(c={}));var m={baseUrl:"",isActiveUrl:"",longPollUrl:"",clientInfo:"",cnsEnabled:!1},v=function(){return o({},m,{baseUrl:u.Configuration.CHAT_HOST_URL.replace(/\/v\d\/?$/,""),clientInfo:u.Configuration.getChatClientInfo(),cnsEnabled:!u.Configuration.ECS.cnsPollingDisabled})};t.getTeamsPolling=function(){return v().cnsEnabled?new b:new h.PollingTeams};var y,_=!1,b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.currentAttempt=0,t._startPollingSequence=function(e){return Promise.resolve()},t.reset=function(){return t.stop(),t.start(),Promise.resolve()},t.setupPolling=function(e){return m.isActiveUrl=e.isActiveUrl,m.longPollUrl=e.subscriptions.pop().longPollUrl,v().longPollUrl},t.createEndpoint=function(){var e={startingTimeSpan:0,endpointFeatures:[a.Agent,a.MessageProperties].join(","),subscriptions:[{channelType:c.Poll,interestedResources:[s.ConversationMessages,s.ConversationProperties,s.Threads]}]},n=new Headers,i={headers:n,body:JSON.stringify(e)},r=f.ServicesManager.signInManager.getSkypeToken().then(function(e){n.set("authentication","skypetoken="+e),n.set("BehaviorOverride","redirectAs404"),n.set("clientinfo",u.Configuration.getChatClientInfo()),n.set("content-type","application/json");var t=p.guid.generate();return g.put("polling-teams",v().baseUrl+"/v2/users/ME/endpoints/"+t,i,!0,!0)}).then(function(e){return e.ok&&e.json?(t._authPromise.resolve(),e.json()):Promise.reject("Failed to create endpoint")});return t._endpointCreationPromise=new l.CancelablePromise(r),r},t.poll=function(e){if(t.longPollPromise)return t.longPollPromise;var n=new Headers,i={headers:n};return t.longPollPromise=new l.CancelablePromise(f.ServicesManager.signInManager.getSkypeToken().then(function(t){return n.set("authentication","skypetoken="+t),n.set("BehaviorOverride","redirectAs404"),n.set("clientinfo",v().clientInfo),n.set("content-type","application/json"),y=void 0,g.get("polling-teams",e,i,!0)}).then(function(e){t.longPollPromise.isCanceled||(t.longPollPromise=void 0,e.ok&&e.json&&e.json().then(function(e){return e.eventMessages&&t.dispatch(e.eventMessages),y=e.next,_?Promise.reject("[PollingTeamsCns.poll] Polling Paused, stopping"):e.next?t.poll(e.next):Promise.reject("[PollingTeamsCns.poll] No next link returned, reseting")}))}).catch(function(){return t.longPollPromise=void 0})),t.longPollPromise},t.dispatch=function(e){t.handlePollData({eventMessages:e})},t}return r(t,e),t.prototype.pause=function(){_=!0},t.prototype.resume=function(){_&&y&&(_=!1,this.poll(y))},t.prototype.start=function(){var e=this;if(!this.isPolling){this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=void 0);var t=this.createEndpoint().then(this.setupPolling).then(this.poll).then(function(){e.currentAttempt=0}).catch(function(t){var n=1e3*Math.exp(++e.currentAttempt);e.retryTimeout=setTimeout(e.reset,n)});this._pollingPromise=new l.CancelablePromise(t),d.get().subscribe("isOnline",function(t){t?e.reset():e.stop()})}},t.prototype.stop=function(){try{this._pollingPromise.cancel(),this.longPollPromise.cancel()}catch(e){}},Object.defineProperty(t.prototype,"isPolling",{get:function(){return!!this.longPollPromise},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"authorization",{get:function(){return this._authPromise.promise},enumerable:!0,configurable:!0}),t}(h.PollingTeams);t.PollingTeamsCns=b},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(8),a=n(116),c=n(198),u=n(132),l=n(28),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setEndpointPresence=function(){if(o.swc.services.signInManager.isAadSupported())try{var e=o.swc.services.mePerson.mri;o.swc.services.presenceService.subscribe(e,t.handleNotifications),o.swc.services.presenceService.startPolling()}catch(e){s.default.throwError(103501,"Presence init failed.")}return Promise.resolve()},t.handleNotifications=function(e){e.etagMatch||("Self"===e.presence.sourceNetwork&&e.presence.deviceType===a.DeviceType.Desktop?o.swc.services.notificationsManager.disableNotifications():o.swc.services.notificationsManager.enableNotifications())},t.onEndpointCreation=function(e){0===o.swc.services.signInManager.currentUserName.indexOf("teamsvisitor:")||(t._setEndpointProperty(u.SET_ENDPOINT_PROPERTY,!0),t.setEndpointPresence())},t.filterOutUnsupportedEvents=function(e){var n=!!e.resource,i=e.resource,r=n&&"ThreadActivity/MemberConsumptionHorizonUpdate"===i.messagetype,o=l.getConversationIdFromUrl(e.resourceLink),s=n&&o===l.TEAMS_NOTIFICATION_CHANNEL_ID,a=n&&l.isThread(i),u=!a&&n&&i.threadtype,p=!a&&n&&i.properties&&i.properties.consumptionHorizonBookmark;return!(r||s||a)&&(!(!u&&!p||a)||(c.reportEnterprisePollFormatViolation(e),(!n||!l.isThreadExtended(i))&&(t.validateAndDispatch(e),!1)))},t.ongoingValidations={},t.validateAndDispatch=function(e){var n=l.getConversationIdFromUrl(e.resourceLink);t.ongoingValidations[n]||(t.ongoingValidations[n]=o.swc.services.webApi.fetchConversation(n)),t.ongoingValidations[n].then(function(n){!l.isThreadExtended(n)&&n.id&&(o.swc.services.conversations.get(n.id).update(n),t._handlePollData({eventMessages:[e]}))})},t.handlePollData=function(e){e.eventMessages&&(e.eventMessages=e.eventMessages.filter(t.filterOutUnsupportedEvents)),t._handlePollData(e)},t}return r(t,e),t.prototype.start=function(){},t.prototype._getInterestedResources=function(){return["/v1/users/ME/conversations/ALL/properties","/v1/users/ME/conversations/ALL/messages","/v1/threads/ALL","/v1/users/ME/contacts/ALL"]},t}(u.Polling);t.PollingTeams=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(28),o=n(23);function s(e,t){var n=t.split("."),i=e;return!1===n.some(function(e){return!i[e]||(i=i[e],!1)})?i:void 0}t.reportEnterprisePollFormatViolation=function(e){try{var t=r.getConversationIdFromUrl(e.resourceLink),n=(c=e,["resource.threadtype","resource.threadType","resource.threadProperties.threadtype","resource.threadProperties.threadType","resource.properties.threadtype","resource.properties.threadType","resource.type"].some(function(e){return!!s(c,e)&&(u=e,!0)}),u),a=s(e,n);i.swc.Telemetry.sendEvent.pollingFormatViolation(t,n,a,e.resourceType,e.resource&&e.resource.messagetype||o.NA,e.resource&&e.resource.type||o.NA)}catch(e){}var c,u}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(30),s=n(133),a="teams-csa",c=function(){function e(e,t,n){void 0===n&&(n={}),this.customHeaders=n,this.client=new s.JsonClient(a,e),this.createAuthenticationHandler(t),this.client.setAuthentication(this.authenticationHandler)}return e.prototype.createAuthenticationHandler=function(e){var t=this;this.authenticationHandler=function(n){return void 0===n&&(n={}),n.headers=n.headers||{},e(o.AadAudience.AggregationApi).then(function(e){var o=i({Authorization:e,"x-ms-client-type":"swc","x-ms-client-version":r.Configuration.getClientVersion()},t.customHeaders);return Object.assign(n.headers,o),n})}},e.prototype.getUserChats=function(e,t){void 0===e&&(e=20);var n={version:"v2",pageSize:e,continuationToken:t};return this.client.get("/api/:version/teams/users/me/chats",n)},e}();t.ChatServiceAggregatorClient=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(44);t.buildUriFromTemplate=function(e,t,n){n=Object.assign({},n);var r=t.split("/");return r.forEach(function(e,t){var i=e.substr(1);(function(e){return 0===e.indexOf(":")})(e)&&n[i]&&(r[t]=n[i].toString(),delete n[i])}),t=r.join("/"),e.lastIndexOf("/")===e.length-1&&(e=e.substr(0,e.length-1)),0!==t.indexOf("/")&&(t="/"+t),i.addGetParamsToUrl(""+e+t,n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(30),o=n(133),s="teams-middletier",a=function(){function e(e,t){this.client=new o.JsonClient(s,e),this.createAuthenticationHandler(t),this.client.setAuthentication(this.authenticationHandler)}return e.prototype.createAuthenticationHandler=function(e){this.authenticationHandler=function(t){return void 0===t&&(t={}),t.headers=t.headers||{},e(r.AadAudience.SpacesApi).then(function(e){0!==e.toLowerCase().indexOf("bearer")&&(e="Bearer "+e);var n={Authorization:e,"x-ms-client-type":"swc","x-ms-client-version":i.Configuration.getClientVersion()};return Object.assign(t.headers,n),t})}},e.prototype.getUsers=function(e){return this.client.post("/:version/users/fetch",{version:"v2",isMailAddress:!1,canBeSmtpAddress:!1,enableGuest:!0,skypeTeamsInfo:!0},e).then(function(e){return e.value})},e}();t.TeamsMiddleTierClient=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(21),o=n(11),s=n(5),a=n(134),c=function(){function e(){var e=this;this._contactsByEmail=[],this._haveAllContactsByEmail=!1,this.fetchContactsByMail=function(t,n,i){void 0===t&&(t=100),void 0===n&&(n=10);var r=0;if(e._fetchContactsByMailPromise)return i&&i(e._contactsByEmail),e._fetchContactsByMailPromise.promise;var a=new Promise(function(o,a){var c=function(){if(!e._fetchContactsByMailPromise||!e._fetchContactsByMailPromise.isCanceled){s.ServicesManager.microsoftGraphService.fetchCommonEmails(t,r*t).then(function(s){if(!e._fetchContactsByMailPromise.isCanceled)if(s&&s.value){if(0===s.value.length)return void(e._haveAllContactsByEmail=!0);var u=[];s.value.forEach(function(e){e.scoredEmailAddresses.forEach(function(e){u.push(e.address)})}),e.getContactsByEmail(u).then(function(s){if(!e._fetchContactsByMailPromise.isCanceled){if(!s.ok){var l={code:s.status,message:s.statusText};return a(l),void(e._fetchContactsByMailPromise=null)}s.json().then(function(l){return function(l){if(!l)return e._haveAllContactsByEmail=!0,void(e._contactsByEmail?o(e._contactsByEmail):(a({status:s.status,statusText:s.statusText}),e._fetchContactsByMailPromise=null));i&&i(l.contacts),e._contactsByEmail=e._contactsByEmail.concat(l.contacts),e._haveAllContactsByEmail=e._haveAllContactsByEmail||e._contactsByEmail.length>=n||u.length<t,e._haveAllContactsByEmail?o(e._contactsByEmail):(r++,c())}(l)},function(t){a(t),e._fetchContactsByMailPromise=null})}}).catch(function(e){a(e)})}else e._contactsByEmail?o(e._contactsByEmail):(a({status:0,statusText:"No emails to get skypeIds"}),e._fetchContactsByMailPromise=null)}).catch(function(e){a(e)})}};s.ServicesManager.signInManager.onceSignedIn().then(c.bind(e))});return e._fetchContactsByMailPromise=new o.CancelablePromise(a),e._fetchContactsByMailPromise.promise},s.ServicesManager.signInManager.subscribe("state",function(t){t===r.SigninState.SignedOut&&e.dispose()})}return Object.defineProperty(e.prototype,"fetchContactsByMailPromise",{get:function(){return this._fetchContactsByMailPromise&&this._fetchContactsByMailPromise.promise},enumerable:!0,configurable:!0}),e.prototype.getContactsByEmail=function(e){var t={Emails:e};return a.post("fetchContactsByEmail","scdemaillookup",JSON.stringify(t),i.Configuration.CONTACTS_SCD_HOST_URL)},e.prototype.dispose=function(){this._contactsByEmail=[],this._fetchContactsByMailPromise&&this._fetchContactsByMailPromise.status===o.PromiseStatus.Pending&&this._fetchContactsByMailPromise.cancel(),this._fetchContactsByMailPromise=null},e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),r=n(1);t.getHeaders=function(){return new Promise(function(e){i.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=new Headers;n.append("X-Skypetoken",t),n.append("X-Skype-Caller",r.Configuration.getUiVersion()),e(n)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(11),r=n(8),o=n(5),s=function(){function e(){var e=this;this._rawContacts=[],this._rawContactIds={},this.fetchMyContacts=function(t,n){if(e._fetchContactsPromise)return e._fetchContactsPromise.promise;var s=o.ServicesManager.webApi.fetchRecentConversations().then(function(t){e._rawContacts=[];var n=t;if(!n)return r.default.throwError(11010,"Unable to fetch contacts"),{};if(!n.users)return{contacts:[],count:0,scope:"",duration:0};var i=o.ServicesManager.mePerson;return n.users.forEach(function(t){if(t.mri===i.mri)return i.displayName=t.displayName,void(i.email=t.userPrincipalName);e._rawContacts.push({id:t.mri,person_id:t.mri,type:t.type,display_name:t.displayName,authorized:!0,blocked:!1,avatar_url:"",mood:"",name:{first:t.givenName,surname:t.surname,nickname:"",company:""},mri:t.mri,email:t.userPrincipalName,objectId:t.objectId}),e._rawContactIds[t.mri]=!0}),{contacts:e._rawContacts,count:n.users.length,scope:"",duration:0}},function(t){e._fetchContactsPromise=null,r.default.throwError(11010,"Unable to fetch contacts",t)});return e._fetchContactsPromise=new i.CancelablePromise(s),e._fetchContactsPromise.promise},this.getContactsUpdate=function(e){return Promise.resolve()},this.getContact=function(t,n){var i=e._rawContacts.filter(function(e){return e.mri.indexOf(n)>-1});return i.length?Promise.resolve(i[0]):e.fetchContactById(n)},this.addContact=function(t,n,i){return i&&!e._rawContactIds[i.mri]&&e._rawContacts.push(i),Promise.resolve()},this.blockContact=function(e,t,n){return Promise.resolve()},this.unblockContact=function(e){return Promise.resolve()},this.addFavoriteContact=function(e){return Promise.resolve()},this.removeFavoriteContact=function(e){return Promise.resolve()},this.dispose=function(){},this.getContactByObjectId=function(t){var n;return e._rawContacts.some(function(e){return t===e.objectId&&(n=e,!0)}),n?Promise.resolve(n):e.fetchContactById(t)}}return e.prototype.getContactByMri=function(e){var t=this._rawContacts.filter(function(t){return t.mri===e});return t.length?t[0]:void 0},Object.defineProperty(e.prototype,"contactsList",{get:function(){return this._rawContacts},enumerable:!0,configurable:!0}),e.prototype.getBlockedList=function(){return Promise.resolve([])},e.prototype.getContactByMriIfPresent=function(e){return""},e.prototype.fetchContactById=function(t){var n=this;return o.ServicesManager.stratusService.fetchShortProfile([t]).then(function(t){return e.createContactFromShortProfile(t[0])}).then(function(e){return n.addContact(e.mri,"",e),e})},e.createContactFromShortProfile=function(e){return{id:e.mri,person_id:e.mri,type:e.type,display_name:e.displayName,authorized:!0,blocked:!1,avatar_url:"",mood:"",mri:e.mri,email:e.email,objectId:e.objectId}},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.reportContactsLoadedQosError=function(e,t){i.swc.Telemetry.sendEvent.contactsLoadedQos(e,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.items=[],this.key=e}return e.prototype.reset=function(){this.items=[]},e.prototype.add=function(e,t){var n=this;e&&(e.forEach(function(e){n.items=n.items.filter(function(t){return t[n.key]!==e[n.key]})}),t&&(e=e.filter(function(e){return!e.deleted})),this.items=this.items.concat(e))},e.prototype.getItems=function(){return this.items},e.prototype.getItemsByType=function(e){return this.items.filter(function(t){return 0===t.person_id.indexOf(e+":")})},e}(),r=function(){function e(){this.callCount=0,this.contacts=new i("mri"),this.blocklist=new i("mri"),this.groups=new i("id"),this.duration=0,this.firstScope=""}return e.prototype.reset=function(){this.firstScope="",this.contacts.reset(),this.groups.reset(),this.blocklist.reset()},e.prototype.update=function(e){this.callCount++,e&&(this.callCount>1&&"full"===e.scope&&this.reset(),e.scope&&!this.firstScope&&(this.firstScope=e.scope),this.contacts.add(e.contacts,!0),this.groups.add(e.groups,!1),this.blocklist.add(e.blocklist,!0))},e.prototype.filter=function(e){return this.contacts.getItemsByType(e)},e}();t.ContactsInfo=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=n(21),a=n(13),c=n(24),u=n(0),l=n(38),p=n(32),d=n(82),f=n(5),h=n(117),g=n(208),m=n(135),v="8:echo123",y=function(e){function t(){var t=e.call(this)||this;return t._contactsData={contacts:[],blocked:[],groups:[]},t._fetchContactsResolved=!1,t._updateContact=function(e,t){var n=f.ServicesManager.persons.getPerson(e.skypeid,!1);e.blocked=n.isBlocked=t.blocked,e.favorite=n.isFavorite=t.favorite;var i=t.profile&&t.profile.avatar_url?t.profile.avatar_url:null;i&&i!==e.avatar&&(e.avatar=n.avatarData=i),t.display_name&&t.display_name!==e.name&&(e.name=n.displayName=t.display_name)},t._addNewContact=function(e){var n=t._mapContact(e);t._contactsData.contacts.push(n),t._createPerson(n),u.swc.Eventing.triggerEvent("contactAdded",n)},t._handleContactUpdate=function(e){e.contacts&&e.contacts.length&&e.contacts.forEach(function(e){for(var n=!1,i=0;i<t._contactsData.contacts.length;i++){var r=t._contactsData.contacts[i];if(r.skypeid===e.mri){t._updateContact(r,e),n=!0;break}}n||t._addNewContact(e)})},t._onContactListChangedNotification=function(){t._contactsService.getContactsUpdate(m.reasons.NOTIFICATION).then(t._handleContactUpdate)},t._mapContact=function(e){return{skypeid:e.mri,name:e.display_name,favorite:e.favorite,blocked:e.blocked,normalized_name:p.normalizeString(e.display_name),avatar:e.profile&&e.profile.avatar_url?e.profile.avatar_url:"",type:l.default.getContactType({mri:e.mri})}},t.fetchMyContacts=function(e){var n=Date.now();return t._fetchContactsResolved?new Promise(function(e){e(t._contactsData)}):t._contactsService.fetchMyContacts(d.PAGE_SIZE.default).then(function(e){if(!t._fetchContactsResolved&&e){var i=[];e&&e.contacts&&(i=e.contacts.filter(function(e){return!(e.mri.indexOf("4:")>-1)&&e.mri!==v})),t._contactsData.groups=e.groups,t._contactsData.contacts=i.map(t._mapContact),t._createPersonForAllContacts(t._contactsData.contacts),e.blocklist&&(t._contactsData.blocked=e.blocklist.map(function(e){return{skypeid:e.mri}})),t._fetchContactsResolved=!0,t._sendTelemetryData(t._contactsData,n)}return t._contactsData},function(e){})},t.isPersonContact=function(e){return new Promise(function(n,i){t._isPersonContactPromiseRejectCallback=i,u.swc.services.signInManager.getSkypeToken().then(function(i){var r=u.swc.services.signInManager.currentUserName;if(u.swc.services.signInManager.userIdentityType===c.IdentityType.GUEST)return n(!0);t._contactsService.getContact(r,e).then(function(i){t._isPersonContactPromiseRejectCallback=null,n(t.isContact(i,e))},function(e){t._isPersonContactPromiseRejectCallback(!1),t._isPersonContactPromiseRejectCallback=null})},t._isPersonContactPromiseRejectCallback.bind(t,{source:"onSigninFailed"}))})},t.addContact=function(e,n){return t._contactsService.addContact(e,n)},t.blockContact=function(e,n,i){return t._contactsService.blockContact(e,n,i)},t.unblockContact=function(e){return t._contactsService.unblockContact(e)},t.addFavoriteContact=function(e){return t._contactsService.addFavoriteContact(e)},t.removeFavoriteContact=function(e){return t._contactsService.removeFavoriteContact(e)},t.getBlockedlist=function(){return t._contactsService.getBlockedList()},t.signinStateChangedHandler=function(){u.swc.services.signInManager.state===s.SigninState.SignedOut&&(t._contactsService.dispose(),t._isPersonContactPromiseRejectCallback&&t._isPersonContactPromiseRejectCallback({source:"signout"}),t._contactsData={blocked:[],groups:[],contacts:[]},t._fetchContactsResolved=!1)},t.isContact=function(e,t){return!!e&&(!!e&&e.mri===t&&e.authorized)},t._sendTelemetryData=function(e,t){var n=e.contacts?e.contacts:[];u.swc.Telemetry.sendEvent.contactsLoaded(n.length,n.filter(function(e){return 4===e.type}).length,n.filter(function(e){return 8===e.type}).length,n.filter(function(e){return 28===e.type}).length,Date.now()-t)},t._contactsService=u.swc.services.contactsService,t._outlookContactsService=u.swc.services.outlookContactsService,u.swc.services.signInManager.subscribe("state",t.signinStateChangedHandler),t._initTrouter(),t}return r(t,e),t.prototype._initTrouter=function(){var e=new h.LocalCallingLogger,t=f.ServicesManager.signInManager.getSkypeToken.bind(f.ServicesManager.signInManager),n={onContactListChangedNotification:this._onContactListChangedNotification};f.ServicesManager.trouterService.init(e,t,o.default.get.sessionId),f.ServicesManager.trouterService.registerMessageHandler(this._handleTrouterMessage(n))},t.prototype._getEventId=function(e){return e.eventId?e.eventId:e.body&&e.body.eventId},t.prototype._handleTrouterMessage=function(e){var t=this;return{handleMessage:function(e){switch(t._getEventId(e)){case g.trouterEvents.CONTACTLIST_CHANGE:return t._onContactListChangedNotification(),g.HANDLER_RESULT_STATUS_OK}return g.HANDLER_RESULT_STATUS_UNHANDLED}}},t.prototype._createPerson=function(e){var t=f.ServicesManager.persons.getPerson(e.skypeid,!1);return t.displayName=e.name,t.avatarData=e.avatar,t.isBlocked=e.blocked,t.isFavorite=e.favorite,t},t.prototype._createPersonForAllContacts=function(e){e.forEach(this._createPerson)},t.prototype.dispose=function(){this._contactsService.dispose(),this._isPersonContactPromiseRejectCallback&&this._isPersonContactPromiseRejectCallback({source:"onDispose"}),u.swc.services.signInManager.unsubscribe("state",this.signinStateChangedHandler)},t}(a.default);t.SkypeContactsManager=y,t.default=y},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.OK=200]="OK",e[e.created=201]="created",e[e.badRequest=400]="badRequest",e[e.unauthorized=401]="unauthorized",e[e.notFound=404]="notFound",e[e.forbidden=403]="forbidden",e[e.preconditionFailed=412]="preconditionFailed",e[e.unprocessableEntity=422]="unprocessableEntity",e[e.internalServerError=500]="internalServerError"}(i=t.httpStatusCodes||(t.httpStatusCodes={})),function(e){e[e.CONTACTLIST_CHANGE=6]="CONTACTLIST_CHANGE",e[e.OFFLINE_AUTHREQUEST=14]="OFFLINE_AUTHREQUEST",e[e.INCOMING_SKYPE_NGC_CALL=107]="INCOMING_SKYPE_NGC_CALL",e[e.INCOMING_SKYPE_P2P_CALL=108]="INCOMING_SKYPE_P2P_CALL",e[e.INCOMING_SKYPE_NGC_GVC_CALL=109]="INCOMING_SKYPE_NGC_GVC_CALL",e[e.INCOMING_LYNC_NGC_CALL=105]="INCOMING_LYNC_NGC_CALL",e[e.INCOMING_STOP_RINGER=104]="INCOMING_STOP_RINGER",e[e.INCOMING_SKYPE_NGC_STOP_RINGER=110]="INCOMING_SKYPE_NGC_STOP_RINGER",e[e.INCOMING_SKYPE_NGC_PSTN_CALL=111]="INCOMING_SKYPE_NGC_PSTN_CALL",e[e.USER_SERVICES_CHANGE=601]="USER_SERVICES_CHANGE",e[e.INCOMING_CONTACT_INVITE=801]="INCOMING_CONTACT_INVITE",e[e.OUTGOING_CONTACT_INVITE_ACCEPTED=802]="OUTGOING_CONTACT_INVITE_ACCEPTED",e[e.CONTACT_INVITES_LIST_CHANGE=803]="CONTACT_INVITES_LIST_CHANGE",e[e.USER_PROFILE_CHANGE=20]="USER_PROFILE_CHANGE",e[e.USER_AVATAR_CHANGE=21]="USER_AVATAR_CHANGE"}(t.trouterEvents||(t.trouterEvents={})),t.HANDLER_RESULT_STATUS_OK={isHandled:!0,resultCode:i.OK},t.HANDLER_RESULT_STATUS_UNHANDLED={isHandled:!1}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(11),s=n(0),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._searchAadDirectory=function(e){return t._searchPromise&&t._searchPromise.status===o.PromiseStatus.Pending&&(t._searchPromise.cancel(),t._searchPromise=null),t._searchKey=e,t._searchPromise=new o.CancelablePromise(s.swc.services.teamsGraphService.fetchProfiles(e)),t._searchPromise.promise},t}return r(t,e),t.prototype.searchSkypeDirectory=function(e){var t=function(e){return{nodeProfileData:{avatarUrl:"",city:"",contactType:"",country:"",countryCode:"",language:"",state:"",name:e.displayName,skypeId:e.mri,jobTitle:e.jobTitle,department:e.department,location:e.userLocation},nodeAnnotation:"",nodeConnectionData:{distance:0,mutualFriendCount:0}}},n=function(e){return!!e.mri};return this._searchAadDirectory(e).then(function(e){return{requestId:"",results:e.filter(n).map(t)}})},t}(n(137).default);t.TeamsSearchManager=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(1),o=n(127),s=n(20),a=n(0),c=n(38),u=n(19),l=n(73),p=function(e){return a.swc.services.i18n.fetch(e)},d=function(){function e(){this.isConnected=!1}return e.prototype.registerServices=function(){var e=a.swc.services;e.signInManager&&e.signInManager.isAadSupported()?this.registerEnterpriseProxy(e.presenceService,e.persons,e.mePerson):this.registerConsumerProxy(e.persons)},e.prototype.registerSharedProxy=function(){a.swc.Eventing.registerEvent("proxy:presence:getStatusList",function(){i.default.get.isTeams()?a.swc.Eventing.triggerEvent("proxy:presence:getStatusList:response",[{key:"Online",description:p("presence_status_online"),url:r.Configuration.ECS.domain+"/assets/personas/status/Available.svg"},{key:"BeRightBack",description:p("presence_status_berightback"),url:r.Configuration.ECS.domain+"/assets/personas/status/Away.svg"},{key:"Away",description:p("presence_status_away"),url:r.Configuration.ECS.domain+"/assets/personas/status/Away.svg"},{key:"Busy",description:p("presence_status_busy"),url:r.Configuration.ECS.domain+"/assets/personas/status/Busy.svg"},{key:"DoNotDisturb",description:p("presence_status_donotdisturb"),url:r.Configuration.ECS.domain+"/assets/personas/status/DoNotDisturb.svg"}]):a.swc.Eventing.triggerEvent("proxy:presence:getStatusList:response",[{key:"Online",description:p("presence_status_online"),url:r.Configuration.ECS.domain+"/assets/personas/status/Available.svg"},{key:"Busy",description:p("presence_status_busy"),url:r.Configuration.ECS.domain+"/assets/personas/status/Busy.svg"},{key:"Away",description:p("presence_status_away"),url:r.Configuration.ECS.domain+"/assets/personas/status/Away.svg"},{key:"Offline",description:p("presence_status_offline"),url:r.Configuration.ECS.domain+"/assets/personas/status/Offline.svg"}])})},e.prototype.registerEnterpriseProxy=function(e,t,n){if(e.isEnabled&&!this.isConnected){this.registerSharedProxy(),a.swc.Eventing.registerEvent("proxy:presence:getStatus",function(){e.getMyPresence().catch(function(){return l.Availability.PresenceUnknown}).then(function(e){var t=l.getStatusFromAvailability(e);a.swc.Eventing.triggerEvent("proxy:presence:getStatus:response",t)})}),a.swc.Eventing.registerEvent("proxy:presence:setStatus",function(t){var n=l.getAvailabilityFromStatus(t);n?e.setMyPresence(n).then(function(){a.swc.Eventing.triggerEvent("proxy:presence:setStatus:response",{status:!0})}):a.swc.Eventing.triggerEvent("proxy:presence:setStatus:response",{status:!1})});var i=function(e){a.swc.Eventing.triggerEvent("proxy:presence:announceUserStatus",{userId:c.default.normalizePersonId(e.mri),status:l.getStatusFromAvailability(e.presence.availability)})};a.swc.Eventing.registerEvent("proxy:presence:subscribeToUserStatus",function(r){if(o.ME!==r){var s=t.getPerson(r);s&&e.subscribe(s.mri,i)}else e.subscribe(n.mri,function(e){e.mri=o.ME,i(e)})}),a.swc.Eventing.registerEvent("proxy:presence:unsubscribeFromUserStatus",function(r){o.ME===r&&e.unsubscribe(n.mri,i);var s=t.getPerson(r);s&&e.unsubscribe(s.mri,i)}),a.swc.Eventing.registerEvent("proxy:presence:getUserStatus",function(n){var i=t.getPerson(n);if(i){var r=function(t){a.swc.Eventing.triggerEvent("proxy:presence:getUserStatus:response",{userId:n,status:l.getStatusFromAvailability(t.presence.availability)}),e.unsubscribe(i.mri,r)};e.subscribe(i.mri,r)}}),s.ProxyConnector.instance.connect("presence",{}),this.isConnected=!0}},e.prototype.registerConsumerProxy=function(e){this.isConnected||(this.registerSharedProxy(),a.swc.Eventing.registerEvent("proxy:presence:getStatus",function(){var t=e.getMyStatus()||u.PresenceStatus.Offline;a.swc.Eventing.triggerEvent("proxy:presence:getStatus:response",t)}),a.swc.Eventing.registerEvent("proxy:presence:setStatus",function(t){e.setMyStatus(t).then(function(){return a.swc.Eventing.triggerEvent("proxy:presence:setStatus:response",{status:!0})}).catch(function(){return a.swc.Eventing.triggerEvent("proxy:presence:setStatus:response",{status:!1})})}),a.swc.Eventing.registerEvent("proxy:presence:subscribeToUserStatus",function(t){o.ME!==t?e.subscribeToUserStatus(t,function(e,n){a.swc.Eventing.triggerEvent("proxy:presence:announceUserStatus",{userId:t,status:n})}):e.subscribeToMyStatus(function(e){a.swc.Eventing.triggerEvent("proxy:presence:announceUserStatus",{userId:o.ME,status:e})})}),a.swc.Eventing.registerEvent("proxy:presence:unsubscribeFromUserStatus",function(t){e.unsubscribeFromUserStatus(t)}),a.swc.Eventing.registerEvent("proxy:presence:getUserStatus",function(t){e.getUserStatus(t).then(function(e){a.swc.Eventing.triggerEvent("proxy:presence:getUserStatus:response",{userId:t,status:e})}).catch(function(){a.swc.Eventing.triggerEvent("proxy:presence:getUserStatus:response",{userId:t,status:null})})}),s.ProxyConnector.instance.connect("presence",{}),this.isConnected=!0)},e}();t.PresenceProxyOperator=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(8),o=n(5),s=n(100),a=n(73),c=n(212),u=n(213),l=function(e,t){return void 0===t&&(t=function(){}),o.ServicesManager.signInManager.aad&&s.getConfig().isEnabled?e():t()},p=function(){function e(){}return Object.defineProperty(e,"isEnabled",{get:function(){return l(function(){return!0},function(){return!1})},enumerable:!0,configurable:!0}),e.setMyPresence=function(t,n){if(void 0===n&&(n=null),!a.isForcedAvailabilityAllowed(t))return Promise.reject("Availability can only be one of ("+a.allowedForcedAvailabilities.join(",")+")");if(null!==n&&!a.isActivityCombinationAllowed(t,n))return Promise.reject("Combination of '"+t+"/"+n+"' is not allowed");return l(function(){var i={activity:n,availability:t};return u.put("Presence.setMyPresence","/me/forceAvailability",JSON.stringify(i)).then(function(n){return n.ok?(e.lastStatus=t,Promise.resolve()):(r.default.throwError(103503,"Unable to update presence "+n.status),Promise.reject("Unable to set Presence"))})},function(){return Promise.resolve()})},e.getMyPresence=function(){return l(function(){return e.lastStatus?Promise.resolve(e.lastStatus):new Promise(function(t,n){var i=0,r=setInterval(function(){return i++>5?(clearInterval(r),n("Unable to getPresence info")):e.lastStatus?(clearInterval(r),t(e.lastStatus)):void 0},1e3)})},function(){return Promise.reject("Presence is disabled")})},e.getMeEndpoints=function(){return l(function(){return u.get("Presence.getMeEndpoints","/me/endpoints")},function(){return Promise.resolve([])})},e.pollPresence=function(e){return l(function(){return u.post("Presence.pollPresence","/presence/getpresence",JSON.stringify(e))},function(){return Promise.resolve([])})},e.subscribe=function(t,n){var i=c.PresencePollingService.get(e.pollPresence);i.subscribe(t,n),i.isRunning&&i.forceDelayedPoll()},e.unsubscribe=function(t,n){c.PresencePollingService.get(e.pollPresence).unsubscribe(t,n)},e.subscribeToMyUpdates=function(){if(e.mePersonMri)return Promise.resolve();var t=i.swc.services;return t.signInManager&&t.signInManager.isAadSupported()?t.signInManager.onceSignedIn().then(function(){e.mePersonMri=t.mePerson.mri,e.subscribe(e.mePersonMri,function(t){t.presence&&t.presence.availability&&(e.lastStatus=t.presence.availability)})}):Promise.reject("subscribeToMyUpdates failed")},e.startPolling=function(){l(function(){e.subscribeToMyUpdates().then(function(){c.PresencePollingService.get(e.pollPresence).start()})})},e}();t.UnifiedPresenceService=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(100),r=n(73),o=function(){function e(e){var t=this;this.pollPresence=e,this.subscriptions={},this.subscribe=function(e,n){/^\d+:orgid:/.test(e)&&(t.subscriptions[e]||(t.subscriptions[e]={handlers:[]}),0===t.subscriptions[e].handlers.filter(function(e){return e===n}).length&&t.subscriptions[e].handlers.push(n))},this.unsubscribe=function(e,n){t.subscriptions[e]||(t.subscriptions[e].handlers=t.subscriptions[e].handlers.filter(function(e){return e!==n}))},this.start=function(){t.isRunning||(t.poll(),t.pollInterval=setInterval(function(){return t.poll()},1e3*i.getConfig().pollingInterval))},this.stop=function(){clearInterval(t.pollInterval),t.clearForcedDelayedPoll(),t.pollInterval=void 0},this.getUsers=function(){return Object.keys(t.subscriptions).map(function(e){return{mri:e,etag:t.subscriptions[e].etag||""}})},this.handlePoll=function(e){return e.forEach(function(e){if(e.status>=2e4&&e.status<=29999&&t.subscriptions.hasOwnProperty(e.mri))if(e.etagMatch&&t.subscriptions[e.mri].lastResponse)t.subscriptions[e.mri].handlers.forEach(function(n){return n(t.subscriptions[e.mri].lastResponse)});else if(e.presence)try{var n=t.subscriptions[e.mri].lastResponse&&t.subscriptions[e.mri].lastResponse.presence.availability||r.Availability.Offline;e.presence.availability!==n&&t.subscriptions[e.mri].handlers.forEach(function(t){return t(e)}),t.subscriptions[e.mri].etag=e.etag,t.subscriptions[e.mri].lastResponse=e}catch(e){}}),e},this.poll=function(){var e=t.getUsers();return t.clearForcedDelayedPoll(),e?t.pollPresence(e).then(t.handlePoll):Promise.resolve([])}}return e.get=function(t){return e.instance||(e.instance=new e(t)),e.instance},Object.defineProperty(e.prototype,"isRunning",{get:function(){return!!this.pollInterval},enumerable:!0,configurable:!0}),e.prototype.forceDelayedPoll=function(){var e=this;this.forcedPollTimeout||(this.forcedPollTimeout=setTimeout(function(){e.poll()},1e4))},e.prototype.clearForcedDelayedPoll=function(){this.forcedPollTimeout&&(clearTimeout(this.forcedPollTimeout),this.forcedPollTimeout=void 0)},e}();t.PresencePollingService=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(0),o=n(8),s=n(12),a=n(30),c=n(10),u={baseUrl:"https://presence.teams.microsoft.com/v1"},l={retryCount:3,timeout:12e4,policy:""},p=function(e,t,n){return c.default("presence-"+e,l,u.baseUrl+t,n).then(function(i){if(404===i.status){var r=i.headers.get("location");if(r){var o=/^(https:\/\/[^\/]+\/v1)/g.exec(r)[0];return u.baseUrl=o,c.default("presence-"+e,l,u.baseUrl+t,n)}}return i})},d=function(e){void 0===e&&(e=a.AadAudience.SpacesApi);var t=r.swc.services.signInManager;return t.isAadSupported()&&t.aad?Promise.all([t.aad(e),t.getSkypeToken()]).then(function(e){var t=e[0],n=new Headers;return n.append("Authorization",t),n.append("Accept","application/json"),n.append("x-skype-client",i.Configuration.getClientVersion()),n.append("x-ms-correlation-id",s.guid.generate()),n.append("x-ms-client-type","Web"),n.append("x-ms-client-version",i.Configuration.getClientVersion()),n.append("x-ms-client-user-agent","swc"),n.append("content-type","application/json;charset=UTF-8"),n.append("BehaviorOverride","redirectAs404"),n}):(o.default.throwError(103502,"Unable to get AAD Token"),Promise.reject("Unable to get AAD Token"))};t.post=function(e,t,n){return d().then(function(i){return p(e,t,{method:"POST",cache:"no-cache",headers:i,body:n}).then(function(e){return e.ok?e.json():Promise.reject("Failed")})})},t.put=function(e,t,n){return d().then(function(i){return p(e,t,{method:"PUT",cache:"no-cache",headers:i,body:n})})},t.get=function(e,t){return d().then(function(n){var i={method:"GET"};return i.headers=n,p(e,t,i).then(function(e){return e.ok?e.json():Promise.reject("Failed")})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(215),r=function(){return function(){this.addAgentToContacts=function(e){var t="api/v1/bots/add/"+e;return i.put("addAgentToContacts",t)}}}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o=n(216),s={retryCount:3,timeout:12e4,policy:""},a=function(e,t,n){return r.default("joinAgents-"+e,s,i.Configuration.AGENTS_HOST_URL+t,n)};t.getResponse=function(e,t){return a(e,t)},t.get=function(e,t){var n={method:"GET"};return function(e,t,n){return r.default("joinAgents-"+e,s,i.Configuration.AGENTS_HOST_URL+t,n).then(function(e){return e.json()})}(e,t,n)},t.put=function(e,t,n){return void 0===n&&(n=""),o.putHeaders().then(function(i){var r={method:"PUT"};return r.body=n,r.headers=i,a(e,t,r)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5);t.putHeaders=function(){var e=new Headers;return new Promise(function(t){i.ServicesManager.signInManager.getSkypeToken().then(function(n){e.append("X-Skypetoken",n),t(e)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o=n(3),s=n(29),a={retryCount:3,timeout:12e4,policy:""},c=function(){function e(){}return e.prototype.auth=function(e){void 0===e&&(e="customer");var t={method:"POST",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,lang:"en",greeniddc:"none"})};return r.default("join-auth",a,i.Configuration.WX_HOST_URL,t).then(function(e){return e.json()})},e.prototype.join=function(e,t){void 0===t&&(t="guest"),t=t||"guest",e=s.default.toFullIdentifier(e);var n=i.Configuration.INVITE_HOST_URL_INT+"users/guests/light",c={method:"POST",cache:"no-cache",headers:{"Content-Type":"application/json",Accept:"application","Accept-Language":"en-US,en;"},body:JSON.stringify({name:t,threadId:e,longId:"swc",shortId:"swc",flowId:o.default.get.sessionId})};return r.default("join-join",a,n,c).then(function(e){return e.json()})},e}();t.WX=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this,t,!1,!0)||this;return n._isMePerson=!0,n}return r(t,e),Object.defineProperty(t.prototype,"msaId",{get:function(){return this._msaId},set:function(e){e&&(this._msaId=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"personalFileSite",{get:function(){return this._personalFileSite},set:function(e){e&&(this._personalFileSite=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayName",{get:function(){return this._forcedDisplayName?this._forcedDisplayName:e.prototype.getDisplayName.call(this)},set:function(t){e.prototype.setDisplayName.call(this,t)},enumerable:!0,configurable:!0}),t.prototype.forceDisplayName=function(e){this._forcedDisplayName=e,this.publish("displayName",e)},t}(n(138).default);t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(220),r=function(){function e(){}return e.prototype.fetchCommonEmails=function(e,t){void 0===e&&(e=10),void 0===t&&(t=0);var n="people/?$top="+e+"&$skip="+t+"&$Select=scoredEmailAddresses";return i.get("scoredMails",n).then(function(e){return e})},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o=n(221),s={retryCount:3,timeout:12e4,policy:""},a=function(e,t,n){return r.default("msGraph-"+e,s,i.Configuration.MS_GRAPH_URL+t,n)};t.postWithoutHeaders=function(e,t,n){var i={method:"GET",cache:"no-cache"};return n&&(i.headers=n),a(e,t,i).then(function(e){return e.json()})},t.get=function(e,t){return o.getHeaders().then(function(n){var i={method:"GET"};return i.headers=n,i.cache="no-cache",a(e,t,i).then(function(e){return e.json()})},function(e){})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(31),o=n(44),s=n(12),a=n(81),c=n(5),u={clientID:i.Configuration.MS_APP_CLIENT_ID,graphScopes:["People.Read","openid","profile"]},l=function(){return function(e,t,n){var i=JSON.parse(c.ServicesManager.sessionStorage.getItem(e)),r=Math.round((new Date).getTime()/1e3);if(i){if(i.expiresIn>r)return Promise.resolve(i.token);c.ServicesManager.sessionStorage.removeItem(e)}return new Promise(function(r,o){var s;i&&(s=i.token),n(s).then(function(n){var i={expiresIn:t(n),token:n};c.ServicesManager.sessionStorage.setItem(e,JSON.stringify(i)),r(n)}).catch(o)})}(r.SKYPE_GRAPH_ACCESS_TOKEN_KEY+a.hashCode(c.ServicesManager.signInManager.currentUserName),function(e){return Math.round((new Date).getTime()/1e3)+ +e.expires_in},function(){return new Promise(function(e,t){var n=c.ServicesManager.signInManager.currentUserName,r=s.guid.generate(),a=i.Configuration.MS_AUTHORIZE_URL,l=i.Configuration.MS_APP_REDIRECT_URL_DEMO;window.location.hostname.toLowerCase().indexOf("outlook")>=0&&(l=i.Configuration.MS_APP_REDIRECT_URL_OUTLOOK);var p={response_type:"token",scope:u.graphScopes.join(" "),client_id:u.clientID,username:n,nonce:r,redirect_uri:l},d=o.addGetParamsToUrl(a,p),f=function(n){if(n.data){window.removeEventListener("message",f);var i=n.data;if(-1!==i.indexOf("access_token")){var r={};i.split("&").forEach(function(e){var t=e.split("="),n=t[0],i=t[1];r[n]=decodeURIComponent(i)}),e(r)}t(i)}};window.addEventListener("message",f),window.open(d,"_blank",i.Configuration.LOGIN_POPUP_FEATURES)})})};t.getHeaders=function(){return new Promise(function(e,t){var n=new Headers;l().then(function(t){n.append("Authorization",[t.token_type,t.access_token].join(" ")),e(n)}).catch(function(e){t(e)})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(20),o=n(0),s=n(5),a=n(89),c=36e5,u=function(){function e(){var e=this;this._hostName=i.Configuration.getPlatformName(),this._registered=!1,this._getStorageItem=function(e){var t=o.swc.services.sessionStorage.getItem(e);return t?JSON.parse(t):null},this._setStorageItem=function(e){e&&o.swc.services.sessionStorage.setItem(e.id,JSON.stringify(e))},this._checkIfValid=function(e){return e&&e.validUntil>Date.now()},this._getItem=function(e,t){return{id:e,value:t&&t.length?t:a.NOTIFICATION_DEFAULT,validUntil:Date.now()+c}},this.registerProxy=function(){e._registered||(o.swc.Eventing.registerEvent("proxy:settings:notification:readOption",function(t){t.name&&e.get(t.name).then(function(e){e.pairId=t.id,o.swc.Eventing.triggerEvent("proxy:settings:notification:readOption:response",e)})}),o.swc.Eventing.registerEvent("proxy:settings:notification:setOption",function(t){if(t.o){var n=Date.now();e.set(t.o).then(function(e){o.swc.Telemetry.sendEvent.userSettings(a.NotificationSettingSource.api,t.o.name,t.o.value,Date.now()-n,"200"),e.pairId=t.id,o.swc.Eventing.triggerEvent("proxy:settings:notification:setOption:response",e)},function(e){o.swc.Telemetry.sendEvent.userSettings(a.NotificationSettingSource.api,t.o.name,t.o.value,Date.now()-n,e)})}}),r.ProxyConnector.instance.connect("notificationSettings",{}),e._registered=!0)},this.readSettings=function(t){return new Promise(function(n,i){var r=[],o=[];t.forEach(function(t){var n=e._getStorageItem(t);e._checkIfValid(n)?r.push(n):o.push(t)});var s=e._getOptionsForHost(r);o.length?e.service.fetchUserOptionsBatch(o).then(function(t){var i=[];t&&t.options&&t.options.forEach(function(t){i.push(e._createItem(t.name,t.value))});var r=e._getOptionsForHost(i);n(s.concat(r))},function(e){i(e)}):n(s)})},this.service||(this.service=s.ServicesManager.userOptionsService)}return e.prototype._createItem=function(e,t){var n=this._getItem(e,t);return this._setStorageItem(n),n},e.prototype._resolveHeaderName=function(e){var t="";switch(e){case a.NotificationSettingType.NewMessage:t="notification_settings_header_new_message";break;case a.NotificationSettingType.IncomingCall:t="notification_settings_header_incoming_calls"}return t?o.swc.services.i18n.fetch(t):t},e.prototype._getOptionsForHost=function(e){var t=this,n=[];return e.forEach(function(e){n.push({name:t._resolveHeaderName(e.id),id:e.id,value:t._getValueForHost(e.value)})}),n},e.prototype._getValueForHost=function(e){var t=this,n=null;return e.forEach(function(e){e.host&&e.host.toLowerCase()===t._hostName&&(n=e.value)}),n||(n=a.NotificationAllowedValue.All),n},e.prototype._getOptionForHost=function(e,t){var n=this._createItem(e,t);return{name:e,value:this._getValueForHost(n.value)}},e.prototype.get=function(e){var t=this,n=this._getStorageItem(e);return new Promise(function(i,r){n&&t._checkIfValid(n)?i({name:n.id,value:t._getValueForHost(n.value)}):t.service.fetchUserOption(e).then(function(n){n&&i(t._getOptionForHost(e,n.value))},function(){i(t._getOptionForHost(e,null))})})},e.prototype.set=function(e){var t=this;return new Promise(function(n,i){var r=function(r){var s;if(!r||!r.value||!r.value.length){var c={name:e.name,value:a.NOTIFICATION_DEFAULT};r=c}if(r.value.forEach(function(n){n.host.toLocaleLowerCase()===t._hostName&&(n.value=e.value,s=!0)}),!s&&r.name===e.name){var u={host:t._hostName.toUpperCase(),value:e.value};r.value.push(u)}t.service.setUserOption(r).then(function(){var e=t._getOptionForHost(r.name,r.value);n(e),o.swc.Eventing.triggerEvent("notificationSettingsChange",e)},function(e){i(e)})};t.service.fetchUserOption(e.name).then(r,r)})},e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(224);t.ping=function(){return i.sendRequest("ping","GET","/swc")},t.getExistingCompanies=function(){return i.sendRequest("getCompanies","GET","/companies")},t.createCompany=function(e,t){var n={businessName:e,description:t};return i.sendRequest("createCompany","POST","/swc",{body:JSON.stringify(n)})},t.setCompanyEnabledStatusTo=function(e){return i.sendPutRequest("enableCompany","/swc/status",{body:JSON.stringify({enabled:e})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o=n(225),s={retryCount:3,timeout:12e4,policy:""},a=function(e,t,n){return r.default("oa-"+e,s,i.Configuration.OA_URL+t,n)},c=function(e,t,n){e.append("Content-Type","application/json");var i=Object.assign({},n);return i.method=t,i.headers=e,i.cache="no-cache",i};t.sendRequest=function(e,t,n,i){return o.getHeaders().then(function(r){return a(e,n,c(r,t,i)).then(function(e){return e.json()})})},t.sendPutRequest=function(e,t,n){return o.getHeaders().then(function(i){return a(e,t,c(i,"PUT",n))})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5);t.postHeaders=function(){return new Promise(function(e){i.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=new Headers;n.append("X-Skypetoken",t),e(n)},function(){})})},t.getHeaders=function(){return new Promise(function(e){i.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=new Headers;n.append("X-Skypetoken",t),e(n)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(102),r=n(0),o=n(227),s=n(228),a=n(231),c=n(232),u=function(){function e(){this._isInitialized=!1}return Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"map",{get:function(){return i.shortcutIdMap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emoticonMap",{get:function(){return i.idEmoticonMap},enumerable:!0,configurable:!0}),e.prototype.canRenderConfigItems=function(){return o.default.canRenderConfigItems()},e.prototype.refresh=function(){this.renderLoop&&this.renderLoop.updateEmoticonCanvases()},e.prototype.init=function(e){var t=this;return new Promise(function(n,i){a.default.init(e).then(function(e){t.renderLoop=new c.EmoticonsRenderLoop;var i=o.default.init(e);s.default.register(i),t.renderLoop.updateCache(i),i.items&&i.items.forEach(function(e){e.background=t.renderLoop.getUrlFromCache(e.id)}),n(i),t._isInitialized=!0,r.swc.Eventing.triggerEvent("pesConfigInitialized",null,!0),t.renderLoop.updateEmoticonCanvases()}).catch(function(){i()})})},e}();t.PesManager=u},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(102),o=n(22),s=n(36),a=n(103),c=function(){function e(){this._configuration={countryCode:"",tabsRoot:"",itemsRoot:"",emoticonsRoot:"",packsRoot:"",items:[],packs:[],tabs:[],emoticonPreviewItem:null}}return e.prototype.canRenderConfigItems=function(){return this._configuration.items.length>0},e.prototype.init=function(e){var t=this._processItems(e);t.forEach(function(e){r.idEmoticonMap[e.id]=e});var n=this._processPacks(e,t),o=e.tabs?this._resolveTabsFromSections(e,n):this._makeTabsFromPacks(n,e.packsRoot);return this._configuration=i({},e,{packs:n,tabs:o,items:t},{emoticonPreviewItem:t[0]}),this._configuration},e.prototype._processPacks=function(e,t){return e.packs.map(function(e){var n=[];return e.items.forEach(function(e){var i=t.find(function(t){return t.id===e});i&&n.push(i)}),i({},e,{items:n})})},e.prototype._resolveTabsFromSections=function(e,t){var n=this;return e.tabs.map(function(r){var o=[];return r.sections.forEach(function(e){var n=t.find(function(t){return t.id===e.pack});n&&n.items&&n.items.length&&o.push(n)}),i({},r,{packs:o,type:s.default.itemTypes.tab.id,thumbnailUrl:n._createThumbnailUrl(r.id,e.tabsRoot)})})},e.prototype._createThumbnailUrl=function(e,t){var n=(t||"#")+"/"+e+"/views/thumbnail";return n=a.rewriteUrls(n,s.default.pesCDNAuthentication.rewriteRules)},e.prototype._makeTabsFromPacks=function(e,t){var n=this,i=[];return e?(e.forEach(function(e){if(!n._isFeaturedPack(e)){var r=n._createTabFromPack(e,t);i.push(r)}}),e.forEach(function(e){if(n._isFeaturedPack(e)){var r=e.title.replace(s.default.FEATURED_IN_PREFIX,""),o=i.find(function(e){return e.title===r});o?(e.isHidden=!1,o.packs.unshift(e)):!1===e.isHidden&&(e.title=r,o=n._createTabFromPack(e,t),i.push(o))}}),i):i},e.prototype._createTabFromPack=function(e,t){var n=this._createThumbnailUrl(e.id,t),r=i({},e,{type:s.default.itemTypes.tab.id,thumbnailUrl:n,packs:[e],sections:[{pack:e.id}],glyphBgColor:"",isDiscoverable:!1,badgeETag:""});return delete r.isSponsored,delete r.items,r},e.prototype._isFeaturedPack=function(e){return 0===(e.title||"").indexOf(s.default.FEATURED_IN_PREFIX)},e.prototype._processItems=function(e){var t=this,n=e.countryCode;return e.items.filter(function(e){return e.type===s.default.itemTypes.emoticon.id&&(!(n&&e.excludedCountries&&e.excludedCountries.indexOf(n)>=0)&&!(n&&e.includedCountries&&e.includedCountries.length&&e.includedCountries.indexOf(n)<0))}).map(function(n){var r={staticHtmlClass:n.id,staticExtraLargeHtmlClass:n.id+" extraLarge",animatedExtraLargeHtmlClass:n.id+" extraLarge animated",background:""},o=e.emoticonsRoot+"/"+n.id+"/views/",s=t._getEmoticonURLs(o,n.etag),a=i({},n,r,s);return delete a.includedCountries,delete a.excludedCountries,a})},e.prototype._getEmoticonURLs=function(e,t){return e=a.rewriteUrls(e,s.default.pesCDNAuthentication.rewriteRules),{smallStaticUrl:this._buildUrl(e+s.default.profiles.emoticons.getSmall(),t),largeStaticUrl:this._buildUrl(e+s.default.profiles.emoticons.getLarge(),t),extraLargeStaticUrl:this._buildUrl(e+s.default.profiles.emoticons.getExtraLarge(),t),superLargeStaticUrl:this._buildUrl(e+s.default.profiles.emoticons.getSuperLarge(),t),smallUrl:this._buildUrl(e+s.default.profiles.emoticons.getSmallAnimated(),t),largeUrl:this._buildUrl(e+s.default.profiles.emoticons.getLargeAnimated(),t),extraLargeUrl:this._buildUrl(e+s.default.profiles.emoticons.getExtraLargeAnimated(),t),superLargeUrl:this._buildUrl(e+s.default.profiles.emoticons.getSuperLargeAnimated(),t)}},e.prototype._buildUrl=function(e,t){return o.UrlHelper.setQueryParameters(e,{etag:t})},e}();t.default=new c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(102),r=n(36),o=n(229),s=n(230),a=function(){function e(){}return e.prototype.register=function(e){var t=this._getArtifacts(e),n="";i.clearShortcutMap(),t.encodingMaps.forEach(function(e){switch(e.type){case r.default.itemTypes.emoticon.id:i.shortcutIdMap[e.shortcut]=e.id;break;case r.default.itemTypes.tab.id:case r.default.itemTypes.moji.id:case r.default.itemTypes.sticker.id:throw new Error("mapping.type not implemented yet:"+e.type);default:throw new Error("mapping.type not supported yet:"+e.type)}}),t.pesStyles.forEach(function(e){n+=e}),this._registerStyles(n)},e.prototype._getArtifacts=function(e){var t=[],n=[],i=[];return e.tabs&&e.tabs.forEach(function(e){var r=s.default.getResources(e);t.push(r.styleDef),n.unshift(r.prefetchUrls[0]),e.packs.forEach(function(e){e.items.forEach(function(e){var r=o.default.getResources(e);r&&(t.push(r.styleDef),i.push.apply(i,r.encoderMaps),n.push.apply(n,r.prefetchUrls))})})}),{pesStyles:t,prefetchUrls:n,encodingMaps:i}},e.prototype._registerStyles=function(e){var t,n,i=document.getElementById("pesStyles");return i||(n=document.head,(i=document.createElement("style")).id="pesStyles",i.type="text/css"),i.styleSheet?i.styleSheet.cssText=e:(t=document.createTextNode(e),i.firstChild&&i.removeChild(i.firstChild),i.appendChild(t)),n&&n.appendChild(i),e},e}();t.default=new a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(36),r=function(){function e(){}return e.prototype.getResources=function(e){if(e.type!==i.default.itemTypes.emoticon.id)return null;var t=e.shortcuts.map(function(t){return{shortcut:t,id:e.id,type:i.default.itemTypes.emoticon.id}});return{styleDef:"",prefetchUrls:[e.smallUrl,e.smallStaticUrl,e.largeUrl,e.largeStaticUrl,e.extraLargeUrl,e.extraLargeStaticUrl,e.superLargeUrl,e.superLargeStaticUrl],encoderMaps:t}},e}();t.default=new r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(36),r=function(){function e(){}return e.prototype.getResources=function(e){if(e.type!==i.default.itemTypes.tab.id)return null;var t="\n.swx .tab_id_"+e.id+"\n";return t+="{\n",t+=" -ms-high-contrast-adjust: none;\n",t+=" background-image: url('"+e.thumbnailUrl+"'); \n",{styleDef:t+="} \n",prefetchUrls:[e.thumbnailUrl]}},e}();t.default=new r},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(128),s=n(98),a=n(79),c=n(10),u=n(3),l=n(36),p=n(103),d={retryCount:3,timeout:12e4,policy:""},f=function(){function e(){}return e.prototype.init=function(e){var t=this;return this._initPromise?this._initPromise:(u.default.get.pesLanguageLocale=o.default.getPesLocale(u.default.get.getCurrentLocale()||r.Configuration.LOCALE),this._initPromise=a.configLoader("Skype",{id:e}).then(function(e){var n=e.SkypePersonalization?e.SkypePersonalization.pes_config:null,r=e.Headers?e.Headers.CountryCode:null;return t._fetchConfiguration(n).then(function(e){return i({},e,{countryCode:r})})}),this._initPromise)},e.prototype._fetchConfiguration=function(e){var t=this;return this._fetch(this._getLocalizedUrl(e)).catch(function(){return t._fetch(e)})},e.prototype._fetch=function(e){return e=p.rewriteUrls(e,l.default.pesCDNAuthentication.rewriteRules),Promise.resolve(c.default("pes-CDNTokenFromSkypeToken",d,e,{method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json, text/javascript"}}).then(function(e){return s.parseJson(e)}))},e.prototype._getLocalizedUrl=function(e){var t=u.default.get.pesLanguageLocale||r.Configuration.PES_LOCALE;return e.replace("/default","/"+t)},e}();t.default=new f},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(27),s=n(49),a=n(36),c=n(233),u=n(140),l=["conversation","recentsList"],p={running:!1,active:!0,lastBoundsTimestamp:-1313,lastDrawTimestamp:-1313},d=function(){function e(){var e=this;if(this._pixelRatio=1,this._refreshTime=0,this._bounds={},this.BOUNDS_REFRESH_TIMEOUT=1e3,this._imageCache={},this.viewports={},this.updateViewport=function(t){e.viewports[t.id]?e.viewports[t.id].active=t.state.active:e.viewports[t.id]=i({},p,{active:t.state.active,window:t.window})},s.isInIframe()){var t=r.swc.services.viewports;t.byType(l).forEach(function(t){e.updateViewport(t)}),t.onChange(this.updateViewport)}else this.viewports.default=i({},p,{window:o.default.getWindow()})}return e.prototype.updateCache=function(e){var t=this,n=0;e.items.forEach(function(i){if(!t._imageCache[i.id]&&i.type===a.default.itemTypes.emoticon.id){t._imageCache[i.id]=new c.default(e.emoticonsRoot,i);var r=i.media;r&&r.default&&r.default.fps>n&&(n=r.default.fps)}}),0!==n&&(this._refreshTime=Math.floor(1e3/n))},e.prototype.getUrlFromCache=function(e){var t="";for(var n in this._imageCache)if(this._imageCache[n].id===e){var i=this._imageCache[n].largeStatic;t=i?i.url:"";break}return t},e.prototype.updateEmoticonCanvases=function(){for(var e=0,t=Object.keys(this.viewports);e<t.length;e++){var n=t[e],i=this.viewports[n];if(i&&i.active)try{i.canvases=i.window&&i.window.document?i.window.document.querySelectorAll(".swc span.emoticon canvas"):null}catch(e){r.swc.Telemetry.sendEvent.runtimeError(104010,"Error updating emoticon canvases","Error updating emoticon canvases","")}i.running=i.active&&i.canvases&&!!i.canvases.length,i.running&&this.start(i)}},e.prototype.start=function(e){var t=this,n=e.window;"devicePixelRatio"in n&&(this._pixelRatio=n.devicePixelRatio),e.lastDrawTimestamp=-1313,n.requestAnimationFrame(function(n){return t.draw(n,e)})},e.prototype.draw=function(e,t){var n=this;if(e-t.lastDrawTimestamp>=this._refreshTime){t.lastDrawTimestamp=e;var i=e-t.lastBoundsTimestamp>this.BOUNDS_REFRESH_TIMEOUT;i&&(t.lastBoundsTimestamp=e);var s=t.canvases;s&&Array.prototype.forEach.call(s,function(s){if(""!==s.id){i&&delete n._bounds[s.id],n._bounds[s.id]||(n._bounds[s.id]=s.getBoundingClientRect());var c=n._bounds[s.id];if(!(c.width<=2)&&o.default.isInViewport(c,t.window)){i&&n.setDimensionsIfNeeded(s,c);var l="itemId",p="item-id",d="isAnimated",f="is-animated",h=o.default.readDataset(s,l,p),g=n._imageCache[h],m="true"===o.default.readDataset(s,d,f);try{g&&function(e,t,n,i,r){var o;o=n<=a.default.frameHeights.emoticons.SMALL?u.ITEM_SIZES.SMALL:n<=a.default.frameHeights.emoticons.LARGE?u.ITEM_SIZES.LARGE:n<=a.default.frameHeights.emoticons.EXTRA_LARGE?u.ITEM_SIZES.EXTRA_LARGE:u.ITEM_SIZES.SUPER_LARGE;t[o+(i?"Animated":"Static")].draw(e,r)}(s,g,c.width,m,e/1e3)}catch(e){r.swc.Telemetry.sendEvent.runtimeError(104011,e.message,"Error in render loop draw",e.stack)}}}})}t.running&&t.window.requestAnimationFrame(function(e){return n.draw(e,t)})},e.prototype.setDimensionsIfNeeded=function(e,t){var n=t.width*this._pixelRatio;e.width===n&&e.height===n||(e.width=n,e.height=n)},e}();t.EmoticonsRenderLoop=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(103),r=n(140),o=n(234),s=function(){return function(e,t){this.id=t.id,this.smallAnimated=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.SMALL,!0),t.media.default),this.largeAnimated=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.LARGE,!0),t.media.default),this.extraLargeAnimated=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.EXTRA_LARGE,!0),t.media.default),this.superLargeAnimated=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.SUPER_LARGE,!0),t.media.default),this.smallStatic=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.SMALL,!1),r.STATIC_MEDIA_INFO),this.largeStatic=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.LARGE,!1),r.STATIC_MEDIA_INFO),this.extraLargeStatic=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.EXTRA_LARGE,!1),r.STATIC_MEDIA_INFO),this.superLargeStatic=new o.default(i.buildEmoticonUrl(e,t,r.ITEM_SIZES.SUPER_LARGE,!1),r.STATIC_MEDIA_INFO)}}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.isLoaded=!1,this.isLoading=!1,this.url=e,this.mediaInfo=t}return e.prototype.draw=function(e,t){var n=this;if(!this.isLoading)if(this.isLoaded){var i=e.getContext("2d"),r=this.image.naturalWidth;i.clearRect(0,0,e.width,e.width);var o=void 0;o=1===this.mediaInfo.framesCount?0:Math.floor(t*this.mediaInfo.fps)%this.mediaInfo.framesCount,i.drawImage(this.image,0,r*o,r,r,0,0,e.width,e.width)}else this.image=new Image,this.isLoading=!0,this.image.onload=function(){n.isLoading=!1,n.isLoaded=!0,n.draw(e,t)},this.image.src=this.url},e}();t.default=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(139),s=["smile","laugh","heart","kiss","sad","tongueout","wink","cry","inlove","hug","cwl","lips","blush","surprised","penguin","yes","like","cool","rofl","cat","monkey","hi","snowangel","flower","giggle","devil","party","worry","champagne","sun","star","polarbear","dull","speechless","wonder","angry","puke","facepalm","sweat","holidayspirit","sleepy","bow","makeup","cash","lipssealed","shivering","cake","headbang","dance","wasntme","hungover","yawn","gift","angel","xmastree","brokenheart","think","clap","punch","envy","handshake","nod","nerdy","emo","muscle","mmm","ok","highfive","turkey","call","movember","dog","coffee","poke","swear","donttalktome","fingerscrossed","rainbow","headphones","waiting","festiveparty","bandit","heidy","beer","doh","bomb","happy","ninja"],a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.init=function(){return new Promise(function(e,n){t.initSkype().then(function(n){t.config=t._filterConfiguration(n),e(t.config)})})},t.getConfiguration=function(){return new Promise(function(e,n){t.config?e(t.config):t.init().then(function(t){e(t)})})},t}return r(t,e),t.prototype._filterConfiguration=function(e){var t=function(e){return s.indexOf(e)>-1};return e.items=e.items.filter(function(e){return t(e.id)}),e.packs.forEach(function(e){e.items=e.items.filter(function(e){return t(e.id)})}),e},t}(o.default);t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(237))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(12),o=n(53),s=n(42),a=n(238),c=n(239),u=function(){function e(){this._uploads={}}return e.prototype.checkAndUploadFile=function(e,t){var n,i=this;this._uploads[t]=o.DocumentStatus.InProgress;var r=this._getPersonalFileSite().then(function(e){return n=e,e}).then(function(){return i._checkFileCycle(n,e.name)}).then(function(t){return{fileCheckValue:t,uploadPromise:i.uploadFile(e,t,n)}});return r.catch(function(){i._uploads[t]=o.DocumentStatus.Failed}),r},e.prototype.uploadFile=function(e,t,n){var i=this,s=t.objectId,a=r.guid.generate(),u="_api/web/GetFolderByServerRelativeUrl(@folder)/Files/getByUrlOrAddStub(@file)/StartUpload(uploadId=guid'"+a+"')",l="@folder='"+t.siteInfo.relativeUrl+"'&@file='"+t.title+"'",p=""+n.personalSiteUrl+u+"?"+l,d=function(t){var r="_api/web/GetFolderByServerRelativeUrl(@folder)/Files/getByUrlOrAddStub(@file)/FinishUpload(uploadId=guid'"+a+"',fileOffset="+e.size+")",u=""+n.personalSiteUrl+r+"?"+l;return c.post(u,"").then(function(){i._uploads[s]=t?o.DocumentStatus.Failed:o.DocumentStatus.Success}).catch(function(){i._uploads[s]=o.DocumentStatus.Failed})};return this._uploads[s]=o.DocumentStatus.InProgress,c.post(p,e).then(function(){return d()}).catch(function(e){return d(e)})},e.prototype.shareFile=function(e,t){var n=i.Configuration.SHAREPOINT_URL+"_api/SP.Sharing.DocumentSharingManager.UpdateDocumentSharingInfo",r={additiveMode:!1,customMessage:"Shared a file",includeAnonymousLinksInNotification:!0,resourceAddress:e,sendServerManagedNotification:!1,userRoleAssignments:t.map(function(e){return{Role:2,UserId:e}}),validateExistingPermissions:!1};return c.postJson(n,JSON.stringify(r))},e.prototype._checkFileCycle=function(e,t,n,i){var r=this;return void 0===n&&(n=t),void 0===i&&(i=0),new Promise(function(o){r._checkFileOnce(e,n).then(function(e){return o(e.value)}).catch(function(){var n=function(e,t){var n="$1 ("+t+")$2";return e.replace(/^(.+)(\.[\w\d]+)$/g,n)}(t,++i);return r._checkFileCycle(e,t,n,i).then(o)})})},e.prototype._getPersonalFileSite=function(){var e=this;if(this._sharepointLocations)return Promise.resolve(this._sharepointLocations);var t=i.Configuration.TEAMS_PROFILE_URL+"api/mt/amer/beta/me/files/availability";return a.post("teams-mt-filesAvailability",t,"").then(function(t){if(t.errorCode)throw new Error(t.message);return e._sharepointLocations=t,t})},e.prototype._checkFileOnce=function(e,t){var n={parentServerRelativeUrl:e.personalRootFolderUrl.match(/^https?:\/\/[^\/]+(.*)\/?$/)[1]+"/Microsoft Teams Chat Files",itemName:t,createBlankFile:!1,overwrite:!1},r=i.Configuration.TEAMS_PROFILE_URL+"api/mt/amer/beta/me/files",o=s.addGetParamsToUrl(r,n);return a.post("teams-mt-fileCheck",o,"").then(function(e){return e.errorCode&&"FilenameCollision"===e.errorCode?Promise.reject(e):e})},e.prototype.downloadFile=function(e){var t="_api/web/GetFileByServerRelativeUrl('"+(e.fileInfo.serverRelativeUrl||function(e){var t="";if(e){var n=e.split("/").slice(3);n&&n.length&&(t="/"+n.join("/"))}return t}(e.objectUrl))+"')/GetPreAuthorizedAccessUrl(1)";return a.get("SharepointService.downloadFile",""+e.baseUrl+t).then(function(e){return e.value?a.getData("SharepointService.downloadFile",e.value):null})},e.prototype.getFileStatus=function(e){return this._uploads[e]},e}();t.SharepointService=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(98),o=n(30),s=n(5),a=n(10),c={retryCount:3,timeout:12e4,policy:""};t.post=function(e,n,i){return t.getHeaders().then(function(t){return function(e,t,n){return a.default("sharepoint-"+e,c,t,n)}(e,n,{method:"POST",cache:"no-cache",headers:t,body:i}).then(function(e){return e.json()})})},t.getHeaders=function(e){return void 0===e&&(e=o.AadAudience.SpacesApi),new Promise(function(t){Promise.all([s.ServicesManager.signInManager.aad(e),s.ServicesManager.signInManager.getSkypeToken()]).then(function(e){var n=e[0],r=e[1],o=new Headers({Authorization:n,"x-skypetoken":r,"x-skype-client":i.Configuration.getClientVersion(),Accept:"application/json","Content-Type":"application/json"});t(o)})})},t.get=function(e,n){var i=n.match(/^(https?:\/\/[^\/]+).*\/?$/)[1];return t.getHeaders(i).then(function(t){var i={method:"GET"};return i.headers=t,r.request(e,n,i).then(function(e){return e.json()})})},t.getData=function(e,t){var n=new Headers;n.append("Accept","text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8"),n.append("Accept-Encoding","gzip, deflate, sdch, br");var i={method:"GET"};return i.headers=n,r.request(e,t,i).then(function(e){return e.blob()})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(30),o=n(5),s=n(10);function a(e){return new Promise(function(t){o.ServicesManager.signInManager.aad(r.AadAudience.Sharepoint).then(function(n){var r=new Headers;r.append("Authorization",n),r.append("x-skype-client",i.Configuration.getClientVersion()),r.append("Accept","application/json"),e&&r.append("content-type",e),t(r)})})}function c(e,t,n){return s.default("sharepoint-"+e,{retryCount:3,timeout:12e4,policy:""},t,n)}t.postJson=function(e,t){return a("application/json").then(function(n){return c("sharepoint",e,{method:"POST",cache:"no-cache",headers:n,body:t}).then(function(e){try{return e.json()}catch(t){return e}})})},t.post=function(e,t){return a().then(function(n){return c("sharepoint",e,{method:"POST",cache:"no-cache",headers:n,body:t}).then(function(e){try{return e.json()}catch(t){return e}})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(8),o=n(12),s=n(79),a=n(5),c=n(241),u=function(){function e(){this._profiles={}}return e.prototype.fetchProfiles=function(e){var t=this;return this.getEcsConfig().then(function(){var n="?requestid="+t.getAppDataParams()+"&locale="+i.Configuration.LOCALE+"&searchstring="+e;return c.get("namesearch",n).then(function(e){return e&&e.results.forEach(function(e){var t=a.ServicesManager.persons.getPerson(e.nodeProfileData.skypeId,!1,!1);t.displayName=e.nodeProfileData.name,t.avatarData=e.nodeProfileData.avatarUrl}),e})},this.searchV1.bind(this,e))},e.prototype.searchV1=function(e){var t="search/v1.1/namesearch/swx/?requestid="+this.getAppDataParams()+"&locale="+i.Configuration.LOCALE+"&searchstring="+e;return c.get("namesearch",t)},e.prototype.getAppDataParams=function(){return[i.Configuration.APPNAME,i.Configuration.ECS.version,o.guid.generate()].join("-")},e.prototype.getEcsConfig=function(){if(e.getEcsConfigPromise)return e.getEcsConfigPromise;var t={id:a.ServicesManager.signInManager.currentUserName};return e.getEcsConfigPromise=s.configLoader("Skype",t).then(function(e){i.Configuration.ECS_GRAPH_ETAG=e.Headers.ETag;var t=e.PeopleSearch?e.PeopleSearch:void 0;if(t&&t.v2Endpoint&&(i.Configuration.ECS_GRAPH_URL=t.v2Endpoint),t&&t.serviceSettings){var n=t.serviceSettings;i.Configuration.ECS_GRAPH_SERVICE_SETTINGS="experiment="+n.experiment+";geoProximity="+n.geoProximity}},function(e){throw r.default.throwError(12002,"Unable to get advanced search params",e),e}),e.getEcsConfigPromise},e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o=n(242),s={retryCount:3,timeout:12e4,policy:""};t.get=function(e,t){return o.getHeaders().then(function(n){var o={method:"GET"};return o.headers=n,o.cache="no-cache",function(e,t,n){return r.default("skypegraph-"+e,s,i.Configuration.ECS_GRAPH_URL+t,n)}(e,t,o).then(function(e){return e.json()})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(5);t.getHeaders=function(){return new Promise(function(e){r.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=new Headers;n.append("x-skypetoken",t),n.append("x-skype-client",i.Configuration.getClientVersion()),i.Configuration.ECS_GRAPH_ETAG&&n.append("x-ecs-etag",i.Configuration.ECS_GRAPH_ETAG),i.Configuration.ECS_GRAPH_SERVICE_SETTINGS&&n.append("x-skypegraphservicesettings",i.Configuration.ECS_GRAPH_SERVICE_SETTINGS),e(n)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(244);t.getSessionStorage=i.getSessionStorage;var r=n(245);t.getLocalStorage=r.getLocalStorage},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(141);t.getSessionStorage=function(){if(i)return i;try{"object"==typeof sessionStorage&&(sessionStorage.setItem("ss","0"),sessionStorage.removeItem("ss"),i=window.sessionStorage)}catch(e){i=new r.MemoryStorage}return i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(141);t.getLocalStorage=function(){if(i)return i;try{"object"==typeof localStorage&&(localStorage.setItem("ls","0"),localStorage.removeItem("ls"),i=window.localStorage)}catch(e){i=new r.MemoryStorage}return i}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(46),s=n(74),a=function(e){function t(t){var n=e.call(this)||this;return n.mePersonMri=t,n.unreadMap={},n.debouncedNotify=o(function(){n.notify(n.unreadCounter)}),n}return r(t,e),Object.defineProperty(t.prototype,"unreadCounter",{get:function(){return Object.keys(this.unreadMap).length},enumerable:!0,configurable:!0}),t.prototype.markAsUnread=function(e){this.unreadMap[e]=!0,this.debouncedNotify()},t.prototype.markAsRead=function(e){delete this.unreadMap[e],this.debouncedNotify()},t.prototype.update=function(e){var t=s.default.isUnread(this.mePersonMri,e.id,e.properties,e.lastMessage);!("false"===e.properties.alerts)&&t?this.markAsUnread(e.id):this.markAsRead(e.id)},t}(n(143).SubscribeableStore);t.UnreadCounterStore=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(248),o=function(){function e(){this.timeout=0,this.idInQueue=[]}return e.prototype.fetchMeProperties=function(){return r.get("fetchMeProfiles","users/self/profile")},e.prototype.fetchPerson=function(e){var t=this;return this.idInQueue.push(e),10!==this.idInQueue.length?this.idInQueue.length>1?this.idInQueuePromise:(this.idInQueuePromise=new Promise(function(e,n){t.lastCreatedRequest=function(){t.fetchPersons(t.idInQueue).then(e,n),t.idInQueue=[],clearTimeout(t.timeout)},t.timeout=setTimeout(t.lastCreatedRequest,2e3)}),this.idInQueuePromise):(this.lastCreatedRequest(),this.idInQueuePromise)},e.prototype.getAvatarUrl=function(e){return i.Configuration.STRATUS_DOMAIN_HOST_URL+"users/"+e+"/profile/avatar?cacheHeaders=1"},e.prototype.fetchPersons=function(e){var t={usernames:e};return r.post("fetchPersons","batch/profiles",JSON.stringify(t))},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o=n(249),s={retryCount:3,timeout:12e4,policy:""},a=function(e,t,n){return r.default("stratus-"+e,s,i.Configuration.STRATUS_DOMAIN_HOST_URL+t,n)};t.put=function(e,t,n){return o.putHeaders().then(function(i){var r={method:"PUT"};return r.body=n,r.headers=i,a(e,t,r)})},t.post=function(e,t,n){return o.getHeaders().then(function(i){i.append("Content-Type","application/json");var r={method:"POST"};return r.body=n,r.headers=i,a(e,t,r).then(function(e){return e.json()})})};t.get=function(e,t){return o.getHeaders().then(function(n){var o={method:"GET"};return o.headers=n,function(e,t,n,o){return r.default("stratus-"+e,s,(o||i.Configuration.STRATUS_DOMAIN_HOST_URL)+t,n).then(function(e){return e.json()})}(e,t,o)})},t.getData=function(e,t){return o.getDataHeaders().then(function(n){var o={method:"GET"};return o.headers=n,function(e,t,n,o){return r.default("stratus-"+e,s,(o||i.Configuration.STRATUS_DOMAIN_HOST_URL)+t,n).then(function(e){return e.blob()})}(e,t,o)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(5);function o(e){var t=new Headers;return e&&t.append("X-Skypetoken",e),t.append("X-Stratus-Caller",i.Configuration.getUiVersion()),t}t.putHeaders=function(){return new Promise(function(e){r.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=o(t);n.append("Content-Type","application/x-www-form-urlencoded"),e(n)},function(){})})},t.getHeaders=function(){return new Promise(function(e){r.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=o(t);e(n)},function(){})})},t.getProxyHeaders=function(){return new Promise(function(e){var t=o();t.append("Accept","application/json, text/javascript"),e(t)})},t.getDataHeaders=function(){return new Promise(function(e){r.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=o(t);n.append("Accept","image/webp,image/*,*/*;q=0.8"),n.append("Accept-Encoding","gzip, deflate, sdch"),e(n)},function(){})})},t.getDataProxyHeaders=function(){return new Promise(function(e){var t=o();t.append("Accept","image/webp,image/*,*/*;q=0.8"),t.append("Accept-Encoding","gzip, deflate, sdch"),e(t)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5);function r(e){return"8:"+e}var o=function(){function e(){}return e.prototype.fetchMeProperties=function(){return Promise.resolve()},e.prototype.fetchShortProfile=function(e){return i.ServicesManager.userService.then(function(t){return t.getUsers(function(e){return e.map(function(e){return function(e){return 0===e.indexOf("8:")}(e)?e:r(e)})}(e))})},e.prototype.fetchPerson=function(e){return i.ServicesManager.userService.then(function(t){return t.getUser(r(e)).then(function(e){return i.ServicesManager.avatarService.fetchAvatars(e.mri,e.displayName).then(function(t){return[{avatarUrl:"",username:e.mri,displayname:e.displayName,avatarData:t[0]}]})})})},e.prototype.getAvatarUrl=function(e){return""},e.prototype.fetchPersons=function(e){return Promise.resolve([])},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),r=n(252),o=function(){function e(){}return e.prototype.fetchProfiles=function(e){if(e.length>3){return new Promise(function(t){r.post("search","https://teams.microsoft.com/api/mt/amer/beta/users/search?includeDLs=true&includeBots=true&enableGuest=true&skypeTeamsInfo=true",e).then(function(e){e.value&&e.value.forEach(function(e){if(e.mri){var t=i.ServicesManager.persons.getPerson(e.mri,!1,!1);t.displayName=e.displayName,t.email=e.email,t.description=e.jobTitle,i.ServicesManager.avatarService.fetchAvatars(e.mri,e.displayName).then(function(e){e&&(t.avatarData=e)})}}),t(e.value)})})}return Promise.resolve([])},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(30),o=n(5),s=n(10),a={retryCount:3,timeout:12e4,policy:""};t.post=function(e,n,i){return t.getHeaders().then(function(t){return function(e,t,n){return s.default("teamsgraph-"+e,a,t,n)}(e,n,{method:"POST",cache:"no-cache",headers:t,body:i}).then(function(e){return e.json()})})},t.getHeaders=function(){return new Promise(function(e){Promise.all([o.ServicesManager.signInManager.aad(r.AadAudience.SpacesApi),o.ServicesManager.signInManager.getSkypeToken()]).then(function(t){var n=t[0],r=t[1],o=new Headers;o.append("Authorization",n),o.append("x-skypetoken",r),o.append("x-skype-client",i.Configuration.getClientVersion()),e(o)})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(1),o=n(0),s=n(18);t.reportInappActivityStartEvent=function(e){var t=i.default.get.isTeams()?"AAD":"MSA";o.swc.services.signInManager.onceSignedIn().then(function(){return o.swc.Telemetry.sendEvent.inAppActivityStarted(e,o.swc.services.signInManager.currentUserName,r.Configuration.getUiVersion(),s.default.getOsVersion(),t)})}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),r=function(){function t(){}return t.translate=function(e,t,n){var i="https://dev.microsofttranslator.com/api/skype/translate?from="+e+"&to="+t+"&text="+n;return this._requestWithToken(i)},t.detect=function(t){var n="https://f3cc4fc2.ngrok.io/detect?text="+t;return new Promise(function(t,i){return e(encodeURI(n),{method:"GET"}).then(function(e){e.json().then(function(e){var n=e.string.$t.split("-")[0];t(n)}).catch(function(e){i(e)})},function(e){i(e)})})},t.getLanguages=function(){return this._requestWithToken("https://dev.microsofttranslator.com/api/languages")},t._requestWithToken=function(t){var n=new Headers,r={};return new Promise(function(o,s){i.ServicesManager.signInManager.getSkypeToken().then(function(i){return n.append("Content-Type","application/x-www-form-urlencoded"),n.append("X-Skypetoken",i),n.append("X-ScenarioId","FF63883DDDED40068EC45030A601460C"),r.method="GET",r.headers=n,e(encodeURI(t),r).then(function(e){e.json().then(function(e){o(e)}).catch(function(e){s(e)})},function(e){s(e)})})})},t}();t.default=r}).call(this,n(52))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(256),r=n(1),o=n(12),s=function(){return function(e){var t=this;this.logEvent=function(e){t._logger.debug(e)},this._logger=e}}(),a=function(){function e(){var e,t,n=this;this._platformName="chrome",this._stateCallback=function(e,t){e===i.TrouterState.Connected&&n.trouterUrl(t)},this._trouterUrlChangeListenerRegistry=(e=[],(t=function(t){e.push(t)}).off=function(t){var n=e.indexOf(t,0);n>-1&&e.splice(n,1)},t.notifyAll=function(t){e.forEach(function(e){e(t)})},t),this.trouterUrl=function(){var e=function(e){if(n._logger.info("trouterUrl change"),void 0===e)return n._trouterUrl;n._trouterUrl!==e&&(n._trouterUrl=e,n._trouterUrlChangeListenerRegistry.notifyAll(e))};return e.changed=n._trouterUrlChangeListenerRegistry,e}()}return e.prototype._getSettings=function(e,t){return{registrationId:o.guid.generate(),registrarServiceUrl:t.incomingCalls.registrarServiceUrl,registrarTtlInSeconds:t.incomingCalls.registrarTtlInSeconds,maxRegistrationTimeInMs:t.incomingCalls.maxRegistrationTimeInMs,registrarRefreshTimeoutInMs:t.incomingCalls.registrarRefreshTimeoutInMs,pnhAppId:t.incomingCalls.pnhAppId,pnhTemplate:t.incomingCalls.pnhTemplate,platform:e,platformUIVersion:"0.0.0",trouterServiceUrl:t.incomingCalls.trouterServiceUrl,version:t.version,trouterConnectTimeoutInMs:t.incomingCalls.trouterConnectTimeoutInMs,productName:t.productName,sessionId:t.sessionId,environment:"",incallModeTimeoutMs:0}},e.prototype._getTrouterSettings=function(){return{version:r.Configuration.getUiVersion(),productName:"swc",incomingCalls:{trouterServiceUrl:"https://go.trouter.skype.com/v4/a",registrarServiceUrl:"https://prod.registrar.skype.com/v2/registrations",registrarTtlInSeconds:360,registrarRefreshTimeoutInMs:35e4,trouterReadyTimeoutInMs:6e4,trouterConnectTimeoutInMs:2e4,maxRegistrationTimeInMs:864e5,pnhAppId:"skype",pnhTemplate:"SkypeWebNGC_1.7"},telemetry:{jSkypeTenantToken:"dummy-not-used",skypeConcoreToken:""}}},e.prototype._createTrouterTelemetryConfig=function(e){return{eventLogger:new s(e.createChild("TrouterTelemetry")),settings:{enabled:!0,logHealthCheckError:!0,trouter_js_client_connected:!0,trouter_js_client_disconnected:!0,trouter_js_client_error:!0,trouter_js_client_progress:!0,trouter_js_client_response:!0,numberOfStepsToMaintain:0,sendProgressTimeoutSecs:0}}},e.prototype._getTrouterConfig=function(e,t,n,i){return{trouterSettings:this._getSettings(t,n),skypeTokenProvider:i,telemetryConfig:this._createTrouterTelemetryConfig(e)}},e.prototype.init=function(e,t,n){var r=this._getTrouterSettings(),o={sessionId:n};return this._logger=e,this._logger.info("Trouterservice init"),this._trouterService?this._logger.warn("Trouterservice already initialized"):(this._options=this._getTrouterConfig(e,this._platformName,r,t),this._trouterService=i.createTrouterService(e.createChild("Trouter")),this.start(o)),this},e.prototype.start=function(e){this._logger.info("Trouterservice start"),this._trouterService?(e&&(this._options.trouterSettings.environment=e.environment,this._options.trouterSettings.sessionId=e.sessionId),this._trouterService.start(this._options),this._trouterService.onStateChanged(this._stateCallback)):this._logger.error("Trouterservice not initialized")},e.prototype.stop=function(){this._logger.info("Trouterservice stop"),this._trouterService?(this._trouterService.stop(),this._trouterService=void 0):this._logger.error("Trouterservice not inited")},e.prototype.registerMessageHandler=function(e){this._logger.info("Trouterservice registerMessageHandler"),this._trouterService&&this._trouterService.registerMessageHandler(e)},e.prototype.clearMessageHandlers=function(){this._trouterService&&this._trouterService.clearMessageHandlers()},e.prototype.checkConnection=function(){this._trouterService&&this._trouterService.checkConnection()},e.prototype.state=function(){return this._logger.info("Trouterservice state"),this._trouterService?this._trouterService.state():i.TrouterState.Unknown},e.prototype.onStateChanged=function(e){this._logger.info("Trouterservice onStateChanged"),this._trouterService&&this._trouterService.onStateChanged(e)},e.prototype.getTrouterUrlAsync=function(){return this._trouterService?(this._logger.info("getTrouterUrlAsync called"),this._trouterService.getTrouterUrlAsync()):Promise.reject("Trouterservice not started yet")},e}();t.Trouter=a},function(module,exports,__webpack_require__){(function(fetch){var e;e=function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=19)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.name=e,this.logger=t}return e.prototype.debug=function(e){this.logger.debug("["+this.name+"] "+e)},e.prototype.info=function(e){this.logger.info("["+this.name+"] "+e)},e.prototype.warn=function(e){this.logger.warn("["+this.name+"] "+e)},e.prototype.error=function(e){this.logger.error("["+this.name+"] "+e)},e}();t.Logger=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.constants={TROUTER_INIT:"trouterinit",TROUTER_READY_EVENT:"trouterReadyEvent",TROUTER_READY_TIMEOUT:"trouterReadyTimeout",TROUTER_TOKEN_REQUEST:"trouterTokenRequest",TROUTER_TOKEN_GET_SUCCEEDED:"trouterTokenGetSucceeded",TROUTER_TOKEN_GET_FAILED:"trouterTokenGetFailed",TROUTER_RECONNECTING:"trouterReconnecting",RENEWAL:"renewal",NEW_CONNECTION:"newConnection",ENDPOINT_REGISTRATION_FAILED:"endpointRegistrationFailed"},t.CLIENT_VERSION="2019.19.01.1",t.HANDLED_MESSAGE_ACK=200,t.UNHANDLED_MESSAGE_ACK=404,t.FAILED_MESSAGE_ACK=500},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toJson=function(e){try{return JSON.stringify(e)}catch(t){return"Unable to serialize object of type "+typeof e}},t.calculateTtlInSec=function(e){var t=Math.round((new Date).getTime()/1e3);return void 0!==e&&e>t?e-t:0},t.calculateExpireTsInSec=function(e){return Math.round((new Date).getTime()/1e3)+e};var i=function(){function e(){this.start=Date.now()}return e.prototype.duration=function(){return Date.now()-this.start},e.prototype.reset=function(){this.start=Date.now()},e}();t.Timespan=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(){}}();t.HttpHeaders=i,function(e){e[e.Unknown=0]="Unknown",e[e.Connected=2]="Connected",e[e.Disconnected=3]="Disconnected",e[e.Switching=9]="Switching"}(t.TrouterState||(t.TrouterState={}))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=function(){function e(e){this.logger=e,this.messageHandlers=[]}return e.prototype.register=function(e){if(this.messageHandlers.some(function(t){return t===e}))throw new Error("Registering the same handler twice is not allowed");this.messageHandlers.push(e)},e.prototype.clear=function(){this.logger.debug("Clearing message handlers"),this.messageHandlers=[]},e.prototype.active=function(){return this.messageHandlers.length>0},e.prototype.handleMessage=function(e){for(var t={resultCode:i.UNHANDLED_MESSAGE_ACK,isHandled:!1},n=0,r=this.messageHandlers;n<r.length;n++){var o=r[n],s=this.safeExecuteHandle(o,e);if(void 0!==s&&(void 0===s.isHandled||s.isHandled))return void 0===s.resultCode&&(s.resultCode=i.HANDLED_MESSAGE_ACK),s}return t},e.prototype.safeExecuteHandle=function(e,t){try{return e.handleMessage(t)}catch(e){return void this.logger.warn("A trouter message handler is throwing exceptions. exception: "+e)}},e}();t.MessageHandlerRegistry=r},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}c((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,o&&(s=2&n[0]?o.return:n[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.addCacheAsBackupTo=function(e){var t,n=this;return function(o){return i(n,void 0,void 0,function(){return r(this,function(n){return o&&(t=void 0),[2,new Promise(function(n,i){e(o).then(function(e){t=e,n(e)}).catch(function(e){void 0!==t&&t.length>0&&n(t),i(e)})})]})})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(0),o=n(16),s=n(18),a=function(){function e(e,t,n,o){this.logFunc=e,this.options=t,this.tokenProvider=n,this.listener=o,this.logger=new r.Logger("Manager",e),this.logger.info("Created TrouterManager with options "+i.toJson(this.options)),this.fsm=new s.TrouterManagerFsm(e,this),this.baseEndpointUrl=""}return e.prototype.start=function(){this.fsm.start()},e.prototype.stop=function(){this.fsm.stop()},e.prototype.checkConnection=function(e){void 0!==this.firstConnection&&this.firstConnection.checkConnection(e),void 0!==this.secondConnection&&this.secondConnection.checkConnection(e)},e.prototype.getServerState=function(){if(void 0!==this.firstConnection)return this.firstConnection.getServerState()},e.prototype.getState=function(){return this.fsm.getState()},e.prototype.startFirstConnection=function(){this.firstConnection=new o.TrouterConnection(this.logFunc,this.options,this,this.tokenProvider),this.firstConnection.start()},e.prototype.startSecondConnection=function(){this.secondConnection=new o.TrouterConnection(this.logFunc,this.options,this,this.tokenProvider),this.secondConnection.start()},e.prototype.stopFirstConnection=function(e){void 0!==this.firstConnection&&(this.firstConnection.stop(e),this.storedFirstConnection=this.firstConnection,this.firstConnection=void 0)},e.prototype.stopSecondConnection=function(e){void 0!==this.secondConnection&&(this.secondConnection.stop(e),this.secondConnection=void 0)},e.prototype.switchConnections=function(){var e=this.firstConnection;this.firstConnection=this.secondConnection,this.secondConnection=e},e.prototype.doesSecondConnectionExist=function(){return void 0!==this.secondConnection},e.prototype.dispatchConnected=function(){if(void 0!==this.firstConnection){var e=this.firstConnection.getServerState(),t="/"===e.url.slice(-1)?e.url.slice(0,-1):e.url,n={baseEndpointUrl:t,newEndpointUrl:t!==this.baseEndpointUrl,clientId:e.connectedClientId,connectionId:e.connectionId,connectionTtlSec:e.getRemainingTtlInSec()};this.baseEndpointUrl=t,this.listener.onTrouterConnected(e.url,n)}},e.prototype.dispatchReconnecting=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},e.prototype.dispatchStopped=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},e.prototype.onDownstreamRequest=function(e,t,n){var i={id:t.id,method:t.method,path:"/"+t.shortUrl,body:t.body,headers:t.headers},r={id:t.id,status:0,headers:{},body:"",send:function(){return r.status<=100||r.status>=999?3:(n.writeHead(r.status,r.headers),n.end(r.body))}};this.listener.onTrouterRequest(i,r)},e.prototype.onConnected=function(e){this.fsm.onConnected(e===this.firstConnection)},e.prototype.onRegistered=function(e){this.fsm.onRegistered(e===this.firstConnection)},e.prototype.onReconnecting=function(e){this.fsm.onReconnecting(e===this.firstConnection)},e.prototype.onReconnectIsRequired=function(e){this.fsm.onReconnectionRequired(e===this.firstConnection)},e.prototype.onDisconnected=function(e){this.fsm.onDisconnected(e===this.storedFirstConnection)},e}();t.TrouterManager=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.logger=e}return e.prototype.getPromise=function(){var e=this;return void 0!==this.url?(this.logger.debug("[TrouterUrlPromise] returning previously resolved url: "+this.url),Promise.resolve(this.url)):(void 0===this.pendingPromise?(this.logger.debug("[TrouterUrlPromise] creating and returning promise"),this.pendingPromise=new Promise(function(t,n){e.pendingPromiseResolveRef=t,e.pendingPromiseRejectRef=n})):this.logger.debug("[TrouterUrlPromise] returning existing promise"),this.pendingPromise)},e.prototype.resolveUrl=function(e){this.url=e,this.logger.debug("[TrouterUrlPromise] got url: "+this.url);var t=this.pendingPromiseResolveRef;this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==t&&(this.logger.debug("[TrouterUrlPromise] resolving promise"),t(e))},e.prototype.rejectUrl=function(e){this.logger.debug("[TrouterUrlPromise] aborting");var t=this.pendingPromiseRejectRef;this.url=void 0,this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==t&&(this.logger.debug("[TrouterUrlPromise] rejecting promise"),t(e))},e.prototype.resetUrl=function(){this.logger.debug("[TrouterUrlPromise] resetting url"),this.url=void 0},e}();t.TrouterUrlPromise=i},function(module,exports,__webpack_require__){(function(global,module){var t,e,n;t=module.exports,e=void 0===global?window:global,n=t,n.version="0.9.6",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(t,i){var r,o,s=n.util.parseUri(t);e&&e.location&&(s.protocol=s.protocol||e.location.protocol.slice(0,-1),s.host=s.host||(e.document?e.document.domain:e.location.hostname),s.port=s.port||e.location.port),r=n.util.uniqueUri(s);var a={host:s.host,secure:"https"==s.protocol,port:s.port||("https"==s.protocol?443:80),query:s.query||""};return n.util.merge(a,i),!a["force new connection"]&&n.sockets[r]||(o=new n.Socket(a)),!a["force new connection"]&&o&&(n.sockets[r]=o),(o=o||n.sockets[r]).of(s.path.length>1?s.path:"")};var io=module.exports;!function(e,t){var n=e.util={},i=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(e){for(var t=i.exec(e||""),n={},o=14;o--;)n[r[o]]=t[o]||"";return n},n.uniqueUri=function(e){var n=e.protocol,i=e.host,r=e.port;return"document"in t?(i=i||document.domain,r=r||("https"==n&&"https:"!==document.location.protocol?443:document.location.port)):(i=i||"localhost",r||"https"!=n||(r=443)),(n||"http")+"://"+i+":"+(r||80)},n.query=function(e,t){var i=n.chunkQuery(e||""),r=[];for(var o in n.merge(i,n.chunkQuery(t||"")),i)i.hasOwnProperty(o)&&r.push(o+"="+i[o]);return r.length?"?"+r.join("&"):""},n.chunkQuery=function(e){for(var t,n={},i=e.split("&"),r=0,o=i.length;r<o;++r)(t=i[r].split("="))[0]&&(n[t[0]]=t[1]);return n};var o=!1;n.load=function(e){if("document"in t&&"complete"===document.readyState||o)return e();n.on(t,"load",e,!1)},n.on=function(e,t,n,i){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,i)},n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}return null},"undefined"!=typeof window&&n.load(function(){o=!0}),n.defer=function(e){if(!n.ua.webkit||"undefined"!=typeof importScripts)return e();n.load(function(){setTimeout(e,100)})},n.merge=function(e,t,i,r){var o,s=r||[],a=void 0===i?2:i;for(o in t)t.hasOwnProperty(o)&&n.indexOf(s,o)<0&&("object"==typeof e[o]&&a?n.merge(e[o],t[o],a-1,s):(e[o]=t[o],s.push(t[o])));return e},n.mixin=function(e,t){n.merge(e.prototype,t.prototype)},n.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},n.intersect=function(e,t){for(var i=[],r=e.length>t.length?e:t,o=e.length>t.length?t:e,s=0,a=o.length;s<a;s++)~n.indexOf(r,o[s])&&i.push(o[s]);return i},n.indexOf=function(e,t,n){var i=e.length;for(n=n<0?n+i<0?0:n+i:n||0;n<i&&e[n]!==t;n++);return i<=n?-1:n},n.toArray=function(e){for(var t=[],n=0,i=e.length;n<i;n++)t.push(e[n]);return t},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(e){return!1}return null!=e.withCredentials}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent)}(void 0!==io?io:module.exports,void 0===global?window:global),function(e,t){function n(){}e.EventEmitter=n,n.prototype.on=function(e,n){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(e,t){function n(){i.removeListener(e,n),t.apply(this,arguments)}var i=this;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,n){if(this.$events&&this.$events[e]){var i=this.$events[e];if(t.util.isArray(i)){for(var r=-1,o=0,s=i.length;o<s;o++)if(i[o]===n||i[o].listener&&i[o].listener===n){r=o;break}if(r<0)return this;i.splice(r,1),i.length||delete this.$events[e]}else(i===n||i.listener&&i.listener===n)&&delete this.$events[e]}return this},n.prototype.removeAllListeners=function(e){return this.$events&&this.$events[e]&&(this.$events[e]=null),this},n.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},n.prototype.emit=function(e){if(!this.$events)return!1;var n=this.$events[e];if(!n)return!1;var i=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,i);else{if(!t.util.isArray(n))return!1;for(var r=n.slice(),o=0,s=r.length;o<s;o++)r[o].apply(this,i)}return!0}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(exports,nativeJSON){"use strict";function f(e){return e<10?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,r,o,s,a=gap,c=t[e];switch(c instanceof Date&&(c=date(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(c)){for(o=c.length,n=0;n<o;n+=1)s[n]=str(n,c)||"null";return r=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,r}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;n<o;n+=1)"string"==typeof rep[n]&&((r=str(i=rep[n],c))&&s.push(quote(i)+(gap?": ":":")+r));else for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(r=str(i,c))&&s.push(quote(i)+(gap?": ":":")+r);return r=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,r}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;i<n;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})},JSON.parse=function(text,reviver){function walk(e,t){var n,i,r=e[t];if(r&&"object"==typeof r)for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(void 0!==(i=walk(r,n))?r[n]=i:delete r[n]);return reviver.call(e,t,r)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}(void 0!==io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(e,t){var n=e.parser={},i=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],r=n.reasons=["transport not supported","client not handshaken","unauthorized"],o=n.advice=["reconnect"],s=t.JSON,a=t.util.indexOf;n.encodePacket=function(e){var t=a(i,e.type),n=e.id||"",c=e.endpoint||"",u=e.ack,l=null;switch(e.type){case"error":var p=e.reason?a(r,e.reason):"",d=e.advice?a(o,e.advice):"";""===p&&""===d||(l=p+(""!==d?"+"+d:""));break;case"message":""!==e.data&&(l=e.data);break;case"event":var f={name:e.name};e.args&&e.args.length&&(f.args=e.args),l=s.stringify(f);break;case"json":l=s.stringify(e.data);break;case"connect":e.qs&&(l=e.qs);break;case"ack":l=e.ackId+(e.args&&e.args.length?"+"+s.stringify(e.args):"")}var h=[t,n+("data"==u?"+":""),c];return null!=l&&h.push(l),h.join(":")},n.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var n=0,i=e.length;n<i;n++)t+="�"+e[n].length+"�"+e[n];return t};var c=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(e){if(!(a=e.match(c)))return{};var t=a[2]||"",n=(e=a[5]||"",{type:i[a[1]],endpoint:a[4]||""});switch(t&&(n.id=t,a[3]?n.ack="data":n.ack=!0),n.type){case"error":var a=e.split("+");n.reason=r[a[0]]||"",n.advice=o[a[1]]||"";break;case"message":n.data=e||"";break;case"event":try{var u=s.parse(e);n.name=u.name,n.args=u.args}catch(e){}n.args=n.args||[];break;case"json":try{n.data=s.parse(e)}catch(e){}break;case"connect":n.qs=e||"";break;case"ack":if((a=e.match(/^([0-9]+)(\+)?(.*)/))&&(n.ackId=a[1],n.args=[],a[3]))try{n.args=a[3]?s.parse(a[3]):[]}catch(e){}}return n},n.decodePayload=function(e){if("�"==e.charAt(0)){for(var t=[],i=1,r="";i<e.length;i++)"�"==e.charAt(i)?(t.push(n.decodePacket(e.substr(i+1).substr(0,r))),i+=Number(r)+1,r=""):r+=e.charAt(i);return t}return[n.decodePacket(e)]}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t){function n(e,t){this.socket=e,this.sessid=t,this.connectErrorCallback=void 0,this.isOpened=!1}e.Transport=n,t.util.mixin(n,t.EventEmitter),n.prototype.onData=function(e){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e){var n=t.parser.decodePayload(e);if(n&&n.length)for(var i=0,r=n.length;i<r;i++)this.onPacket(n[i])}return this},n.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),"error"==e.type&&"reconnect"==e.advice&&(this.isOpened=!1),this.socket.onPacket(e),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.close&&this.isOpened&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this.connectErrorCallback=void 0,this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},n.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.isOpened=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){this.isOpened=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(e,t){t.call(this)},n.prototype.clearEventHandlers=function(){return this}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t,n){function i(e){if(this.options={port:80,secure:!1,document:"document"in n&&document,resource:"socket.io",transports:t.transports.slice(),"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var i=this;t.util.on(n,"unload",function(){i.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function r(){}e.Socket=i,t.util.mixin(i,t.EventEmitter),i.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},i.prototype.publish=function(){var e;for(var t in this.emit.apply(this,arguments),this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t)).$emit.apply(e,arguments)},i.prototype.handshake=function(e){function n(t){t instanceof Error?i.onError(t.message):e.apply(null,t.split(":"))}var i=this,o=this.options,s=["http"+(o.secure?"s":"")+":/",o.host+":"+o.port,o.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS){var a=document.getElementsByTagName("script")[0],c=document.createElement("script");c.src=s+"&jsonp="+t.j.length,a.parentNode.insertBefore(c,a),t.j.push(function(e){n(e),c.parentNode.removeChild(c)})}else{var u=t.util.request();u.open("GET",s,!0),u.withCredentials=!0,u.onreadystatechange=function(){4==u.readyState&&(u.onreadystatechange=r,200==u.status?n(u.responseText):!i.reconnecting&&i.onError(u.responseText))},u.send(null)}},i.prototype.getTransport=function(e){for(var n,i=e||this.transports,r=0;n=i[r];r++)if(t.Transport[n]&&t.Transport[n].check(this)&&(!this.isXDomain()||t.Transport[n].xdomainCheck()))return new t.Transport[n](this,this.sessionid);return null},i.prototype.connect=function(e){if(this.connecting)return this;var n=this;return this.handshake(function(i,r,o,s){function a(){if(!n.connected)if(n.connecting=!1,clearTimeout(n.connectTimeoutTimer),n.options["try multiple transports"]){for(;n.remainingTransports.length>0&&n.remainingTransports.splice(0,1)[0]!=n.transport.name;);n.remainingTransports.length?c(n.remainingTransports):n.publish("connect_failed")}else n.publish("connect_failed")}function c(e){if(n.transport&&(n.transport.clearTimeouts(),n.transport.clearEventHandlers()),n.transport=n.getTransport(e),!n.transport)return n.publish("connect_failed");n.transport.ready(n,function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(a),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){a()},n.options["connect timeout"]))})}n.sessionid=i,n.closeTimeout=1e3*o+2e3,n.heartbeatTimeout=1e3*r+2e3,n.transports=s?t.util.intersect(s.split(","),n.options.transports):n.options.transports,n.setHeartbeatTimeout(),n.remainingTransports=n.transports.slice(0),c(n.transports),n.once("connect",function(){clearTimeout(n.connectTimeoutTimer),e&&"function"==typeof e&&e()})}),this},i.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)},i.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},i.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])},i.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},i.prototype.disconnectSync=function(){var e=t.util.request(),n=this.resource+"/"+t.protocol+"/"+this.sessionid;e.open("GET",n,!0),this.onDisconnect("booted")},i.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},i.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},i.prototype.onOpen=function(){this.open=!0},i.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},i.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},i.prototype.onError=function(e){e&&e.advice&&"reconnect"===e.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},i.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||n)&&(this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},i.prototype.reconnect=function(){function e(){if(n.connected){for(var e in n.namespaces)n.namespaces.hasOwnProperty(e)&&""!==e&&n.namespaces[e].packet({type:"connect"});n.publish("reconnect",n.transport.name,n.reconnectionAttempts)}clearTimeout(n.reconnectionTimer),n.removeListener("connect_failed",t),n.removeListener("connect",t),n.reconnecting=!1,delete n.reconnectionAttempts,delete n.reconnectionDelay,delete n.reconnectionTimer,delete n.redoTransports,n.options["try multiple transports"]=r}function t(){if(n.reconnecting)return n.connected?e():n.connecting&&n.reconnecting?n.reconnectionTimer=setTimeout(t,1e3):void(n.reconnectionAttempts++>=i?n.redoTransports?(n.publish("reconnect_failed"),e()):(n.on("connect_failed",t),n.options["try multiple transports"]=!0,n.transport=n.getTransport(),n.redoTransports=!0,n.connect()):(n.reconnectionDelay<o&&(n.reconnectionDelay*=2),n.connect(),n.publish("reconnecting",n.reconnectionDelay,n.reconnectionAttempts),n.reconnectionTimer=setTimeout(t,n.reconnectionDelay)))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var n=this,i=this.options["max reconnection attempts"],r=this.options["try multiple transports"],o=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(t,this.reconnectionDelay),this.on("connect",t)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t){function n(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new i(this,"json"),this.ackPackets=0,this.acks={}}function i(e,t){this.namespace=e,this.name=t}e.SocketNamespace=n,t.util.mixin(n,t.EventEmitter),n.prototype.$emit=t.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=t),this.packet(n)},n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],i={type:"event",name:e};return"function"==typeof n&&(i.id=++this.ackPackets,i.ack="data",this.acks[i.id]=n,t=t.slice(0,t.length-1)),i.args=t,this.packet(i)},n.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(e){function n(){i.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var i=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var r=["message",e.data];"data"==e.ack?r.push(n):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,r);break;case"event":r=[e.name].concat(e.args);"data"==e.ack&&r.push(n),this.$emit.apply(this,r);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):"unauthorized"==e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},i.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},i.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t,n){function i(e){t.Transport.apply(this,arguments)}function r(){}e.websocket=i,t.util.inherit(i,t.Transport),i.prototype.name="websocket",i.prototype.open=function(e){var i,r=t.util.query(this.socket.options.query),o=this;return this.connectErrorCallback=e,i||(i=n.MozWebSocket||n.WebSocket),this.websocket=new i(this.prepareUrl()+r),this.websocket.onopen=function(){o.onOpen(),o.socket.setBuffer(!1)},this.websocket.onmessage=function(e){o.onData(e.data)},this.websocket.onclose=function(){o.onClose(),o.socket.setBuffer(!0)},this.websocket.onerror=function(e){o.onError(e)},this},i.prototype.send=function(e){return this.websocket.send(e),this},i.prototype.payload=function(e){for(var t=0,n=e.length;t<n;t++)this.packet(e[t]);return this},i.prototype.close=function(){return this.websocket.close(),this},i.prototype.onError=function(e){void 0!==this.connectErrorCallback&&(this.connectErrorCallback(),this.connectErrorCallback=void 0),this.socket.onError(e)},i.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},i.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},i.xdomainCheck=function(){return!0},i.prototype.clearEventHandlers=function(){return this.websocket&&(this.websocket.onopen=this.websocket.onmessage=this.websocket.onclose=this.websocket.onerror=r),this},t.transports.push("websocket")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t,n){function i(e){e&&(t.Transport.apply(this,arguments),this.sendBuffer=[])}function r(){}e.XHR=i,t.util.inherit(i,t.Transport),i.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},i.prototype.payload=function(e){for(var n=[],i=0,r=e.length;i<r;i++)n.push(t.parser.encodePacket(e[i]));this.send(t.parser.encodePayload(n))},i.prototype.send=function(e){return this.post(e),this},i.prototype.post=function(e){var t=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=function(){this.onload=r,t.socket.setBuffer(!1)}:this.sendXHR.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=r,t.posting=!1,200==this.status?(t.socket.setBuffer(!1),clearTimeout(t.sendXHR.ackTimeoutTimer)):t.onClose())},this.sendXHR.send(e),t.sendXHR.ackTimeoutTimer=setTimeout(function(){t.onClose()},t.socket.options.ackTimeoutMs)},i.prototype.close=function(){return this.onClose(),this},i.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),i=t.util.query(this.socket.options.query,"t="+ +new Date);if(n.open(e||"GET",this.prepareUrl()+i,!0),"POST"==e)try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(e){}return n},i.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},i.check=function(e,i){try{var r=t.util.request(i),o=n.XDomainRequest&&r instanceof XDomainRequest,s=(e&&e.options&&e.options.secure?"https:":"http:")!=n.location.protocol;if(r&&(!o||!s))return!0}catch(e){}return!1},i.xdomainCheck=function(){return i.check(null,!0)},i.prototype.clearEventHandlers=function(){return this.sendXHR&&(this.sendXHR.onreadystatechange=this.sendXHR.onload=r),this}}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t,n){function i(){t.Transport.XHR.apply(this,arguments)}function r(){}e["xhr-polling"]=i,t.util.inherit(i,t.Transport.XHR),t.util.merge(i,t.Transport.XHR),i.prototype.name="xhr-polling",i.prototype.open=function(e){return this.connectErrorCallback=e,t.Transport.XHR.prototype.open.call(this),!1},i.prototype.get=function(){if(this.isOpened){var e=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=function(){e.connectErrorCallback=void 0,this.onload=r,this.onerror=r,e.onData(this.responseText),e.get()},this.xhr.onerror=function(){e.onClose(),void 0!==e.connectErrorCallback&&(e.connectErrorCallback(),e.connectErrorCallback=void 0)}):this.xhr.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=r,200==this.status?(e.connectErrorCallback=void 0,e.onData(this.responseText),e.get()):(e.onClose(),void 0!==e.connectErrorCallback&&(e.connectErrorCallback(),e.connectErrorCallback=void 0)))},this.xhr.send(null)}},i.prototype.onClose=function(){if(t.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=r;try{this.xhr.abort()}catch(e){}this.xhr=null}},i.prototype.ready=function(e,n){var i=this;t.util.defer(function(){n.call(i)})},i.prototype.clearEventHandlers=function(){return t.Transport.XHR.prototype.clearEventHandlers.call(this),this.xhr&&(this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=r),this},t.transports.push("xhr-polling")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),exports.io=io}).call(exports,__webpack_require__(4),__webpack_require__(12)(module))},function(e,t,n){(function(t,i){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   4.0.5
 */
!function(t,n){e.exports=n()}(0,function(){"use strict";function e(e){return"function"==typeof e}function r(){var e=setTimeout;return function(){return e(o,1)}}function o(){for(var e=0;e<w;e+=2)(0,R[e])(R[e+1]),R[e]=void 0,R[e+1]=void 0;w=0}function s(e,t){var n=arguments,i=this,r=new this.constructor(c);void 0===r[L]&&_(r);var o=i._state;return o?function(){var e=n[o-1];E(function(){return y(o,r,e,i._result)})}():g(i,r,e,t),r}function a(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(c);return p(t,e),t}function c(){}function u(e){try{return e.then}catch(e){return F.error=e,F}}function l(t,n,i){n.constructor===t.constructor&&i===s&&n.constructor.resolve===a?function(e,t){t._state===U?f(e,t._result):t._state===x?h(e,t._result):g(t,void 0,function(t){return p(e,t)},function(t){return h(e,t)})}(t,n):i===F?h(t,F.error):void 0===i?f(t,n):e(i)?function(e,t,n){E(function(e){var i=!1,r=function(e,t,n,i){try{e.call(t,n,i)}catch(e){return e}}(n,t,function(n){i||(i=!0,t!==n?p(e,n):f(e,n))},function(t){i||(i=!0,h(e,t))},e._label);!i&&r&&(i=!0,h(e,r))},e)}(t,n,i):f(t,n)}function p(e,t){e===t?h(e,new TypeError("You cannot resolve a promise with itself")):function(e){return"function"==typeof e||"object"==typeof e&&null!==e}(t)?l(e,t,u(t)):f(e,t)}function d(e){e._onerror&&e._onerror(e._result),m(e)}function f(e,t){e._state===D&&(e._result=t,e._state=U,0!==e._subscribers.length&&E(m,e))}function h(e,t){e._state===D&&(e._state=x,e._result=t,E(d,e))}function g(e,t,n,i){var r=e._subscribers,o=r.length;e._onerror=null,r[o]=t,r[o+U]=n,r[o+x]=i,0===o&&e._state&&E(m,e)}function m(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var i=void 0,r=void 0,o=e._result,s=0;s<t.length;s+=3)i=t[s],r=t[s+n],i?y(n,i,r,o):r(o);e._subscribers.length=0}}function v(){this.error=null}function y(t,n,i,r){var o=e(i),s=void 0,a=void 0,c=void 0,u=void 0;if(o){if((s=function(e,t){try{return e(t)}catch(e){return j.error=e,j}}(i,r))===j?(u=!0,a=s.error,s=null):c=!0,n===s)return void h(n,new TypeError("A promises callback cannot return that same promise."))}else s=r,c=!0;n._state!==D||(o&&c?p(n,s):u?h(n,a):t===U?f(n,s):t===x&&h(n,s))}function _(e){e[L]=H++,e._state=void 0,e._result=void 0,e._subscribers=[]}function b(e,t){this._instanceConstructor=e,this.promise=new e(c),this.promise[L]||_(this.promise),S(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?f(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&f(this.promise,this._result))):h(this.promise,new Error("Array Methods must be provided an Array"))}function T(e){this[L]=H++,this._result=this._state=void 0,this._subscribers=[],c!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof T?function(e,t){try{t(function(t){p(e,t)},function(t){h(e,t)})}catch(t){h(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}var S=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},w=0,P=void 0,C=void 0,E=function(e,t){R[w]=e,R[w+1]=t,2===(w+=2)&&(C?C(o):N())},O="undefined"!=typeof window?window:void 0,I=O||{},M=I.MutationObserver||I.WebKitMutationObserver,k="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),A="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,R=new Array(1e3),N=void 0;N=k?function(){return t.nextTick(o)}:M?function(){var e=0,t=new M(o),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}():A?function(){var e=new MessageChannel;return e.port1.onmessage=o,function(){return e.port2.postMessage(0)}}():void 0===O?function(){try{var e=n(20);return void 0!==(P=e.runOnLoop||e.runOnContext)?function(){P(o)}:r()}catch(e){return r()}}():r();var L=Math.random().toString(36).substring(16),D=void 0,U=1,x=2,F=new v,j=new v,H=0;return b.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===D&&n<e;n++)this._eachEntry(t[n],n)},b.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===a){var r=u(e);if(r===s&&e._state!==D)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(n===T){var o=new n(c);l(o,e,r),this._willSettleAt(o,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(i(e),t)},b.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===D&&(this._remaining--,e===x?h(i,n):this._result[t]=n),0===this._remaining&&f(i,this._result)},b.prototype._willSettleAt=function(e,t){var n=this;g(e,void 0,function(e){return n._settledAt(U,t,e)},function(e){return n._settledAt(x,t,e)})},T.all=function(e){return new b(this,e).promise},T.race=function(e){var t=this;return new t(S(e)?function(n,i){for(var r=e.length,o=0;o<r;o++)t.resolve(e[o]).then(n,i)}:function(e,t){return t(new TypeError("You must pass an array to race."))})},T.resolve=a,T.reject=function(e){var t=new this(c);return h(t,e),t},T._setScheduler=function(e){C=e},T._setAsap=function(e){E=e},T._asap=E,T.prototype={constructor:T,then:s,catch:function(e){return this.then(null,e)}},T.polyfill=function(){var e=void 0;if(void 0!==i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=T},T.Promise=T,T})}).call(t,n(11),n(4))},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function r(e){if(u===setTimeout)return setTimeout(e,0);if((u===n||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function o(){h&&d&&(h=!1,d.length?f=d.concat(f):g=-1,f.length&&s())}function s(){if(!h){var e=r(o);h=!0;for(var t=f.length;t;){for(d=f,f=[];++g<t;)d&&d[g].run();g=-1,t=f.length}d=null,h=!1,function(e){if(l===clearTimeout)return clearTimeout(e);if((l===i||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{l(e)}catch(t){try{return l.call(null,e)}catch(t){return l.call(this,e)}}}(e)}}function a(e,t){this.fun=e,this.array=t}function c(){}var u,l,p=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:n}catch(e){u=n}try{l="function"==typeof clearTimeout?clearTimeout:i}catch(e){l=i}}();var d,f=[],h=!1,g=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new a(e,t)),1!==f.length||h||r(s)},a.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=c,p.addListener=c,p.once=c,p.off=c,p.removeListener=c,p.removeAllListeners=c,p.emit=c,p.prependListener=c,p.prependOnceListener=c,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(2),o=n(1),s=n(0),a=function(){return function(e){this.id=e,this.status=200,this.headers={},this.body=""}}();t.ResponseData=a,function(e){e.Connected="trouter_js_client_connected",e.Disconnected="trouter_js_client_disconnected",e.Error="trouter_js_client_error",e.Progress="trouter_js_client_progress",e.Response="trouter_js_client_response",e.Request="trouter_js_client_request",e.CheckConnection="trouter_js_client_check_connection",e.Registration="trouter_js_client_registration",e.Unregistration="trouter_js_client_unregistration"}(i=t.ClientEventName||(t.ClientEventName={}));var c=function(){return function(e,t,n,i,r){this.stepName=e,this.operation=t,this.delta=n,this.ts=i,this.error=r}}();t.TrackerStep=c;var u=function(){return function(){}}();t.Properties=u;var l=function(){return function(){this.numberOfPingReplies=0,this.connectedTimestamp=0,this.isNewUrl=!1,this.transportType="",this.connectionNumber=0}}(),p=function(){return function(){this.enabled=!1,this.numberOfStepsToMaintain=40,this.logHealthCheckError=!1,this.sendProgressTimeoutSecs=55,this.logSendPingError=!1,this.maxBackoffInMs=12e4,this.trouter_js_client_connected=!1,this.trouter_js_client_disconnected=!1,this.trouter_js_client_error=!1,this.trouter_js_client_progress=!1,this.trouter_js_client_response=!1,this.trouter_js_client_request=!1,this.trouter_js_client_registration=!1,this.trouter_js_client_unregistration=!1,this.trouter_js_client_check_connection=!0}}(),d=function(){function e(e,t,n,i,o,a){this.clientId=t,this.clientInfo=n,this.getServerState=i,this.clientCorrelationID=o,this.environment=a,this.logger=new s.Logger("ConnectionTracker",e),this.clientCorrelationID=void 0!==o?o:"",this.steps=[],this.connectionAttempt=0,this.totalStepCount=0,this.beginTimestamp=new r.Timespan,this.eventLogSettings=new p,this.connectedInfo=new l}return e.prototype.enable=function(e){this.eventLogSettings.enabled=!0,this.eventLogger=e},e.prototype.disable=function(){this.eventLogSettings.enabled=!1},e.prototype.sendProgress=function(e){this.steps.length>0&&this.sendTelemetry(i.Progress,e,this.steps)},e.prototype.cancelProgressTimer=function(){void 0!==this.progressTimeout&&(clearTimeout(this.progressTimeout),this.progressTimeout=void 0)},e.prototype.resetProgressSendTimer=function(){var e=this;this.cancelProgressTimer(),void 0!==this.eventLogSettings.sendProgressTimeoutSecs&&this.eventLogSettings.sendProgressTimeoutSecs>0&&(this.progressTimeout=setTimeout(function(){e.sendProgress({reason:"timeout",timeoutSecs:e.eventLogSettings.sendProgressTimeoutSecs})},1e3*this.eventLogSettings.sendProgressTimeoutSecs))},e.prototype.setConnectedInfo=function(e,t){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=Date.now(),this.connectedInfo.isNewUrl=e,this.connectedInfo.transportType=t,++this.connectedInfo.connectionNumber},e.prototype.clearConnectedInfo=function(){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=0,this.connectedInfo.isNewUrl=!0,this.connectedInfo.transportType=""},e.prototype.copyProperties=function(e,t){for(var n=0,i=Object.keys(t);n<i.length;n++){var r=i[n];t.hasOwnProperty(r)&&void 0!==t[r]&&(e[r.replace(/-/g,"_")]={value:t[r]})}},e.prototype.increasePingResponseCount=function(){++this.connectedInfo.numberOfPingReplies},e.prototype.sendTelemetry=function(e,t,n){try{if(!0===this.eventLogSettings.enabled&&!0===this.eventLogSettings[e]&&void 0!==this.eventLogger){var i=this.getServerState(),s={name:e,properties:{connectionAttempt:{value:this.connectionAttempt},clientCorrelationID:{value:this.clientCorrelationID},steps:{value:r.toJson(n)},clientID:{value:this.clientId},eventVersion:{value:3},environment:{value:this.environment},cv:{value:o.CLIENT_VERSION},ua:{value:this.clientInfo.ua},connectionId:{value:i.connectionId},connectedClientId:{value:i.connectedClientId},domId:{value:i.domId},url:{value:i.unsecureUrl},surl:{value:i.url},ttlInSecs:{value:i.getRemainingTtlInSec()},numberOfPingReplies:{value:this.connectedInfo.numberOfPingReplies},connectedTimestamp:{value:this.connectedInfo.connectedTimestamp},isNewUrl:{value:this.connectedInfo.isNewUrl},transportType:{value:this.connectedInfo.transportType},connectionNumber:{value:this.connectedInfo.connectionNumber}}};this.copyProperties(s.properties,t),this.eventLogger.logEvent(s)}}catch(t){this.logger.warn("error in sending event "+e+": "+r.toJson(t))}},e.prototype.createStep=function(e,t,n){return new c(e,t,this.beginTimestamp.duration(),Date.now(),n)},e.prototype.addStep=function(e,t,n){if(!1!==this.eventLogSettings.enabled&&(0===this.steps.length&&this.beginTimestamp.reset(),this.steps.push(this.createStep(e,t,n)),++this.totalStepCount,void 0!==this.eventLogSettings.numberOfStepsToMaintain&&this.steps.length>this.eventLogSettings.numberOfStepsToMaintain)){var r=this.steps.slice(0);this.steps.length=0,this.sendTelemetry(i.Progress,{reason:"flush"},r)}},e.prototype.trackStart=function(e){this.addStep(e,"start")},e.prototype.trackEnd=function(e){this.addStep(e,"end")},e.prototype.trackError=function(e,t,n,r){void 0===r&&(r=!1),"health"===e&&!0!==this.eventLogSettings.logHealthCheckError||"ping"===e&&!1===this.eventLogSettings.logSendPingError||(!0===r&&this.addStep(e,t,n),this.sendTelemetry(i.Error,{},[this.createStep(e,t,n)]))},e.prototype.trackProgress=function(e,t){this.addStep(e,t)},e.prototype.trackConnected=function(e,t){this.setConnectedInfo(e,t);var n=this.steps.slice(0),r=this.totalStepCount,o=this.beginTimestamp.duration();this.steps.length=0,this.totalStepCount=0,this.sendTelemetry(i.Connected,{stepCount:n.length,totalStepCount:r,connectionEstablishmentMs_Total:o},n),this.cancelProgressTimer()},e.prototype.trackDisconnected=function(e){e.sessionLengthMS=Date.now()-this.connectedInfo.connectedTimestamp,this.sendTelemetry(i.Disconnected,e,[]),this.resetProgressSendTimer()},e.prototype.trackNewConnection=function(){++this.connectionAttempt},e.prototype.trackRequest=function(e,t){var n={};void 0!==t&&(n.hasError=!0,n.error=t);try{if(e){n.requestID=e.id,n.httpMethod=e.method,n.url=e.url,n.bodyLength=e.body.length,n.shortUrl=e.shortUrl,n.requestTimeStamp=e.startTS;for(var o=e.headers,s=0,a=Object.keys(o);s<a.length;s++){var c=a[s];o.hasOwnProperty(c)&&(n[c]=o[c])}}}catch(e){n.hasError=!0,n.error=n.error+" error creating request context "+r.toJson(e)}this.sendTelemetry(i.Request,n,[])},e.prototype.trackResponse=function(e,t,n,o){var s={};void 0!==o&&(s.hasError=!0,s.error=o);try{if(s.responseTimestamp=void 0!==n?n.sentTS:Date.now(),e){s.requestID=e.id,s.httpMethod=e.method,s.shortUrl=e.shortUrl;for(var a=e.headers,c=0,u=Object.keys(a);c<u.length;c++){var l=u[c];a.hasOwnProperty(l)&&(s[l]=a[l])}}n&&(s.latencyMS=t,s.responseCode=n.status,s.responseLength=n.body.length)}catch(e){s.hasError=!0,s.error=s.error+" error creating response context "+r.toJson(e)}this.sendTelemetry(i.Response,s,[])},e.prototype.sendResponseError=function(e,t,n){this.trackResponse(t,void 0,n,e)},e.prototype.close=function(){this.sendProgress({reason:"closed"}),this.steps.length=0,this.cancelProgressTimer()},e.prototype.mergeSettings=function(e){if(e){this.eventLogSettings.numberOfStepsToMaintain=Math.min(40,Math.max(10,void 0!==e.numberOfStepsToMaintain?e.numberOfStepsToMaintain:0)),this.eventLogSettings.sendProgressTimeoutSecs=Math.min(3600,Math.max(55,void 0!==e.sendProgressTimeoutSecs?e.sendProgressTimeoutSecs:0)),this.eventLogSettings.logHealthCheckError=e.logHealthCheckError,this.eventLogSettings.logSendPingError=e.logSendPingError;for(var t=0,n=Object.keys(i).map(function(e){return i[e]});t<n.length;t++){var r=n[t];e.hasOwnProperty(r)&&void 0!==e[r]&&(this.eventLogSettings[r]=e[r])}this.resetProgressSendTimer()}},e}();t.ConnectionTracker=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.logger=e,this.maxBackoffInMs=t,this.backoffId=0,this.backoffCount=0}return e.calculateNextBackoffMs=function(e,t){var n=1+.4*(Math.random()-.5),i=1e3*Math.pow(2,e)*n;return i=Math.round(i),Math.min(t,i)},e.prototype.setMaxBackoffMs=function(e){this.maxBackoffInMs=e},e.prototype.backoff=function(t,n){var i=this;void 0!==this.timerHandle&&(this.logger.debug("Clearing current back off"),clearTimeout(this.timerHandle),this.timerHandle=void 0);var r=e.calculateNextBackoffMs(this.backoffCount,this.maxBackoffInMs);this.backoffId++,this.backoffCount++,this.logger.info("Backing off "+t+" for "+r+" milliseconds with ID "+this.backoffId),this.timerHandle=setTimeout(function(){i.logger.info("Back off for "+t+" with ID "+i.backoffId+" complete, invoking handler"),i.timerHandle=void 0,n()},r)},e.prototype.reset=function(){void 0!==this.timerHandle&&(this.logger.debug("Resetting back off"),clearTimeout(this.timerHandle),this.timerHandle=void 0),this.backoffCount=0},e}();t.ExponentialBackoff=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=function(){function e(e,t,n,i,r,o){this.connectionId=e,this.connectedClientId=t,this.domId=n,this.unsecureUrl=i,this.url=r,this.expirationTsSec=o}return e.prototype.getRemainingTtlInSec=function(){return i.calculateTtlInSec(this.expirationTsSec)},e}();t.ServerState=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(10),r=n(2),o=n(13),s=n(1),a=n(14),c=n(15),u=n(0),l=n(17),p=n(9),d=function(){return function(){this.cv=s.CLIENT_VERSION,this.ua="",this.hr="",this.v=""}}(),f=function(){return function(){this["force new connection"]=!0,this.reconnect=!1,this.query="",this.ackTimeoutMs=5e3}}(),h=function(){function e(e){var t=JSON.parse(e);this.startTS=t.hasOwnProperty("startTS")?t.startTS:0,this.url=t.hasOwnProperty("url")?t.url:"",this.shortUrl=t.hasOwnProperty("shortUrl")?t.shortUrl:"",this.body=t.hasOwnProperty("body")?t.body:"",this.headers=t.hasOwnProperty("headers")?t.headers:{},this.id=t.hasOwnProperty("id")&&"number"==typeof t.id?t.id:-1,this.method=t.hasOwnProperty("method")?t.method:"",this.replied=!1,this.timedout=!1,this.timeoutTimerId=0}return e.prototype.on=function(e,t){"data"===e?this.dataCallback=t:"end"===e&&("function"==typeof this.dataCallback&&this.dataCallback(this.body),t())},e}(),g=function(){function e(e,t,n){this.request=e,this.responseData=t,this.sendResponse=n}return e.prototype.writeHead=function(e,t){this.responseData.status=e,this.responseData.headers=t},e.prototype.write=function(e){this.responseData.body+=e},e.prototype.end=function(e){return e&&(this.responseData.body+=e),this.sendResponse(this.request,this.responseData)},e}(),m=function(){function e(e,t,n,i){var c=this;this.options=t,this.manager=n,this.tokenProvider=i,this.connectionId="",this.inIncallMode=!1,this.connectionAttempt=0,this.connectedClientId="",this.UNKNOWN_TRANSPORT="unknown_transport",this.logger=new u.Logger("Connection",e),this.timeoutOptions=this.options.timeoutOptions,this.healthBackoff=new a.ExponentialBackoff(this.logger,this.timeoutOptions.maxBackoffMs),this.tokenBackoff=new a.ExponentialBackoff(this.logger,this.timeoutOptions.maxBackoffMs),this.clientID=Date.now(),this.healthUrl=this.options.trouterUrl,"undefined"!=typeof window&&window.location&&(this.domId=window.location.hostname),this.clientInfo=new d,this.clientInfo.cv=s.CLIENT_VERSION,this.clientInfo.ua="",this.options&&this.options.clientInfo&&(this.clientInfo.ua=this.safeString(this.options.clientInfo.ua),this.clientInfo.v=this.safeString(this.options.clientInfo.v)),this.connectionTracker=new o.ConnectionTracker(e,this.clientID,this.clientInfo,function(){return c.getServerState()},this.options.clientCorrelationID,this.options.environment);try{this.options.eventLogger&&"function"==typeof this.options.eventLogger.logEvent?(this.connectionTracker.mergeSettings(this.options.telemetrySettings),this.connectionTracker.enable(this.options.eventLogger)):this.logger.warn("Trouter client event logging disabled due to invalid configuration.")}catch(e){this.connectionTracker.disable(),this.logger.warn("Trouter client event logging disabled. error in initialization: "+r.toJson(e))}var p=this.options.incallModeTimeoutMs>0;this.fsm=new l.TrouterFsm(e,this,p)}return e.prototype.start=function(){this.logger.info("Starting"),this.fsm.start()},e.prototype.stop=function(e){this.logger.info("Stopping"),this.connectionTracker.close(),this.fsm.stop(e)},e.prototype.checkConnection=function(e){this.logger.info("checkConnection called with "+e),this.fsm.checkConnection(e),e&&this.connectionTracker.sendTelemetry(o.ClientEventName.CheckConnection,{disconnectDetected:e},[])},e.prototype.getServerState=function(){return new c.ServerState(this.connectionId,this.connectedClientId,this.domId?this.domId:"",this.allocateResult?this.allocateResult.url:"",this.allocateResult?this.allocateResult.surl:"",this.connectionExpireTimestampInSecs)},e.prototype.getToken=function(e,t){var n=this;this.logger.info("Getting token "+(t?"with backoff":"without backoff"));var i=function(){n.connectionTracker.trackStart("token"),n.tokenProvider(!e).then(function(e){n.logger.debug("token is received"),n.connectionTracker.trackEnd("token"),n.fsm.onTokenReceived(e)}).catch(function(t){var i=r.toJson(t);n.logger.error("Error getting token - retry after timeout: "+i),n.connectionTracker.trackError("token","error",i,!0),n.getToken(e,!0)})};t?this.tokenBackoff.backoff("getting token",i):(this.tokenBackoff.reset(),i())},e.prototype.startConnectionTimer=function(){var e=this;this.logger.debug("Starting connection timeout for "+this.timeoutOptions.connectionTimeoutMs+" ms"),this.connectionTimeoutId=setTimeout(function(){e.logger.info("Connection timeout is fired"),e.fsm.onConnectingTimeout()},this.timeoutOptions.connectionTimeoutMs)},e.prototype.stopConnectionTimer=function(){this.connectionTimeoutId&&(this.logger.debug("Stopping connection timeout"),clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=void 0)},e.prototype.startPingTimer=function(){var e=this;"websocket"===this.transportTypeName?(this.logger.debug("Starting ping timeout for "+this.timeoutOptions.pingTimeoutMs+" ms"),this.pingTimerId=setInterval(function(){e.logger.info("Ping interval fired"),e.fsm.onPingInterval()},this.timeoutOptions.pingTimeoutMs)):this.logger.debug("Not starting ping for transport "+this.transportTypeName)},e.prototype.stopPingTimer=function(){this.pingTimerId&&(this.logger.debug("Stopping ping timeout"),this.clearPingResponseTimer(),clearInterval(this.pingTimerId),this.pingTimerId=void 0)},e.prototype.shouldSkipRegistration=function(){return void 0===this.options.registration},e.prototype.hasCustomRegisterTtl=function(){return this.options.registration&&this.options.registration.registrarTtlSec},e.prototype.startRegisterTimer=function(){var e=this;if(void 0===this.registrationTimerId){var t=this.getRegistrationTtl()-30;this.logger.debug("Starting registration timeout for "+t+" sec"),this.registrationTimerId=setTimeout(function(){e.logger.info("Registration timeout is fired"),e.registrationTimerId=void 0,e.fsm.onRegistrationTimeout()},1e3*t)}else this.logger.error("Another registration timer is set - don't create another one")},e.prototype.stopRegisterTimer=function(){this.registrationTimerId&&(this.logger.debug("Stopping registration timeout"),clearTimeout(this.registrationTimerId),this.registrationTimerId=void 0)},e.prototype.buildSocketIoUrlParams=function(){if(!this.allocateResult)throw new Error("Allocate result is undefined in buildSocketIoUrlParams()");var e={};if(this.allocateResult.connectparams)for(var t=this.allocateResult.connectparams,n=0,i=Object.keys(t);n<i.length;n++){var o=i[n];t.hasOwnProperty(o)&&void 0!==t[o]&&(e[o]=t[o])}return e.v="v4",e.tc=encodeURI(r.toJson(this.clientInfo)),e.timeout=this.timeoutOptions.pingTimeoutMs/1e3,e.auth="true",this.appendConnectedClientIds(this.buildQuery(e),!0)},e.prototype.startSocketIo=function(){var e=this;if(this.logger.info("Starting socket io"),this.connectionTracker.trackStart("connectSocket"),!this.allocateResult)throw new Error("Allocate result is undefined in startSocketIo()");var t=this.options.ioOptions||new f;if(t["force new connection"]=!0,t.reconnect=!1,t.query=this.buildSocketIoUrlParams(),this.logger.info("connecting to "+this.allocateResult.socketio+"?"+t.query),this.stopSocketIo(),this.socket=(this.options.io||p).connect(this.allocateResult.socketio,t),void 0===this.socket)throw new Error("Can't create Socket.io object");this.socket.on("connecting",function(t){e.onSocketConnecting(t)}),this.socket.on("connect",function(){e.onSocketConnect()}),this.socket.on("connect_failed",function(t){e.onSocketConnectFailed(t)}),this.socket.on("disconnect",function(){e.onSocketDisconnect()}),this.socket.on("reconnect",function(){e.onSocketReconnect()}),this.socket.on("reconnect_failed",function(t){e.onSocketReconnectFailed(t)}),this.socket.on("reconnecting",function(){e.onSocketReconnecting()}),this.socket.on("error",function(t){e.onSocketError(t)}),this.socket.on("message",function(t){e.onSocketMessage(t)}),this.socket.on("trouter.connected",function(t){e.onTrouterConnected(t)}),this.socket.on("trouter.reconnect",function(){e.onTrouterReconnect()})},e.prototype.stopSocketIo=function(){if(this.socket){this.logger.info("clearing socket.io");try{for(var e=0,t=["connecting","connect","connect_failed","disconnect","reconnect","reconnect_failed","reconnecting","error","message","trouter.connected","trouter.reconnect"];e<t.length;e++){var n=t[e];this.socket.removeAllListeners(n)}this.socket.disconnect(),this.logger.debug("cleared socket"),this.socket=void 0}catch(e){this.logger.error("exception in disconnecting previous socket: "+r.toJson(e.stack))}}},e.prototype.dispatchConnected=function(){this.logger.info("dispatching connected"),this.manager.onConnected(this)},e.prototype.dispatchRegistered=function(){this.logger.info("dispatching connected"),this.manager.onRegistered(this)},e.prototype.dispatchDownstreamRequest=function(e){var t=this;this.logger.info("dispatching downstream request");try{var n=new g(e,new o.ResponseData(e.id),function(e,n){return t.logger.info("sending response to downstream"),t.sendResponse(e,n)});this.manager.onDownstreamRequest(this,e,n)}catch(e){this.logger.error("exception in socket.on message: "+r.toJson(e.stack))}},e.prototype.dispatchReconnecting=function(){this.logger.info("dispatching reconnecting"),this.manager.onReconnecting(this)},e.prototype.dispatchReconnectIsRequired=function(){this.logger.info("dispatching reconnect is required by server"),this.manager.onReconnectIsRequired(this)},e.prototype.dispatchDisconnected=function(){this.logger.info("dispatching disconnected"),this.manager.onDisconnected(this)},e.prototype.resetAllocationConnectionParams=function(){this.allocateResult&&(this.logger.info("Resetting allocation connection parameters"),this.allocateResult.connectparams=void 0)},e.prototype.sendAllocateRequest=function(e){var t=this;this.connectionAttempt++,this.connectionTracker.trackNewConnection();var n=this.appendCorrelationIds(this.options.trouterUrl,!1);this.allocateResult&&this.allocateResult.connectparams&&(n+="&"+this.buildQuery(this.allocateResult.connectparams),this.allocateResult.connectparams.v||(n+="&v=v4"));var i=new Request(n,{method:"POST",mode:"cors",headers:new Headers({"X-Skypetoken":e,"Content-Type":"text/plain"})});this.logger.info("sendAllocateRequest: POST "+n),this.connectionTracker.trackStart("allocation"),this.fetchWithTimeout(i,this.timeoutOptions.fetchTimeoutMs).then(function(e){if(401===e.status)throw{message:e.statusText||"Request not authorized",status:401};if(200!==e.status)throw new Error("Response status "+e.status+" "+e.statusText);var n=e.headers.get("content-type");if(!n||"application/json"!==n&&"application/json;"!==n.substring(0,17))throw new Error("Content-type "+n+" is unexpected");return t.connectionTracker.trackEnd("allocation"),e.json()}).then(function(e){t.onAllocationResponse(e)}).catch(function(e){t.logger.error("Allocation request failed with "+e.message),t.connectionTracker.trackError("allocation","end",e.message,!0),t.fsm.onAllocationFailed(e.status&&401===e.status)})},e.prototype.sendPingRequest=function(){var e=this;if(this.socket&&void 0===this.pingResponseTimerId)try{this.logger.info("emitting ping event"),this.socket.emit("ping",function(){e.onPingResponse()}),this.pingResponseTimerId=setTimeout(function(){e.logger.error("Ping response timeout is fired"),e.clearPingResponseTimer(),e.fsm.onPingResponseTimeout()},this.timeoutOptions.pongTimeoutMs)}catch(e){var t=r.toJson(e.stack);this.logger.error("unable to send ping, error: "+t),this.connectionTracker.trackError("ping","send",t)}},e.prototype.sendRegisterRequest=function(e){var t=this;this.logger.info("sending register request");var n=new r.Timespan;if(!this.options.registration)throw new Error("Internal error - options.registration is undefined");if(!this.allocateResult)throw new Error("Allocate result is undefined in sendRegisterRequest()");var i={clientDescription:{appId:this.options.registration.pnhAppId,aesKey:"",languageId:"en-US",platform:this.options.registration.platform,templateKey:this.options.registration.pnhTemplateKey,platformUIVersion:this.options.registration.platformUIVersion},registrationId:this.options.registration.registrationId,nodeId:"",transports:{TROUTER:[{context:"",path:this.allocateResult.surl,ttl:this.getRegistrationTtl()}]}},s=new Request(this.options.registration.registrarUrl,{method:"POST",mode:"cors",headers:new Headers({"X-Skypetoken":e,"content-type":"application/json",accept:"application/json, text/javascript"}),body:r.toJson(i)});this.connectionTracker.trackStart("registration"),this.fetchWithTimeout(s,this.timeoutOptions.fetchTimeoutMs).then(function(e){e.ok?(t.logger.info("onRegisterResponse: status "+e.status),t.connectionTracker.trackEnd("registration"),t.fsm.onRegistrationSucceed()):(t.logger.error("Error status in register response: "+e.status),t.connectionTracker.trackError("registration","registration",e.status.toString()),t.fsm.onRegistrationFailed(401===e.status)),t.connectionTracker.sendTelemetry(o.ClientEventName.Registration,{status:e.status,duration:n.duration()},[])}).catch(function(e){t.logger.error("Error while sending register request: "+e.message),t.fsm.onRegistrationFailed(!1),t.connectionTracker.sendTelemetry(o.ClientEventName.Registration,{status:-1,duration:n.duration()},[])})},e.prototype.sendUnregisterRequest=function(e){var t=this;this.logger.info("sending unregister request");var n=new r.Timespan;if(!this.options.registration)throw new Error("Internal error - options.registration is undefined");var i=new Request(this.options.registration.registrarUrl+"/"+this.options.registration.registrationId,{method:"DELETE",mode:"cors",headers:new Headers({"X-Skypetoken":e,accept:"application/json, text/javascript"})});this.connectionTracker.trackStart("unregistration"),this.fetchWithTimeout(i,this.timeoutOptions.fetchTimeoutMs).then(function(e){e.ok?(t.logger.info("onUnregisterResponse: status "+e.status),t.connectionTracker.trackEnd("unregistration"),t.fsm.onUnregistrationSucceed()):(t.logger.error("Error status in unregister response: "+e.status),t.connectionTracker.trackError("unregistration","unregistration",e.status.toString()),t.fsm.onUnregistrationFailed(401===e.status)),t.connectionTracker.sendTelemetry(o.ClientEventName.Unregistration,{status:e.status,duration:n.duration()},[])}).catch(function(e){t.logger.error("Error while sending unregister request: "+e.message),t.fsm.onUnregistrationFailed(!1),t.connectionTracker.sendTelemetry(o.ClientEventName.Unregistration,{status:-1,duration:n.duration()},[])})},e.prototype.fetchWithTimeout=function(e,t){return new i.Promise(function(n,i){fetch(e).then(n).catch(i),0!==t&&setTimeout(i,t,new Error("Fetch for '"+e.url+"' timed out"))})},e.prototype.sendHealthRequest=function(e){var t=this;this.logger.info("sending health request "+(e?"with backoff":"without backoff"));var n=new Request(this.healthUrl,{method:"POST",mode:"cors",headers:new Headers}),i=function(){t.logger.info("sendHealthRequest: POST "+n.url),t.connectionTracker.trackStart("health"),t.fetchWithTimeout(n,t.timeoutOptions.fetchTimeoutMs).then(function(e){if(!e.ok)throw new Error("Response status "+e.status+" "+e.statusText);t.connectionTracker.trackEnd("health"),t.logger.info("Health check request succeed"),t.fsm.onHealthSucceed()}).catch(function(e){t.logger.error("Health check request failed with "+e.message),t.connectionTracker.trackEnd("health"),t.connectionTracker.trackError("health","health error",e.message),t.fsm.onHealthFailed()})};e?this.healthBackoff.backoff("health request",i):(this.healthBackoff.reset(),i())},e.prototype.resetHealthBackoff=function(){this.healthBackoff.reset()},e.prototype.resetTokenBackoff=function(){this.tokenBackoff.reset()},e.prototype.restartIncallModeTimer=function(){var e=this;this.clearIncallModeTimerId(),this.logger.debug("Restarting incall mode timer"),this.incallModeTimerId=setTimeout(function(){e.logger.info("Call mode timer fired"),e.fsm.onIncallModeTimer()},this.options.incallModeTimeoutMs)},e.prototype.enterIncallMode=function(){this.logger.info("Entering incall mode"),this.timeoutOptions=this.options.incallTimeoutOptions,this.healthBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!0},e.prototype.exitIncallMode=function(){this.logger.info("Exiting incall mode"),this.clearIncallModeTimerId(),this.timeoutOptions=this.options.timeoutOptions,this.healthBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!1},e.prototype.isIncallMode=function(){return this.inIncallMode},e.prototype.onSocketConnecting=function(e){this.logger.info("onSocketConnecting("+e+")"),this.transportTypeName=e,this.connectionTracker.trackProgress("connecting",this.transportTypeName),this.fsm.onConnecting()},e.prototype.onSocketConnect=function(){this.logger.info("onSocketConnect")},e.prototype.onSocketConnectFailed=function(e){this.logger.error("onSocketConnectFailed"),this.connectionTracker.trackError("connect_failed",this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT,e,!0),this.fsm.onConnectingFailed()},e.prototype.onSocketDisconnect=function(){this.logger.error("onSocketDisconnect"),this.connectionTracker.trackDisconnected({serverClosed:!this.fsm.isActive()}),this.connectionTracker.clearConnectedInfo(),this.fsm.onSocketError(void 0),this.connectionExpireTimestampInSecs=void 0},e.prototype.onSocketReconnect=function(){this.logger.error("onSocketReconnect"),this.fsm.onTrouterConnected()},e.prototype.onSocketReconnectFailed=function(e){this.logger.error("onSocketReconnectFailed with '"+e+"'"),this.fsm.onSocketError("string"==typeof e?e:void 0)},e.prototype.onSocketReconnecting=function(){this.logger.error("onSocketReconnecting")},e.prototype.onSocketError=function(e){this.logger.error("onSocketError with '"+r.toJson(e)+"'"),this.connectionTracker.trackError("connectSocket","socketio.error",e,!0),this.fsm.onSocketError("string"==typeof e?e:void 0)},e.prototype.onSocketMessage=function(e){var t,n=this;this.logger.info("onSocketMessage");try{var i=(t=new h(e)).headers&&t.headers["X-Microsoft-Skype-Chain-ID"],s=i?" Chain-Id "+i:"";this.logger.info("Received request N "+t.id+s+" to '"+t.url+"'"),t.startTS=Date.now(),t.url&&this.urlPath&&0===t.url.indexOf(this.urlPath)&&(t.shortUrl=t.url.substring(this.urlPath.length))}catch(e){var a=r.toJson(e.stack);return this.logger.error("unable to parse request, error: "+a),this.connectionTracker.trackRequest(void 0,a),void this.connectionTracker.sendResponseError("unable to parse request, error: "+e.message)}t.timeoutTimerId=setTimeout(function(){if(!t.replied){n.logger.error("Request "+t.id+" timed out");var e=new o.ResponseData(t.id);e.status=504,e.headers={"Trouter-Responder":"ClientLib"},n.sendResponse(t,e),t.timedout=!0}},this.timeoutOptions.requestTimeoutMs);try{this.connectionTracker.trackRequest(t),this.fsm.onDownstreamRequest(t)}catch(e){this.logger.error("exception in socket.on message: "+r.toJson(e.stack)),this.connectionTracker.sendResponseError(e.message,t,void 0)}},e.prototype.onTrouterConnected=function(e){if(this.allocateResult){this.logger.info("onTrouterConnected: "+this.allocateResult.url),this.socket&&this.socket.socket&&this.socket.socket.options&&this.socket.socket.options.query&&(this.socket.socket.options.query+="&connected=true"),this.urlPath=this.allocateResult.url.replace(/https?:\/\/([A-z0-9\:\$\-\_\.\+\!\*\"\(\)\,]*)\//,"/");var t=this.connectedUrl!==this.allocateResult.url;this.connectedUrl=this.allocateResult.url,this.connectionExpireTimestampInSecs=r.calculateExpireTsInSec(e.ttl),this.connectionTracker.trackEnd("connectSocket"),this.connectionTracker.trackConnected(t,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),this.fsm.onTrouterConnected()}else this.logger.error("Invalid internal state - received onTrouterConnected while allocateResult is not set")},e.prototype.onTrouterReconnect=function(){this.logger.info("onTrouterReconnect"),this.fsm.onReconnectRequired()},e.prototype.onAllocationResponse=function(e){this.logger.info("Received allocation response"),this.allocateResult=e;var t=+e.ttl;this.connectionExpireTimestampInSecs=r.calculateExpireTsInSec(t),this.connectionId=this.allocateResult.id||"",this.allocateResult.healthUrl?this.healthUrl=this.allocateResult.healthUrl:(this.healthUrl=this.getHealthUrl(this.options.trouterUrl),this.logger.warn("No healthUrl property found when parsing allocation.")),this.connectedClientId=this.allocateResult.ccid,this.logger.info("connected client id set {connectedClientId:"+this.connectedClientId+"}"),this.healthUrl=this.appendConnectedClientIds(this.healthUrl,!1),this.fsm.onAllocationSucceed()},e.prototype.onPingResponse=function(){this.logger.info("onPingResponse"),this.connectionTracker.increasePingResponseCount(),this.clearPingResponseTimer(),this.fsm.onPingResponse()},e.prototype.clearPingResponseTimer=function(){void 0!==this.pingResponseTimerId&&(clearTimeout(this.pingResponseTimerId),this.pingResponseTimerId=void 0)},e.prototype.buildQuery=function(e){for(var t=[],n=0,i=Object.keys(e);n<i.length;n++){var r=i[n];e.hasOwnProperty(r)&&void 0!==e[r]&&t.push(r+"="+e[r])}return t.join("&")},e.prototype.appendConnectedClientIds=function(e,t){var n="";e.indexOf("ccid=")<0&&(n="ccid="+this.connectedClientId+"&"),this.domId&&(n+="dom="+this.domId+"&"),n.length>0&&(n=n.slice(0,-1));var i=t||-1!==e.indexOf("?")?"&":"?";return this.appendCorrelationIds(e+i+n,t)},e.prototype.appendCorrelationIds=function(e,t){var n=t||-1!==e.indexOf("?")?"&":"?";return e.indexOf("cor_id")<0?""+e+n+"cor_id="+this.options.clientCorrelationID+"&con_num="+this.clientID+"_"+this.connectionAttempt:e},e.prototype.getHealthUrl=function(e){return e.substring(0,e.lastIndexOf("/a"))+"/h"},e.prototype.safeString=function(e){return"string"==typeof e?e:""},e.prototype.sendResponse=function(e,t){if(e.timedout)return this.logger.error("Request "+e.id+" already timed out"),1;if(e.replied)return this.logger.error("Response for request "+e.id+" already sent"),2;clearTimeout(e.timeoutTimerId),e.timeoutTimerId=0,e.replied=!0,this.logger.info("Sending response for request N "+e.id+" with status "+t.status),t.headers=t.headers||{},e.headers&&e.headers["trouter-request"]&&!t.headers["trouter-request"]&&(t.headers["trouter-request"]=e.headers["trouter-request"]);var n=Date.now()-e.startTS;if(t.headers["trouter-client"]=r.toJson({cd:n}),this.logger.debug("response: "+r.toJson(t)),!this.socket)return this.connectionTracker.sendResponseError("no socket",e,t),4;try{return this.socket.send(r.toJson(t)),t.sentTS=Date.now(),this.connectionTracker.trackResponse(e,n,t),"websocket"===this.transportTypeName&&this.sendPingRequest(),0}catch(n){var i="unable to send data on response.end, err: "+r.toJson(n.stack);return this.connectionTracker.sendResponseError(i,e,t),this.logger.error(i),4}},e.prototype.getRegistrationTtl=function(){var e=r.calculateTtlInSec(this.connectionExpireTimestampInSecs);return this.logger.debug("Current connectionID will expire in "+e+" seconds"),this.options.registration&&this.options.registration.registrarTtlSec&&e>0?Math.min(this.options.registration.registrarTtlSec,e):this.options.registration&&this.options.registration.registrarTtlSec?this.options.registration.registrarTtlSec:e>0?e:3600},e.prototype.clearIncallModeTimerId=function(){void 0!==this.incallModeTimerId&&(this.logger.debug("Clearing in-call mode timer"),clearTimeout(this.incallModeTimerId),this.incallModeTimerId=void 0)},e}();t.TrouterConnection=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r,o=n(0);!function(e){e[e.Initial=0]="Initial",e[e.RetrievingToken=1]="RetrievingToken",e[e.Allocating=2]="Allocating",e[e.Handshaking=3]="Handshaking",e[e.Connecting=4]="Connecting",e[e.Connected=5]="Connected",e[e.CheckingHealth=6]="CheckingHealth",e[e.UnregisteringRetrievingToken=7]="UnregisteringRetrievingToken",e[e.Unregistering=8]="Unregistering"}(i=t.State||(t.State={})),function(e){e[e.Initial=0]="Initial",e[e.RetrievingToken=1]="RetrievingToken",e[e.Registering=2]="Registering",e[e.Registered=3]="Registered",e[e.NotRegistered=4]="NotRegistered"}(r||(r={}));var s=function(){function e(e,t,n){this.worker=t,this.incallModeEnabled=n,this.state=i.Initial,this.isAllocateResultValid=!1,this.connectionErrors=0,this.logger=new o.Logger("ConnectionFsm",e),this.connectedSubstate=r.Initial}return e.prototype.getState=function(){return this.state},e.prototype.isActive=function(){return this.state===i.Allocating||this.state===i.CheckingHealth||this.state===i.Connected||this.state===i.Handshaking||this.state===i.Connecting||this.state===i.RetrievingToken},e.prototype.start=function(){return this.state===i.Initial?(this.setState(i.RetrievingToken),this.worker.getToken(!0,!1),!0):(this.showIgnored("start"),!1)},e.prototype.stop=function(e){e&&(this.connectedSubstate=r.Initial),this.worker.isIncallMode()&&this.worker.exitIncallMode(),this.worker.resetHealthBackoff(),this.worker.resetTokenBackoff(),this.state!==i.Connecting&&this.state!==i.Handshaking&&this.state!==i.Connected&&this.state!==i.CheckingHealth||this.worker.stopSocketIo(),this.isRegistered()?(this.setState(i.UnregisteringRetrievingToken),this.worker.stopRegisterTimer(),this.worker.getToken(!0,!1)):(this.setState(i.Initial),this.worker.dispatchDisconnected())},e.prototype.onTokenReceived=function(e){this.state===i.RetrievingToken?(this.setState(i.Allocating),this.worker.sendAllocateRequest(e)):this.state===i.Connected&&this.connectedSubstate===r.RetrievingToken?(this.connectedSubstate=r.Registering,this.worker.sendRegisterRequest(e)):this.state===i.UnregisteringRetrievingToken?(this.setState(i.Unregistering),this.worker.sendUnregisterRequest(e)):this.showIgnored("onTokenReceived")},e.prototype.checkConnection=function(e){e?this.onPingInterval():this.onHealthSucceed()},e.prototype.onAllocationSucceed=function(){return this.state===i.Allocating?(this.isAllocateResultValid=!0,this.setState(i.Handshaking),this.connectedSubstate=r.Initial,this.worker.startSocketIo(),!0):this.state===i.CheckingHealth?(this.isAllocateResultValid=!0,this.setState(i.Handshaking),this.worker.startConnectionTimer(),this.connectedSubstate=r.Initial,this.worker.startSocketIo(),!0):(this.showIgnored("onAllocationSucceed"),!1)},e.prototype.onAllocationFailed=function(e){this.state===i.Allocating?(this.setState(i.RetrievingToken),this.worker.stopConnectionTimer(),this.worker.getToken(!e,!0)):this.showIgnored("onAllocationFailed")},e.prototype.onConnectingTimeout=function(){this.state===i.Allocating||this.state===i.Connecting||this.state===i.Handshaking?(this.setState(i.CheckingHealth),this.resetAllocationIfNecessary(void 0),this.worker.sendHealthRequest(!1)):this.showIgnored("onConnectingTimeout")},e.prototype.onConnecting=function(){this.state===i.Handshaking?this.setState(i.Connecting):this.showIgnored("onConnecting")},e.prototype.onConnectingFailed=function(){this.state===i.Connecting?this.onConnectingTimeout():this.state===i.Handshaking?(this.logger.error("Unexpected error in Socket.io - no valid transports"),this.onConnectingTimeout()):this.showIgnored("onConnectingFailed")},e.prototype.onSocketError=function(e){this.state===i.Handshaking?(this.setState(i.CheckingHealth),this.worker.resetAllocationConnectionParams(),this.resetAllocationIfNecessary(e),this.worker.sendHealthRequest(!1)):this.state===i.Connected?(this.setState(i.CheckingHealth),this.worker.dispatchReconnecting(),this.resetAllocationIfNecessary(e),this.worker.sendHealthRequest(!1)):this.showIgnored("onSocketError")},e.prototype.onHealthSucceed=function(){this.state===i.CheckingHealth?(this.worker.stopSocketIo(),this.isAllocateResultValid?(this.logger.info("Allocation exists - connecting"),this.setState(i.Handshaking),this.worker.startConnectionTimer(),this.worker.startSocketIo()):(this.logger.info("Allocation doesn't exists - start with getting token"),this.setState(i.RetrievingToken),this.worker.getToken(!0,!0))):this.showIgnored("onHealthSucceed")},e.prototype.onHealthFailed=function(){this.state===i.CheckingHealth?this.worker.sendHealthRequest(!0):this.showIgnored("onHealthFailed")},e.prototype.onTrouterConnected=function(){this.state===i.Connecting||this.state===i.CheckingHealth?(this.setState(i.Connected),this.isAllocateResultValid=!0,this.worker.resetTokenBackoff(),this.worker.stopConnectionTimer(),this.connectionErrors=0,this.worker.shouldSkipRegistration()?(this.connectedSubstate=r.NotRegistered,this.worker.dispatchRegistered()):(this.connectedSubstate=r.RetrievingToken,this.worker.getToken(!0,!1))):this.showIgnored("onTrouterConnected")},e.prototype.onReconnectRequired=function(){this.worker.dispatchReconnectIsRequired()},e.prototype.onDownstreamRequest=function(e){this.state===i.Connected?(this.switchToIncallModeIfEnabled(),this.worker.dispatchDownstreamRequest(e)):this.state===i.CheckingHealth?(this.setState(i.Connected),this.switchToIncallModeIfEnabled(),this.worker.dispatchDownstreamRequest(e)):this.showIgnored("onDownstreamRequest")},e.prototype.onPingInterval=function(){this.state===i.Connected?this.worker.sendPingRequest():this.showIgnored("onPingInterval")},e.prototype.onPingResponseTimeout=function(){this.state===i.Connected?(this.setState(i.CheckingHealth),this.worker.dispatchReconnecting(),this.worker.sendHealthRequest(!1)):this.showIgnored("onPingResponseTimeout")},e.prototype.onPingResponse=function(){this.state===i.CheckingHealth?this.setState(i.Connected):this.state===i.Connected||this.showIgnored("onPingResponse")},e.prototype.onRegistrationFailed=function(e){this.state===i.Connected&&this.connectedSubstate===r.Registering?(this.connectedSubstate=r.RetrievingToken,this.worker.getToken(!e,!0)):this.showIgnored("onRegistrationFailed")},e.prototype.onRegistrationSucceed=function(){this.state===i.Connected?(this.connectedSubstate===r.Registering&&(this.connectedSubstate=r.Registered,this.worker.dispatchRegistered()),this.worker.hasCustomRegisterTtl()&&this.worker.startRegisterTimer()):this.showIgnored("onRegistrationSucceed")},e.prototype.onRegistrationTimeout=function(){this.state===i.Connected&&this.connectedSubstate!==r.NotRegistered?(this.connectedSubstate=r.RetrievingToken,this.worker.getToken(!0,!1)):this.showIgnored("onRegistrationTimeout")},e.prototype.onUnregistrationFailed=function(e){this.state===i.Unregistering?(this.setState(i.UnregisteringRetrievingToken),this.worker.getToken(!e,!e)):this.showIgnored("onUnregistrationFailed")},e.prototype.onUnregistrationSucceed=function(){this.state===i.Unregistering?(this.setState(i.Initial),this.worker.dispatchDisconnected()):this.showIgnored("onUnregistrationSucceed")},e.prototype.onIncallModeTimer=function(){this.worker.exitIncallMode(),this.state===i.Connected?(this.worker.stopPingTimer(),this.worker.startPingTimer()):this.showIgnored("onIncallModeTimer")},e.prototype.showIgnored=function(e){this.logger.debug("Ignoring event '"+e+"' in state '"+i[this.state]+"'")},e.prototype.setState=function(e){this.logger.info("Switching from state '"+i[this.state]+"' to state '"+i[e]+"'"),this.state!==e?(this.onStateExit(this.state),this.state=e,this.onStateEnter(this.state)):this.logger.error("Attempt to switching into the current state '"+i[e]+"'")},e.prototype.onStateExit=function(e){e===i.Connected&&this.worker.stopPingTimer()},e.prototype.onStateEnter=function(e){e===i.Connected?(this.worker.startPingTimer(),this.worker.dispatchConnected()):e===i.CheckingHealth?this.worker.stopConnectionTimer():e===i.Allocating&&this.worker.startConnectionTimer()},e.prototype.resetAllocationIfNecessary=function(e){this.connectionErrors++,this.connectionErrors>=2||void 0!==e&&/^4\d\d /.test(e)?(this.logger.error("Connection error count is "+this.connectionErrors+" - will reset allocation"),this.connectionErrors=0,this.isAllocateResultValid=!1):this.logger.info("Connection error count is "+this.connectionErrors+" - will NOT reset allocation")},e.prototype.isRegistered=function(){return this.connectedSubstate===r.Registered||this.connectedSubstate===r.Registering},e.prototype.switchToIncallModeIfEnabled=function(){this.incallModeEnabled&&(this.worker.isIncallMode()||(this.worker.enterIncallMode(),this.worker.stopPingTimer(),this.worker.startPingTimer()),this.worker.restartIncallModeTimer())},e}();t.TrouterFsm=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(0),o=function(){function e(e,t){this.worker=t,this.state=i.TrouterState.Unknown,this.logger=new r.Logger("ManagerFsm",e)}return e.prototype.start=function(){this.state===i.TrouterState.Unknown?(this.setState(i.TrouterState.Disconnected),this.worker.startFirstConnection()):this.showIgnored("start")},e.prototype.stop=function(){this.state!==i.TrouterState.Unknown?(this.setState(i.TrouterState.Unknown),this.worker.stopFirstConnection(!1),this.worker.stopSecondConnection(!1)):this.showIgnored("stop")},e.prototype.getState=function(){return this.state},e.prototype.onConnected=function(e){this.state===i.TrouterState.Disconnected&&e?this.worker.doesSecondConnectionExist()?this.setState(i.TrouterState.Switching):(this.setState(i.TrouterState.Connected),this.worker.dispatchConnected()):this.showIgnored("onConnected("+e+")")},e.prototype.onRegistered=function(e){this.state===i.TrouterState.Disconnected&&!e||this.state===i.TrouterState.Switching&&!e?(this.setState(i.TrouterState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnection(!0),this.worker.dispatchConnected()):this.showIgnored("onRegistered("+e+")")},e.prototype.onReconnecting=function(e){this.state===i.TrouterState.Connected&&e?(this.setState(i.TrouterState.Disconnected),this.worker.dispatchReconnecting()):this.state===i.TrouterState.Switching&&e?(this.setState(i.TrouterState.Disconnected),this.worker.dispatchReconnecting()):this.showIgnored("onReconnecting("+e+")")},e.prototype.onReconnectionRequired=function(e){this.state===i.TrouterState.Connected&&e?(this.setState(i.TrouterState.Switching),this.worker.startSecondConnection()):this.state===i.TrouterState.Disconnected&&e?this.worker.startSecondConnection():this.showIgnored("onReconnectionRequired("+e+")")},e.prototype.onDisconnected=function(e){this.state===i.TrouterState.Unknown&&e?this.worker.dispatchStopped():this.showIgnored("onDisconnected("+e+")")},e.prototype.showIgnored=function(e){this.logger.info("Ignoring event '"+e+"' in state '"+i.TrouterState[this.state]+"'")},e.prototype.setState=function(e){this.logger.info("Switching from state '"+i.TrouterState[this.state]+"' to state '"+i.TrouterState[e]+"'"),this.state!==e?this.state=e:this.logger.error("Attempt to switching into the current state '"+i.TrouterState[e]+"'")},e}();t.TrouterManagerFsm=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(3);t.TrouterState=r.TrouterState;var o=n(5),s=n(6),a=n(7),c=n(8),u=function(){function e(e){this.logger=e,this.stateChangedListeners=[],this.trouterUrlPromise=new c.TrouterUrlPromise(e),this.messageHandlers=new o.MessageHandlerRegistry(e),this.listeners={},this.connectionInfo=null,this.logger.info("Created TrouterService version "+i.CLIENT_VERSION)}return e.prototype.start=function(e){if(this.logger.info("Start"),!e.trouterSettings.disableInternalSkypeTokenCache){var t=e.skypeTokenProvider;e.skypeTokenProvider=s.addCacheAsBackupTo(t)}void 0===this.trouterServer&&(this.trouterServer=new a.TrouterManager(this.logger,function(e){return{clientInfo:{ua:e.trouterSettings.productName,v:e.trouterSettings.version},ioOptions:{ackTimeoutMs:5e3},clientCorrelationID:e.trouterSettings.sessionId,environment:e.trouterSettings.environment,telemetrySettings:e.telemetryConfig.settings,eventLogger:e.telemetryConfig.eventLogger,trouterUrl:e.trouterSettings.trouterServiceUrl,registration:e.trouterSettings.registrarServiceUrl?{registrarUrl:e.trouterSettings.registrarServiceUrl,registrationId:e.trouterSettings.registrationId||"",pnhAppId:e.trouterSettings.pnhAppId||"",platform:e.trouterSettings.platform||"",pnhTemplateKey:e.trouterSettings.pnhTemplate||"",platformUIVersion:e.trouterSettings.platformUIVersion||"",registrarTtlSec:(e.trouterSettings.maxRegistrationTimeInMs||0)/1e3}:void 0,timeoutOptions:e.trouterSettings.timeoutOptions||{connectionTimeoutMs:e.trouterSettings.trouterConnectTimeoutInMs||3e4,fetchTimeoutMs:1e4,pingTimeoutMs:4e4,pongTimeoutMs:5e3,maxBackoffMs:3e4,requestTimeoutMs:5e3},incallTimeoutOptions:e.trouterSettings.incallTimeoutOptions||{connectionTimeoutMs:1e4,fetchTimeoutMs:5e3,pingTimeoutMs:5e3,pongTimeoutMs:2e3,maxBackoffMs:1e4,requestTimeoutMs:5e3},incallModeTimeoutMs:e.trouterSettings.incallModeTimeoutMs||0}}(e),e.skypeTokenProvider,this)),this.trouterServer.start()},e.prototype.stop=function(){this.logger.log("[Trouter] close connection"),this.trouterUrlPromise.rejectUrl(new Error("TrouterSerice is stopped")),void 0!==this.trouterServer&&this.trouterServer.stop()},e.prototype.checkConnection=function(e){void 0!==this.trouterServer&&this.trouterServer.checkConnection(e||!1)},e.prototype.registerListener=function(e,t){return""===t||"/"!==t[0]||t.indexOf("?")>=0||t.indexOf("#")>=0?(this.logger.error("Listener path '"+t+"' is not valid"),!1):this.listeners[t]?(this.logger.error("Another listener is already registered for path '"+t+"'"),!1):(this.listeners[t]=e,this.logger.debug("Listener for path '"+t+"' registered"),this.connectionInfo&&e.onTrouterConnected(this.connectionInfo.baseEndpointUrl+t,this.connectionInfo),!0)},e.prototype.unregisterListener=function(e){for(var t=[],n=0,i=Object.keys(this.listeners);n<i.length;n++){var r=i[n];this.listeners[r]===e&&t.push(r)}if(0===t.length)return!1;for(var o=0,s=t;o<s.length;o++){r=s[o];delete this.listeners[r]}return this.logger.debug("Listener for path(s) '"+t.join("', '")+"' unregistered"),!0},e.prototype.onTrouterConnected=function(e,t){this.logger.debug("Trouter is now connected");for(var n=0,i=Object.keys(this.listeners);n<i.length;n++){var o=i[n];try{this.listeners[o].onTrouterConnected(t.baseEndpointUrl+o,t)}catch(e){this.logger.error("Listener '"+o+"' threw an exception from onTrouterConnected(): "+e)}}this.connectionInfo=t,this.trouterUrlPromise.resolveUrl(e),this.notifyStateChanged(r.TrouterState.Connected,{url:e,getRemainingTtlInSec:function(){return t.connectionTtlSec}})},e.prototype.onTrouterDisconnected=function(){this.logger.debug("Trouter is now disconnected"),this.connectionInfo=null;for(var e=0,t=Object.keys(this.listeners);e<t.length;e++){var n=t[e],i=this.listeners[n].onTrouterDisconnected;if(i)try{i()}catch(e){this.logger.error("Listener '"+n+"' threw an exception from onTrouterDisconnected(): "+e)}}this.notifyStateChanged(r.TrouterState.Disconnected)},e.prototype.onTrouterRequest=function(e,t){for(var n="",i=0,r=Object.keys(this.listeners);i<r.length;i++){var o=r[i];e.path.substring(0,o.length)===o&&o.length>n.length&&(n=o)}if(""===n)this.tryMessageHandlers(e,t)||(t.status=404,t.headers={"Trouter-Responder":"ClientLib"},t.send());else try{this.listeners[n].onTrouterRequest(e,t)}catch(e){this.logger.error("Listener '"+n+"' threw an exception from onTrouterRequest(): "+e),t.status=500,t.headers={"Trouter-Responder":"ClientLib"},t.send()}},e.prototype.state=function(){return void 0!==this.trouterServer?this.trouterServer.getState():r.TrouterState.Unknown},e.prototype.getServerState=function(){if(void 0!==this.trouterServer)return this.trouterServer.getServerState()},e.prototype.getTrouterUrlAsync=function(){return void 0!==this.trouterServer?this.trouterUrlPromise.getPromise():Promise.reject(new Error("TrouterService has not been started"))},e.prototype.onStateChanged=function(e){if(this.logger.info("onStateChanged called"),void 0===e)this.stateChangedListeners=this.stateChangedListeners.filter(function(e){return void 0===e.wrappedCallback});else{this.offStateChanged(e);var t=function(t,n){e(t,n?n.url:"")};t.wrappedCallback=e,this.stateChangedListeners.push(t)}},e.prototype.offStateChanged=function(e){this.logger.info("offStateChanged called");var t=this.stateChangedListeners.length;return this.stateChangedListeners=this.stateChangedListeners.filter(function(t){return t.wrappedCallback!==e}),t>this.stateChangedListeners.length},e.prototype.addCallback=function(e){this.logger.info("addListener called"),-1===this.stateChangedListeners.indexOf(e,0)&&void 0!==e&&this.stateChangedListeners.push(e)},e.prototype.removeCallback=function(e){this.logger.info("removeListener called");var t=this.stateChangedListeners.indexOf(e,0);return t>-1&&(this.stateChangedListeners.splice(t,1),!0)},e.prototype.registerMessageHandler=function(e){this.logger.info("registerMessageHandler is called"),this.messageHandlers.register(e)},e.prototype.clearMessageHandlers=function(){this.logger.info("clearMessageHandlers is called"),this.messageHandlers.clear()},e.prototype.notifyStateChanged=function(e,t){var n=this;this.logger.info("notifyStateChanged called, will forward to "+this.stateChangedListeners.length+" listeners"),this.stateChangedListeners.forEach(function(i){try{i(e,t)}catch(e){n.logger.error("Error in callback "+e)}})},e.prototype.tryMessageHandlers=function(e,t){if(!this.messageHandlers.active())return!1;var n,i=null;try{i=(n=JSON.parse(e.body))&&(n.evt||n.eventId)||null}catch(e){}var r={eventId:i,url:(this.connectionInfo?this.connectionInfo.baseEndpointUrl:"")+e.path,body:n,rawBody:e.body,headers:e.headers},o=this.messageHandlers.handleMessage(r);return!!o.isHandled&&(t.status=o.resultCode,o.responseHeaders&&(t.headers=o.responseHeaders),o.responseBody&&(t.body=o.responseBody),t.send(),!0)},e}();t.TrouterService=u,t.createTrouterService=function(e){return new u(e)},t.getTrouterServiceVersion=function(){return i.CLIENT_VERSION}},function(e,t){}])},module.exports=e()}).call(this,__webpack_require__(52))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(258),o=i.Configuration.USER_OPTIONS_SERVICE.PROD+"options/v1/users/self/options",s=function(){function e(){}return e.prototype.fetchUserOption=function(e){var t=o+"/"+e;return new Promise(function(e,n){r.get("fetchUserOption",encodeURI(t)).then(function(t){t&&t.code?50300===t.code||50100===t.code||40100===t.code||n(t):e(t)},function(e){n(e)})})},e.prototype.fetchUserOptionsBatch=function(e){if(!e.length)return null;var t=o+"?names="+e.join(",");return new Promise(function(e,n){r.get("fetchUserOptionsBatch",encodeURI(t)).then(function(t){t&&t.code?50300===t.code||50100===t.code||40100===t.code||n(t):e(t)},function(e){n(e)})})},e.prototype.setUserOption=function(e){var t=o+"/"+e.name,n={value:e.value};return new Promise(function(e,i){r.putData("setUserOption",t,JSON.stringify(n)).then(function(t){t&&202===t.status?e(t):i(t)},function(e){i(e)})})},e.prototype.setUserOptionsBatch=function(e){var t={options:e};return r.post("setUserOptionsBatch",o,JSON.stringify(t)).then(function(e){},function(e){})},e}();t.UserOptionsService=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(12),o=n(5),s=n(10),a={retryCount:3,timeout:12e4,policy:""},c=function(e,t,n){return s.default("userOptions-"+e,a,t,n)},u=function(){return new Promise(function(e,t){return o.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=new Headers({"x-microsoft-skype-chain-id":i.default.get.correlationId,"x-microsoft-skype-message-id":r.guid.generate(),"x-skypetoken":t,Accept:"application/json","Content-Type":"application/json"});e(n)})})};t.post=function(e,t,n){return u().then(function(i){return c(e,t,{method:"POST",cache:"no-cache",headers:i,body:n}).then(function(e){return e.json()})})},t.putData=function(e,t,n){return u().then(function(i){var r={method:"PUT"};return r.body=n,r.headers=i,s.default("userOptions-"+e,a,t,r)})},t.get=function(e,t){return u().then(function(n){var i={method:"GET"};return i.headers=n,c(e,t,i).then(function(e){return e.json()})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(260),o=n(262),s=function(){function e(e,t){this.aadTokenProvider=e,this.cache=t,this._storedSettings={},this._defaultSettingsService=new r.DefaultUserPolicyService,this._requestPromises={}}return e.prototype.getMessagingPolicy=function(){return this._getSettings("messagingPolicy")},e.prototype.getCallingPolicy=function(){return this._getSettings("callingPolicy")},e.prototype.getUserPolicies=function(){return this._getSettings("policySettings")},e.prototype.getUpgradePolicy=function(){var e=this;if(this._storedUpgradePolicy)return Promise.resolve(this._storedUpgradePolicy);var t=this.cache.get("teamsUpgradePolicy");return t?(this._storedUpgradePolicy=t,Promise.resolve(t)):this._fetchTeamsUpgradePolicy().then(function(t){return e._storedUpgradePolicy=t,e.cache.set("teamsUpgradePolicy",t),t})},e.prototype._getSettings=function(e){var t=this,n=this._getStoredSettings(e);return n?Promise.resolve(n):this._fetchSettings(e).then(function(n){return n?(t._storeSettings(e,n),n):t._getDefaultSettings(e)})},e.prototype._getStoredSettings=function(e){if(!this._storedSettings[e]){var t=this.cache.get(e);t&&(this._storedSettings[e]=t)}return this._storedSettings[e]},e.prototype._storeSettings=function(e,t){this.cache.set(e,t),this._storedSettings[e]=t},e.prototype._fetchSettings=function(e){var t,n=this;if(!this._requestPromises[e]){var r=i.Configuration.TEAMS_PROFILE_URL+"api/mt/amer/beta/users/useraggregatesettings",s=((t={})[e]=!0,t);this._requestPromises[e]=o.post("useraggregatesettings",r,JSON.stringify(s),this.aadTokenProvider).then(function(t){var i=t[e];return delete n._requestPromises[e],i.value}).catch(function(){delete n._requestPromises[e]})}return this._requestPromises[e]},e.prototype._fetchTeamsUpgradePolicy=function(){var e=i.Configuration.TEAMS_PROFILE_URL+"api/mt/amer/beta/me/settings/teamsupgradev2";return o.get("useraggregatesettings",e,this.aadTokenProvider).then(function(e){return e.value})},e.prototype._getDefaultSettings=function(e){return this._defaultSettingsService.getDefaultPolicy(e)},e}();t.TeamsUserPolicyService=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(261),r=function(){function e(){this._defaultPolicy={messagingPolicy:{allowOwnerEditMessage:!1,allowOwnerDeleteMessage:!1,allowUserEditMessage:!1,allowUserDeleteMessage:!1,allowUserChat:!1,allowGiphy:!1,allowUserTranslation:!1,giphyRatingType:i.GiphyRatingType.Strict,allowMemes:!1,allowStickers:!1,readReceiptsEnabledType:i.ReadReceiptsEnabledType.None},callingPolicy:{allowPrivateCalling:!1,allowGroupCalling:!1,allowCallForwarding:!1,allowCallForwardingToPhone:!1,allowCallForwardingToUser:!1,allowCallGroups:!1,allowDelegation:!1,allowVoicemail:"AlwaysDisabled"}}}return e.prototype.getDefaultPolicy=function(e){return this._defaultPolicy[e]},e}();t.DefaultUserPolicyService=r},function(e,t,n){"use strict";var i,r,o,s,a,c,u,l,p,d,f,h;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Strict=0]="Strict",e[e.Moderate=1]="Moderate",e[e.NoRestriction=2]="NoRestriction"}(t.GiphyRatingType||(t.GiphyRatingType={})),function(e){e.Everyone="Everyone",e.None="None",e.UserPreference="UserPreference"}(t.ReadReceiptsEnabledType||(t.ReadReceiptsEnabledType={})),function(e){e[e.Success=0]="Success",e[e.Warning=1]="Warning",e[e.Error=2]="Error"}(i||(i={})),function(e){e[e.Unknown=0]="Unknown",e[e.InvalidArguments=1]="InvalidArguments",e[e.AccessDenied=2]="AccessDenied",e[e.BadRequest=3]="BadRequest",e[e.Forbidden=4]="Forbidden",e[e.GatewayTimeout=5]="GatewayTimeout",e[e.NotFound=6]="NotFound",e[e.SharepointSiteNotExists=7]="SharepointSiteNotExists",e[e.UserNotFound=8]="UserNotFound",e[e.UserNotFoundInSkypeTeam=9]="UserNotFoundInSkypeTeam",e[e.GroupExceededMaxSupportedNestedGroups=10]="GroupExceededMaxSupportedNestedGroups",e[e.GroupExceededMaxSupportedTeamMembers=11]="GroupExceededMaxSupportedTeamMembers",e[e.TeamNotFound=12]="TeamNotFound",e[e.ThreadNotFound=13]="ThreadNotFound",e[e.TeamOwnerNotFound=14]="TeamOwnerNotFound",e[e.TeamGroupIdMissing=15]="TeamGroupIdMissing",e[e.ChannelsRosterFailed=16]="ChannelsRosterFailed",e[e.MaxChannelLimitExceeded=17]="MaxChannelLimitExceeded",e[e.FileDoesNotExist=18]="FileDoesNotExist",e[e.FileLocked=19]="FileLocked",e[e.OneNoteNotAvailable=20]="OneNoteNotAvailable",e[e.GetPersonalSiteUrlError=21]="GetPersonalSiteUrlError",e[e.NotesSectionCreationError=22]="NotesSectionCreationError",e[e.GroupNotesStartedButNotFinishedYet=23]="GroupNotesStartedButNotFinishedYet",e[e.MissingTeamSmtpAddress=24]="MissingTeamSmtpAddress",e[e.UpdateTeamMembershipInExchangeFailed=25]="UpdateTeamMembershipInExchangeFailed",e[e.UpdateTeamMembershipInSkypeFailed=26]="UpdateTeamMembershipInSkypeFailed",e[e.UpdateBotTeamMembershipInSkypeFailed=27]="UpdateBotTeamMembershipInSkypeFailed",e[e.UpdateTeamMembershipFailed=28]="UpdateTeamMembershipFailed",e[e.ChannelThreadNotExist=29]="ChannelThreadNotExist",e[e.ChannelNameAlreadyExist=30]="ChannelNameAlreadyExist",e[e.MaxChannelNameCharacterLimitExceeded=31]="MaxChannelNameCharacterLimitExceeded",e[e.MaxChannelDescriptionCharacterLimitExceeded=32]="MaxChannelDescriptionCharacterLimitExceeded",e[e.MaxTeamNameCharacterLimitExceeded=33]="MaxTeamNameCharacterLimitExceeded",e[e.MaxTeamDescriptionCharacterLimitExceeded=34]="MaxTeamDescriptionCharacterLimitExceeded",e[e.InvalidTeamName=35]="InvalidTeamName",e[e.UserIsNotOwnerToPerformMigration=36]="UserIsNotOwnerToPerformMigration",e[e.GroupHasMoreMemberThanSkypeTeamsSupports=37]="GroupHasMoreMemberThanSkypeTeamsSupports",e[e.InvalidChannelName=38]="InvalidChannelName",e[e.UpdateChannelNameFailed=39]="UpdateChannelNameFailed",e[e.UpdateChannelDescriptionFailed=40]="UpdateChannelDescriptionFailed",e[e.ChannelNameUpdateToTeamThreadFailed=41]="ChannelNameUpdateToTeamThreadFailed",e[e.CreateChannelThreadFailed=42]="CreateChannelThreadFailed",e[e.CreateChatThreadFailed=43]="CreateChatThreadFailed",e[e.NotAbleToGetChannelThreadAfterCreating=44]="NotAbleToGetChannelThreadAfterCreating",e[e.DeleteChannelThreadFailed=45]="DeleteChannelThreadFailed",e[e.UnableToFetchTeamThread=46]="UnableToFetchTeamThread",e[e.GetUnifiedGroupMembersInExchangeFailed=47]="GetUnifiedGroupMembersInExchangeFailed",e[e.NotImplemented=48]="NotImplemented",e[e.CreateTeamInExchangeNotAuthorized=49]="CreateTeamInExchangeNotAuthorized",e[e.CreateTeamInSkypeFailed=50]="CreateTeamInSkypeFailed",e[e.CreateTeamInExchangeFailed=51]="CreateTeamInExchangeFailed",e[e.UnableToGenerateUniqueAlias=52]="UnableToGenerateUniqueAlias",e[e.TeamCreationInProgress=53]="TeamCreationInProgress",e[e.UpdateTeamInSkypeFailed=54]="UpdateTeamInSkypeFailed",e[e.UpdateTeamInExchangeFailed=55]="UpdateTeamInExchangeFailed",e[e.DeleteTeamNotAuthorized=56]="DeleteTeamNotAuthorized",e[e.DeleteTeamFailedChannelNotFound=57]="DeleteTeamFailedChannelNotFound",e[e.DeleteTeamFailedSettingTopicsProperty=58]="DeleteTeamFailedSettingTopicsProperty",e[e.DeleteTeamFailedRemovingInitiator=59]="DeleteTeamFailedRemovingInitiator",e[e.DeletingTeamInExchangeFailed=60]="DeletingTeamInExchangeFailed",e[e.DeletingTeamInSkypeFailed=61]="DeletingTeamInSkypeFailed",e[e.DeletingTeamSettingStatusPropertyFailed=62]="DeletingTeamSettingStatusPropertyFailed",e[e.AadGetUserCallFailed=63]="AadGetUserCallFailed",e[e.AadUserSearchCallFailed=64]="AadUserSearchCallFailed",e[e.AadGroupsSearchCallFailed=65]="AadGroupsSearchCallFailed",e[e.AadGroupMembersCallFailed=66]="AadGroupMembersCallFailed",e[e.AadGetProfilePictureCallFailed=67]="AadGetProfilePictureCallFailed",e[e.ChatProfilePictureCallFailed=68]="ChatProfilePictureCallFailed",e[e.ExchangeGetProfilePictureCallFailed=69]="ExchangeGetProfilePictureCallFailed",e[e.ExchangeSetProfilePictureCallFailed=70]="ExchangeSetProfilePictureCallFailed",e[e.ExchangeFindPeopleCallFailed=71]="ExchangeFindPeopleCallFailed",e[e.ExchangeInvalidLicense=72]="ExchangeInvalidLicense",e[e.ErrorNonExistentMailbox=73]="ErrorNonExistentMailbox",e[e.ExchangeAccessDenied=74]="ExchangeAccessDenied",e[e.ExchangeOrganizationAccessBlocked=75]="ExchangeOrganizationAccessBlocked",e[e.OrgChartGetManagerAadCallFailed=76]="OrgChartGetManagerAadCallFailed",e[e.JsonResponseParsingFailed=77]="JsonResponseParsingFailed",e[e.GetMyPropertiesFailed=78]="GetMyPropertiesFailed",e[e.GetUserPropertiesFailed=79]="GetUserPropertiesFailed",e[e.SetMyPropertyFailed=80]="SetMyPropertyFailed",e[e.ReconcileExchangeTeamStatusInvalid=81]="ReconcileExchangeTeamStatusInvalid",e[e.ReconcileExchangeTeamFailed=82]="ReconcileExchangeTeamFailed",e[e.MaximumTeamMembersLimitReached=83]="MaximumTeamMembersLimitReached",e[e.MaximumTeamOwnersLimitReached=84]="MaximumTeamOwnersLimitReached",e[e.MemberIsNotAdminToPerformOperation=85]="MemberIsNotAdminToPerformOperation",e[e.OperationDeniedAsMemberIsLastMemberInTeam=86]="OperationDeniedAsMemberIsLastMemberInTeam",e[e.OperationDeniedAsMemberIsLastAdminInTeam=87]="OperationDeniedAsMemberIsLastAdminInTeam",e[e.MSGraphRequestThrottled=88]="MSGraphRequestThrottled",e[e.MSGraphGetGroupWithFilterFailed=89]="MSGraphGetGroupWithFilterFailed",e[e.MSGraphGetGroupMembersFailed=90]="MSGraphGetGroupMembersFailed",e[e.MSGraphGetGroupOwnersFailed=91]="MSGraphGetGroupOwnersFailed",e[e.MSGraphAddGroupMemberFailed=92]="MSGraphAddGroupMemberFailed",e[e.MSGraphAddGroupOwnerFailed=93]="MSGraphAddGroupOwnerFailed",e[e.GroupOwnersLimitExceeded=94]="GroupOwnersLimitExceeded",e[e.MSGraphRemoveGroupMemberFailed=95]="MSGraphRemoveGroupMemberFailed",e[e.MSGraphRemoveGroupOwnerFailed=96]="MSGraphRemoveGroupOwnerFailed",e[e.MSGraphGetGroupUsersFailed=97]="MSGraphGetGroupUsersFailed",e[e.ExchangeTeamNotProvisionedGroupIdMissing=98]="ExchangeTeamNotProvisionedGroupIdMissing",e[e.ThreadIsNotSpaceOrTopic=99]="ThreadIsNotSpaceOrTopic",e[e.ThreadUpgradeForTopicThreadFailed=100]="ThreadUpgradeForTopicThreadFailed",e[e.ThreadUpgradeForSpaceThreadFailed=101]="ThreadUpgradeForSpaceThreadFailed",e[e.ThreadUpgradeFailedCalledOnWrongObject=102]="ThreadUpgradeFailedCalledOnWrongObject",e[e.ConversationUpgradeForSpaceThreadFailed=103]="ConversationUpgradeForSpaceThreadFailed",e[e.ConversationUpgradeFailedCalledOnWrongObject=104]="ConversationUpgradeFailedCalledOnWrongObject",e[e.ConversationUpgradeFailedToSetUserSubscriberState=105]="ConversationUpgradeFailedToSetUserSubscriberState",e[e.InvalidUserId=106]="InvalidUserId",e[e.AadGroupCreationLimitExceeded=107]="AadGroupCreationLimitExceeded",e[e.MsGraphReplicationUnavailable=108]="MsGraphReplicationUnavailable",e[e.SkypeTeamCreationFailed=109]="SkypeTeamCreationFailed",e[e.MigratingToSkypeTeamFailed=110]="MigratingToSkypeTeamFailed",e[e.AadGroupDeletionFailed=111]="AadGroupDeletionFailed",e[e.AadGetUserGroupsFailed=112]="AadGetUserGroupsFailed",e[e.AadGetUserGroupsFailedMailboxTemporaryUnavailable=113]="AadGetUserGroupsFailedMailboxTemporaryUnavailable",e[e.AadGetGroupMembersFailed=114]="AadGetGroupMembersFailed",e[e.AadGetGroupOwnersFailed=115]="AadGetGroupOwnersFailed",e[e.AadSmtpAddressMissing=116]="AadSmtpAddressMissing",e[e.GetTeamMembersFailed=117]="GetTeamMembersFailed",e[e.BotNotFound=118]="BotNotFound",e[e.BotsNotSupportedInChannels=119]="BotsNotSupportedInChannels",e[e.UpdateBotRoleNotSupported=120]="UpdateBotRoleNotSupported",e[e.GetPeopleFailed=121]="GetPeopleFailed",e[e.GetSuggestedGroupsFromExchangeFailed=122]="GetSuggestedGroupsFromExchangeFailed",e[e.GetAllGroupsFailed=123]="GetAllGroupsFailed",e[e.FindingGroupsFailed=124]="FindingGroupsFailed",e[e.FeatureDisabled=125]="FeatureDisabled",e[e.SkypeTeamsStoreAreSkypeTeamsFailed=126]="SkypeTeamsStoreAreSkypeTeamsFailed",e[e.ExchangeMailboxTemporaryUnavailable=127]="ExchangeMailboxTemporaryUnavailable",e[e.GetTenantSettingsFailed=128]="GetTenantSettingsFailed",e[e.SetTenantSettingsFailed=129]="SetTenantSettingsFailed",e[e.InvalidEndDateInRecurrence=130]="InvalidEndDateInRecurrence",e[e.InvalidPatternPropertiesInRecurrence=131]="InvalidPatternPropertiesInRecurrence",e[e.MissingCorrectRecurrencePatternObject=132]="MissingCorrectRecurrencePatternObject",e[e.CalendarEventCreationFailedInExchange=133]="CalendarEventCreationFailedInExchange",e[e.CalendarEventDeletionFailedInExchange=134]="CalendarEventDeletionFailedInExchange",e[e.CalendarEventCancellationFailedInExchange=135]="CalendarEventCancellationFailedInExchange",e[e.CalendarEventUpdateFailedInExchange=136]="CalendarEventUpdateFailedInExchange",e[e.InvalidCancelEventRequest=137]="InvalidCancelEventRequest",e[e.CalendarEventRespondFailure=138]="CalendarEventRespondFailure",e[e.SharepointResponseFailure=139]="SharepointResponseFailure",e[e.DeepLinkTypeNotSupported=140]="DeepLinkTypeNotSupported",e[e.DocumentLibraryNotFound=141]="DocumentLibraryNotFound",e[e.DocumentLibrarySettingsNotFound=142]="DocumentLibrarySettingsNotFound",e[e.UserMailboxDoesNotExist=143]="UserMailboxDoesNotExist",e[e.TaskCanceled=144]="TaskCanceled",e[e.CalendarEventNotFound=145]="CalendarEventNotFound",e[e.GetTeamOutgoingWebhooksFailed=146]="GetTeamOutgoingWebhooksFailed",e[e.SetTeamOutgoingWebhooksFailed=147]="SetTeamOutgoingWebhooksFailed",e[e.RemoveTeamOutgoingWebhookFailed=148]="RemoveTeamOutgoingWebhookFailed",e[e.GetOutgoingWebhookConfigurationFailed=149]="GetOutgoingWebhookConfigurationFailed",e[e.SetOutgoingWebhookConfigurationFailed=150]="SetOutgoingWebhookConfigurationFailed",e[e.GetEmailAddressDetailsFailed=151]="GetEmailAddressDetailsFailed",e[e.GetChannelSettingsFailed=152]="GetChannelSettingsFailed",e[e.ProvisionEmailAddressFailed=153]="ProvisionEmailAddressFailed",e[e.EmailAddressAlreadyProvisioned=154]="EmailAddressAlreadyProvisioned",e[e.TeamCachedPropertiesNotFound=155]="TeamCachedPropertiesNotFound",e[e.GetTeamAppEntitlementsFailed=156]="GetTeamAppEntitlementsFailed",e[e.SetTeamAppEntitlementFailed=157]="SetTeamAppEntitlementFailed",e[e.RemoveTeamAppEntitlementFailed=158]="RemoveTeamAppEntitlementFailed",e[e.GetUserAppEntitlementsFailed=159]="GetUserAppEntitlementsFailed",e[e.SetUserAppEntitlementFailed=160]="SetUserAppEntitlementFailed",e[e.RemoveUserAppEntitlementFailed=161]="RemoveUserAppEntitlementFailed",e[e.GetTeamAppDefinitionsFailed=162]="GetTeamAppDefinitionsFailed",e[e.SetTeamAppDefinitionFailed=163]="SetTeamAppDefinitionFailed",e[e.RemoveTeamAppDefinitionFailed=164]="RemoveTeamAppDefinitionFailed",e[e.GetUserAppDefinitionsFailed=165]="GetUserAppDefinitionsFailed",e[e.SetUserAppDefinitionFailed=166]="SetUserAppDefinitionFailed",e[e.RemoveUserAppDefinitionFailed=167]="RemoveUserAppDefinitionFailed",e[e.GetAppDefinitionFailed=168]="GetAppDefinitionFailed",e[e.UserAlreadyExists=169]="UserAlreadyExists",e[e.UserAlreadyExistsInTeam=170]="UserAlreadyExistsInTeam"}(r||(r={})),function(e){e[e.RequiredOutsideScheduleMeeting=0]="RequiredOutsideScheduleMeeting",e[e.NotRequired=1]="NotRequired",e[e.AlwaysRequired=2]="AlwaysRequired"}(o||(o={})),function(e){e[e.Immediate=0]="Immediate",e[e.Simultaneous=1]="Simultaneous"}(s||(s={})),function(e){e[e.Voicemail=0]="Voicemail",e[e.SingleTarget=1]="SingleTarget",e[e.MyDelegates=2]="MyDelegates"}(a||(a={})),function(e){e[e.Regular=0]="Regular",e[e.CallQueue=1]="CallQueue",e[e.CallGroup=2]="CallGroup",e[e.Delegate=3]="Delegate"}(c||(c={})),function(e){e[e.Ring=0]="Ring",e[e.Bop=1]="Bop",e[e.Bounce=2]="Bounce",e[e.Bubbles=3]="Bubbles",e[e.DripDrop=4]="DripDrop",e[e.Eureka=5]="Eureka",e[e.Flutter=6]="Flutter",e[e.HighScore=7]="HighScore",e[e.NextLevel=8]="NextLevel",e[e.Plink=9]="Plink",e[e.RingRing=10]="RingRing",e[e.Ripple=11]="Ripple",e[e.Spacetime=12]="Spacetime",e[e.WishGranted=13]="WishGranted",e[e.Wobble=14]="Wobble"}(u||(u={})),function(e){e[e.Unknown=0]="Unknown",e[e.Online=1]="Online",e[e.OnPrem=2]="OnPrem"}(l||(l={})),function(e){e[e.Unknown=0]="Unknown",e[e.Online=1]="Online",e[e.OnPrem=2]="OnPrem"}(p||(p={})),function(e){e[e.Default=0]="Default",e[e.Immediately=1]="Immediately",e[e.Every10Mins=2]="Every10Mins",e[e.Hourly=3]="Hourly",e[e.EveryEightHours=4]="EveryEightHours",e[e.Daily=5]="Daily",e[e.Never=6]="Never"}(d||(d={})),function(e){e[e.All=0]="All",e[e.CallMentionChats=1]="CallMentionChats",e[e.Off=2]="Off"}(f||(f={})),function(e){e[e.Unknown=0]="Unknown",e[e.Teacher=1]="Teacher",e[e.Student=2]="Student"}(h||(h={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(30),o=n(10),s={retryCount:3,timeout:12e4,policy:""},a=function(e,t,n){return o.default("teamsmiddleware-"+e,s,t,n)};t.post=function(e,n,i,r){return t.getHeaders(r).then(function(t){return a(e,n,{method:"POST",cache:"no-cache",headers:t,body:i}).then(function(e){return e.json()})})},t.get=function(e,n,i){return t.getHeaders(i).then(function(t){return a(e,n,{method:"GET",cache:"no-cache",headers:t}).then(function(e){return e.json()})})},t.getHeaders=function(e){return e(r.AadAudience.SpacesApi).then(function(e){return e=0===e.toLowerCase().indexOf("bearer")?e:"Bearer "+e,new Headers({Authorization:e,"x-skype-client":i.Configuration.getClientVersion(),Accept:"application/json","Content-Type":"application/json"})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(11),r=n(264),o=function(){function e(e){var t=this;this.client=e,this._userProfiles={},this.resolve=function(e){var n=[];return e.forEach(function(e){t._userProfiles[e.mri].resolve(e),n.push(e)}),n},this._requestQueue=new r.BatchQueue(function(e){return t.getUsers(e)},{timeout:200})}return e.prototype.cleanUpUnresolved=function(e){var t=this;e.forEach(function(e){t._userProfiles[e]&&t._userProfiles[e].status!==i.PromiseStatus.Resolved&&(t._userProfiles[e].cancel(),delete t._userProfiles[e])})},e.prototype.getExisting=function(e){var t=this,n=[];return e.forEach(function(e){t._userProfiles[e]&&n.push(t._userProfiles[e].promise)}),Promise.all(n)},e.prototype.getUser=function(e){return this._userProfiles[e]||(this._userProfiles[e]=new i.CancelablePromise,this._requestQueue.push(e)),this._userProfiles[e].promise},e.prototype.getUsers=function(e){var t=this,n=e.filter(function(e){return!t._userProfiles[e]||t._userProfiles[e].status!==i.PromiseStatus.Resolved});return n.forEach(function(e){t._userProfiles[e]=t._userProfiles[e]||new i.CancelablePromise}),n.length>0?this.client.getUsers(n).then(this.resolve).then(function(){return t.cleanUpUnresolved(e)}).then(function(){return t.getExisting(e)}):Promise.resolve(this.getExisting(e))},e}();t.UserService=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(46),r=function(){function e(e,t){void 0===t&&(t={});var n=this;this.onFlush=e,this.options=t,this._items=[],this._flush=function(){n.onFlush(n._items),delete n._items,n._items=[]},this.flush=i(this._flush,this.options.timeout||500)}return e.prototype.push=function(e){this._items.push(e),this.flush()},e}();t.BatchQueue=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(25),r=n(11),o=n(0),s=n(12),a=function(){function e(e){this.viewports=[],this.requests={},this.callbacks=[],this.options=e||{}}return Object.defineProperty(e.prototype,"all",{get:function(){return this.viewports},enumerable:!0,configurable:!0}),e.prototype.byGroup=function(e,t){var n="string"==typeof e?[e]:e;return(t||this.viewports).filter(function(e){return 1!==n.indexOf(e.options.group)})},e.prototype.byType=function(e,t){var n="string"==typeof e?[e]:e;return(t||this.viewports).filter(function(e){return-1!==n.indexOf(e.options.type)})},e.prototype.byName=function(e,t){return(t||this.viewports).filter(function(t){return t.options.name===e})[0]},e.prototype.byChild=function(e){var t=function(t){return t&&16&t.compareDocumentPosition(e)};return this.viewports.filter(function(e){return t(e.document)||t(e.stash)})[0]},e.prototype.byId=function(e){return this.viewports.filter(function(t){return t.id===e})[0]},e.prototype.resolve=function(e){var t=this;if(function(e){return e&&e.viewport&&e.location.origin===o.swcWindow.location.origin}(e)){var n=e.viewport.id,i=this.byId(n);i&&(i.window=e,i.document=e.document),i.stash?setTimeout(function(){return t.restore(i)}):(i.state.connected=!0,this.requests[n].resolve(i),o.swc.Eventing.triggerEvent("viewport:ready",n,!0),this.notify(i))}},e.prototype.stash=function(e,t){var n=this.byId(e);n.stash=document.createDocumentFragment(),n.stash.appendChild(t),n.state.connected=!1,this.notify(n)},e.prototype.create=function(e,t){var n=this,i=s.guid.generate();return this.viewports.push({id:i,options:e||{},state:t||{}}),this.requests[i]=new r.CancelablePromise,o.swc.Eventing.triggerEvent("viewport:add",{id:i,options:e,state:t},!0),o.swc.Eventing.registerEvent("viewport:update:dir",function(e){if(i===e.id){var t=n.byId(e.id);t&&t.document&&t.document.dir!==e.direction&&(t.document.dir=e.direction||o.swc.Dir||"ltr")}}),this.requests[i].promise},e.prototype.update=function(e,t){e.state=t,o.swc.Eventing.triggerEvent("viewport:update",{id:e.id,state:t},!0),this.notify(e),e.document&&i.setupIFrame(e.document)},e.prototype.onChange=function(e){-1===this.callbacks.indexOf(e)&&this.callbacks.push(e)},e.prototype.notify=function(e){this.callbacks.forEach(function(t){return t(e)})},e.prototype.restore=function(e){var t=e.document;t&&(t.replaceChild(e.stash,t.lastChild),e.stash=null,e.state.connected=!0,this.update(e,e.state))},e}();t.ViewportManager=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(144),r=n(270),o=n(274),s=function(){function e(){}return e.prototype.get=function(e){switch(e){case o.DYNAMICS_ID:return new r.DynamicsCblBase;default:return new i.CblBase}},e}();t.CblManager=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(){this.shouldDisableChatInputForCurrentUser=function(e){return!0}}}();t.DeleteMemberProcessorCblBase=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(19),r=function(){return function(){this.setImDisplayName=function(e,t){},this.getMessageType=function(e){return i.MessagePayloadType.RichText}}}();t.MessagesCblBase=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(){this.clearUserDataFromCache=function(){}}}();t.SkypeSignInManagerCblBase=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(144),s=n(271),a=n(272),c=n(273),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),Object.defineProperty(t.prototype,"messages",{get:function(){return new a.DynamicsMessagesCbl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skypeSignInManager",{get:function(){return new c.DynamicsSkypeSignInManagerCblBase},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deleteMemberProcessor",{get:function(){return new s.DynamicsDeleteMemberProcessorCblBase},enumerable:!0,configurable:!0}),t}(o.CblBase);t.DynamicsCblBase=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(){this.shouldDisableChatInputForCurrentUser=function(e){return!e}}}();t.DynamicsDeleteMemberProcessorCblBase=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(19),r=function(){return function(){var e=this;this.isMessageContentText=function(e){var t=!0,n=(new DOMParser).parseFromString(e,"text/html");return 0!==n.getElementsByTagName("parsererror").length||(t=n.body.innerHTML===n.body.innerText),t},this.getMessageType=function(t){return e.isMessageContentText(t)?i.MessagePayloadType.Text:i.MessagePayloadType.RichText},this.setImDisplayName=function(e,t){}}}();t.DynamicsMessagesCbl=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(31),r=n(0),o=function(){return function(){this.clearUserDataFromCache=function(){r.swc.services.sessionStorage.removeItem(i.SKYPE_TOKEN_KEY),r.swc.services.sessionStorage.removeItem(i.SKYPE_REGTOKEN_KEY),r.swc.services.sessionStorage.removeItem(i.SKYPE_ENDPOINT_ID_KEY),r.swc.services.sessionStorage.removeItem(i.SKYPE_HAS_HISTORY_KEY)}}}();t.DynamicsSkypeSignInManagerCblBase=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DYNAMICS_ID=937},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(74),a=n(4),c=n(276),u=n(143),l=n(5),p=function(e){function t(){var t=e.call(this)||this;return t._conversations={},t._enterpriseFavourites={},t.updateConversation=function(e,n){if(a.ConversationType.UNDEFINED!==s.default.getType(e)){var i=t._conversations[e];t.initialiseFavouriteForEnterprise(i),i.update(n)}},l.ServicesManager.ready().then(function(e){e.signInManager.onceSignedIn().then(function(){e.signInManager.isAadSupported()&&e.mePersonManager.getMeProperties().then(function(e){t._enterpriseFavourites=e,Object.keys(e).forEach(function(e){t._conversations[e]&&(t._conversations[e].isFavorite=!0)})})})}),t}return r(t,e),t.prototype.get=function(e,t){return this._conversations.hasOwnProperty(e)||this.createConversationModel(e),t&&(this._conversations[e].definition=t),this._conversations[e]},t.prototype.getIfExist=function(e){return this._conversations.hasOwnProperty(e)?this._conversations[e]:null},t.prototype.getAll=function(){return this._conversations},t.prototype.deleteConversation=function(e){var t=this;return this._conversations[e]?this._conversations[e].deleteConversation().then(function(){t._conversations[e].dispose(),delete t._conversations[e]}):o.swc.services.webApi.deleteConversation(e)},t.prototype.initialiseFavouriteForEnterprise=function(e){this._enterpriseFavourites[e.id]&&(e.isFavorite=!0)},t.prototype.isLeftGroupConversation=function(e){var t=e.threadProperties?parseInt(e.threadProperties.lastleaveat,10):null,n=e.threadProperties?parseInt(e.threadProperties.lastjoinat,10):null;return!!t&&t>n},t.prototype.isRecentConversation=function(e){return!!e.lastMessage&&((!e.properties.conversationblocked||"true"!==e.properties.conversationblocked.toLocaleLowerCase())&&(!this._conversations[e.id]&&(!!e.lastMessage.originalarrivaltime&&!this.isLeftGroupConversation(e))))},t.prototype.createConversationModel=function(e,t){var n=this,i=this.getIfExist(e),r=!i;return r&&(i=new c.default(e,{})),this._conversations[e]=i,t?this.updateConversation(e,t):r&&o.swc.services.webApi.fetchConversation(e).then(function(t){n.updateConversation(e,t)}),r&&this.notify(this._conversations[e]),i},t.prototype.loadConversations=function(e,t){var n=this;return void 0===t&&(t=100),l.ServicesManager.webApi.fetchRecentConversations(e,t).then(function(e){var t={hasMoreConversations:!1,conversations:[]};return e.conversations.forEach(function(e){if(n.isRecentConversation(e)){var i=n.createConversationModel(e.id,e);t.conversations.push(i)}}),t.hasMoreConversations=e.hasMoreConversations,t})},t.prototype.loadAllConversations=function(){var e=this;if(this.conversationSyncPromise)return this.conversationSyncPromise;var t=function(n,i){return l.ServicesManager.webApi.fetchRecentConversations(0,100).then(function(r){return r.conversations.forEach(function(t){e.isRecentConversation(t)&&e.createConversationModel(t.id,t)}),r.hasMoreConversations?new Promise(function(e){setTimeout(function(){t(n,i).then(function(){return e()})},200)}):Promise.resolve()})};return this.conversationSyncPromise=t(0,100),this.conversationSyncPromise},t.prototype.prefetchRecents=function(e,t){var n=this;return void 0===e&&(e=0),void 0===t&&(t=100),l.ServicesManager.webApi.prefetchRecents(0,100).then(function(e){return e&&e.conversations&&e.conversations.forEach(function(e){n.isRecentConversation(e)?n.createConversationModel(e.id,e):n._conversations[e.id]&&n.updateConversation(e.id,e)}),e})},t.prototype.subscribeToNewConversations=function(e){return this.subscribe(e)},t}(u.SubscribeableStore);t.default=p},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(46),s=n(145),a=n(3),c=n(1),u=n(13),l=n(84),p=n(16),d=n(34),f=n(0),h=n(54),g=n(74),m=n(8),v=n(154),y=n(29),_=n(277),b=n(278),T=n(28),S=n(4),w=n(5),P=n(279),C=n(35),E=n(142),O=n(104),I=function(e){function t(t,n){var i=e.call(this)||this;i._definition=n,i.backend=p.MessagingBackend.UNDETERMINED,i._isSealed=!1,i.messagesReceived=0,i._messagesSent=0,i.sdkMode=d.SDKMode.UNDEFINED,i.isUnreadBookmark=!1,i._contextAad="",i._isChatEnabled=!0,i._topic="",i._alertsOff=!1,i._isFavorite=!1,i._hasOngoingGroupCall=!1,i._hasActiveSplitter=!1,i.handleIsReadChange=function(e){i.debouncedPublishIsUnread();var t=!1,n=i.lastMessage||i.messages.length>0&&i.messages[i.messages.length-1];n&&(t=n.originalTimestamp.getTime()<Date.now()-2592e6);i.alertsOff||t||e?w.ServicesManager.unreadCounterStore.markAsRead(i.id):w.ServicesManager.unreadCounterStore.markAsUnread(i.id)},i.debouncedPublishIsUnread=o(function(){return i.publish("isUnread",i.isUnread)}),i.debouncedPublishIsRead=o(function(){return i.publish("isRead",i.isRead)}),i.sendLiveState=function(){return i._messagingService.sendLiveState()},i.download=function(e){return i.externalDownload&&f.swc.Eventing.triggerEvent("proxy:conversation:resDownload",{refId:i.refId,url:e})},i.setupProxy=function(){var e=function(e){return e===i.id};i._isOneOnOne||f.swc.Eventing.registerEvent("proxy:conversation:connected",function(t){e(t.id)&&i.heartBeat&&(t.connected?i.heartBeat.connect():i.heartBeat.disconnect())}),f.swc.Eventing.registerEvent("proxy:conversation:regMessageReceived",function(t){e(t.id)&&(i.refId=t.refId,i.messageReceivedProxied=!0)}),f.swc.Eventing.registerEvent("proxy:conversation:regDownload",function(t){e(t.id)&&(i.refId=t.refId,i.externalDownload=!0)})},i._id=t;var r,s=g.default.getType(t);return i.isAgent=s===S.ConversationType.AGENT,i.isPerson=s===S.ConversationType.PERSON,i.isGroup=s===S.ConversationType.GROUP,i.sdkMode=y.default.getSdkModeFromId(i._id),i.isSfB=a.default.get.isTeams()&&b.isSfB(t),i._messages=l.ObservableCollection.create(),i._allMessages=l.ObservableCollection.create(),i._participants=l.ObservableCollection.create(),i._messagingService=new P.default(i),i._isControlOpen=!1,i._consumptionHorizon=new E.ConsumptionHorizon,i._unreadMessagesCount=0,i.subscribe("isRead",i.handleIsReadChange),i.messages.subscribe(function(e){var t=i.lastMessage;if(t){i.publish("lastMessage",t);var n=function(e){e&&(i.debouncedPublishIsRead(),t.unsubscribe("isDeleted",n))};i.isControlOpen||i.debouncedPublishIsRead(),t.subscribe("isDeleted",n)}i.lastReceivedMessage&&i.publish("lastReceivedMessage",i.lastReceivedMessage)}),i.subscribe("lastReceivedMessage",function(e){e&&e.direction===S.Direction.Incoming&&r!==e&&(w.ServicesManager.notificationsManager.registerUnreadMessage(i,e),r=e)}),i._consumptionHorizon.subscribe("value",function(e){i.debouncedPublishIsRead()}),w.ServicesManager.mePerson&&(i.selfParticipant=new O.default(w.ServicesManager.mePerson)),a.default.get.isTeams()?i._isOneOnOne=-1!==t.indexOf("@unq.gbl.spaces"):i._isOneOnOne=i.getConversationType()!==S.ConversationType.GROUP,i.isBRB=i._isBRBConversation(),i._isOneOnOne||(i.heartBeat=new _.HeartBeat(i.sendLiveState)),i.setupProxy(),i.members=[],i}return r(t,e),Object.defineProperty(t.prototype,"isSealed",{get:function(){return this._isSealed},set:function(e){this._isSealed!==e&&(this._isSealed=!!e,this.publish("isSealed",this._isSealed))},enumerable:!0,configurable:!0}),t.prototype._isBRBConversation=function(){if(a.default.get.isTeams()&&this.isOneOnOne){var e=c.Configuration.BRB_BOT_MRI_TEAMS.substring(3);return this.id.indexOf(e)>-1}return this.id===c.Configuration.BRB_BOT_MRI},Object.defineProperty(t.prototype,"isRead",{get:function(){if(this.isPstn)return!0;if(!this.isPerson&&!this.isGroup&&!this.isAgent)return!0;if(!this.properties)return!0;if(!this.properties.consumptionhorizon&&"AcceptPendingRecipient"===this.properties.conversationstatus)return!0;var e=this.lastReceivedMessage||this.lastMessage,t=this.selfParticipant&&this.selfParticipant.person||w.ServicesManager.mePerson;return!this.isUnreadBookmark&&!!(!e||!g.UNREAD_TYPES[e.rawMessageType]||e.sender&&t&&T.normalizePersonId(e.sender.mri)===T.normalizePersonId(t.mri)||!e.content||""===e.content||e.id===this.consumptionHorizon.lastReadMessageId||e.clientMessageId===this.consumptionHorizon.lastReadMessageId||e.skypeEditedId===this.consumptionHorizon.lastReadMessageId||e.timestamp.getTime()<=this.consumptionHorizon.lastReadMessageTimestamp||"CallEndMsg"===e.customType)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isUnread",{get:function(){return!this.isRead},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFavorite",{get:function(){return this._isFavorite},set:function(e){this._isFavorite!==e&&(this._isFavorite=e,this.publish("isFavorite",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sortedMessages",{get:function(){return this.messages.sort(function(e,t){return e.timestamp.getTime()-t.timestamp.getTime()})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastReceivedMessage",{get:function(){var e=this.messages.filter(function(e){return e.direction===S.Direction.Incoming});return v.getLastItemFromArray(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastMessage",{get:function(){return v.getLastItemFromArray(this.sortedMessages)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allMessages",{get:function(){return this._allMessages},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"avatar",{get:function(){return this._avatar},set:function(e){((e=h.default.resolveConversationAvatar(this.isGroup,e))||e!==this._avatar)&&(this._avatar=e,this.publish("avatar",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"consumptionHorizon",{get:function(){return this._consumptionHorizon},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contextAad",{get:function(){return this._contextAad},set:function(e){e=(e=C.default.dompurify.sanitize(e,{ALLOWED_TAGS:[],ALLOWED_ATTR:[]})).replace(/["()\'\/+*`~!@#$%^\[\]:=]/g,""),this._contextAad=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"definition",{get:function(){return this._definition},set:function(e){this._definition=e,this.publish("definition",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(e){e!==this._id&&(this._id=e,this.publish("id",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isActive",{get:function(){return this._isActive},set:function(e){this._isActive=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBlocked",{get:function(){return this._isBlocked},set:function(e){e!==this._isBlocked&&(this._isBlocked=e,this.publish("isBlocked",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isChatEnabled",{get:function(){return this._isChatEnabled},set:function(e){e!==this._isChatEnabled&&(this._isChatEnabled=e,this.publish("isChatEnabled",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isControlOpen",{get:function(){return this._isControlOpen},set:function(e){this._isControlOpen=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isInRecent",{get:function(){return this._isInRecent},set:function(e){this._isInRecent=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return this._isLoaded},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isNew",{get:function(){return this._isNew},set:function(e){e!==this._isNew&&(this._isNew=e,this.publish("isNew",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isOneOnOne",{get:function(){return this._isOneOnOne},set:function(e){this._isOneOnOne!==e&&(this._isOneOnOne="true"===e,this.publish("isOneOnOne",this._isOneOnOne))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isUnderQuarantine",{get:function(){return this._isUnderQuarantine},set:function(e){e!==this._isUnderQuarantine&&(this._isUnderQuarantine=e,this.publish("isUnderQuarantine",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"members",{get:function(){return this._members},set:function(e){this._members=e,this.publish("members",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"messages",{get:function(){return this._messages},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"participants",{get:function(){return this._participants},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"theOtherParticipant",{get:function(){var e=this,t=this.participants.filter(function(t){return t.person.id!==e.selfParticipant.person.id});return 1===t.length?t.pop():void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selfParticipant",{get:function(){return this._selfParticipant},set:function(e){e!==this._selfParticipant&&(this._selfParticipant=e,this.publish("selfParticipant",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topic",{get:function(){return this._topic},set:function(e){e!==this._topic&&(this._topic=e,this.publish("topic",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"messagesSent",{get:function(){return this._messagesSent},set:function(e){e!==this._messagesSent&&(this._messagesSent=e,this.publish("messagesSent",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unreadMessagesCount",{get:function(){return this._unreadMessagesCount},set:function(e){this._unreadMessagesCount!==e&&(this._unreadMessagesCount=e,this.publish("unreadMessagesCount",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alertsOff",{get:function(){return this._alertsOff},set:function(e){e!==this._alertsOff&&(this._alertsOff=e,this.publish("alertsOff",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasActiveSplitter",{get:function(){return this._hasActiveSplitter},set:function(e){e!==this._hasActiveSplitter&&(this._hasActiveSplitter=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasOngoingGroupCall",{get:function(){return this._hasOngoingGroupCall},set:function(e){this._hasOngoingGroupCall!==e&&(this._hasOngoingGroupCall=e,this.publish("hasOngoingGroupCall",e))},enumerable:!0,configurable:!0}),t.prototype.addBotToThread=function(e){this._messagingService.addBotToThread(e)},t.prototype.addParticipant=function(e){this._messagingService.addParticipantToThread(e)},t.prototype.deleteConversation=function(){return this._messagingService.deleteConversation(this.id)},t.prototype.deleteMessage=function(e){var t=this,n=this.lastMessage;return this._messagingService.deleteMessage(e).then(function(){e.content="",e.isDeleted=!0,e.isEdited=!0,e.id===n.id&&t.publish("lastMessage",n)})},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._contextAad="",this._messages&&(this._messages.forEach(function(e){e.dispose()}),this._messages.dispose(),this._messages.spliceObservable(0,this._messages.length)),this._participants.dispose(),this._isDisposed=!0,this._messagingService.dispose()},t.prototype.editMessage=function(e,t){return this._messagingService.editMessage(e,t)},t.prototype.getBackend=function(){return this.backend=g.default.getBackend(this.id,this.backend),this.backend},t.prototype.getConversationType=function(){return g.default.getType(this._id)},t.prototype.getReceviedMessagesCount=function(){return 0},t.prototype.getSentMessagesCount=function(){return 0},t.prototype.isSkypeBackend=function(){return this.getBackend()===p.MessagingBackend.SKYPE},t.prototype.isWithMe=function(){return f.swc.services.signInManager.currentUserName&&this.getConversationType()===S.ConversationType.PERSON&&y.default.isEqual(this.id,f.swc.services.signInManager.currentUserName)},t.prototype.loadMoreMessages=function(){return this._messagingService.loadMoreMessages(this)},t.prototype.markAsRead=function(){this._messagingService.markAsRead()},t.prototype.removeMessageProperty=function(e,t,n,i){return this._messagingService.removeMessageProperty(e,t,n,i)},t.prototype.removeParticipant=function(e){return this._messagingService.removeParticipantFromThread(e)},t.prototype.sendDataToBot=function(e){if(this.getConversationType()===S.ConversationType.GROUP){var t=this.participants.filter(function(e){return e.person.isAgent});if(t.length>0)return this._messagingService.sendDataToBot(y.default.toFullIdentifier(t[0].person.id),e)}return this.isAgent?this._messagingService.sendDataToBot(this.id,e):Promise.resolve()},t.prototype.sendFile=function(e){return f.swc.Eventing.triggerEvent("onMessageSent",{type:s.default.File}),this._messagingService.sendFile(e)},t.prototype.sendFilesAsProperties=function(e){return f.swc.Eventing.triggerEvent("onMessageSent",{type:s.default.Card}),this._messagingService.sendFilesAsProperties(e)},t.prototype.sendFilesAsAmsProperties=function(e){return f.swc.Eventing.triggerEvent("onMessageSent",{type:s.default.File}),this._messagingService.sendFilesAsAmsProperties(e)},t.prototype.sendMessage=function(e,t,n){this._messagingService.sendMessage(e,t,n),f.swc.Eventing.triggerEvent("onMessageSent",{type:s.default.Text})},t.prototype.sendSwift=function(e){return f.swc.Eventing.triggerEvent("onMessageSent",{type:s.default.Card}),this._messagingService.sendSwift(e)},t.prototype.setIsTyping=function(e){this._messagingService.setIsTyping(e)},t.prototype.setMessageProperty=function(e,t,n,i){return this._messagingService.setMessageProperty(e,t,n,i)},t.prototype.setParticipantTyping=function(e,t,n){var i=this._participants.filter(function(t){return t.person.id===e});i.length&&(f.swc.EcsConfig.showCustomTypingName&&n&&(i[0].person.imDisplayName=n),i[0].isTyping=t)},t.prototype.setTopic=function(e){this._messagingService.setConversationTopic(e)},t.prototype.start=function(){var e=this;return this._isDisposed=!1,this._messagingService.startConversation().then(function(){e._isLoaded=!0,e.publish("isLoaded",!0)},function(t){m.default.throwError(100001,"Unable to start conversation",t,e.id)})},t.prototype.update=function(e){var t=this;if(this._id===e.id){if(this.isTeamsOneOnOne=this.isTeamsOneOnOne||e.isOneOnOne,this.properties=e.properties||this.properties,this.threadProperties=e.threadProperties||this.threadProperties,this.hasOngoingGroupCall=e.threadProperties&&!!e.threadProperties.awareness_conversationLiveState,this.isBlocked=M(e.properties),this.properties.consumptionHorizonBookmark&&0!==this.properties.consumptionHorizonBookmark.indexOf("0")&&a.default.get.isTeams()?(this.isUnreadBookmark=!0,this.properties.consumptionHorizonBookmark=this._addMissingLastReadMessageId(this.properties.consumptionHorizonBookmark),this.updateConsumptionHorizon(this.properties.consumptionHorizonBookmark)):(this.isUnreadBookmark=!1,this.updateConsumptionHorizon(this.properties.consumptionhorizon)),this.alertsOff=k(e.properties),this.isFavorite=e.properties&&"true"===e.properties.favorite,e.members){this.members=e.members,this._participants.spliceObservable(0,this._participants.length);var n=w.ServicesManager.mePerson;this.members.forEach(function(e){var i=w.ServicesManager.persons.getPerson(e.id,!0);!i.displayName&&e.name&&(i.displayName=e.name),t._participants.pushObservable(new O.default(i,e)),n&&n.mri===e.id&&(t.selfParticipant=new O.default(n,e))})}if(e.threadProperties&&e.threadProperties.picture&&(this.avatar=e.threadProperties.picture),0===this.members.length&&e.threadProperties&&e.threadProperties.members)try{var i=JSON.parse(e.threadProperties.members);i.length>0&&(this._participants.spliceObservable(0,this._participants.length),i.forEach(function(e){var n=w.ServicesManager.persons.getPerson(e);n&&t._participants.pushObservable(new O.default(n))}))}catch(e){}this._updateTopic(e.threadProperties,e),e.lastMessage&&e.lastMessage.id&&this._messagingService.processNewMessage(this,e.lastMessage,void 0,void 0,!0)}},t.prototype.updateThread=function(e){this._id===e.id&&(this.members=e.members,e.properties&&(this._updateTopic(e.properties),e.properties.picture&&(this.avatar=e.properties.picture.replace("URL@","")||this.avatar),this.threadProperties=e.properties,this.hasOngoingGroupCall=!!e.properties.awareness_conversationLiveState))},t.prototype._updateTopic=function(e,t){var n=this,i=this.topic&&-1!==this.topic.indexOf("8:orgid");if(!this.topic||i){var r=w.ServicesManager.signInManager.isAadSupported(),o=e&&e.topic||t&&t.properties&&t.properties.topic||t&&t.lastMessage&&t.lastMessage.threadtopic||this.isOneOnOne&&!r&&this.id||null;if(!r&&this.isOneOnOne){var s=w.ServicesManager.persons.getPerson(this.id);s.displayName?o=s.displayName:s.subscribe("displayName",function(e){return n.topic=e})}else if(this.isPstn)o=this.id.replace("4:","");else{var a=this._messagingService.parseConversationTopic(o);1!==a.trim().length&&""!==a.trim().replace(",","")&&(o=a)}this.topic=o||""}},t.prototype._addMissingLastReadMessageId=function(e){var t=e.lastIndexOf(";");return e.indexOf("undefined",t)>-1&&(e=e.replace("undefined",this.lastMessage.id)),e},t.prototype.startGuestConversation=function(){return this.isAgent?this._messagingService.startGuestConversation():Promise.resolve()},t.prototype.updateConsumptionHorizon=function(e){e&&e!==this._consumptionHorizon.value&&this._consumptionHorizon.set(e,!0)},t.prototype.messageReceived=function(e,t){var n={type:e,messageType:t};f.swc.Eventing.triggerEvent("onMessageReceived",n),this.messageReceivedProxied&&f.swc.Eventing.triggerEvent("proxy:conversation:messageReceived",{refId:this.refId,message:n})},Object.defineProperty(t.prototype,"refId",{get:function(){return this._refId},set:function(e){this._refId=this._refId||e},enumerable:!0,configurable:!0}),t}(u.default);t.default=I;var M=function(e){return!!e.conversationblocked&&"true"===e.conversationblocked.toLocaleLowerCase()},k=function(e){return!!e.alerts&&/false/i.test(e.alerts)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.callback=e}return e.prototype.connect=function(){this.timer||(this.callback(),this.timer=setInterval(this.callback,3e4))},e.prototype.disconnect=function(){clearInterval(this.timer)},e}();t.HeartBeat=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(32),r="sip:",o="8:orgid:sfb:",s="@sfb.unq.gbl.spaces",a="19:sfb:";t.isSfB=function(e){return!!e&&(t=e,!!t&&i.startsWith(t,r)||function(e){return!!e&&i.startsWith(e,o)}(e)||function(e){return!!e&&(function(e){return i.startsWith(e,a)&&!i.endsWith(e,s)}(e)||function(e){return i.endsWith(e,s)}(e))}(e));var t}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(145),o=n(3),s=n(1),a=n(90),c=n(77),u=n(287),l=n(11),p=n(84),d=n(92),f=n(307),h=n(24),g=n(109),m=n(16),v=n(91),y=n(35),_=n(31),b=n(0),T=n(168),S=n(74),w=n(156),P=n(8),C=n(61),E=n(75),O=n(12),I=n(29),M=n(308),k=n(9),A=n(48),R=n(38),N=n(18),L=n(147),D=n(19),U=n(101),x=n(4),F=n(104),j=/(^|\s)(https?:\/\/[^\s]*\.(?:png\?\d+|png|jpg\?\d+|jpg|jpeg\?\d+|jpeg|gif))($|<|\s)/gim,H={ALLOWED_TAGS:["img","a"],ALLOWED_ATTR:["target","src","alt","class","href"]},B=/<a href="([^"]+)"( target="([^"]+)")?>([^<]+)<\/a>/g,G=730,z=5e3,W=3e3,V=!0,q=function(){function e(e){var t=this;this._encoder=new a.Encoder(null,null),this._isBackfillEnabled=!1,this._handleMessageResource=function(e,n){if(t._messageTypesHandler.isTypingIndicator(n)&&n.from){var i=R.default.normalizePersonId(k.MessageUtils.getSenderIdFromUrl(n.from));return b.swc.EcsConfig.showCustomTypingName&&n.imdisplayname?void e.setParticipantTyping(i,"Control/Typing"===n.messagetype,n.imdisplayname):void e.setParticipantTyping(i,"Control/Typing"===n.messagetype)}var o=n.contentOriginal&&0===n.contentOriginal.trim().length;if(n.content&&0!==n.content.trim().length||!o||n.skypeeditedid){t._setHistoryParamToCache(e.id);var s=t.processNewMessage(e,n,null,!1);if(s&&s.direction===x.Direction.Incoming){var a=k.MessageUtils.getSenderIdFromUrl(n.from);(i=R.default.normalizePersonId(a))&&e.setParticipantTyping(i,!1),e.messagesReceived++,t._updateUnreadMessageCounter(e,s),s.isDeleted||s.isEdited||"SystemMessage"===s.type||b.swc.Telemetry.sendEvent.messageReceived(e,s.type,e.sdkMode,e.topic,e.isControlOpen),e.messageReceived(r.default.getReceivedMessageType(s.type),s.type)}}},this._updateUnreadMessageCounter=function(e,n){if(e.isControlOpen)t.updateConsumptionHorizonToLastMessage(),e.unreadMessagesCount=0;else if(n.isDeleted){var i=n.originalTimestamp.getTime();!(e.consumptionHorizon.lastReadMessageTimestamp>=i)&&n.isEdited&&e.unreadMessagesCount>0&&e.unreadMessagesCount--}else n.isEdited||e.unreadMessagesCount++},this._isFetched=!1,this._isTeamsBackend=o.default.get.backend===m.MessagingBackend.TEAMS,this._isUseEditMessageClassic=function(){return V&&o.default.get.backend!==m.MessagingBackend.TEAMS},this._messageToBotWasSent=!1,this._pendingContactRequest=!1,this._quarantineCountDown=-1,this.checkConversationStatus=function(e){return t.isConversationNotFoundError(e)?Promise.resolve():b.swc.services.webApi.fetchConversation(t.conversation.id).then(function(e){if(!t.isConversationNotFoundError(e)){if(t.isConversationBlocked(e))return t.conversation.isBlocked=!0,void(t.conversation.isChatEnabled=!1);switch(e.properties.conversationstatus){case"Accepted":return t.conversation.isUnderQuarantine=!1,t.conversation.isChatEnabled=!0,void(t._quarantineCountDown=-1);case"AcceptPendingSender":break;case"AcceptPendingRecipient":return t._pendingContactRequest=!0,t.conversation.isUnderQuarantine=!1,void(t.conversation.isChatEnabled=!0);default:return}t.checkIfBuddy()}},function(e){t.isConversationNotFoundError(e)||P.default.throwError(105002,"Unable to check IConversation Status",e)})},this.checkIfBuddy=function(){t._checkContactTimeout||(t._checkContactTimeout=U.build(t.checkConversationStatus.bind(t),z)),t._checkContactTimeout.start()},this.fetchUserMessages=function(e){return new Promise(function(n,i){b.swc.services.webApi.fetchMessages(t.conversation.id).then(function(i){t._isBackfillEnabled=!0,t._messagesHandler(t.conversation,e,i),t._isFetched=!0,n(i)},function(e){t.onConversationLoadingFinished(),i(e)})})},this.isConversationBlocked=function(e){return!!e.properties.conversationblocked&&"true"===e.properties.conversationblocked.toLocaleLowerCase()},this.isConversationNotFoundError=function(e){return!(!e||e.errorCode!==G)&&(t.conversation.isChatEnabled=!0,t._quarantineCountDown=0,!0)},this.isOneToOneOrBot=function(){return t.conversation.isPerson||t.conversation.isAgent},this.startConversationWithBot=function(e){void 0===e&&(e=!0);var n=t.conversation.id,i=t.conversation.id.slice(3),r=t;if(0===t.conversation.participants.length){var o=new F.default(b.swc.services.persons.getPerson(t.conversation.id,!0));t.conversation.participants.pushObservable(o)}return t.executeWhenSignedIn(function(){b.swc.services.contactsManager.isPersonContact(n).then(function(n){n?(r.subscribeToConversation(),t.conversation.isChatEnabled=!0,b.swc.services.signInManager.userIdentityType===h.IdentityType.GUEST&&(t.conversation.isNew=!0,t.conversation.startGuestConversation()),t.conversation.definition.Payload&&t.conversation.sendDataToBot({payload:t.conversation.definition.Payload})):(t.conversation.isChatEnabled=!1,t.conversation.isNew=!0,e&&b.swc.services.agentsManager.addAgent(i),t._checkContactTimeout=U.build(function(){r.startConversationWithBot(!1)},W),t._checkContactTimeout.start()),t.fetchUserMessages(Date.now())},function(e){P.default.throwError(105001,"Unable to start conversation with bot",e,n)})})},this.startConversationWithPerson=function(){t.conversation.id.slice(2);if(0===t.conversation.participants.length){var e=new F.default(b.swc.services.persons.getPerson(t.conversation.id,!0));t.conversation.participants.pushObservable(e)}return t.executeWhenSignedIn(function(){return b.swc.services.contactsManager.isPersonContact(t.conversation.id).then(function(e){return e?(t.conversation.isNew=!1,b.swc.services.webApi.subscribeContactPresence(t.conversation.id),t.subscribeToConversation()):(t.conversation.isNew=!0,t.subscribeToConversation().then(t.checkConversationStatus.bind(t)))}).then(function(e){return t.fetchUserMessages(Date.now()),e})})},this.presubscribeConversation=function(e){if(void 0===e&&(e=!1),t._subscriptionPromise)return t._subscriptionPromise;var n=t.currentUserHasHistory(t._conversationId);return e=e&&b.swc.services.signInManager.userIdentityType===h.IdentityType.SKYPE||n,t._subscriptionPromise=b.swc.services.webApi.subscribeConversation(t._conversationId,t._eventHandler,function(){return t._backfilllingHandler(!0)}),t._subscriptionPromise},this.subscribeToConversation=function(){var e=t,n=t.currentUserHasHistory(e.conversation.id),i=b.swc.services.signInManager.userIdentityType===h.IdentityType.SKYPE||n;b.swc.Eventing.triggerEvent("onConversationReady",{id:t.conversation.id}),b.swc.Telemetry.sendEvent.conversationLoaded(t.conversation);var r=function(n){if(t.isConversationNotFoundError(n))return n;n&&n.properties&&n.properties.consumptionhorizon&&t.conversation.updateConsumptionHorizon(n.properties.consumptionhorizon),n&&n.threadProperties&&t.updateConversationProperties(n.threadProperties,!0);var i=t.isConversationBlocked(n);return t.conversation.isBlocked=i,t.conversation.isChatEnabled=!i,e.onConversationLoadingFinished(),n};return t.presubscribeConversation().then(function(){return i?b.swc.services.webApi.fetchConversation(t.conversation.id).then(r):Promise.reject("Do not fetch Properties (this is not and error)")}).catch(function(n){t._messageToBotWasSent?t.fetchUserMessages(Date.now()):e.onConversationLoadingFinished()})},this.sendFileMessageFailed=function(e,n,r){var o=t.createMessageData({content:b.swc.services.i18n.fetch("file_message_send_failed"),messagetype:D.MessagePayloadType.RichTextHtml,clientmessageid:e,properties:JSON.stringify(i({},t.conversation.currentMessageProperties||{},{files:n}))});t.pushMessageToConversation(g.MessageType.TEXT,o).status=x.DeliveryStatus.Failed,b.swc.Telemetry.sendEvent.scenario(!1,"sendFileSkypeMessagingService",r.message,"Not sending, file status is failed",r.stack)},this.sendSwift=function(e){return t.sendMessageToService(g.MessageType.SWIFT,t.createMessageData({content:e.title,properties:e.value||e,messagetype:D.MessagePayloadType.RichText,processedcontent:e.title}))},this.sendLiveState=function(){return t.sendMessageToService(g.MessageType.LIVE_STATE,t.createMessageData({content:"",messagetype:D.MessagePayloadType.ControlLiveState}))},this.setIsTyping=function(e){return t.sendMessageToService(g.MessageType.TYPING,t.createMessageData({content:"",messagetype:e?D.MessagePayloadType.ControlTyping:D.MessagePayloadType.ControlClearTyping}))},this._getReportProblemContext=function(){var e=O.guid.generate().slice(0,5),t=o.default.get.isTeams()?"enterprise":"consumer",n="swc,feedback,"+s.Configuration.getPlatformName()+","+t;return o.default.get.isTeams()?"#bug | Platform: "+s.Configuration.getPlatformId()+" | App Version: "+s.Configuration.getVersion()+" | OS Version: "+N.default.getOsName()+" "+N.default.getOsName()+" | Device: "+N.default.getDeviceType()+" | Language: "+window.navigator.language+") | Tags: "+n+' | Network: WIFI<context feedbackId ="'+e+'"></context>':'<context PlatformID="'+s.Configuration.getPlatformId()+'" AppVersion="'+s.Configuration.getVersion()+'" OS="'+N.default.getOsName()+" "+N.default.getOsName()+'" Device="'+N.default.getDeviceType()+'" Language="'+window.navigator.language+'" BrbEnabled="true" Tags="'+n+'" feedbackId="'+e+'"></context>'},this._eventHandler=function(e,n){switch(e){case"NewMessage":case"MessageUpdate":t._handleMessageResource(t.conversation,n);break;case"ConversationUpdate":t._isFetched||t.fetchUserMessages(Date.now()),t.conversation.update(n)}},M.Masks.init(),e||P.default.throwError(10501,"conversation is missing"),this._conversationId=e.id,this._messageTypesHandler=new u.default,this._firstMessagePopulationPromise=new l.CancelablePromise,b.swc.services.mePersonManager.fetch(),this._backfilllingHandler=this.backFillLostMessges.bind(this),A.get().subscribe("isOnline",this._backfilllingHandler),this.presubscribeConversation()}return Object.defineProperty(e.prototype,"mePerson",{get:function(){return b.swc.services.mePersonManager.mePerson},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"conversation",{get:function(){return b.swc.services.conversations.get(this._conversationId)},enumerable:!0,configurable:!0}),e.prototype.startGroupConversation=function(){var e=this,t=function(){return b.swc.services.webApi.fetchThread(e.conversation.id).then(function(t){if(t.properties){var n=t.properties;t.members&&(n.members=t.members),e.updateConversationProperties(n);var i=n.joiningenabled,r=n.capabilities,o=!r||0===r.length;if(e._isTeamsBackend){var s=n.fixedRoster&&n.uniquerosterthread;e.conversation.isOneOnOne=s}else e.conversation.isOneOnOne=-1===t.id.indexOf("19:");var a=e.isMember(b.swc.services.signInManager.currentUserName,t);!o||i||e._isTeamsBackend&&a?e.subscribeToConversation():P.default.throwError(10506,"Joining to a group conversation is disabled",{},e.conversation.id);var c=e.conversation.participants;c.spliceObservable(0,c.length),t.members.forEach(function(e){var t=b.swc.services.persons.getPerson(e.id,!0),n=new F.default(t,e);c.pushObservable(n),t.isAgent&&b.swc.Eventing.triggerEvent("botAddedToThread",t.id)}),b.swc.services.mePersonManager.fetch().then(function(t){c.forEach(function(n){t.id===n.person.id&&(e.conversation.selfParticipant=n)})})}else e.subscribeToConversation();return e.conversation.members=t.members,t},function(t){P.default.throwError(10509,"Unable to fetch a thread",t,e.conversation.id)})},n=function(t){return b.swc.services.webApi.addParticipant(e.conversation.id,t).then(null,function(t){P.default.throwError(10507,"Unable to join conversation",t,e.conversation.id)})};return this.executeWhenSignedIn(function(){var i="8:"+b.swc.services.signInManager.currentUserName;new Promise(function(t){0===e.conversation.id.indexOf("19:guest")&&-1===b.swc.services.signInManager.currentUserName.indexOf("guest")?n(i).then(function(){return t()}):t()}).then(function(){e.fetchUserMessages(Date.now()),t().then(function(r){e.isMember(b.swc.services.signInManager.currentUserName,r)||n(i).then(t),e.conversation.topic||(e.conversation.topic=e.parseConversationTopic(r.properties.topic||null))})})})},e.prototype.isMember=function(e,t){var n="8:"+e;return t&&t.members&&t.members.some(function(e){return e.id===n})},e.prototype.addBotToThread=function(e){b.swc.services.webApi.addParticipant(this.conversation.id,"28:"+e).then(function(e){},function(t){P.default.throwError(10510,"Unable to add bot to conversation",t,e)})},e.prototype.addParticipantToThread=function(e){b.swc.services.webApi.addParticipant(this.conversation.id,e).then(function(e){},function(t){P.default.throwError(10511,"Unable to add participant to conversation",t,e)})},e.prototype.createConversation=function(e){e&&b.swc.services.webApi.createThread([])},e.prototype.deleteConversation=function(e){return b.swc.services.webApi.deleteConversation(e)},e.prototype.deleteMessage=function(e){return this._isUseEditMessageClassic()?this.editMessageClassicWay(e):b.swc.services.webApi.deleteMessage(this.conversation.id,e.id)},e.prototype.dispose=function(){this._messageToBotWasSent=!1,this.stopListeningConversation(),this._checkContactTimeout&&(this._checkContactTimeout.reset(),this._checkContactTimeout=null),this._firstMessagePopulationPromise.status===l.PromiseStatus.Pending&&(this._firstMessagePopulationPromise.promise.then(null,function(){}),this._firstMessagePopulationPromise.cancel()),this._firstMessagePopulationPromise=new l.CancelablePromise,A.get().unsubscribe("isOnline",this._backfilllingHandler)},e.prototype.mask=function(e,t){var n=M.Masks.instance;return n&&n.shouldMask(e)&&(e=n.process(e),t&&(t.tags=t.tags||"",t.tags=w.default.add(t.tags,"masked",!0))),e},e.prototype.editMessage=function(e,t){t=this.mask(t);var n=this._encoder.encode(t,this.conversation,this.mePerson),i=v.default.parse(n);return this._isUseEditMessageClassic()?this.editMessageClassicWay(e,i):b.swc.services.webApi.editMessage(this.conversation.id,e.id,e.rawMessageType,i)},e.prototype.getUnreadMessagesCount=function(){return this.conversation.unreadMessagesCount},e.prototype.loadMoreMessages=function(e){return this._backwardLink?b.swc.services.webApi.fetchMessagesByLink(this._backwardLink).then(this._messagesHandler.bind(this,e,Date.now())):Promise.resolve()},e.prototype.markAsRead=function(){(b.swc.services.signInManager.userIdentityType===h.IdentityType.SKYPE||this.currentUserHasHistory(this.conversation.id))&&this.updateConsumptionHorizonToLastMessage()},e.prototype.removeMessageProperty=function(e,t,n,i){return b.swc.services.webApi.removeMessageProperty(e,t,n,i)},e.prototype.removeParticipantFromThread=function(e){return b.swc.services.webApi.removeParticipant(this.conversation.id,e).then(function(e){},function(t){P.default.throwError(10512,"Unable to remove participant from conversation",t,e)})},e.prototype.sendDataToBot=function(e,t){var n={name:"SWC",conversation:{id:this.conversation.isGroup?this.conversation.id:b.swc.services.signInManager.currentUserName},value:t};return this._messageToBotWasSent=!0,b.swc.services.webApi.sendDataToBot(e,n)},e.prototype.sendFile=function(e){var t=this,n=e.file,i=e.uploadPromise,r=e.registerPromise,o=e.clientMessageId,s=C.isDocumentTypeImage(n.type),a=s?g.MessageType.IMAGE:g.MessageType.FILE,c=function(e){var r=t.generateFileMessagePayload(n,o,e);return t.sendMessageToService(a,r,null,i)},u=function(n){t.sendFileMessageFailed(o,e.file,n)};return r.then(function(e){var t=e.documentId;return s?b.swc.services.amsManager.downloadPictureThumbnail(t).then(function(){return c(t)},u):b.swc.services.amsManager.downloadFileByDocumentId(t).then(function(){c(t)},u)}).catch(function(n){return t.sendFileMessageFailed(o,e.file,n)})},e.prototype.generateFileMessagePayload=function(e,t,n){void 0===n&&(n=t);var i=C.isDocumentTypeImage(e.type),r={content:i?C.createImageMessage(e,n):C.createFileMessage(e,n),clientmessageid:t,messagetype:i?D.MessagePayloadType.RichTextUriObject:D.MessagePayloadType.RichTextMedia_GenericFile,properties:JSON.stringify(this.conversation.currentMessageProperties||{})};return this.createMessageData(r)},e.prototype.sendFilesAsProperties=function(e){var t=this,n=e.clientMessageId,r=this.createMessageData({content:"",messagetype:D.MessagePayloadType.RichTextHtml,clientmessageid:n,properties:JSON.stringify(i({},this.conversation.currentMessageProperties||{},{files:e.files}))}),o=this.pushMessageToConversation(g.MessageType.TEXT,r);return e.registerPromise.then(function(r){var s=t.createMessageData({content:"",messagetype:D.MessagePayloadType.RichTextHtml,clientmessageid:n,properties:JSON.stringify(i({},t.conversation.currentMessageProperties||{},{files:JSON.stringify(r.files)}))});return t.sendMessageToService(g.MessageType.TEXT,s,null,e.uploadPromise,o)}).catch(function(){o.status=x.DeliveryStatus.Failed})},e.prototype.sendFilesAsAmsProperties=function(e){var t=this,n=e.clientMessageId,r=this.createMessageData({content:"",messagetype:D.MessagePayloadType.RichTextHtml,clientmessageid:n,properties:JSON.stringify(i({},this.conversation.currentMessageProperties||{},{files:e.files}))}),o=this.pushMessageToConversation(g.MessageType.TEXT,r);return e.registerPromise.then(function(r){var s=t.createMessageData({content:"",messagetype:D.MessagePayloadType.Text,amsreferences:JSON.stringify([r.documentId]),clientmessageid:n,properties:JSON.stringify(i({},t.conversation.currentMessageProperties||{},{files:JSON.stringify(r.files),importance:"",subject:null}))});return t.sendMessageToService(g.MessageType.TEXT,s,null,e.uploadPromise,o)}).catch(function(){o.status=x.DeliveryStatus.Failed})},e.prototype.sendMessage=function(e,t,n){var r,o={messageLength:e.length,origin:t};if(n=i({},this.conversation.currentMessageProperties,n)||{},this.conversation.isBRB)r=e+this._getReportProblemContext();else{var s=this.mask(e,n);r=this._encoder.encode(s,this.conversation,this.mePerson)}var a=v.default.parse(r).replace(/<br\s*\/?>/g,"<br/>").replace(/<hr\s*\/?>/g,"<hr/>"),c=b.swc.services.cbl.messages.getMessageType(a),u=this.createMessageData({content:a,messagetype:c,"Has-Mentions":k.MessageUtils.containsMention(r).toString()});return Object.keys(n).length&&(u.properties=n),this.sendMessageToService(g.MessageType.TEXT,u,o)},e.prototype.setConversationTopic=function(e){b.swc.services.webApi.setConversationTopic(this.conversation.id,e)},e.prototype.setMessageProperty=function(e,t,n,i){return b.swc.services.webApi.setMessageProperty(e,t,n,i)},e.prototype.startConversation=function(){return this.isOneToOneOrBot()?this.conversation.isPerson?this.startConversationWithPerson():this.startConversationWithBot():this.startGroupConversation()},e.prototype.startGuestConversation=function(){var e={name:"startConversation",conversation:{id:I.default.toFullIdentifier(b.swc.services.signInManager.currentUserName)},value:{}};return b.swc.services.webApi.sendDataToBot(this.conversation.id,e)},e.prototype.stopListeningConversation=function(){b.swc.services.webApi.unsubscribeConversation(this.conversation.id)},e.prototype._messagesHandler=function(e,t,n){var i,r=this;if(e.messages)if(n){this._backwardLink=n._metadata.backwardLink;var o=p.ObservableCollection.create();n.messages.forEach(function(t){r.processNewMessage(e,t,o,!0)}),o.sortObservable(function(e,t){return e.timestamp.getTime()>t.timestamp.getTime()?1:-1}),b.swc.Telemetry.sendEvent.messagesFetched(this.conversation,Date.now()-t,200,n.messages.length),(i=e.messages).pushObservable.apply(i,o),this.onConversationLoadingFinished()}else this.onConversationLoadingFinished();else this.onConversationLoadingFinished()},e.prototype._setHistoryParamToCache=function(e){if(b.swc.services.signInManager.userIdentityType!==h.IdentityType.SKYPE&&!this.currentUserHasHistory(e)){var t=b.swc.services.sessionStorage.getItem(_.SKYPE_HAS_HISTORY_KEY)||"";t=""===t?e:t+";"+e,b.swc.services.sessionStorage.setItem(_.SKYPE_HAS_HISTORY_KEY,t)}},e.prototype._triggerCustomAction=function(e){var t=e.content;if(t){var n=/<swc-event>(?:<name>([\s\S]*)<\/name>)[\s]?(?:<action>([\s\S]*)<\/action>)[\s]?(?:<data>([\s\S]*)<\/data>)<\/swc-event>/i,i=t.match(n);if(i&&!(i.length<3)){var r=i[1],o=i[2],s=i[3];o&&o.toLowerCase()===f.default.DELIVERED.toLowerCase()&&(r&&b.swc.Eventing.triggerEvent(r,s),e.content=t.replace(n,""))}}},e.prototype.backFillLostMessges=function(e){var t=this;if((!this._backfilllingPromise||this._backfilllingPromise.status!==l.PromiseStatus.Pending)&&this._isBackfillEnabled){var n=this;this._backfilllingPromise=new l.CancelablePromise(b.swc.services.webApi.fetchMessages(this.conversation.id)),this._backfilllingPromise.promise.then(function(e){e.messages&&e.messages.sort(function(e,t){var n=new Date(e.originalarrivaltime),i=new Date(t.originalarrivaltime);return n>i?1:n<i?-1:0}),n._messagesHandler(t.conversation,Date.now(),e)},function(e){})}},e.prototype.currentUserHasHistory=function(e){return(b.swc.services.sessionStorage.getItem(_.SKYPE_HAS_HISTORY_KEY)||"").indexOf(e)>=0||E.getConversationType(e)===x.ConversationType.GROUP},e.prototype.editMessageClassicWay=function(e,t){void 0===t&&(t="");var n={messagetype:e.rawMessageType,content:t,skypeeditedid:e.clientMessageId?e.clientMessageId:e.key};return b.swc.services.webApi.sendMessage(this.conversation.id,n)},e.prototype.executeWhenSignedIn=function(e){return b.swc.services.signInManager.getSkypeToken().then(function(t){return e()})},e.prototype.filterMessagesByKey=function(e,t){return e.filter(function(e){return e.key===t})[0]},e.prototype.getExistingMessage=function(e,t,n){var i=n!==t,r=this.filterMessagesByKey(n,e.key);return r||(i&&(r=this.filterMessagesByKey(t,e.key)),r)},e.prototype.mapSuggestedActionsArray=function(e,t,n){e.forEach(function(e){t.suggestedActions.pushObservable(n(e))})},e.prototype.onConversationLoadingFinished=function(){this._firstMessagePopulationPromise.status===l.PromiseStatus.Pending&&(this._firstMessagePopulationPromise.resolve(),(b.swc.services.signInManager.userIdentityType===h.IdentityType.SKYPE||this.currentUserHasHistory(this.conversation.id))&&this.updateConsumptionHorizonToLastMessage())},e.prototype.processNewMessage=function(e,t,n,i,r){function o(t){return t.title&&(t.title=this._encoder.decode(this._encoder.encode(t.title))),new T.default(t,e,s.senderId)}this._triggerCustomAction(t),n=n||e.messages;var s=this._messageTypesHandler.handle(t,{conversation:this.conversation,isHistory:i});if("Control/LiveState"===t.messagetype)return null;if(!s)return null;L.default.parseMessageProperties(s,t),s.status=x.DeliveryStatus.Sent,t.suggestedActions&&t.suggestedActions.actions&&this.mapSuggestedActionsArray(t.suggestedActions.actions,s,o.bind(this)),t.properties&&t.properties.suggestedActions&&t.properties.suggestedActions.actions&&this.mapSuggestedActionsArray(t.properties.suggestedActions.actions,s,o.bind(this));var a,c,u=this.getExistingMessage(s,n,e.messages);if((a=s)&&"SystemMessage"===a.type)return u?(s.isEdited=!0,this._messageTypesHandler.updateExistingMessage(u,s,i),s.subscribe("content",function(e){return u.content=e}),s):(n.pushObservable(s),s);if(!this._isTeamsBackend&&!u&&s.skypeEditedId)return(c=this.filterMessagesByKey(e.allMessages,s.key))?this._messageTypesHandler.updateExistingMessage(c,s,i):(r&&s.skypeEditedId&&((u=this._messageTypesHandler.handle(t,{conversation:this.conversation,isHistory:i})).id=s.skypeEditedId,u.skypeEditedId=void 0,this._messageTypesHandler.updateExistingMessage(u,s,i),n.pushObservable(u)),e.allMessages.pushObservable(s)),s;if(!u&&!s.skypeEditedId&&(c=this.filterMessagesByKey(e.allMessages,s.key)))return this._messageTypesHandler.updateExistingMessage(c,s,i),n.pushObservable(c),c;if(j.test(s.content)&&(s.content=s.content.replace(j,"$1"+y.default.dompurify.sanitize('<a class="replacedImg" href="$2" target="_blank"><img src="$2" alt=""></a>',H)+"$3")),B.test(s.content)){var l=s.content.match(B);l&&!l[2]&&(s.content=s.content.replace(l[0],y.default.dompurify.sanitize(l[0],H)))}return u?this._messageTypesHandler.updateExistingMessage(u,s,i):n.pushObservable(s),s},e.prototype.createMessageData=function(e){var t={contenttype:"text",composetime:(new Date).toISOString(),clientmessageid:Date.now().toString()};return Object.assign(t,e||{})},e.prototype.pushMessageToConversation=function(e,t){var n;return g.MessageType.SWIFT!==e&&(n=this._messageTypesHandler.generateOutgoing(t)),n&&this.conversation.messages.pushObservable(n),n},e.prototype.prepareForSending=function(e){var t=this;return new Promise(function(n,i){t.conversation.isSealed&&i("Conversation is Sealed and cannot be used for sending messaged");var r=-1!==e.messagetype.indexOf("Control");t._quarantineCountDown>=0&&!r&&(t._quarantineCountDown++,t.conversation.isChatEnabled=t.conversation.isChatEnabled&&t._quarantineCountDown<10,t.checkIfBuddy()),t._pendingContactRequest&&!r&&(t._pendingContactRequest=!1,b.swc.services.webApi.acceptConversation(t.conversation.id));var o=t.mePerson;o&&o.displayName&&(e.imdisplayname=o.displayName);var s=Date.now(),a=t.conversation.isAgent&&"RichText"===e.messagetype&&A.get().isOnline;a&&t.conversation.participants.length&&(t.conversation.participants[0].isTyping=!0),t.conversation.contextAad&&(e.content+='<context reason="customAad">'+t.conversation.contextAad+"</context>"),n({startTime:s,showTypingInAdvance:a})})},e.prototype.sendMessageToService=function(e,t,n,i,r){var o=this;return this.prepareForSending(t).then(function(s){var a=s.startTime,c=s.showTypingInAdvance;r=r||o.pushMessageToConversation(e,t);var u=function(i){r&&(r.status=x.DeliveryStatus.Sent),n&&n.origin!==d.ActionTrigger.TYPING&&(o.conversation.messagesSent++,o.updateConsumptionHorizonToLastMessage()),b.swc.Telemetry.sendEvent.messageSent(o.conversation,e,Date.now()-a,200,t.content.length||0,o.conversation.messagesSent,null,null,null,k.MessageUtils.containsMention(t.content),k.MessageUtils.containsEmoticon(r&&r.content),k.MessageUtils.containsLargeEmoticon(r&&r.content))},l=function(n){r&&(r.status=x.DeliveryStatus.Failed),c&&o.conversation.participants.length&&(o.conversation.participants[0].isTyping=!1),b.swc.Telemetry.sendEvent.messageSent(o.conversation,e,Date.now()-a,n.status,t.content.length||0,o.conversation.messagesSent,void 0,n.errorCode,n.message,k.MessageUtils.containsMention(t.content),k.MessageUtils.containsEmoticon(r&&r.content),k.MessageUtils.containsLargeEmoticon(r&&r.content)),804===n.errorCode&&(o.conversation.isChatEnabled=!1,o.conversation.isUnderQuarantine=!0,o.checkIfBuddy()),403!==n.status&&404!==n.status||(o.conversation.isSealed=!0,o.conversation.isChatEnabled=!1)};return(i||Promise.resolve({})).then(function(){return b.swc.services.webApi.sendMessage(o.conversation.id,t).then(u,l)},l)})},e.prototype.updateConsumptionHorizonToLastMessage=function(){var e=this;if(0!==this.conversation.messages.length&&this.conversation.isActive&&c.default.instance.isFocused){var t=this.conversation.messages[this.conversation.messages.length-1];if(!(this.conversation.consumptionHorizon.lastReadMessageTimestamp>=t.timestamp.getTime())){var n="";o.default.get.isTeams()&&this.conversation.isUnreadBookmark?(n=this.getUpdatedConsumptionHorizon(0,(new Date).getTime(),"0"),b.swc.services.webApi.updateConsumptionHorizonBookmark(this.conversation.id,n).then(function(){e.conversation.updateConsumptionHorizon(n)})):(n=this.getUpdatedConsumptionHorizon(t.timestamp.getTime(),(new Date).getTime(),t.key),b.swc.services.webApi.updateConsumptionHorizon(this.conversation.id,n).then(function(){e.conversation.updateConsumptionHorizon(n)}))}}},e.prototype.getUpdatedConsumptionHorizon=function(e,t,n){return e+";"+t+";"+n},e.prototype.parseConversationTopic=function(e){var t=this,n={};return this.conversation.participants.forEach(function(e){if(e.person.displayName)n[e.person.mri]=e.person.displayName;else{n[e.person.mri]=e.person.mri;var i=function(r){n[e.person.mri]=r,t.conversation.topic=S.default.parseConversationTopic(t.conversation.topic,n,t.mePerson.mri),e.person.unsubscribe("displayName",i)};e.person.subscribe("displayName",i)}}),0===this.conversation.participants.length&&this.conversation.members&&this.conversation.members.forEach(function(e){e.name&&(n[e.id]=e.name)}),S.default.parseConversationTopic(e,n,this.mePerson.mri)},e.prototype.updateConversationProperties=function(e,t){var n=this;if(void 0===t&&(t=!1),e&&(e.topic&&(this.conversation.topic=this.parseConversationTopic(e.topic)),e.picture&&(this.conversation.avatar=e.picture.replace("URL@","")),this._isTeamsBackend&&e.members)){var i=[];if(e.members.forEach(function(e){if(!b.swc.services.mePersonManager.isMe(e.id)){var t=b.swc.services.persons.getPerson(e.id);t.displayName&&i.push({userId:e.id,displayName:t.displayName})}}),0===i.length)return;b.swc.services.signInManager.isAadSupported()&&b.swc.services.avatarService.fetchMergedAvatars(i).then(function(e){e&&(n.conversation.avatar=e)})}},e}();t.default=q},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prepare=function(e){return e=(e=e.replace(/&nbsp;/g," ").replace(/<div( itemprop="copy-paste-block")?>/g,"").replace(/<\/div>/g,"").trim()).replace(/<span[^>]*type="(\([a-z]+\))"[^>]*><img[^>]*itemid="(\w+)"[^>]*><\/span>/g,'<ss type="$2">$1</ss>')},e}();t.TeamsMessageUtil=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.addFormatting=function(t){return t=e.addFormattingTags(t,"s",/(\s|^|_|\*|i>|b>|s>)~((?!~\s).)*~(\s|$|_|\*|<)/gi,"~")},e.addFormattingTags=function(t,n,i,r){for(var o=t.match(i);o&&o.length>0&&2!==o[0].trim().length;)o.forEach(function(i){var o=i.trim(),s=(o=o.substring(o.indexOf(r),o.lastIndexOf(r)+1)).substr(1,o.length-2);s=e.createStartTag(n,r)+s+e.createEndTag(n),t=t.replace(o,s)}),o=t.match(i);return t},e.createStartTag=function(e,t){return"<"+e+' raw_pre="'+t+'" raw_post="'+t+'">'},e.createEndTag=function(e){return"</"+e+">"},e}();t.default=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),s=n(2),a=n(0),c=n(119),u=n(76),l=/^\w$/,p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.fixInvalidHtml=function(e){return e.replace(/<canvas((?:\s?(?:data-[-a-z]*|height|width)="[a-z0-9]*")*)\s*\/>/g,"<canvas$1></canvas>")},t.prototype.createHtmlElement=function(e,t,n,i,r,a){var u={large:i,largeEmoticonClass:a,textContent:n,emoticonId:t,isAnimated:!r},l=s.createElement(c.SwcEmoticon,u),p=document.createDocumentFragment();return o.render(l,p),p},t.prototype.isElementAllowed=function(e){return"span"!==e.nodeName.toLowerCase()||-1===e.className.toLowerCase().indexOf("emoticon")},t.prototype.encodeTextNodeToXml=function(t,n,i,r){n.parentNode&&"a"!==n.parentNode.nodeName.toLowerCase()&&e.prototype.encodeTextNodeToXml.call(this,t,n,i,r)},t.prototype.wordRawToXml=function(e,t,n){var i=[],r=0,o=a.swc.services.pesManager.map;if(!a.swc.services.pesManager.canRenderConfigItems()||n&&n.isSfB)return i;for(var s=0;s<t.length;s++){for(var c="",u=-1,l=s+1;l<t.length+1;l++){var p=t.substring(s,l),d=o.hasOwnProperty(p)&&o[p];d&&!this.isWordChar(t[l])&&(c=d,u=l)}c&&(r!==s&&i.push(e.createTextNode(t.substring(r,s))),r=u,i.push(this.createXmlElement(e,c,t.substring(s,u))),s=u-1)}return 0!==r&&r<t.length&&i.push(e.createTextNode(t.substring(r))),i},t.prototype.createXmlElement=function(e,t,n){var i=e.createElement("ss");return i.setAttribute("type",t),i.innerText=n,i},t.prototype.isWordChar=function(e){return l.test(e)},t}(u.WordDomTransformer);t.default=p},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.isElementAllowed=function(e){return"i"!==e.nodeName.toLowerCase()||-1===e.className.toLowerCase().indexOf("mention")},t.prototype.xmlNodeToHtml=function(e,t){if("at"===t.nodeName.toLowerCase()&&t.attributes.getNamedItem("id")){var n=e.createElement("span");return n.setAttribute("data-mention-id",t.attributes.getNamedItem("id").value),n.setAttribute("class","mention"),n.setAttribute("title",t.attributes.getNamedItem("id").value),n.textContent="@"+t.textContent,[n]}return[]},t}(n(284).DomTransformerBase);t.MentionDomDecoder=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.transformRawToXml=function(e,t,n,i){var r=[];for(r.push(t);0!==r.length;){var o=r.pop();this.encodeTextNodeToXml(e,o,n,i)&&o.nodeType!==Node.TEXT_NODE&&this.isElementAllowed(o)&&this.pushChildNodes(r,o)}},e.prototype.encodeTextNodeToXml=function(e,t,n,i){var r=t.parentNode,o=this.xmlNodeToHtml(e,t,n,i);if(!o||!o.length)return!0;for(var s=0;s<o.length;s++)r.insertBefore(o[s],t);return r.removeChild(t),!1},e.prototype.pushChildNodes=function(e,t){for(var n=0;n<t.childNodes.length;n++)e.push(t.childNodes[n])},e}();t.DomTransformerBase=i},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.isElementAllowed=function(e){return"pre"!==e.nodeName.toLowerCase()},t.prototype.wordRawToXml=function(e,t){return[s(e)]},t.prototype.getAllWords=function(e){for(var t,n=/\r?\n/g,i=new Array;null!==(t=n.exec(e));)i.push(t);return i},t}(n(76).WordDomTransformer);function s(e){return e.createElement("br")}t.NewLineDomTransformer=o},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.isElementAllowed=function(e){return"a"!==e.nodeName.toLowerCase()},t.prototype.wordRawToXml=function(e,t){var n,i=t.match(/^(?:https?:\/\/|mailto:)(.+)$/i),r=i&&i[0],o=r;return r||(r=(i=t.match(/^[^@]+@(?:\w+(?:\.\w+)+)$/i))&&"mailto:"+i[0],o=i&&i[0]),r||(i=t.match(/^(?:www(?:\.\w+){1,}\.(?:com|org|net|edu|gov|mil|aero|arpa|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|pro|tel|travel|[a-z]{2,3}))$/i))&&i[0]&&(n=i.input?i.input.split("?")[1]:"",r="https://"+i[0],o=r=n?r+"?"+n:r),r?[s(e,r,o)]:[]},t.prototype.wordMatcher=function(){return/\S+/g},t}(n(76).WordDomTransformer);function s(e,t,n){var i=e.createElement("a");return i.setAttribute("href",t),i.setAttribute("title",t),i.setAttribute("target","_blank"),i.setAttribute("tabindex","-1"),i.innerText=n,i}t.URLDomTransformer=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(1),o=n(147),s=n(4),a=n(9),c=n(288),u=n(289),l=n(290),p=n(294),d=n(295),f=n(296),h=n(297),g=n(298),m=n(299),v=n(300),y=n(301),_=n(302),b=n(303),T=n(304),S=n(305),w=n(306),P=function(){function e(){this._processors=[],this._xmmFallbackProcessor=new w.default,this._processors.push(new T.default),this._processors.push(new c.default),this._processors.push(new p.default),this._processors.push(new _.default),this._processors.push(new S.default),this._processors.push(new y.default),this._processors.push(new h.default),this._processors.push(new m.default),this._processors.push(new b.default),this._processors.push(new l.default),this._processors.push(new g.default),this._processors.push(new f.FileMessageProcessor),this._processors.push(new v.default),this._processors.push(new d.default),this._processors.push(new u.default)}return e.prototype.handle=function(e,t){var n,i=0;for(e.contentOriginal&&e.contentOriginal!==e.content?e.content=e.contentOriginal:e.contentOriginal=e.contentOriginal||e.content;!n&&i<this._processors.length;)n=this._processors[i].process(e,t),i++;return n||(n=this._xmmFallbackProcessor.process(e)),n},e.prototype.generateOutgoing=function(e){for(var t,n=0;!t&&n<this._processors.length;)t=this._processors[n].generate(e),n++;return t},e.prototype.updateExistingMessage=function(e,t,n){if(!t||e.senderId!==t.senderId&&e.customType!==s.CustomMessageType.Call)return e;var c=0===t.content.indexOf(r.Configuration.MSG_DELETED_CLASSIC_SKYPE),u=0===e.content.indexOf(r.Configuration.MSG_DELETED_CLASSIC_SKYPE),l=t.skypeEditedId&&c,p=t.version>e.version,d=t.originalTimestamp>e.originalTimestamp,f=p||d;return d&&n&&(e.content=l?a.MessageUtils.extractMsgContent(t.content):t.content,e.timestamp=t.timestamp,e.originalTimestamp=t.originalTimestamp),e.type!==s.MessageType.LwcFile&&e.type!==s.MessageType.LwcImage||(e.content=t.content),e.status=t.status,t.skypeEditedId?t.editedTimestamp&&o.default.updateMessageProperties(e,t):o.default.updateMessageProperties(e,t),t.isEdited&&(e.isEdited=!0,u&&(e.content=a.MessageUtils.extractMsgContent(e.content)),(t.editedTimestamp>e.timestamp||f)&&(e.content=t.content)),e.isEdited&&!d&&n&&(e.timestamp=t.timestamp),t.isDeleted&&(e.isDeleted=!0),i.default.get.isTeams()&&(e.isDeleted=t.isDeleted,e.files=t.files,e.id===t.clientMessageId&&(e.id=t.id)),e},e.prototype.isTypingIndicator=function(e){return"Control/Typing"===e.messagetype||"Control/ClearTyping"===e.messagetype},e}();t.default=P},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(104),s=n(0),a=n(17),c=n(39),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e,t){if("ThreadActivity/AddMember"!==e.messagetype)return null;var n=new c.default(this._createMessageModel.bind(this),this._generateContent,e);n.subscribeOnceToPersonsName(n._initiator),n._targets.forEach(n.subscribeOnceToPersonsName);var i=this.parseContentFor(e.content,"target"),r=s.swc.services.persons.getPerson(i),a=t.conversation.participants;if(!t.isHistory&&i&&a&&!a.some(function(e){return e.person.id===r.id})){var u=new o.default(r);a.pushObservable(u),r.isAgent&&s.swc.Eventing.triggerEvent("botAddedToThread",r.id)}return t.conversation.isOneOnOne&&(n._messageModel.content=""),n._messageModel},t.prototype._generateContent=function(e){var t=e._initiator.displayName||e._initiator.id,n=document.createElement("p");return n.innerText=t,e.isSelfAction()?s.swc.services.i18n.fetch("joinedConversation",{participant:"<b>"+n.innerHTML+"</b>"}):s.swc.services.i18n.fetch("wasAdded",{participant:"<b>"+n.innerHTML+"</b>",contact:"<b>"+e._targets.filter(function(t){return t.id!==e._initiator.id}).map(function(e){var t=e.displayName||e.id,n=document.createElement("p");return n.innerText=t,n.innerHTML}).join("</b>, <b>")+"</b>"})},t}(a.default);t.default=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(9),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e){if("RichText/Media_CallRecording"!==e.messagetype)return null;var t=this._parseRawMessage(e.content);if(!t)return null;if(!this._isValidCallRecordingMessage(t))return null;var n=this._createMessageModel(e);return n.type=o.MessageType.LwcCallRecording,n.content=this._createMessageContent(t),n},t.prototype._parseRawMessage=function(e){if(!e)return null;var t=e.match(/<URIObject[^>]*?\suri=\"([^"]+?)\"/i),n=e.match(/<URIObject[^>]*?\stype=\"([^"]+?)\"/i),i=e.match(/<URIObject[^>]*?\surl_thumbnail=\"([^"]+?)\"/i),r=e.match(/<originalname[^>]*?\sv=\"([^"]+?)\"/i);return t?{filename:r?r[1]:null,uri:s.MessageUtils.normalizeUrl(t[1]),xmmType:n?n[1].split(".")[0]:null,thumbnail:i?i[1]:null}:null},t.prototype._isValidCallRecordingMessage=function(e){return e&&e.uri&&"Video"===e.xmmType},t.prototype._createMessageContent=function(e){return["<LwcCallRecording",'url="'+e.uri+'"','thumbnail="'+e.thumbnail+'"','filename="'+e.filename+'"></LwcCallRecording>'].join(" ")},t}(n(17).default);t.default=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),s=n(291),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e,t){return(o.Configuration.ECS.showEngagementCampaings&&"PopCard"===e.messagetype||"Notice"===e.messagetype)&&s.default.instance.register(e,t),null},t}(n(17).default);t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(0),o=n(292),s=12096e5,a=function(){function e(){var e=this;this.register=function(t,n){var i,s;if(e._isSupported(n.conversation)&&e._isWithinTwoWeeks(t)){try{s=JSON.parse(t.content)}catch(e){}if(s&&s.length){switch(t.messagetype){case"Notice":i=new o.default(s[0],t.messagetype)}e._isInValid(i.validUntilTimestamp)||i&&r.swc.Eventing.triggerEvent("campaign:show",i)}}},this._isSupported=function(t){return t.isAgent&&e._isConversationWithConciergeBot(t.id)},this._isInValid=function(e){return Date.now()>e.getTime()},this._isWithinTwoWeeks=function(e){var t=Date.now()-s;return new Date(e.originalarrivaltime).getTime()>t},this._isConversationWithConciergeBot=function(e){return e===i.Configuration.CONCIERGE_BOT_MRI||e===i.Configuration.CONCIERGE_BOT_DF_MRI}}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e}();t.default=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.campaignId=t.campaignId,i.schemaVersion=t.schemaVersion,i.attachment=t.attachments&&t.attachments.length?t.attachments[0]:null,i}return r(t,e),t}(n(293).default);t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(12);t.NOTICE_CONTENT_TYPE={GENERIC:"application/vnd.microsoft.notice",USER:"application/vnd.microsoft.notice.avatar"};var r=function(){return function(e,t){this.id=e.campaignGuid||e.campaignId||i.guid.generate(),this.type=t,this.language=e.language,this.clientVersion=e.clientVersion,this.platformList=e.platformList,this.userTagging=e.userTagging,this.validUntilTimestamp=e.validUntilTimestamp?new Date(e.validUntilTimestamp):null,this.experimentName=e.experimentName,this.contentCategory=e.contentCategory,this.telemetry=e.telemetry}}();t.default=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),s=n(0),a=n(17),c=n(39),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e,t){if("ThreadActivity/DeleteMember"!==e.messagetype)return null;var n=new c.default(this._createMessageModel.bind(this),this._generateContent,e);if(n.subscribeOnceToPersonsName(n._initiator),n._targets.forEach(function(e){n.subscribeOnceToPersonsName(e),t.conversation&&e===s.swc.services.mePersonManager.mePerson&&o.ServicesManager.cbl.deleteMemberProcessor.shouldDisableChatInputForCurrentUser(t.isHistory)&&(t.conversation.isChatEnabled=!1)}),!1===t.isHistory)for(var i=this.parseContentFor(e.content,"target"),r=s.swc.services.persons.getPerson(i),a=0;a<t.conversation.participants.length;a++){if(t.conversation.participants[a].person.id===r.id){t.conversation.participants.spliceObservable(a,1);break}}return n._messageModel},t.prototype._generateContent=function(e){var t=e._initiator.displayName||e._initiator.id,n=document.createElement("p");return n.innerText=t,e.isSelfAction()?s.swc.services.i18n.fetch("hasLeftConversation",{participant:"<b>"+n.innerHTML+"</b>"}):s.swc.services.i18n.fetch("wasRemoved",{participant:"<b>"+n.innerHTML+"</b>",removedParticipant:"<b>"+e._targets.map(function(e){var t=e.displayName||e.id,n=document.createElement("p");return n.innerText=t,n.innerHTML}).join("</b>, <b>")+"</b>"})},t}(a.default);t.default=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(0),a=n(83),c=n(9),u=n(17),l=function(e,t){return s.swc.services.i18n.fetch(e,t)},p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._getMissedCallMessage=function(e,t){var n=s.swc.services.persons.getPerson(e),i=l("message_text_missedCallFrom",{fromParticipant:n.displayName||n.id});return n.displayName||n.fetchDisplayNameAndAvatar().then(function(){var n=s.swc.services.persons.getPerson(e),i=l("message_text_missedCallFrom",{fromParticipant:n.displayName});t.content=c.MessageUtils.getMessageSanitizedContent(i)}),i},t._getParticipantIds=function(e){for(var t=[],n=/<part identity="(.*?)">/g,i=n.exec(e);null!==i;)t.push(i[1]),i=n.exec(e);return t},t._getDurationMessage=function(e){var t="",n=Math.floor(e/3600);n>0&&(t+=n+l("message_text_hours")+" ");e%=3600;var i=Math.floor(e/60);i>0&&(t+=i+l("message_text_minutes")+" ");var r=e%60;r>0&&(t+=r+l("message_text_seconds"));return t.trim()},t}return r(t,e),t.prototype.process=function(e,t){var n=this;if("Event/Call"!==e.messagetype&&"Signal/Flamingo"!==e.messagetype)return null;var i=this._createMessageModel(e,"",!0),r=e.conversationId||e.conversationid||"",u=t&&t.conversation&&t.conversation.isGroup||a.default.detectConversationType(r)===o.ConversationType.GROUP,p=e.content.replace(/\r?\n/g,""),d=o.CustomMessageType.Call,f=function(){var t=null;if(p.indexOf("<partlist")>-1){var r=/(<partlist alt ?= ?"">\s*<\/partlist>)|(<partlist type="started")/.test(p),a=/(^<ended)|(<partlist type="ended")/.test(p),f=/<partlist type="missed"/.test(p),h=new RegExp("<duration>([\\d|\\.]+)</duration>"),g=p.match(h.source),m=n._getParticipantIds(p),v=1===m.length,y=g?parseInt(g[1],10):0,_=c.MessageUtils.getSenderIdFromUrl(e.from),b=u?"GroupCall":"Call";if(r)t=l("message_text_startedCall"),d=o.CustomMessageType.Call;else if(a&&!v){var T=y?"<span>"+n._getDurationMessage(y)+"</span>":"";t=y?l("message_text_ended"+b)+" "+T:l("message_text_noAnswer"+b),d=o.CustomMessageType.CallEnd}else if(f||a&&v){var S=s.swc.services.mePersonManager.isMe(_);t=l("message_text_missed"+b),f&&!S&&(t=n._getMissedCallMessage(_,i)),S=m&&s.swc.services.mePersonManager.isMe(m[0]),a&&v&&!S&&(t=n._getMissedCallMessage(m[0],i)),d=u?o.CustomMessageType.MissedGroupCall:o.CustomMessageType.MissedCall}}i.content=c.MessageUtils.getMessageSanitizedContent(t)};return f(),s.swc.Eventing.registerEvent("proxy:configuration:setLanguage:response",f),i.senderId=c.MessageUtils.getSenderIdFromUrl(e.from),i.sender=s.swc.services.persons.getPerson(i.senderId),i.isDeleted=!1,i.isEdited=!1,i.customType=d,i.content?i:null},t}(u.default);t.default=p},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(9),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.parseRawMessage=function(e){if(!e)return null;var t=e.match(/<URIObject[^>]*?\suri=\"([^"]+?)\"/i),n=e.match(/<URIObject[^>]*?\stype=\"([^"]+?)\"/i),i=e.match(/<meta[^>]*?\stype=\"([^"]+?)\"/i);return t?{uri:t[1],uriObjectType:i?i[1]:null,xmmType:n?n[1].split(".")[0]:null,size:null,originalName:null}:null},t.isValidFileMessage=function(e){return null===e||null===e.uri||"File"!==e.xmmType},t.createFileContent=function(e){return'<LwcFile url="'+e.uri+'" size="'+e.size+'" originalName="'+e.originalName+'"></LwcFile>'},t}return r(t,e),t.prototype.process=function(e){if(-1===["RichText/UriObject","RichText/Media_GenericFile","RichText/Media_Video","RichText/Media_AudioMsg","RichText/Media_Card"].indexOf(e.messagetype))return null;var t=e.content,n=this.parseRawMessage(t);if(!n)return e.content=s.MessageUtils.getMessageSanitizedContent(e.content),this._createMessageModel(e);if(this.isValidFileMessage(n))return null;var i=t.match(/<FileSize[\s]+[^<]*v=\"([\d]*?)\"[^<]/i),r=t.match(/<OriginalName[\s]+[^<]*v=\"([\s\S]*?)\"[^<]/);n.size=i?i[1]:"0",n.originalName=r?r[1]:null;var a=this._createMessageModel(e);return a.type=o.MessageType.LwcFile,a.content=this.createFileContent(n),a},t.prototype.generate=function(e){if("RichText/Media_GenericFile"!==e.messagetype)return null;var t=e.content,n=this.parseRawMessage(t);if(this.isValidFileMessage(n))return null;var i=t.match(/<FileSize[\s]+[^<]*v=\"([\d]*?)\"[^<]/i),r=t.match(/<OriginalName[\s]+[^<]*v=\"([\s\S]*?)\"[^<]/);n.size=i?i[1]:"0",n.originalName=r?r[1]:null;var s=this._generateOutgoingModel(e);return s.type=o.MessageType.LwcFile,s.content=this.createFileContent(n),s},t}(n(17).default);t.FileMessageProcessor=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(17),a=n(39),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e){if("ThreadActivity/HistoryDisclosedUpdate"!==e.messagetype)return null;var t=new a.default(this._createMessageModel.bind(this),this._generateContent.bind(this,e.content),e);return t.subscribeOnceToPersonsName(t._initiator),t._messageModel},t.prototype._generateContent=function(e,t){var n=t._initiator.displayName||t._initiator.id,i=document.createElement("p");return i.innerText=n,"false"===this._getUpdateValue(e)?o.swc.services.i18n.fetch("historyDisclosed",{participant:"<b>"+i.innerHTML+"</b>"}):o.swc.services.i18n.fetch("historyClosed",{participant:"<b>"+i.innerHTML+"</b>"})},t.prototype._getUpdateValue=function(e){var t=e.match(/<value>(.+)<\/value>/i);return t?t[1]:""},t}(s.default);t.default=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(9),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.parseRawMessage=function(e){if(!e)return null;var t=e.match(/<URIObject[^>]*?\suri=\"([^"]+?)\"/i),n=e.match(/<URIObject[^>]*?\stype=\"([^"]+?)\"/i),i=e.match(/<meta[^>]*?\stype=\"([^"]+?)\"/i),r=e.match(/<originalname[^>]*?\sv=\"([^"]+?)\"/i);if(!t)return null;var o=new c;return o.filename=r?r[1]:null,o.uri=s.MessageUtils.normalizeUrl(t[1]),o.uriObjectType=i?i[1]:null,o.xmmType=n?n[1].split(".")[0]:null,o},t.isValidImageMessage=function(e){return null===e||null===e.uri||!("Picture"===e.xmmType||"photo"===e.uriObjectType)},t.createImageContent=function(e){return'<LwcImage url="'+e.uri+'" filename="'+e.filename+'" ></LwcImage>'},t}return r(t,e),t.prototype.process=function(e){if("RichText/UriObject"!==e.messagetype)return null;var t=this.parseRawMessage(e.content);if(!t&&e.skypeeditedid)return this._createMessageModel(e);if(t&&""===t.uri)return e.content=null,this._createMessageModel(e);if(this.isValidImageMessage(t))return null;var n=this._createMessageModel(e);return n.type=o.MessageType.LwcImage,n.content=this.createImageContent(t),n},t.prototype.generate=function(e){if("RichText/UriObject"!==e.messagetype)return null;var t=this.parseRawMessage(e.content);if(this.isValidImageMessage(t))return null;var n=this._generateOutgoingModel(e);return n.type=o.MessageType.LwcImage,n.content=this.createImageContent(t),n},t}(n(17).default);t.default=a;var c=function(){return function(){}}()},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(17),a=n(39),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e){if("ThreadActivity/JoiningEnabledUpdate"!==e.messagetype)return null;var t=new a.default(this._createMessageModel.bind(this),this._generateContent.bind(this,e.content),e);return t.subscribeOnceToPersonsName(t._initiator),t._messageModel},t.prototype._generateContent=function(e,t){var n=t._initiator.displayName||t._initiator.id,i=document.createElement("p");return i.innerText=n,"true"===this._getUpdateValue(e)?o.swc.services.i18n.fetch("joiningEnabled",{participant:"<b>"+i.innerHTML+"</b>"}):o.swc.services.i18n.fetch("joiningDisabled",{participant:"<b>"+i.innerHTML+"</b>"})},t.prototype._getUpdateValue=function(e){var t=e.match(/<value>(.+)<\/value>/i);return t?t[1]:""},t}(s.default);t.default=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(9),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e){if(e.messagetype!==o.MessageType.SystemMessage)return null;var t=s.MessageUtils.getMessageSanitizedContent(e.content);return this._createMessageModel(e,t,!0)},t}(n(17).default);t.default=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(17),a=n(39),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e,t){if("ThreadActivity/PictureUpdate"!==e.messagetype)return null;var n=new a.default(this._createMessageModel.bind(this),this._generateContent,e);if((n.subscribeOnceToPersonsName(n._initiator),t.conversation&&t.conversation.messages&&t.conversation.messages.length)&&t.conversation.messages[t.conversation.messages.length-1].timestamp<n._messageModel.timestamp){var i=this.getNewPicture(e.content);t.conversation.avatar=i||t.conversation.avatar}return n._messageModel},t.prototype._generateContent=function(e){var t=e._initiator.displayName||e._initiator.id,n=document.createElement("p");return n.innerText=t,o.swc.services.i18n.fetch("threadPictureUpdated",{participant:"<b>"+n.innerHTML+"</b>"})},t.prototype.getNewPicture=function(e){var t=e.match(/URL@([^<]+)(?=<\/value>)/g);return t?t[0].replace("URL@",""):null},t}(s.default);t.default=c},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(0),a=n(17),c=n(39),u={admin:o.ParticipantRole.Admin,user:o.ParticipantRole.User},l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._updateParticipantRoles=function(e,t,n){var i=u[n.toLowerCase()];t.forEach(function(t){e.participants.forEach(function(e){var n=e.person.id;t.id===n&&(e.role=i)})})},t}return r(t,e),t.prototype.process=function(e,t){if("ThreadActivity/RoleUpdate"!==e.messagetype)return null;var n=this._getRole(e.content),i=new c.default(this._createMessageModel.bind(this),this._generateContent.bind(this,n),e);return i.subscribeOnceToPersonsName(i._initiator),i._targets.forEach(i.subscribeOnceToPersonsName),t.conversation&&t.conversation.participants&&this._updateParticipantRoles(t.conversation,i._targets,n),i._messageModel},t.prototype._generateContent=function(e,t){var n=t._initiator.displayName||t._initiator.id,i=document.createElement("p");i.innerText=n;var r=t._targets[0].displayName||t._targets[0].id,o=document.createElement("p");return o.innerText=r,s.swc.services.i18n.fetch("roleUpdated",{who:"<b>"+i.innerHTML+"</b>",whom:"<b>"+o.innerHTML+"</b>",role:"<b>"+e+"</b>"})},t.prototype._getRole=function(e){var t=e.match(/<role>(.+)<\/role>/i);return t?t[1]:""},t}(a.default);t.default=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(35),a=n(0),c=n(9),u=n(32),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._getTitle=function(e){var t=e.content.match(/<Title>(.*)<\/Title>/i);return t?t[1]:a.swc.services.i18n.fetch("s_title",{mesageType:e.messagetype})},t}return r(t,e),t.prototype.process=function(e){if("RichText/Media_Card"!==e.messagetype)return null;var t=this._getTitle(e),n=e.content.match(/<Swift b64="([^"]+)"\s*\/>/i);try{var i=u.b64DecodeUnicode(n[1]);i=c.MessageUtils.getMessageSanitizedContent(i),i=encodeURIComponent(i),e.content='<SwiftCard Swift="'+i+'">'+s.default.dompurify.sanitize(t,{ALLOWED_TAGS:[]})+"</SwiftCard>"}catch(e){return null}var r=this._createMessageModel(e);r.type=o.MessageType.SwiftCard;try{r.content=decodeURIComponent(e.content)}catch(e){return null}return r},t}(n(17).default);t.default=l},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(91),s=n(9),a=n(17),c=/<context reason=\"customAad\">.*<\/context>/g,u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e,t){if("RichText"!==e.messagetype&&"Text"!==e.messagetype&&"InviteFreeRelationshipChanged/Initialized"!==e.messagetype&&"RichText/Html"!==e.messagetype)return null;e.content||(e.content="");var n=e.content,i=n.match(c);i&&i[0]&&(n=n.replace(i[0],"")),e.content=n;var r=this._createMessageModel(e);return r.content=o.default.parse(r.content),r.content=s.MessageUtils.getMessageSanitizedContent(r.content,t),r},t.prototype.generate=function(e){return"RichText"!==e.messagetype&&"RichText/Html"!==e.messagetype?null:this._generateOutgoingModel(e)},t}(a.default);t.default=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(9),a=n(17),c=n(39),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e,t){if("ThreadActivity/TopicUpdate"!==e.messagetype)return null;e.threadtopic&&t.conversation&&(t.conversation.topic=s.MessageUtils.parseTopic(e.threadtopic));var n=new c.default(this._createMessageModel.bind(this),this._generateContent.bind(this,e.content),e);return n.subscribeOnceToPersonsName(n._initiator),n._messageModel},t.prototype._generateContent=function(e,t){var n=this.parseContentFor(e,"value");n=(n=n?s.MessageUtils.unescape(n):"")?s.MessageUtils.parseTopic(n):"";var i=t._initiator.displayName||t._initiator.id,r=document.createElement("p");r.innerText=i;var a=document.createElement("p");return a.innerText=n,o.swc.services.i18n.fetch("topicUpdated",{participant:"<b>"+r.innerHTML+"</b>",topic:"<i>"+a.innerHTML+"</i>"})},t}(a.default);t.default=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),s=n(4),a=n(0),c=n(17),u=["RichText/UriObject","RichText/Media_GenericFile","RichText/Media_Video","RichText/Media_FlikMsg","RichText/Media_Card","RichText/Contacts","RichText/Location","RichText/Files","RichText/Sms","Event/SkypeVideoMessage","Event/SkypeAudioMessage"],l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.process=function(e){if(u.indexOf(e.messagetype)<0)return null;var t=e.content.match(/^<uriobject[^>]*?>(.*?)<\/uriobject>$/i);if(!t){var n=this._createMessageModel(e,a.swc.services.i18n.fetch("m_unsupported"));return n.type=s.MessageType.Unsupported,a.swc.Eventing.registerEvent("proxy:configuration:setLanguage:response",function(){n.content=a.swc.services.i18n.fetch("m_unsupported")}),n}var i=o.MessageUtils.getMessageSanitizedContent(t[1]);return this._createMessageModel(e,i)},t}(c.default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.DELIVERED="delivered",e.CLICK="click",e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(20),o=n(0);!function(e){e[e.replace=1]="replace"}(i=t.Rule||(t.Rule={}));var s=function(){function e(e,t,n){var i=this;this.pattern=e,this.rule=t,this.replace=function(e){return e.replace(i.pattern,i.replacer)},this.replacer=function(e){for(var t=e.length,n="",r=i.replacement;t--;)n+=r;return n},this.replacement=n}return Object.defineProperty(e.prototype,"replacement",{get:function(){return this.char?String.fromCharCode(this.char):void 0},set:function(e){this.char=e?e.charCodeAt(0):this.char},enumerable:!0,configurable:!0}),e}(),a=function(){function e(){var e=this;this.masks=[],this.setupProxy=function(){o.swc.Eventing.registerEvent("registerMask",function(t){e.register(t,i.replace,"#")}),o.swc.Eventing.registerEvent("unregisterMask",function(t){e.unregister(t)})},r.ProxyConnector.instance.connect("messageMasking",null,this.setupProxy)}return Object.defineProperty(e,"instance",{get:function(){return e.init()},enumerable:!0,configurable:!0}),e.init=function(){return e._instance||(e._instance=new e)},Object.defineProperty(e.prototype,"empty",{get:function(){return!this.masks.length},enumerable:!0,configurable:!0}),e.prototype.register=function(e,t,n){var i=this.masks.find(function(n){return n.pattern===e&&n.rule===t});i?i.replacement!==n&&(i.replacement=n):this.masks.push(new s(e,t,n))},e.prototype.unregister=function(e,t){this.masks.forEach(function(n,i,r){n.pattern!==e||t&&n.rule!==t||r.splice(i,1)})},e.prototype.shouldMask=function(e){if(this.empty)return!1;for(var t,n=0,i=this.masks;n<i.length;n++){var r=i[n];if(t=e.search(r.pattern)>-1)break}return t},e.prototype.process=function(e){return this.masks.forEach(function(t){return e=t.replace(e)}),e},e}();t.Masks=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(38),r=n(19),o=n(138),s=n(5),a=function(){function e(){var e=this;this.persons={},this.subscribedPresenceStatus={},this.subscribeToUserStatus=function(t,n){if(!t||!n)return Promise.resolve(!1);if(e.subscribedPresenceStatus[t])return Promise.resolve(!0);var i=function(){return delete e.subscribedPresenceStatus[t],Promise.resolve(!1)},o=n.bind(null,t);return e.subscribedPresenceStatus[t]=o,s.ServicesManager.initPromise.then(function(){return s.ServicesManager.signInManager.onceSignedIn().then(function(){var n=s.ServicesManager.signInManager.currentUserName,a=e.getMri(t);return s.ServicesManager.contactsService.getContact(n,a).then(function(t){if(!t)return!1;var n=e.getPerson(a);return n.subscribe("presenceStatus",o),s.ServicesManager.webApi.subscribeContactPresence(a),n.presenceStatus&&n.presenceStatus!==r.PresenceStatus.Undefined&&o(n.presenceStatus),!0},i)},i)},i)}}return e.prototype.getPerson=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var r=this.persons[e];if(!r){var a=i.default.normalizePersonId(e);r=this.persons[a]}var c=s.ServicesManager.mePerson,u=c&&(e===c.mri||e===c.id||e.indexOf(c.msaId)>-1);return!r&&c&&u&&(r=this.persons[c.mri],e=c.mri,u=!0,r||(r=c)),r||(r=this.persons[e]=new o.default(e,n,t)),r.isFilled||!t||u||r.fetchDisplayNameAndAvatar(),r},e.prototype.dispose=function(){var e=this;Object.getOwnPropertyNames(this.persons).forEach(function(t){e.persons[t].dispose()}),this.persons={},this.subscribedPresenceStatus={}},e.prototype.createEmptyPerson=function(e){var t=new o.default(e,!1,!1);return this.persons[t.id]=t,t},e.prototype.handlePresenceData=function(e,t){var n=this.getPerson(e),i=t.status;n.presenceStatus=i},e.prototype.unsubscribeFromUserStatus=function(e){if(!e||!this.subscribedPresenceStatus[e])return!1;var t=this.getMri(e);return this.getPerson(t).unsubscribe("presenceStatus",this.subscribedPresenceStatus[e]),delete this.subscribedPresenceStatus[e],!0},e.prototype.getUserStatus=function(e){var t=this;if(!e)return Promise.resolve(null);var n=function(){return Promise.resolve(null)};return s.ServicesManager.initPromise.then(function(){return s.ServicesManager.signInManager.onceSignedIn().then(function(){var i=s.ServicesManager.signInManager.currentUserName,o=t.getMri(e);return s.ServicesManager.contactsService.getContact(i,o).then(function(e){if(!e)return null;var n=t.getPerson(o);return n.presenceStatus&&n.presenceStatus!==r.PresenceStatus.Undefined?n.presenceStatus:s.ServicesManager.webApi.getUsersPresence([o]).then(function(e){var t=e[0];return t.Payload&&t.Payload.status})},n)},n)},n)},e.prototype.subscribeToMyStatus=function(e){var t=this;return s.ServicesManager.initPromise.then(function(){return s.ServicesManager.signInManager.onceSignedIn().then(function(){var n=s.ServicesManager.mePerson;return n.subscribe("presenceStatus",e),s.ServicesManager.webApi.subscribeContactPresence(n.mri),t.subscribedPresenceStatus[n.id]=e,!0},function(e){return Promise.resolve(!1)})},function(e){return Promise.resolve(!1)})},e.prototype.getMyStatus=function(){return s.ServicesManager.mePerson.presenceStatus},e.prototype.setMyStatus=function(e){return s.ServicesManager.webApi.setMyPresence(e).then(function(e){return e.ok?Promise.resolve(!0):Promise.resolve(!1)},function(e){return Promise.resolve(!1)})},e.prototype.getMri=function(e){return-1===e.indexOf("8:")?"8:"+e:e},e}();t.default=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=n(1),a=n(311),c=n(312),u=n(21),l=n(11),p=n(13),d=n(24),f=n(16),h=n(34),g=n(313),m=n(31),v=n(0),y=n(49),_=n(169),b=n(22),T=n(101),S=n(115),w=n(314),P=n(30),C=n(5),E=n(315);n(316);var O="Please disable your popup blocker as it affects sign in/out process. Repeat the operation again after disabling the blocker.",I=2e4,M=function(){function e(e,t){var n=this;this.tokenProvider=e,this.regionGtmsProvider=t,this.tokenProviderCallback=function(){return Promise.all([n.tokenProvider(),n.regionGtmsProvider()]).then(function(e){var t=e[0],i=e[1];return{tokens:{skypeToken:t,expiresIn:n.getExiresIn(t)},regionGtms:i}})}}return e.prototype.getExiresIn=function(e){return(new _.TokenParser).getTokenData(e).exp-Math.floor(Date.now()/1e3)},e}(),k=function(e){function t(n,i,r,p,g){var m=e.call(this)||this;m.outerTokenProvider=n,m.tokenType=p,m._signOutContext=new E.default,m._reloginContext=new a.default(!1),m._tokenParser=new _.TokenParser,m._userIdentityType=d.IdentityType.UNDETERMINED,m._failedSilentLoginCount=0,m.isSilentLoginEnabled=!0,m.login=function(e){if(m._externalLogin&&"function"==typeof m._externalLogin)return m._externalLogin(),void m.sendSignedInTelemetry("","externalLogin");var t=s.Configuration.LOGIN_PAGE_URL;if(t+="?client_id="+s.Configuration.LOGIN_CLIENT_ID,t+="&redirect_uri="+encodeURI(b.UrlHelper.getConnectPagePath(v.swc.EcsConfig)),t+="&lang="+s.Configuration.LOCALE,t+="&response_type=token",m._getTokenPromise&&m._getTokenPromise.status===l.PromiseStatus.Pending){var n=m.showLoginPopup.bind(m,t,e);m._getTokenPromise.promise.then(null,n)}else m.showLoginPopup(t,e)},m.logout=function(e){if(m.outerTokenProvider)return Promise.resolve();if(m._signOutContext.signoutPromise)return m._signOutContext.signoutPromise;if(m.state===u.SigninState.SigningOut)return Promise.resolve();if(m.prelogoutActions.length>0){var t=m._logout.bind(m,e);return m._signOutContext.signoutPromise=m.execPrelogoutAction(m.prelogoutActions.pop()).then(t,t),m._signOutContext.signoutPromise}return m._signOutContext.signoutPromise=m._logout(e),m._signOutContext.signoutPromise},m._logout=function(e){if(m.state===u.SigninState.SigningOut)return Promise.resolve();var t=Date.now();m._reloginContext.canRelogin||m._reloginContext.setContext(m.activeConversationSdkMode===h.SDKMode.BOT,function(){return m.getGuestToken()});var n=s.Configuration.LOGOUT_PAGE_URL;n+="?",n+="&client_id="+s.Configuration.LOGIN_CLIENT_ID,n+="&redirect_uri="+b.UrlHelper.getConnectPagePath(v.swc.EcsConfig),n+="&redirect=true",n+="&response_type=token";var i=window.open(n,"_blank",s.Configuration.LOGOUT_POPUP_FEATURES),r=null==i;return r&&m._userIdentityType===d.IdentityType.SKYPE?(m.sendSignedOutTelemetry(e,t,!0),alert(O),Promise.resolve()):(!r&&window.focus&&i.focus(),m.state=u.SigninState.SigningOut,m.state=u.SigninState.SignedOut,m.reset(),m.sendSignedOutTelemetry(e,t),m._lastAuthSource=c.AuthSource.UserLogout,o.default.get.meId="",Promise.resolve())},m.execPrelogoutAction=function(e){var t=function(){if(m.prelogoutActions.length>0){var e=m.prelogoutActions.pop();return m.execPrelogoutAction(e)}return Promise.resolve()};e&&"function"==typeof e||t();var n=e();return n&&"function"==typeof n.then?n.then(t.bind(m),t.bind(m)):t()},m.getGuestToken=function(){if(m._guestUserPromise)return m._guestUserPromise;var e=Date.now();return m._guestUserPromise=w.getGuestToken("Guest").then(function(t){return m._userIdentityType=d.IdentityType.GUEST,m.setTokenDataToCache(t.SkypeToken,86400,!0),m.sendSignedInTelemetry(t.SkypeToken,"guest",e),m._signOutContext.reset(),t},function(t){m.sendSignedInTelemetry(void 0,"guest",e,t.message),m.clearUserDataFromCache(),m._guestUserPromise=null}),m._guestUserPromise},m.showLoginPopup=function(e,t){var n,i,r=Date.now(),o=m.state===u.SigninState.SignedOut,a=function(e){var s=/(?:access_token=)([\S]*)(?:&)(?:expires_in=)([\d*]*)/g.exec(e.data);if(s&&(n=s[1],i=s[2]),s||(n=e.data.token,i=Date.now()+864e5+""),!n)return m.state=u.SigninState.SignedOut,void window.removeEventListener("message",a);m._failedSilentLoginCount=0,o&&(m.currentUsername=n?m._tokenParser.retrieveMeName(n):"",m.setTokenDataToCache(n,parseInt(i,10),!1),m.publish("resurrect",!0),m._signOutContext.reset()),o?t&&t(n):(m._reloginContext.setContext(!0,function(){return m._userIdentityType=d.IdentityType.SKYPE,m.setTokenDataToCache(n,parseInt(i,10),!1),m.sendSignedInTelemetry(n,"popup",r),t&&t(n),Promise.resolve()}),m._signOutContext.reset(),m._signOutContext.isRelogin=!0,m.logout()),m._lastAuthSource=c.AuthSource.Popup,window.removeEventListener("message",a)};window.addEventListener("message",a,!1);var l=window.open(e,"_blank",s.Configuration.LOGIN_POPUP_FEATURES);l&&window.focus&&l.focus()},m.aadTokens={},m.aad=function(e){if(!m.outerTokenProvider)return Promise.reject("outerTokenProvider is not defined");e||(e=P.AadAudience.SpacesApi);var t=function(e){return m.outerTokenProvider(e).then(function(e){return-1===e.indexOf("Bearer")?"Bearer "+e:e})};return m.aadTokens[e]||(m.aadTokens[e]=t(e)),m.aadTokens[e].then(function(n){return function(e){var t=m._tokenParser.getTokenData(e),n=Date.now()+1e4;return t&&1e3*t.exp>n}(n)?n:(m.aadTokens[e]=t(e),m.aadTokens[e])})};var y=!o.default.get.frameless&&window!==window.top&&!!window.parent,T=!p||p!==S.TokenType.Aad,I=!T&&y;return m.isSilentLoginEnabled=T,m._onceSingedInPromise=new l.CancelablePromise,m._state=u.SigninState.SignedOut,I||(m.getSkypeToken=n||m._getSkypeToken),m._externalLogin=r,o.default.get.backend=p&&"aad"===p?f.MessagingBackend.TEAMS:f.MessagingBackend.SKYPE,I&&g&&(C.ServicesManager.cbl.skypeSignInManager.clearUserDataFromCache(),m.teamsRemoteTokenExchange=new M(g.skypetokenProvider,g.regionGtmsProvider),m.getSkypeToken=function(){return m._getSkypeTokenFromAad()}),m.outerTokenProvider?T?(m.clearUserDataFromCache(),m._getInfoFromExternalToken()):m._getSkypeTokenFromAad():i&&(m.clearUserDataFromCache(),m.setTokenDataToCache(i.skypeToken,i.expiresAt,i.isGuest),T?(m._userIdentityType=t._getUserIdentityType(i),m._lastAuthSource=c.AuthSource.WX):(m.teamsTokenPromise=Promise.resolve(i.skypeToken),m.currentUsername=m._tokenParser.retrieveMeName(i.skypeToken),m.state=u.SigninState.SignedIn,m._lastAuthSource=c.AuthSource.AAD,m._userIdentityType=d.IdentityType.SKYPE)),m.prelogoutActions=[],m}return r(t,e),t._getUserIdentityType=function(e){return e.isGuest?d.IdentityType.GUEST:"aad"===e.tokenType?d.IdentityType.TEAMS:d.IdentityType.SKYPE},t.prototype._getInfoFromExternalToken=function(){var e=this;o.default.get.backend=f.MessagingBackend.SKYPE,this.outerTokenProvider().then(function(t){e.currentUsername=t?e._tokenParser.retrieveMeName(t):"";var n=e._userId.indexOf("guest:")>-1;e.state=t?u.SigninState.SignedIn:u.SigninState.SignedOut,e._lastAuthSource=n?c.AuthSource.Guest:c.AuthSource.External,e._userIdentityType=n?d.IdentityType.GUEST:d.IdentityType.SKYPE,e.sendSignedInTelemetry(t,"external",Date.now())},function(){e.state=u.SigninState.SignedOut,e._lastAuthSource=c.AuthSource.External,e.sendSignedInTelemetry(null,"external",Date.now())})},t.prototype._getSkypeToken=function(){var e=this;if(o.default.get.backend=f.MessagingBackend.SKYPE,this._getTokenPromise&&this._getTokenPromise.status===l.PromiseStatus.Pending)return this._getTokenPromise.promise;this._lastAuthSource=c.AuthSource.UNDEFINED;var t=this.getTokenDataFromCache();if(t&&t.isGuest&&o.default.get.isSkypeOnly&&(t=null),o.default.get.isGuestOnlyMode&&t&&!t.isGuest&&(this.clearUserDataFromCache(),t=null),this._signedIn||!t||t.isGuest||(t=null),t)return this.currentUsername=this._tokenParser.retrieveMeName(t.token),this._userIdentityType=t.isGuest?d.IdentityType.GUEST:d.IdentityType.SKYPE,void 0===this._signedIn&&(this.sendSignedInTelemetry(t.token,"cache",Date.now()),this.callExternalHandler(this.externalSuccessCallback)),this._lastAuthSource=c.AuthSource.Cache,this.state=u.SigninState.SignedIn,Promise.resolve(t.token);this.state=u.SigninState.SigningIn,this.clearUserDataFromCache();var n=new Promise(function(t,n){var i=e;function r(e){i.activeConversationSdkMode===h.SDKMode.BOT?(i.state!==u.SigninState.SignedIn&&(i.state=u.SigninState.SigningIn),i.getGuestToken().then(function(e){i.currentUsername=i._tokenParser.retrieveMeName(e.SkypeToken),i.state=u.SigninState.SignedIn,t(e.SkypeToken),i.callExternalHandler(i.externalSuccessCallback),i._lastAuthSource=c.AuthSource.Guest}).catch(function(e){i.clearUserDataFromCache(),i.callExternalHandler(i.externalFailureCallback,i.formatError(e)),i._guestTokenRetryInterval||(i._guestTokenRetryInterval=new T.FixedTimeout(r.bind(i),I)),i._guestTokenRetryInterval.start()})):(i.state=u.SigninState.SignedOut,n(),i.callExternalHandler(i.externalFailureCallback,i.formatError(e)))}e.state!==u.SigninState.SignedIn&&(e.state=u.SigninState.SigningIn),o.default.get.isGuestOnlyMode?r():e.silentLogin().then(function(e){this.state=u.SigninState.SignedIn,this.currentUsername=this._tokenParser.retrieveMeName(e),t(e),this.callExternalHandler(this.externalSuccessCallback),this._lastAuthSource=c.AuthSource.SilentLogin}.bind(e),function(e){return o.default.get.isSkypeOnly?(i.state=u.SigninState.SignedOut,i.callExternalHandler(i.externalFailureCallback),n()):r(e)}.bind(e))});return this._getTokenPromise=new l.CancelablePromise(n),this._getTokenPromise.promise},t.prototype.onceSignedIn=function(){return this.getSkypeToken().then(null,function(){}),this._onceSingedInPromise.promise},t.prototype.getLastAuthSource=function(){return this._lastAuthSource},Object.defineProperty(t.prototype,"lastAuthSource",{get:function(){return this._lastAuthSource},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTrusted",{get:function(){return this._signedIn&&!y.isInIframe()||!!this.outerTokenProvider||s.Configuration.ECS.enableExtendedFrameApiOn.indexOf(document.referrer)>-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(e){if(e===u.SigninState.SignedIn&&(this._lastSignedInTimestamp=Date.now()),e!==this._state){this._state=e,this._signedIn=this._state===u.SigninState.SignedIn,this.publish("state",e),this.publish("isSignedIn",this._signedIn);var t=this._onceSingedInPromise.status===l.PromiseStatus.Pending;this._signedIn&&t?this._onceSingedInPromise.resolve():this._state!==u.SigninState.SignedOut||t||(this._onceSingedInPromise=new l.CancelablePromise)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"userIdentityType",{get:function(){return this._userIdentityType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentUsername",{set:function(e){this._userId=e,o.default.get.meId=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentUserName",{get:function(){return this._userId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSignedIn",{get:function(){return this._signedIn},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reloginContext",{get:function(){return this._reloginContext},enumerable:!0,configurable:!0}),t.prototype.checkAuthFailuresCount=function(e){e>=3&&this.clearUserDataFromCache()},t.prototype.setExternalCallbacks=function(e,t){this.externalSuccessCallback=e,this.externalFailureCallback=t,this._state===u.SigninState.SignedIn&&this.callExternalHandler(this.externalSuccessCallback)},t.prototype.getTokenExpirationTime=function(){var e=this.getTokenDataFromCache();return e&&e.expiresAt},t.prototype.sendSignedInTelemetry=function(e,t,n,i){this.currentUsername=e?this._tokenParser.retrieveMeName(e):"",v.swc.Telemetry.sendEvent.signIn(e?200:500,t,n?Date.now()-n:-1,i)},t.prototype.sendSignedOutTelemetry=function(e,t,n){v.swc.Telemetry.sendEvent.signOut(n?500:200,e,t?Date.now()-t:-1,n?"Popup is blocked":void 0)},t.prototype.getRegistrationToken=function(){var e,t=v.swc.services.sessionStorage.getItem(m.SKYPE_REGTOKEN_KEY);if(t)try{e=JSON.parse(t)}catch(e){}return e},t.prototype.getTokenDataFromCache=function(){if(!this._tokenData)try{this._tokenData=JSON.parse(v.swc.services.sessionStorage.getItem(m.SKYPE_TOKEN_KEY))}catch(e){return this.clearUserDataFromCache(),null}return this._tokenData&&(this._tokenData=this.isTokenValid(this._tokenData)?this._tokenData:null),this._tokenData},t.prototype.isTokenValid=function(e){var t=this.getRegistrationToken();return!(t&&!t.value&&t.failureCount>=3)&&(!(e.expiresAt<Date.now())&&(this._userIdentityType===d.IdentityType.SKYPE&&this.activeConversationSdkMode===h.SDKMode.PERSON&&e.isGuest?(this._tokenData=null,this.clearUserDataFromCache(),!1):!(this._userIdentityType===d.IdentityType.GUEST&&this.activeConversationSdkMode===h.SDKMode.BOT&&!e.isGuest)||(this._tokenData=null,this.clearUserDataFromCache(),!1)))},t.prototype.setTokenDataToCache=function(e,t,n){var i=this,r=0;t&&(r=Date.now()+1e3*t,this._tokenRenovationTimeout&&this._tokenRenovationTimeout.reset(),this._tokenRenovationTimeout=new T.FixedTimeout(function(){o.default.get.backend===f.MessagingBackend.TEAMS?(i.teamsTokenPromise=null,i._getSkypeTokenFromAad()):n?i.getGuestToken():i.silentLogin()},1e3*Math.abs(t-60)),this._tokenRenovationTimeout.start()),v.swc.services.sessionStorage.setItem(m.SKYPE_TOKEN_KEY,JSON.stringify({token:e,expiresAt:r,isGuest:n}))},t.prototype.clearUserDataFromCache=function(){this._tokenData=null,v.swc.services.sessionStorage.removeItem(m.SKYPE_TOKEN_KEY),v.swc.services.sessionStorage.removeItem(m.SKYPE_REGTOKEN_KEY),v.swc.services.sessionStorage.removeItem(m.SKYPE_ENDPOINT_ID_KEY),v.swc.services.sessionStorage.removeItem(m.SKYPE_HAS_HISTORY_KEY)},t.prototype.silentLogin=function(){var e=this;if(!this.isSilentLoginEnabled)return Promise.reject("Silent login is disabled");if(this._silentLoginPromise)return this._silentLoginPromise;var t=Date.now();return this._silentLoginPromise=new Promise(function(n,i){var r={client_id:s.Configuration.LOGIN_CLIENT_ID,env:"live",callback:function(r){var o,s=function(i){e.sendSignedInTelemetry(i,"silent",t),e._silentLoginPromise=null,n(i)};try{o=JSON.parse(r.data)}catch(e){o=r.data?r.data:r}o.error?(o.error,"invalid_grant"===o.error&&e.clearUserDataFromCache(),e._failedSilentLoginCount<1&&e.sendSignedInTelemetry(void 0,"silent",t,o.error),e._failedSilentLoginCount++,e._silentLoginPromise=null,i(o.error)):o.token?(e.setTokenDataToCache(o.token,o.expires_in,!1),s(o.token)):o.skypetoken&&(e.setTokenDataToCache(o.skypetoken,o.expires_in,!1),s(o.skypetoken)),i(new Error("Neither token nor skypeToken in the response"))}};v.SKYPE.login.Silent.init(r).load()}),this._silentLoginPromise},t.prototype.callExternalHandler=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(e&&"function"==typeof e)try{e.apply(null,[].slice.call(arguments,1))}catch(e){}},t.prototype.formatError=function(e){var t;return e instanceof Error?t=Object.create(e):"string"==typeof e?t=new Error(e):(t=new Error("Unknown: please check *data* property for more info")).data=e,t.name="SWCApi:signin:"+t.name,t},t.prototype.reset=function(){this.clearUserDataFromCache(),this._signOutContext.reset(),this._guestUserPromise=null,this._silentLoginPromise=null,this._signedIn=!1,this._tokenData=null,this.currentUsername="",this._getTokenPromise&&this._getTokenPromise.status===l.PromiseStatus.Pending&&this._getTokenPromise.cancel(),this._getTokenPromise=null,this._aad=null,this._tokenRenovationTimeout&&(this._tokenRenovationTimeout.reset(),this._tokenRenovationTimeout=null)},t.prototype.isAadSupported=function(){return!!this.outerTokenProvider&&this.tokenType===S.TokenType.Aad},t.prototype.setTeamsUrls=function(e){e&&(s.Configuration.CHAT_HOST_URL=e.chatService+"/v1/",s.Configuration.CHAT_GUEST_HOST_URL=e.chatService+"/v1/",s.Configuration.AMS_HOST_URL=e.ams+"/v1/",s.Configuration.AVATAR_SERVICE_URL=e.mtImageService,s.Configuration.TEAMS_MIDDLE_TIER_URL=e.middleTier)},t.prototype._signInWithAadSkypetokens=function(e,t){void 0===t&&(t=!1),this.setTeamsUrls(e.regionGtms),o.default.get.backend=f.MessagingBackend.TEAMS,this.setTokenDataToCache(e.tokens.skypeToken,e.tokens.expiresIn,t),this.currentUsername=this._tokenParser.retrieveMeName(e.tokens.skypeToken),this.state=e.tokens.skypeToken?u.SigninState.SignedIn:u.SigninState.SignedOut,this._lastAuthSource=c.AuthSource.AAD,this._userIdentityType=d.IdentityType.SKYPE,this.sendSignedInTelemetry(e.tokens.skypeToken,"aad",Date.now())},t.prototype._getSkypeTokenFromAad=function(){var e=this;return this.teamsTokenPromise?this.teamsTokenPromise:this.teamsRemoteTokenExchange?(this.teamsTokenPromise=this.teamsRemoteTokenExchange.tokenProviderCallback().then(function(t){return e._signInWithAadSkypetokens(t),t.tokens.skypeToken}),this.teamsTokenPromise):(this.teamsTokenPromise=new Promise(function(t,n){var i=function(t){e.clearUserDataFromCache(),e.state=u.SigninState.SignedOut,e.sendSignedInTelemetry(null,"aad",Date.now()),n()};e.outerTokenProvider(P.AadAudience.SpacesApi).then(function(n){-1===n.indexOf("Bearer")&&(n="Bearer "+n),g.default.exchangeForSkypeToken(n).then(function(n){n.json?n.json().then(function(n){n.tokens?(e.setTeamsUrls(n.regionGtms),e.setTokenDataToCache(n.tokens.skypeToken,n.tokens.expiresIn,!1),e.currentUsername=e._tokenParser.retrieveMeName(n.tokens.skypeToken),e.state=n.tokens.skypeToken?u.SigninState.SignedIn:u.SigninState.SignedOut,e._lastAuthSource=c.AuthSource.AAD,e._userIdentityType=d.IdentityType.SKYPE,e.sendSignedInTelemetry(n.tokens.skypeToken,"aad",Date.now()),t(n.tokens.skypeToken)):i()},i):i()},i)},function(e){})}),this.getSkypeToken=this._skypeTokenBasedOnAad.bind(this),this.teamsTokenPromise)},t.prototype._skypeTokenBasedOnAad=function(){var e=this;return this.teamsTokenPromise.then(function(t){var n=Date.now()+6e4;return e.getTokenExpirationTime()<=n?(e.teamsTokenPromise=void 0,e._getSkypeTokenFromAad()):t})},t}(p.default);t.default=k},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var n=this;this.execCallback=function(){if(n._callback){var e=n.reset.bind(n);return n._callback().then(e,e)}return n.reset(),Promise.resolve()},this.reset=function(){n._callback=null,n._toRelogin=!1},this.setContext(e,t)}return e.prototype.setContext=function(e,t){this._toRelogin=e,this._callback=t},Object.defineProperty(e.prototype,"canRelogin",{get:function(){return this._toRelogin},enumerable:!0,configurable:!0}),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.Cache=10]="Cache",e[e.SilentLogin=20]="SilentLogin",e[e.Popup=30]="Popup",e[e.Guest=40]="Guest",e[e.UserLogout=50]="UserLogout",e[e.External=60]="External",e[e.WX=70]="WX",e[e.AAD=80]="AAD"}(t.AuthSource||(t.AuthSource={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o={retryCount:3,timeout:12e4,policy:""},s=function(){function e(){}return e.exchangeForSkypeToken=function(e){var t={method:"post",headers:{Authorization:e,"x-ms-client-type":"web","x-ms-user-type":"user"}};return r.default("teams-exchange",o,i.Configuration.TEAMS_AUTH_URL+"/authz",t)},e.fetchGuestTokenForTenant=function(e){var t={method:"post",body:JSON.stringify({tenantId:e})};return r.default("teams-anonymout",o,i.Configuration.TEAMS_AUTH_URL+"/authz/visitor",t)},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(10),o={retryCount:3,timeout:12e4,policy:""};t.getGuestToken=function(e){var t={name:e};return new Promise(function(e,n){(function(e,t,n){var s={};s.method=e,s.body=JSON.stringify(n);var a=new Headers;return a.append("Content-Type","application/json"),a.append("X-Skype-Caller",i.Configuration.getUiVersion()),s.headers=a,r.default("scom-invite",o,i.Configuration.INVITE_HOST_URL+t,s)})("POST","users/guests/lwc",t).then(function(t){t.json().then(function(t){e(t)}).catch(function(e){n(e)})},function(e){n(e)})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.isRelogin=!1}return e.prototype.reset=function(){this.isRelogin=!1,this.signoutPromise=null},e}();t.default=i},function(e,t){!function(){"use strict";var e,t,n,i,r,o,s,a,c,u,l,p,d,f,h,g,m,v,y;void 0===window.SKYPE&&(window.SKYPE={}),window.SKYPE.login=window.SKYPE.login||{},window.SKYPE.login.Silent=(n={qa:"https://a.qa.lw.skype.net",live:"https://a.lw.skype.com"},i=null,r={},o=null,s=null,a="",c=!1,u=!1,l=null,p={env:"live",client_id:null,redirect_uri:null},d=function(e,t){if(null===l&&(l=window.location.host.match(/^(pre|dev|qa).*\.net$/)||document.cookie.indexOf("debug")>-1||window.location.search.indexOf("debug")>-1),l)try{if("object"==typeof t){var n=[];for(var i in t)"skypetoken"===i?n.push(i+": <HIDDEN>"):n.push(i+": "+JSON.stringify(t[i]));e+=" - "+n.join(", ")}else"string"==typeof t&&(e+=" - "+t);e="[silentlogin.js] - "+e}catch(e){}},f=function(e){if(d("Received message from "+e.origin),s&&e.origin===s){var t=e.data;if("string"==typeof e.data)try{t=JSON.parse(e.data)}catch(e){}d("Message data",t);var n=t.state||null;if(a===n){for(var i in window.clearTimeout(o),r={},t)t.hasOwnProperty(i)&&(r[i]=t[i]);g()}else d("State "+n+" doesn't match the last submitted state "+a)}},h=function(){i&&(e.removeChild(i),i=null)},g=function(){d("Calling callback function",r),u=!1,"function"==typeof t&&t(r)},m=function(){h(),(r={}).error="timeout",g()},v=function(){var e=(new Date).getTime(),t=n;a="silentloginsdk_"+e;var i={response_type:"postmessage",client_id:p.client_id,partner:"999",redirect_uri:p.redirect_uri,state:a,_accept:"1.0",_nc:e};return(s=t[p.env]||t.live)+"/login/silent?"+function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}(i)},{init:function(e){if("object"==typeof e)for(var t in(e=e||{}).hasOwnProperty("callback")&&y(e.callback),p)e.hasOwnProperty(t)&&(p[t]=e[t]);return c||(c=!0,window.addEventListener?window.addEventListener("message",f,!1):window.attachEvent("onmessage",f)),this},setCallback:y=function(e){return"function"==typeof e&&(t=e),this},load:function(){if(!u){if(function(){if(!p.client_id)throw"[silentlogin.js] client_id not initialized. Call init() first.";p.redirect_uri||(p.redirect_uri=window.location.protocol+"//"+window.location.host+window.location.pathname)}(),u=!0,!("postMessage"in window&&"object"==typeof JSON&&JSON.parse))return r={error:"unsupported_browser"},void g();var t;window.clearTimeout(o),o=window.setTimeout(m,2e4),t=v(),h(),void 0===e&&(e=document.body||document.head||document.getElementsByTagName("head")[0]),(i=document.createElement("iframe")).frameBorder=0,i.width="1px",i.height="1px",i.style.display="none",i.style.visibility="hidden",i.id="silentLoginFrame"+Math.floor(10*Math.random()+1),i.setAttribute("src",t),e.appendChild(i),d("Created iFrame: "+t)}},getSkypetoken:function(){return r.skypetoken||null},getFullResponse:function(){return r}})}()},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(40),o=n(0),s=n(50),a=n(94),c=n(78),u=function(){function e(e){this._callInfo=e}return Object.defineProperty(e.prototype,"callId",{get:function(){return this._callInfo.callId},enumerable:!0,configurable:!0}),e.prototype.getNotification=function(){var t=new c.Notification("Calling");return t.title=this._callInfo.displayName||"",t.description="Incoming call",t.avatarUrl=this._callInfo.avatar,t.callInfo=this._callInfo,t.actionsInformation=e.getActionsInformation(),t},e.getActionsInformation=function(){return{accept:{title:o.swc.services.i18n.fetch("open"),description:o.swc.services.i18n.fetch("accept_descr")},ignore:{title:o.swc.services.i18n.fetch("ignore"),description:o.swc.services.i18n.fetch("ignore_descr")}}},e.getActions=function(e,t){return[{type:"Accept",title:e.actionsInformation.accept.title,description:e.actionsInformation.accept.description,action:function(){var n=e.callInfo.mri;(a.isEnterpriseUserMri(n)?a.generateOneToOneConversationId(n):Promise.resolve(n)).then(function(a){var c=i({},t,{ConversationId:a||""}),u={id:e.callInfo.callId,accept:!0,callerMri:n||""};s.default.startChat(a,c,!1,r.OpenChatOrigin.NOTIFICATION,u),o.swc.Telemetry.sendEvent.notificationAction("Calling","Accept")})}},{type:"Ignore",title:e.actionsInformation.ignore.title,description:e.actionsInformation.ignore.description,action:function(){var t={id:e.callInfo.callId,reject:!0,callerMri:e.callInfo.callerMri||""};o.swc.Eventing.triggerEvent("rejectCall",t),o.swc.Telemetry.sendEvent.notificationAction("Calling","Ignore")}}]},e}();t.default=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),s=n(0),a=n(81),c=n(5),u=n(78),l=/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)/,p=function(e){function t(n){var i=e.call(this,"Summary")||this;return i.description=s.swc.services.i18n.fetch("notification_summary",{count:n.length}),i.avatarUrl=i.getSummaryAvatar(n)||o.Configuration.DEFAULT_AVATAR_URI,t.isEnabled=!1,t.setIgnoreToStorage(),i.actionsInformation=t.getActionsInformation(),i}return r(t,e),t.prototype.getSummaryAvatar=function(e){var t=e.filter(function(e){return!e.isGroup}),n=t.length>0?t[0]:e[0];if(n.avatar&&n.avatar.match(l))return n.avatar;var i=n.isGroup?void 0:n.id.replace(/^\d+:/,""),r=i?encodeURIComponent(i):"thread",o="https://avatar.skype.com/v1/"+"avatars/${contactId}/public?returnDefaultImage=false&cacheHeaders=true".replace("${contactId}",r);return o=o.replace("returnDefaultImage=false","returnDefaultImage=true")},t.getActionsInformation=function(){return{accept:{title:s.swc.services.i18n.fetch("open"),description:s.swc.services.i18n.fetch("open_client_descr")},ignore:{title:s.swc.services.i18n.fetch("ignore"),description:s.swc.services.i18n.fetch("ignore_summary_notificaton_descr")}}},t.getActions=function(e){return[{type:"Accept",title:e.actionsInformation.accept.title,description:e.actionsInformation.accept.description,action:function(){s.swc.Eventing.triggerEvent("openRecentList"),s.swc.Telemetry.sendEvent.notificationAction("Summary","Accept")}},{type:"Ignore",title:e.actionsInformation.ignore.title,description:"",action:function(){s.swc.Telemetry.sendEvent.notificationAction("Summary","Ignore")}}]},t.setIgnoreToStorage=function(){try{var e=60*(o.Configuration.ECS.sumToastDelayMin||0)*1e3,t={ignoreUntil:Date.now()+(0===e?864e5:e),id:a.hashCode(c.ServicesManager.signInManager.currentUserName)};c.ServicesManager.localStorage.setItem("swc|notificationIgnore",JSON.stringify(t))}catch(e){}},t.isIgnored=function(){try{var e=c.ServicesManager.localStorage.getItem("swc|notificationIgnore"),t=a.hashCode(c.ServicesManager.signInManager.currentUserName);if(e){var n=JSON.parse(e);if(!n.id||n.id!==t)return c.ServicesManager.localStorage.removeItem("swc|notificationIgnore"),!1;if(!n.ignoreUntil||isNaN(n.ignoreUntil))return!1;if(n.ignoreUntil>Date.now())return!0}return!1}catch(e){return!1}},t.isEnabled=!0,t}(u.Notification);t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),r=n(148),o=n(149),s=function(){function e(){this.freshUnreadConversations={}}return e.prototype.getNotification=function(e,t){if(!this.canShow(e,t))return null;if(!this.isAllowedByUnread(e)){if(3===this.freshUnreadConversations[e.id]){var n=Object.getOwnPropertyNames(this.freshUnreadConversations).map(function(e){return i.ServicesManager.conversations.get(e)});return new r.default(n,e)}return null}var s=new o.UnreadMessageNotification(e,t);return s&&s.description?s:null},e.prototype.canShow=function(e,t){return!e.isBlocked&&(e.isUnread&&!e.alertsOff)},e.prototype.isAllowedByUnread=function(e){var t=this;if(!this.freshUnreadConversations.hasOwnProperty(e.id)){var n=function(i){i||(delete t.freshUnreadConversations[e.id],e.unsubscribe("isUnread",n))};return e.subscribe("isUnread",n),this.freshUnreadConversations[e.id]=0,!0}return this.freshUnreadConversations[e.id]++,this.freshUnreadConversations[e.id]<3},e}();t.default=s},,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(41),r=n(162),o=n(172);function s(){return!(Array.prototype.find&&Element.prototype.matches&&Object.assign&&window.CustomEvent&&window.Promise&&NodeList.prototype.forEach)}t.shouldPolyfill=s,t.initPolyfills=function(e,t){s()&&!window.polyfillsLoadedCallback?(window.polyfillsLoadedCallback=e,r.addScript(o.getBundleUri(i.PackageName.POLYFILLS,t),!0)):e()}},,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(45),o=function(){function e(){var e=this;this.buffer=[],this.targets={},this.registry={},this.receiver=function(t){var n=t.data;n&&n.origin&&e.testOrigin(n.origin)&&n.name&&e.triggerEvent(n.name,n.payload,!0,!0,null,n.origin)}}return e.prototype.testOrigin=function(e){return this.origin!==e},e.prototype.post=function(e,t){try{r.swcPostMessage(this.targets[e].target,t,this.targets[e].targetDomain)}catch(e){}},e.prototype.cast=function(e,t,n,i){var r=this,o={name:e,origin:this.origin,payload:t};n?Array.isArray(n)?n.forEach(function(e){return r.post(e,o)}):this.post(n,o):Object.keys(this.targets).forEach(function(e){return i!==r.targets[e].origin&&r.post(e,o)})},e.prototype.exists=function(e){return!!this.registry[e]},e.prototype.copy=function(e){var t=this;e&&e.registry&&Object.getOwnPropertyNames(e.registry).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e.registry,n);i&&i.writable&&(t.registry[n]=i.value||t.registry[n])})},e.prototype.addTarget=function(e,t,n,i){this.targets[e]=this.targets[e]||{target:i,origin:t,targetDomain:n}},e.prototype.removeTarget=function(e){delete this.targets[e]},e.prototype.connect=function(e){this.origin=this.origin||e,this.connected||(window.addEventListener("message",this.receiver),this.connected=!0)},e.prototype.disconnect=function(){window.removeEventListener("message",this.receiver),this.connected=!1},e.prototype.registerEvent=function(e,t){if(e&&t){var n=this.registry;if(n[e]){if(-1!==n[e].indexOf(t))return}else n[e]=[];n[e].push(t)}},e.prototype.unregisterEvent=function(e,t){if(e&&t){var n=this.registry;if(n[e]&&n[e].length){var i=n[e].indexOf(t);-1!==i&&n[e].splice(i,1)}}},e.prototype.secure=function(){i.swc.secured&&this.castBuffer()},e.prototype.castBuffer=function(){for(;this.buffer.length;){var e=this.buffer.pop();this.cast(e.name,e.payload,null,e.origin)}},e.prototype.triggerLocalEvent=function(e,t){return this.triggerEvent(e,t,!0,!1)},e.prototype.triggerEvent=function(e,t,n,i,r,o){void 0===i&&(i=!0),this.connected&&i&&this.cast(e,t,r,o);var s=!1,a=this.registry;return a[e]&&a[e].forEach(function(e){try{e(t),s=!0}catch(e){}}),s},e.prototype.dispose=function(){for(var e in this.registry)this.registry.hasOwnProperty(e)&&delete this.registry[e];this.disconnect()},e}();t.Eventing=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.alias=function(t,n,i,r){var o=e.pathToArray(n),s=o.pop(),a=e.build(o,i);return a[s]=r?t:a[s]||t},e.build=function(t,n){var i=n||window;return e.pathToArray(t).forEach(function(e){return i=i[e]=i[e]||{}}),i},e.pathToArray=function(e){return e instanceof Array?e:e.split(".")},e}();t.default=i},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(){this.skypeLogo=n(354),this.iconSkype=n(355),this.iconLogoMicrosoft=n(356),this.iconDock=n(357),this.iconUndock=n(358),this.iconChats=n(359)}}();t.SVG=new i},function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 220 80">\r\n    <path d="M90 57.3v-4.9c.6.5 1.2.9 2 1.3s1.6.7 2.5 1c.9.3 1.7.5 2.6.6.9.1 1.7.2 2.4.2 2.5 0 4.4-.5 5.7-1.4 1.3-.9 1.9-2.3 1.9-4.1 0-1-.2-1.8-.6-2.5-.4-.7-1-1.4-1.7-1.9-.7-.6-1.6-1.1-2.6-1.7-1-.5-2.1-1.1-3.2-1.7-1.2-.6-2.4-1.3-3.4-1.9-1.1-.6-2-1.3-2.8-2.1-.8-.8-1.4-1.6-1.9-2.6s-.7-2.1-.7-3.4c0-1.6.4-3 1.1-4.2.7-1.2 1.6-2.2 2.8-2.9 1.1-.8 2.4-1.3 3.9-1.7 1.5-.4 3-.6 4.5-.6 3.5 0 6 .4 7.6 1.3v4.7c-2.1-1.4-4.7-2.2-8-2.2-.9 0-1.8.1-2.7.3-.9.2-1.7.5-2.4.9s-1.3 1-1.7 1.7c-.4.7-.7 1.5-.7 2.5 0 .9.2 1.7.5 2.3.3.7.8 1.3 1.5 1.8s1.5 1.1 2.4 1.6c.9.5 2 1.1 3.2 1.7 1.3.6 2.5 1.3 3.6 2s2.1 1.5 3 2.3c.9.8 1.5 1.8 2 2.8.5 1 .7 2.2.7 3.5 0 1.7-.3 3.2-1 4.4-.7 1.2-1.6 2.2-2.7 2.9-1.2.8-2.5 1.3-4 1.6-1.5.3-3.1.5-4.8.5-.6 0-1.2 0-2.1-.1-.8-.1-1.7-.2-2.5-.4s-1.7-.4-2.4-.6c-1-.4-1.6-.7-2-1m45.7 1.4H130l-11-12.1h-.1v12.1h-4.1V21.3h4.1V45h.1l10.5-11.6h5.3l-11.7 12.2zm23.7-25.3l-11.5 29.3c-2.1 5.2-5 7.8-8.7 7.8-1 0-1.9-.1-2.6-.3v-3.6c.9.3 1.7.4 2.4.4 2 0 3.5-1.2 4.6-3.6l2-4.8-9.8-25.2h4.5l6.8 19.4c.1.2.3.9.5 1.9h.1c.1-.4.2-1 .5-1.9l7.1-19.5h4.1zm6.3 11.5v3.5c0 2.1.7 3.9 2 5.3 1.4 1.5 3.1 2.2 5.1 2.2 2.4 0 4.3-.9 5.7-2.8 1.4-1.9 2.1-4.5 2.1-7.8 0-2.8-.6-5-1.9-6.6-1.3-1.6-3-2.4-5.2-2.4-2.3 0-4.2.8-5.6 2.5-1.5 1.5-2.2 3.6-2.2 6.1m.1 10.1l-.1 15.3h-4V33.4h4v4.4h.1c2-3.4 4.9-5 8.7-5 3.2 0 5.8 1.1 7.6 3.4 1.8 2.3 2.7 5.3 2.7 9.1 0 4.2-1 7.6-3.1 10.1-2 2.5-4.8 3.8-8.4 3.8-3.2.1-5.8-1.3-7.5-4.2M205 43.7c0-2.3-.6-4.2-1.7-5.5-1.1-1.3-2.6-1.9-4.6-1.9-1.9 0-3.5.7-4.8 2-1.3 1.4-2.1 3.1-2.5 5.4H205zm4.1 3.4h-17.7c.1 2.8.8 5 2.3 6.5 1.4 1.5 3.4 2.3 5.9 2.3 2.8 0 5.4-.9 7.8-2.8v3.8c-2.2 1.6-5.1 2.4-8.8 2.4-3.5 0-6.3-1.1-8.4-3.4-2-2.3-3-5.5-3-9.7 0-3.9 1.1-7.1 3.3-9.6 2.2-2.5 5-3.7 8.3-3.7 3.3 0 5.8 1.1 7.6 3.2 1.8 2.1 2.7 5.1 2.7 8.9v2.1zM41.4 59.2c-10.1 0-14.7-5.1-14.7-8.9 0-1.9 1.5-3.3 3.5-3.3 4.3 0 3.2 6.5 11.3 6.5 4.1 0 6.5-2.5 6.5-4.8 0-1.4-.8-3-3.5-3.6l-9-2.3C28.3 41 27 36.9 27 33.2c0-7.7 7.1-10.5 13.8-10.5 6.2 0 13.6 3.4 13.6 8.1 0 2-1.7 3.1-3.6 3.1-3.7 0-3.1-5.2-10.5-5.2-3.7 0-5.6 1.7-5.6 4.1 0 2.4 2.9 3.2 5.4 3.8l6.6 1.5c7.3 1.6 9.2 5.9 9.2 10 0 6.2-4.9 11.1-14.5 11.1m27.9-13.4c.3-1.6.4-3.3.4-5C69.7 25 57 12.2 41.3 12.2c-1.7 0-3.3.1-4.9.4-2.5-1.4-5.3-2.2-8.4-2.2-9.3 0-16.9 7.6-16.9 17 0 3.1.8 5.9 2.2 8.4-.3 1.6-.4 3.3-.4 5 0 15.8 12.7 28.6 28.4 28.6 1.7 0 3.3-.1 4.9-.4 2.5 1.4 5.3 2.2 8.4 2.2 9.3 0 16.9-7.6 16.9-17 0-3-.8-5.9-2.2-8.4"/>\r\n</svg>\r\n'},function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" class="icon logo" viewBox="0 0 200 200">\r\n    <path d="M1933 623 Q1933 519 1892.5 426.5 Q1852 334 1783 265 Q1714 196 1621.5 155.5 Q1529 115 1425 115 Q1360 115 1298 131 Q1236 147 1179 179 Q1100 165 1024 165 Q906 165 796.5 196 Q687 227 591.5 283 Q496 339 417.5 417.5 Q339 496 283 591.5 Q227 687 196 796.5 Q165 906 165 1024 Q165 1100 179 1179 Q147 1236 131 1298 Q115 1360 115 1425 Q115 1529 155.5 1621.5 Q196 1714 265 1783 Q334 1852 426.5 1892.5 Q519 1933 623 1933 Q688 1933 750 1917 Q812 1901 869 1869 Q948 1883 1024 1883 Q1142 1883 1251.5 1852 Q1361 1821 1456.5 1765 Q1552 1709 1630.5 1630.5 Q1709 1552 1765 1456.5 Q1821 1361 1852 1251.5 Q1883 1142 1883 1024 Q1883 948 1869 869 Q1901 812 1917 750 Q1933 688 1933 623 Z M1462 807 Q1462 885 1434.5 938.5 Q1407 992 1362 1027 Q1317 1062 1259.5 1083 Q1202 1104 1141.5 1118 Q1081 1132 1023.5 1142.5 Q966 1153 921 1167.5 Q876 1182 848.5 1204.5 Q821 1227 821 1264 Q821 1298 837.5 1321.5 Q854 1345 879.5 1359.5 Q905 1374 935.5 1380.5 Q966 1387 994 1387 Q1044 1387 1080 1375.5 Q1116 1364 1143 1347 Q1170 1330 1190.5 1309.5 Q1211 1289 1229.5 1272 Q1248 1255 1266.5 1243.5 Q1285 1232 1309 1232 Q1329 1232 1349 1238.5 Q1369 1245 1384.5 1257 Q1400 1269 1409.5 1286.5 Q1419 1304 1419 1326 Q1419 1368 1398 1402 Q1377 1436 1342.5 1463 Q1308 1490 1264.5 1510 Q1221 1530 1175.5 1543 Q1130 1556 1086.5 1562.5 Q1043 1569 1010 1569 Q936 1569 861 1552 Q786 1535 725.5 1497 Q665 1459 627 1398.5 Q589 1338 589 1251 Q589 1175 616 1124 Q643 1073 687.5 1039 Q732 1005 789 985 Q846 965 905 950.5 Q964 936 1021 924.5 Q1078 913 1122.5 896.5 Q1167 880 1194 855 Q1221 830 1221 790 Q1221 754 1202 728 Q1183 702 1154.5 685.5 Q1126 669 1092 661 Q1058 653 1028 653 Q972 653 933 667 Q894 681 866 702 Q838 723 817.5 747 Q797 771 778 792 Q759 813 738 827 Q717 841 688 841 Q667 841 649 833.5 Q631 826 617 812.5 Q603 799 595 781 Q587 763 587 742 Q587 692 609 653 Q631 614 666.5 585 Q702 556 748.5 536 Q795 516 844 503.5 Q893 491 941 485.5 Q989 480 1028 480 Q1106 480 1183.5 497 Q1261 514 1323 552.5 Q1385 591 1423.5 653.5 Q1462 716 1462 807 Z " transform="scale(0.1, -0.1) translate(0, -2000)"/>\r\n</svg>\r\n'},function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200">\r\n    <path d="M2048 1087 L1087 1087 L1087 2048 L2048 2048 L2048 1087 Z M961 1087 L0 1087 L0 2048 L961 2048 L961 1087 Z M2048 0 L1087 0 L1087 961 L2048 961 L2048 0 Z M961 0 L0 0 L0 961 L961 961 L961 0 Z " transform="scale(0.1, -0.1) translate(0, -2000)"/>\r\n</svg>\r\n'},function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" class="dock" viewBox="0 0 34 34">\r\n    <g fill="white" fill-rule="nonzero">\r\n        <path d="M24.8 9.2c-.1-.1-.3-.3-.5-.4-.2-.1-.4-.1-.7-.1H2c-.2 0-.5 0-.7.1-.1.1-.3.2-.5.4s-.3.3-.4.5c-.1.2-.1.4-.1.7V32c0 .5.2.9.5 1.2.3.3.7.5 1.2.5h21.6c.2 0 .5 0 .7-.1.2-.1.4-.2.5-.4.1-.2.3-.3.4-.5.1-.2.1-.4.1-.7V10.3c0-.2 0-.5-.1-.7-.1-.2-.2-.3-.4-.4zM22 13.7v16.7H3.7V12H22v1.7zM26.9.3h1.7V2h-1.7zM17 .3h1.7V2H17zM20.3.3H22V2h-1.7zM23.6.3h1.7V2h-1.7zM13.7 3.7h1.7v1.7h-1.7zM15.3 2V.3h-.2c-.4 0-.7.1-1 .4-.3.3-.4.6-.4 1V2h1.6zM32 2V.3h-1.7V2H32v1.7h1.7V2M32 5.3h1.7V7H32zM32 8.7h1.7v1.7H32zM32 12h1.7v1.6H32zM32 15.3h1.7V17H32zM28.7 18.7h1.7v1.7h-1.7zM32 18.7v1.7h.2c.4 0 .7-.1 1-.4.3-.3.4-.6.4-1v-.2H32v-.1z"/>\r\n    </g>\r\n</svg>\r\n'},function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" class="undock" viewBox="0 0 24 24">\r\n    <g fill="none" fill-rule="evenodd">\r\n        <path stroke="white" stroke-linecap="square" stroke-width="1" d="M5 5h14M5 19h14M19 5v14M5 5v14"/>\r\n        <path fill="white" stroke="white" stroke-linecap="square" stroke-width="1" d="M12 11h7v7h-7z"/>\r\n    </g>\r\n</svg>\r\n'},function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 91 83">\r\n\t<path fill-rule="evenodd" d="M17 52v13l11-11v8L11 79V58H0V1h80v23h-6V6H6v46h11zm17-23h57v40H80v15L64 69H34V29zm51 34V35H40v28h27l7 8v-8h11z"/>\r\n</svg>\r\n'},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(25),r=n(350),o=n(351),s=n(3),a=n(353),c=n(170),u=n(77),l=n(41),p=n(336),d=n(5),f=n(174),h=n(0),g=n(596),m=n(22),v=n(598),y=o.default.build("SkypeWebControl",window);!function(){var e=function(){h.swc.Eventing=h.swc.Eventing||new r.Eventing,h.swc.Eventing.connect("services"),o.default.alias(a.SVG,"Assets.SVG",h.swc);var e=function(){return v.vendorLoader.preloadDeps().then(function(){y.services=y.services||d.ServicesManager,h.swc.Eventing.registerEvent("services:init",function(e){return e&&function(e){e&&(e.tokenProvider&&(e.tokenProvider=g.createClientFromPlaceHolder(e.tokenProvider)),e.enterpriseAuth&&(e.enterpriseAuth={skypetokenProvider:g.createClientFromPlaceHolder(e.enterpriseAuth.skypetokenProvider),regionGtmsProvider:g.createClientFromPlaceHolder(e.enterpriseAuth.regionGtmsProvider)})),u.default.initServices(e),h.swc.services.signInManager.onceSignedIn().then(function(){return h.swc.services.polling.authorization.then(function(){})}),h.swc.services.initManagers(s.default.get.getCurrentLocale(),{tokenProvider:e.skypeTokenProvider||e.tokenProvider,initialToken:e.initialSkypeTokenData,externalLogin:e.externalLogin,tokenType:e.tokenType,enterpriseAuth:e.enterpriseAuth},{fileSharing:e.fileSharing,userSettings:e.userSettings}).then(function(){u.default.instance.SignInManager,h.swc.services.persons,i.AbilityHelpers.announcer.setup({title:h.swc.services.i18n.fetch("recent_notification_announcements")}),i.AbilityHelpers.outline.setup({areaClass:"swc-focus-outline-area"}),h.swc.Eventing.triggerEvent("services:ready")})}(e)}),h.swc.Eventing.registerEvent("createModule",function(e){var t="";switch(e.module){case c.ModuleType.Calling:t=l.PackageName.CALLING_STANDALONE;break;case c.ModuleType.Recents:t=l.PackageName.RECENTS_BUNDLE;break;case c.ModuleType.Messaging:default:t=l.PackageName.CHAT_BUNDLE}if(t){h.swc.options=h.swc.options||{},h.swc.options[e.module]=e.options;var n=m.UrlHelper.getAbsoluteUrl(t,"js",h.swc.EcsConfig);h.swc.scriptLoader.addScript(n)}}),h.swc.Eventing.triggerEvent("services:loaded",null,!0)})};if(h.swc.Telemetry)e();else{var t=m.UrlHelper.getAbsoluteUrl(l.PackageName.TELEMETRY_BUNDLE,"js",h.swc.EcsConfig);h.swc.scriptLoader.addScript(t,function(){var t=f.createTelemetryConfigFromEcs(h.swc.EcsConfig);h.swc.Telemetry.init(h.swc.initSettings.environment,t),window.swc.Telemetry=h.swc.Telemetry,e()})}},t=function(){};if(h.swc.framed){t=function(){var t=h.swc.EcsConfig.enableExtendedFrameApiOn;t&&-1!==t.indexOf(h.swc.initSettings.parent)&&(h.swc.isTrustedHost=!0),e(),s.default.get.frameless=!1,parent&&h.swc.Eventing.addTarget("core","core",h.swc.initSettings.parent,parent)}}else e();p.initPolyfills(t)}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(597);t.createClientFromPlaceHolder=function(e){if("string"==typeof e&&0===e.indexOf("command_createBridgeClient"))try{var t=e.split("##"),n=(t[0],t[1]);return i.createBridgeClient(n)}catch(e){}return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(12);t.createBridgeClient=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new Promise(function(n){var o={requestId:r.guid.generate(),args:t};i.swc.Eventing.registerEvent(e+":response",function(e){e.requestId===o.requestId&&n(e.value)}),i.swc.Eventing.triggerEvent(e+":request",o)})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(41),r=n(0),o=n(22),s=new(function(){function e(){}return e.prototype.preloadDeps=function(){if(this.loadPromise)return this.loadPromise;var e=o.UrlHelper.getAbsoluteUrl(i.PackageName.VENDORS,"js",r.swc.EcsConfig);return this.loadPromise=new Promise(function(t,n){r.swc.scriptLoader.addScript(e,t,n)}),this.loadPromise},e}());t.vendorLoader=s}]);